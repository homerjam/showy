!function t(e,i,n){function r(a,o){if(!i[a]){if(!e[a]){var h="function"==typeof require&&require;if(!o&&h)return h(a,!0);if(s)return s(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var _=i[a]={exports:{}};e[a][0].call(_.exports,function(t){var i=e[a][1][t];return r(i?i:t)},_,_.exports,t,e,i,n)}return i[a].exports}for(var s="function"==typeof require&&require,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(t){"use strict";window.Showy=t("./src/showy")["default"]},{"./src/showy":2}],2:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a="forwards",o="backwards",h=function(){function t(e){n(this,t);var i={container:"body",slides:[],glslTransitions:{},transition:{name:"slide",duration:2e3,ease:"linear",priority:0}};this.config=_.merge({},i,e),this.container="string"==typeof this.config.container?document.querySelector(this.config.container):this.config.container,this._slides=this.config.slides,this._currentSlideIndex=this._transitionToIndex=0,this._transitionProgress=0,this._imageMap={},this._videoMap={},this._slideContentMap={},this._createCanvases(),this.transition=this._getTransition(),window.addEventListener("resize",this.resize.bind(this)),this._lastFrameTime=0,window.requestAnimationFrame(this._animate.bind(this))}return s(t,[{key:"nextSlide",value:function(){this._transitionDirection=a,this._transitionToIndex=this._transitionToIndex===this._currentSlideIndex-1||this._transitionToIndex===this._slides.length-1&&0===this._currentSlideIndex?this._currentSlideIndex:this._currentSlideIndex===this._slides.length-1?0:this._currentSlideIndex+1}},{key:"prevSlide",value:function(){this._transitionDirection=o,this._transitionToIndex=this._transitionToIndex===this._currentSlideIndex+1||0===this._transitionToIndex&&this._currentSlideIndex===this._slides.length-1?this._currentSlideIndex:0===this._currentSlideIndex?this._slides.length-1:this._currentSlideIndex-1}},{key:"_animate",value:function(t){this._fps=1e3/(t-this._lastFrameTime);try{this._drawSlides(),window.requestAnimationFrame(this._animate.bind(this))}catch(e){console.error(e.stack)}this._lastFrameTime=t}},{key:"_createCanvas",value:function(){var t=document.createElement("canvas");return t.style.position="absolute",t.style.width="100%",t.style.height="100%",this._resizeCanvas(t),t}},{key:"_createCanvases",value:function(){this._currentCanvas=this._createCanvas(),this._currentContext=this._currentCanvas.getContext("2d"),this._nextCanvas=this._createCanvas(),this._nextContext=this._nextCanvas.getContext("2d"),this._prevCanvas=this._createCanvas(),this._prevContext=this._prevCanvas.getContext("2d"),this._renderCanvas=this._createCanvas(),this._renderContext=this._renderCanvas.getContext("webgl")||this._renderCanvas.getContext("experimental-webgl"),this._renderContext.pixelStorei(this._renderContext.UNPACK_FLIP_Y_WEBGL,!0),this.container.appendChild(this._renderCanvas)}},{key:"_resizeCanvas",value:function(t){this._scale=window.devicePixelRatio,t.width=this.container.clientWidth*this._scale,t.height=this.container.clientHeight*this._scale}},{key:"resize",value:function(){this._slideContentMap={},this._resizeCanvas(this._currentCanvas),this._resizeCanvas(this._nextCanvas),this._resizeCanvas(this._prevCanvas),this._resizeCanvas(this._renderCanvas),this._drawSlides(!0)}},{key:"_clearContext",value:function(t){t.clearRect(0,0,t.canvas.width,t.canvas.height)}},{key:"_transitionInProgress",value:function(){return this._transitionProgress>0&&this._transitionProgress<1}},{key:"_getTransition",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=_.merge({},this.config.transition,t||{}),n=_.merge({},this.config.transition,e||{});return i.glsl=this.config.glslTransitions[i.name],n.glsl=this.config.glslTransitions[n.name],i.priority>=n.priority?i:n}},{key:"_drawSlides",value:function(t){var e=this._slides[this._currentSlideIndex],i=this._slides[this._currentSlideIndex===this._slides.length-1?0:this._currentSlideIndex+1],n=this._slides[0===this._currentSlideIndex?this._slides.length-1:this._currentSlideIndex-1],r=void 0;if(t&&(e._rendered=!1),e._hasVideo||!e._rendered||this._transitionInProgress()||this._currentSlideIndex!==this._transitionToIndex){if(this._drawSlide(this._currentContext,e),this._drawSlide(this._nextContext,i),this._drawSlide(this._prevContext,n),this._fromTexture&&this._fromTexture.dispose(),this._toTexture&&this._toTexture.dispose(),this._transitionToIndex!==this._currentSlideIndex||this._transitionInProgress()){(this._transitionToIndex!==this._currentSlideIndex&&this._transitionDirection===a||this._transitionToIndex===this._currentSlideIndex&&this._transitionDirection===o)&&(this._fromTexture=createTexture(this._renderContext,this._currentCanvas),this._toTexture=createTexture(this._renderContext,this._nextCanvas),r=this._getTransition(e.transitionNext,i.transitionPrev)),(this._transitionToIndex!==this._currentSlideIndex&&this._transitionDirection===o||this._transitionToIndex===this._currentSlideIndex&&this._transitionDirection===a)&&(this._fromTexture=createTexture(this._renderContext,this._prevCanvas),this._toTexture=createTexture(this._renderContext,this._currentCanvas),r=this._getTransition(e.transitionPrev,n.transitionNext));var s=60/r.duration;this._transitionDirection===a&&(this._transitionProgress=this._transitionInProgress()?this._transitionProgress+s:s),this._transitionDirection===o&&(this._transitionProgress=this._transitionInProgress()?this._transitionProgress-s:1-s),this._transitionProgress>1&&(this._transitionProgress=1),this._transitionProgress<0&&(this._transitionProgress=0)}else this._fromTexture=createTexture(this._renderContext,this._currentCanvas),this._toTexture=this._fromTexture;r&&this.transition.name!==r.name&&(this.transition=r,this._transition&&(this._transition.dispose(),this._transition=null)),this._transition||(this._transition=createTransition(this._renderContext,this.transition.glsl.glsl));var h=eases[this.transition.ease](this._transitionProgress);this._transition.render(h,this._fromTexture,this._toTexture,this.transition.glsl.uniforms),e._ready&&(e._rendered=!0),this._transitionToIndex===this._currentSlideIndex||this._transitionInProgress()||(this._currentSlideIndex=this._transitionToIndex,this._clearContext(this._currentContext),this._clearContext(this._nextContext),this._clearContext(this._prevContext))}}},{key:"_drawSlide",value:function(t,e){e._hasVideo=e.content.filter(function(t){return"video"===t.type}).length>0,e._rendered=!1,e._ready=!1,e.content.length&&this._drawSlideContent(t,e,0)}},{key:"_drawSlideContent",value:function(t,e,i){var n=e.content[i];if(!n)return void(e._ready=!0);var r=this._drawSlideContent.bind(this,t,e,i+1);switch(n.type){case"image":this._drawImage(t,n,r);break;case"video":this._drawVideo(t,n,r);break;default:throw new Error("Unknown content type")}}},{key:"_position2Pixels",value:function(t){var e=this,i=arguments.length<=1||void 0===arguments[1]?1:arguments[1],n=[];return t.forEach(function(t,r){var s=void 0,a=[e._currentCanvas.width,e._currentCanvas.height,e._currentCanvas.width,e._currentCanvas.height][r];a/=i,s=1>=t?2>r?t*a:t*a-n[r-2]:2>r?t:a-n[r-2]-t,n.push(s)}),{x:n[0]*i,y:n[1]*i,width:n[2]*i,height:n[3]*i}}},{key:"_updateCoords",value:function(t,e,i){var n=t.width/t.height,r=e.width/e.height;if(i&&"fill"===i){if(r>n){var s=e.height*(t.width/e.width);t.y=t.y+.5*(t.height-s),t.height=s}if(n>r){var a=e.width*(t.height/e.height);t.x=t.x+.5*(t.width-a),t.width=a}}else{if(n>r){var o=e.width*(t.height/t.width);e.y=e.y+.5*(e.height-o),e.height=o}if(r>n){var h=e.height*n;e.x=e.x+.5*(e.width-h),e.width=h}}var d=["x","y","width","height"];return d.forEach(function(i){t[i]=Math.round(t[i]),e[i]=Math.round(e[i])}),{src:t,dst:e}}},{key:"_getTile",value:function(t,e){return{x:t.x,y:t.y,width:e[0]<=1?t.width*e[0]:e[0],height:e[1]<=1?t.height*e[1]:e[1]}}},{key:"_drawTiles",value:function(t,e,i,n){var r=void 0,s=void 0,a=0,o=0;i&&"fill"===i?(r=Math.ceil(t.height/e.height),s=Math.ceil(t.width/e.width),a=.5*(e.width*s-t.width),o=.5*(e.height*r-t.height)):(r=Math.floor(t.height/e.height),s=Math.floor(t.width/e.width));for(var h=0,d=0,_=r*s,u=0;_>u;u++)n({x:e.x+d*e.width-a,y:e.y+h*e.height-o}),d===s-1&&h++,d=s-1>d?d+1:0}},{key:"_getImageData",value:function(t,e,i,n,r){var s=document.createElement("canvas");s.width=t.naturalWidth,s.height=t.naturalHeight;var a=s.getContext("2d");return a.drawImage(t,0,0,t.naturalWidth,t.naturalHeight),a.getImageData(e,i,n,r).data}},{key:"_getImage",value:function(t,e){var i=this;if(this._imageMap[t])return void e(this._imageMap[t]);var n=new Image;n.crossOrigin="Anonymous",n.src=t,n.onload=function(){i._imageMap[t]=n,e(n)}}},{key:"_resizeImage",value:function(t,e,i,n){var r=this,s=JSON.stringify(i);return this._slideContentMap[s]?void n(this._slideContentMap[s]):void pica.resizeBuffer({src:this._getImageData(t,e.x,e.y,e.width,e.height),width:e.width,height:e.height,toWidth:i.width,toHeight:i.height,quality:1,alpha:!1,unsharpAmount:0,unsharpRadius:.5,unsharpThreshold:0},function(t,e){var a=new ImageData(new Uint8ClampedArray(e),i.width,i.height);r._slideContentMap[s]=a,n(r._slideContentMap[s])})}},{key:"_drawImage",value:function(t,e,i){var n=this;this._getImage(e.url,function(s){var a={x:0,y:0,width:s.naturalWidth,height:s.naturalHeight},o=n._position2Pixels(e.position,n._scale);if(e.tile){var h=function(){var r=n._getTile(o,e.tile.size),h=n._updateCoords(a,r,e.tile.scaleMode);return n._resizeImage(s,h.src,h.dst,function(r){n._drawTiles(o,h.dst,e.scaleMode,function(e){t.putImageData(r,e.x,e.y)}),i()}),{v:void 0}}();if("object"===("undefined"==typeof h?"undefined":r(h)))return h.v}var d=n._updateCoords(a,o,e.scaleMode);a=d.src,o=d.dst,n._resizeImage(s,a,o,function(e){t.putImageData(e,o.x,o.y),i()})})}},{key:"_getVideoData",value:function(t){var e=document.createElement("canvas");e.width=t.videoWidth,e.height=t.videoHeight;var i=e.getContext("2d");return i.drawImage(t,0,0,t.videoWidth,t.videoHeight),i._getImageData(0,0,t.videoWidth,t.videoHeight).data}},{key:"_getVideo",value:function(t,e){var i=JSON.stringify(t);if(this._videoMap[i])return void e(this._videoMap[i]);var n=document.createElement("video");n.style.display="none",n.crossOrigin="anonymous",n.autoplay=!0,n.loop=!0,n.muted=!0,this.container.appendChild(n),t.forEach(function(t){var e=document.createElement("source");e.src=t.url,e.type=t.type,n.appendChild(e)}),this._videoMap[i]=n,n.addEventListener("play",function(){e(n)})}},{key:"_drawVideo",value:function(t,e,i){var n=this;this._getVideo(e.sources,function(s){if(0!==s.videoWidth&&0!==s.videoHeight){var a={x:0,y:0,width:s.videoWidth,height:s.videoHeight},o=n._position2Pixels(e.position,n._scale);if(e.tile){var h=function(){var r=n._getTile(o,e.tile.size),h=n._updateCoords(a,r,e.tile.scaleMode);return n._drawTiles(o,h.dst,e.scaleMode,function(e){t.drawImage(s,a.x,a.y,a.width,a.height,e.x,e.y,r.width,r.height)}),i(),{v:void 0}}();if("object"===("undefined"==typeof h?"undefined":r(h)))return h.v}var d=n._updateCoords(a,o,e.scaleMode);a=d.src,o=d.dst,t.drawImage(s,a.x,a.y,a.width,a.height,o.x,o.y,o.width,o.height),i()}})}}]),t}();i["default"]=h},{}]},{},[1]);
//# sourceMappingURL=dist/showy.min.js.map