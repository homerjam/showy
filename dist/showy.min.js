!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("util")):"function"==typeof define&&define.amd?define(["util"],t):e.Showy=t(null)}(this,function(e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable;var i=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(e){n[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(e){return!1}}()?Object.assign:function(e,i){for(var a,o,s=function(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),l=1;l<arguments.length;l++){for(var u in a=Object(arguments[l]))r.call(a,u)&&(s[u]=a[u]);if(t){o=t(a);for(var h=0;h<o.length;h++)n.call(a,o[h])&&(s[o[h]]=a[o[h]])}}return s},a=Object.freeze({default:i,__moduleExports:i}),o=arguments[3],s=arguments[4],l=arguments[5],u=JSON.stringify,h=function(e,t){for(var r,n=Object.keys(l),i=0,a=n.length;i<a;i++){var h=n[i],f=l[h].exports;if(f===e||f&&f.default===e){r=h;break}}if(!r){r=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var c={};for(i=0,a=n.length;i<a;i++){c[h=n[i]]=h}s[r]=["function(require,module,exports){"+e+"(self); }",c]}var _=Math.floor(Math.pow(16,8)*Math.random()).toString(16),d={};d[r]=r,s[_]=["function(require,module,exports){var f = require("+u(r)+");(f.default ? f.default : f)(self);}",d];var g={};!function e(t){g[t]=!0;for(var r in s[t][1]){var n=s[t][1][r];g[n]||e(n)}}(_);var p="("+o+")({"+Object.keys(g).map(function(e){return u(e)+":["+s[e][0]+","+u(s[e][1])+"]"}).join(",")+"},{},["+u(_)+"])",A=window.URL||window.webkitURL||window.mozURL||window.msURL,m=new Blob([p],{type:"text/javascript"});if(t&&t.bare)return m;var E=A.createObjectURL(m),v=new Worker(E);return v.objectURL=E,v},f=Object.freeze({default:h,__moduleExports:h}),c="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function d(e,t){return e(t={exports:{}},t.exports),t.exports}var g,p=d(function(e){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}),A=Object.freeze({default:p,__moduleExports:p}),m=A&&p||A,E=d(function(t){try{var r=e;if("function"!=typeof r.inherits)throw"";t.exports=r.inherits}catch(e){t.exports=m}}),v=Object.freeze({default:E,__moduleExports:E}),y=function(e){for(var t=e.replace(/[\r\n=]/g,""),r=t.length,n=new Uint8Array(3*r>>2),i=0,a=0,o=0;o<r;o++)o%4==0&&o&&(n[a++]=i>>16&255,n[a++]=i>>8&255,n[a++]=255&i),i=i<<6|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(t.charAt(o));var s=r%4*6;return 0===s?(n[a++]=i>>16&255,n[a++]=i>>8&255,n[a++]=255&i):18===s?(n[a++]=i>>10&255,n[a++]=i>>2&255):12===s&&(n[a++]=i>>4&255),n},I=Object.freeze({default:y,__moduleExports:y}),x=function(){if(void 0!==g)return g;if(g=!1,"undefined"==typeof WebAssembly)return g;try{var e=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),t=new WebAssembly.Module(e);return 0!==new WebAssembly.Instance(t,{}).exports.test(4)&&(g=!0),g}catch(e){}return g},b=Object.freeze({default:x,__moduleExports:x}),T=a&&i||a,w=I&&y||I,C=b&&x||b,R={js:!0,wasm:!0};function S(e){if(!(this instanceof S))return new S(e);var t=T({},R,e||{});if(this.options=t,this.__cache={},this.has_wasm=C(),this.__init_promise=null,this.__modules=t.modules||{},this.__memory=null,this.__wasm={},this.__isLE=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0],!this.options.js&&!this.options.wasm)throw new Error('mathlib: at least "js" or "wasm" should be enabled')}S.prototype.use=function(e){return this.__modules[e.name]=e,this.has_wasm&&this.options.wasm&&e.wasm_fn?this[e.name]=e.wasm_fn:this[e.name]=e.fn,this},S.prototype.init=function(){if(this.__init_promise)return this.__init_promise;if(!this.options.js&&this.options.wasm&&!this.has_wasm)return Promise.reject(new Error('mathlib: only "wasm" was enabled, but it\'s not supported'));var e=this;return this.__init_promise=Promise.all(Object.keys(e.__modules).map(function(t){var r=e.__modules[t];return e.has_wasm&&e.options.wasm&&r.wasm_fn?e.__wasm[t]?null:WebAssembly.compile(e.__base64decode(r.wasm_src)).then(function(r){e.__wasm[t]=r}):null})).then(function(){return e}),this.__init_promise},S.prototype.__base64decode=w,S.prototype.__reallocate=function(e){if(!this.__memory)return this.__memory=new WebAssembly.Memory({initial:Math.ceil(e/65536)}),this.__memory;var t=this.__memory.buffer.byteLength;return t<e&&this.__memory.grow(Math.ceil((e-t)/65536)),this.__memory},S.prototype.__instance=function(e,t,r){if(t&&this.__reallocate(t),!this.__wasm[e]){var n=this.__modules[e];this.__wasm[e]=new WebAssembly.Module(this.__base64decode(n.wasm_src))}if(!this.__cache[e]){var i={memoryBase:0,memory:this.__memory,tableBase:0,table:new WebAssembly.Table({initial:0,element:"anyfunc"})};this.__cache[e]=new WebAssembly.Instance(this.__wasm[e],{env:T(i,r||{})})}return this.__cache[e]},S.prototype.__align=function(e,t){var r=e%(t=t||8);return e+(r?t-r:0)};var B,M,O,D,N,U,F=S,L=Object.freeze({default:F,__moduleExports:F});function P(e,t,r,n,i,a){var o,s,l,u,h,f,c,_,d,g,p,A,m,E;for(d=0;d<a;d++){for(c=d,_=0,u=h=(o=e[f=d*i])*n[6],p=n[0],A=n[1],m=n[4],E=n[5],g=0;g<i;g++)l=(s=e[f])*p+o*A+u*m+h*E,h=u,u=l,o=s,r[_]=u,_++,f++;for(_--,c+=a*(i-1),u=h=(o=e[--f])*n[7],s=o,p=n[2],A=n[3],g=i-1;g>=0;g--)l=s*p+o*A+u*m+h*E,h=u,u=l,o=s,s=e[f],t[c]=r[_]+u,f--,_--,c-=a}}var j=function(e,t,r,n){if(n){var i=new Uint16Array(e.length),a=new Float32Array(Math.max(t,r)),o=function(e){e<.5&&(e=.5);var t=Math.exp(.527076)/e,r=Math.exp(-t),n=Math.exp(-2*t),i=(1-r)*(1-r)/(1+2*t*r-n);return B=i,M=i*(t-1)*r,O=i*(t+1)*r,D=-i*n,N=2*r,U=-n,new Float32Array([B,M,O,D,N,U,(B+M)/(1-N-U),(O+D)/(1-N-U)])}(n);P(e,i,a,o,t,r),P(i,e,a,o,r,t)}},V=Object.freeze({default:j,__moduleExports:j}),k=function(e,t,r){for(var n,i,a,o,s,l=t*r,u=new Uint16Array(l),h=0;h<l;h++)n=e[4*h],i=e[4*h+1],a=e[4*h+2],s=n>=i&&n>=a?n:i>=a&&i>=n?i:a,o=n<=i&&n<=a?n:i<=a&&i<=n?i:a,u[h]=257*(s+o)>>1;return u},X=Object.freeze({default:k,__moduleExports:k}),Q=V&&j||V,G=X&&k||X,z=function(e,t,r,n,i,a){var o,s,l,u,h,f,c,_,d,g,p,A,m;if(!(0===n||i<.5)){i>2&&(i=2);var E=G(e,t,r),v=new Uint16Array(E);Q(v,t,r,i);for(var y=n/100*4096+.5|0,I=257*a|0,x=t*r,b=0;b<x;b++)A=2*(E[b]-v[b]),Math.abs(A)>=I&&(o=e[m=4*b],s=e[m+1],l=e[m+2],f=257*((_=o>=s&&o>=l?o:s>=o&&s>=l?s:l)+(c=o<=s&&o<=l?o:s<=o&&s<=l?s:l))>>1,c===_?u=h=0:(h=f<=32767?4095*(_-c)/(_+c)|0:4095*(_-c)/(510-_-c)|0,u=o===_?65535*(s-l)/(6*(_-c))|0:s===_?21845+(65535*(l-o)/(6*(_-c))|0):43690+(65535*(o-s)/(6*(_-c))|0)),(f+=y*A+2048>>12)>65535?f=65535:f<0&&(f=0),0===h?o=s=l=f>>8:(d=2*f-(g=f<=32767?f*(4096+h)+2048>>12:f+((65535-f)*h+2048>>12))>>8,g>>=8,o=(p=u+21845&65535)>=43690?d:p>=32767?d+(6*(g-d)*(43690-p)+32768>>16):p>=10922?g:d+(6*(g-d)*p+32768>>16),s=(p=65535&u)>=43690?d:p>=32767?d+(6*(g-d)*(43690-p)+32768>>16):p>=10922?g:d+(6*(g-d)*p+32768>>16),l=(p=u-21845&65535)>=43690?d:p>=32767?d+(6*(g-d)*(43690-p)+32768>>16):p>=10922?g:d+(6*(g-d)*p+32768>>16)),e[m]=o,e[m+1]=s,e[m+2]=l)}},H=Object.freeze({default:z,__moduleExports:z}),q=function(e,t,r,n,i,a){if(!(0===n||i<.5)){i>2&&(i=2);var o=t*r,s=4*o,l=2*o,u=2*o,h=4*Math.max(t,r),f=s,c=f+l,_=c+u,d=_+u,g=d+h,p=this.__instance("unsharp_mask",s+l+2*u+h+32,{exp:Math.exp}),A=new Uint32Array(e.buffer);new Uint32Array(this.__memory.buffer).set(A);var m=p.exports.hsl_l16||p.exports._hsl_l16;m(0,f,t,r),(m=p.exports.blurMono16||p.exports._blurMono16)(f,c,_,d,g,t,r,i),(m=p.exports.unsharp||p.exports._unsharp)(0,0,f,c,t,r,n,a),A.set(new Uint32Array(this.__memory.buffer,0,o))}},Y=Object.freeze({default:q,__moduleExports:q}),W="AGFzbQEAAAABMQZgAXwBfGACfX8AYAZ/f39/f38AYAh/f39/f39/fQBgBH9/f38AYAh/f39/f39/fwACGQIDZW52A2V4cAAAA2VudgZtZW1vcnkCAAEDBgUBAgMEBQQEAXAAAAdMBRZfX2J1aWxkX2dhdXNzaWFuX2NvZWZzAAEOX19nYXVzczE2X2xpbmUAAgpibHVyTW9ubzE2AAMHaHNsX2wxNgAEB3Vuc2hhcnAABQkBAAqJEAXZAQEGfAJAIAFE24a6Q4Ia+z8gALujIgOaEAAiBCAEoCIGtjgCECABIANEAAAAAAAAAMCiEAAiBbaMOAIUIAFEAAAAAAAA8D8gBKEiAiACoiAEIAMgA6CiRAAAAAAAAPA/oCAFoaMiArY4AgAgASAEIANEAAAAAAAA8L+gIAKioiIHtjgCBCABIAQgA0QAAAAAAADwP6AgAqKiIgO2OAIIIAEgBSACoiIEtow4AgwgASACIAegIAVEAAAAAAAA8D8gBqGgIgKjtjgCGCABIAMgBKEgAqO2OAIcCwu3AwMDfwR9CHwCQCADKgIUIQkgAyoCECEKIAMqAgwhCyADKgIIIQwCQCAEQX9qIgdBAEgiCA0AIAIgAC8BALgiDSADKgIYu6IiDiAJuyIQoiAOIAq7IhGiIA0gAyoCBLsiEqIgAyoCALsiEyANoqCgoCIPtjgCACACQQRqIQIgAEECaiEAIAdFDQAgBCEGA0AgAiAOIBCiIA8iDiARoiANIBKiIBMgAC8BALgiDaKgoKAiD7Y4AgAgAkEEaiECIABBAmohACAGQX9qIgZBAUoNAAsLAkAgCA0AIAEgByAFbEEBdGogAEF+ai8BACIIuCINIAu7IhGiIA0gDLsiEqKgIA0gAyoCHLuiIg4gCrsiE6KgIA4gCbsiFKKgIg8gAkF8aioCALugqzsBACAHRQ0AIAJBeGohAiAAQXxqIQBBACAFQQF0ayEHIAEgBSAEQQF0QXxqbGohBgNAIAghAyAALwEAIQggBiANIBGiIAO4Ig0gEqKgIA8iECAToqAgDiAUoqAiDyACKgIAu6CrOwEAIAYgB2ohBiAAQX5qIQAgAkF8aiECIBAhDiAEQX9qIgRBAUoNAAsLCwvfAgIDfwZ8AkAgB0MAAAAAWw0AIARE24a6Q4Ia+z8gB0MAAAA/l7ujIgyaEAAiDSANoCIPtjgCECAEIAxEAAAAAAAAAMCiEAAiDraMOAIUIAREAAAAAAAA8D8gDaEiCyALoiANIAwgDKCiRAAAAAAAAPA/oCAOoaMiC7Y4AgAgBCANIAxEAAAAAAAA8L+gIAuioiIQtjgCBCAEIA0gDEQAAAAAAADwP6AgC6KiIgy2OAIIIAQgDiALoiINtow4AgwgBCALIBCgIA5EAAAAAAAA8D8gD6GgIgujtjgCGCAEIAwgDaEgC6O2OAIcIAYEQCAFQQF0IQogBiEJIAIhCANAIAAgCCADIAQgBSAGEAIgACAKaiEAIAhBAmohCCAJQX9qIgkNAAsLIAVFDQAgBkEBdCEIIAUhAANAIAIgASADIAQgBiAFEAIgAiAIaiECIAFBAmohASAAQX9qIgANAAsLC7wBAQV/IAMgAmwiAwRAQQAgA2shBgNAIAAoAgAiBEEIdiIHQf8BcSECAn8gBEH/AXEiAyAEQRB2IgRB/wFxIgVPBEAgAyIIIAMgAk8NARoLIAQgBCAHIAIgA0kbIAIgBUkbQf8BcQshCAJAIAMgAk0EQCADIAVNDQELIAQgByAEIAMgAk8bIAIgBUsbQf8BcSEDCyAAQQRqIQAgASADIAhqQYECbEEBdjsBACABQQJqIQEgBkEBaiIGDQALCwvTBgEKfwJAIAazQwAAgEWUQwAAyEKVu0QAAAAAAADgP6CqIQ0gBSAEbCILBEAgB0GBAmwhDgNAQQAgAi8BACADLwEAayIGQQF0IgdrIAcgBkEASBsgDk8EQCAAQQJqLQAAIQUCfyAALQAAIgYgAEEBai0AACIESSIJRQRAIAYiCCAGIAVPDQEaCyAFIAUgBCAEIAVJGyAGIARLGwshCAJ/IAYgBE0EQCAGIgogBiAFTQ0BGgsgBSAFIAQgBCAFSxsgCRsLIgogCGoiD0GBAmwiEEEBdiERQQAhDAJ/QQAiCSAIIApGDQAaIAggCmsiCUH/H2wgD0H+AyAIayAKayAQQYCABEkbbSEMIAYgCEYEQCAEIAVrQf//A2wgCUEGbG0MAQsgBSAGayAGIARrIAQgCEYiBhtB//8DbCAJQQZsbUHVqgFBqtUCIAYbagshCSARIAcgDWxBgBBqQQx1aiIGQQAgBkEAShsiBkH//wMgBkH//wNIGyEGAkACfwJAIAxB//8DcSIFBEAgBkH//wFKDQEgBUGAIGogBmxBgBBqQQx2DAILIAZBCHYiBiEFIAYhBAwCCyAFIAZB//8Dc2xBgBBqQQx2IAZqCyIFQQh2IQcgBkEBdCAFa0EIdiIGIQQCQCAJQdWqAWpB//8DcSIFQanVAksNACAFQf//AU8EQEGq1QIgBWsgByAGa2xBBmxBgIACakEQdiAGaiEEDAELIAchBCAFQanVAEsNACAFIAcgBmtsQQZsQYCAAmpBEHYgBmohBAsCfyAGIgUgCUH//wNxIghBqdUCSw0AGkGq1QIgCGsgByAGa2xBBmxBgIACakEQdiAGaiAIQf//AU8NABogByIFIAhBqdUASw0AGiAIIAcgBmtsQQZsQYCAAmpBEHYgBmoLIQUgCUGr1QJqQf//A3EiCEGp1QJLDQAgCEH//wFPBEBBqtUCIAhrIAcgBmtsQQZsQYCAAmpBEHYgBmohBgwBCyAIQanVAEsEQCAHIQYMAQsgCCAHIAZrbEEGbEGAgAJqQRB2IAZqIQYLIAEgBDoAACABQQFqIAU6AAAgAUECaiAGOgAACyADQQJqIQMgAkECaiECIABBBGohACABQQRqIQEgC0F/aiILDQALCwsL",K=Object.freeze({default:W,__moduleExports:W}),Z={name:"unsharp_mask",fn:H&&z||H,wasm_fn:Y&&q||Y,wasm_src:K?W:K},J=Z.name,$=Z.fn,ee=Z.wasm_fn,te=Z.wasm_src,re=Object.freeze({default:Z,__moduleExports:Z,name:J,fn:$,wasm_fn:ee,wasm_src:te}),ne=[{win:.5,filter:function(e){return e>=-.5&&e<.5?1:0}},{win:1,filter:function(e){if(e<=-1||e>=1)return 0;if(e>-1.1920929e-7&&e<1.1920929e-7)return 1;var t=e*Math.PI;return Math.sin(t)/t*(.54+.46*Math.cos(t/1))}},{win:2,filter:function(e){if(e<=-2||e>=2)return 0;if(e>-1.1920929e-7&&e<1.1920929e-7)return 1;var t=e*Math.PI;return Math.sin(t)/t*Math.sin(t/2)/(t/2)}},{win:3,filter:function(e){if(e<=-3||e>=3)return 0;if(e>-1.1920929e-7&&e<1.1920929e-7)return 1;var t=e*Math.PI;return Math.sin(t)/t*Math.sin(t/3)/(t/3)}}],ie=Object.freeze({default:ne,__moduleExports:ne}),ae=ie&&ne||ie,oe=14;function se(e){return Math.round(e*((1<<oe)-1))}var le=function(e,t,r,n,i){var a,o,s,l,u,h,f,c,_,d,g,p,A,m,E,v,y,I=ae[e].filter,x=1/n,b=Math.min(1,n),T=ae[e].win/b,w=Math.floor(2*(T+1)),C=new Int16Array((w+2)*r),R=0,S=!C.subarray||!C.set;for(a=0;a<r;a++){for(o=(a+.5)*x+i,s=Math.max(0,Math.floor(o-T)),u=(l=Math.min(t-1,Math.ceil(o+T)))-s+1,h=new Float32Array(u),f=new Int16Array(u),c=0,_=s,d=0;_<=l;_++,d++)c+=g=I((_+.5-o)*b),h[d]=g;for(p=0,d=0;d<h.length;d++)p+=A=h[d]/c,f[d]=se(A);for(f[r>>1]+=se(1-p),m=0;m<f.length&&0===f[m];)m++;if(m<f.length){for(E=f.length-1;E>0&&0===f[E];)E--;if(v=s+m,y=E-m+1,C[R++]=v,C[R++]=y,S)for(d=m;d<=E;d++)C[R++]=f[d];else C.set(f.subarray(m,E+1),R),R+=y}else C[R++]=0,C[R++]=0}return C},ue=Object.freeze({default:le,__moduleExports:le});function he(e){return e<0?0:e>255?255:e}var fe={convolveHorizontally:function(e,t,r,n,i,a){var o,s,l,u,h,f,c,_,d,g,p,A=0,m=0;for(d=0;d<n;d++){for(h=0,g=0;g<i;g++){for(f=a[h++],c=a[h++],_=A+4*f|0,o=s=l=u=0;c>0;c--)u=u+(p=a[h++])*e[_+3]|0,l=l+p*e[_+2]|0,s=s+p*e[_+1]|0,o=o+p*e[_]|0,_=_+4|0;t[m+3]=he(u+8192>>14),t[m+2]=he(l+8192>>14),t[m+1]=he(s+8192>>14),t[m]=he(o+8192>>14),m=m+4*n|0}m=4*(d+1)|0,A=(d+1)*r*4|0}},convolveVertically:function(e,t,r,n,i,a){var o,s,l,u,h,f,c,_,d,g,p,A=0,m=0;for(d=0;d<n;d++){for(h=0,g=0;g<i;g++){for(f=a[h++],c=a[h++],_=A+4*f|0,o=s=l=u=0;c>0;c--)u=u+(p=a[h++])*e[_+3]|0,l=l+p*e[_+2]|0,s=s+p*e[_+1]|0,o=o+p*e[_]|0,_=_+4|0;t[m+3]=he(u+8192>>14),t[m+2]=he(l+8192>>14),t[m+1]=he(s+8192>>14),t[m]=he(o+8192>>14),m=m+4*n|0}m=4*(d+1)|0,A=(d+1)*r*4|0}}},ce=fe.convolveHorizontally,_e=fe.convolveVertically,de=Object.freeze({default:fe,__moduleExports:fe,convolveHorizontally:ce,convolveVertically:_e}),ge=ue&&le||ue,pe=de&&fe||de;const Ae=pe.convolveHorizontally,me=pe.convolveVertically;var Ee=function(e){const t=e.src,r=e.width,n=e.height,i=e.toWidth,a=e.toHeight,o=e.scaleX||e.toWidth/e.width,s=e.scaleY||e.toHeight/e.height,l=e.offsetX||0,u=e.offsetY||0,h=e.dest||new Uint8Array(i*a*4),f=void 0===e.quality?3:e.quality,c=e.alpha||!1,_=ge(f,r,i,o,l),d=ge(f,n,a,s,u),g=new Uint8Array(i*n*4);return Ae(t,g,r,n,i,_),me(g,h,n,i,a,d),c||function(e,t,r){let n=3,i=t*r*4|0;for(;n<i;)e[n]=255,n=n+4|0}(h,i,a),h},ve=Object.freeze({default:Ee,__moduleExports:Ee});let ye=!0;try{ye=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]}catch(e){}function Ie(e,t,r){if(ye)t.set(function(e){return new Uint8Array(e.buffer,0,e.byteLength)}(e),r);else for(let n=r,i=0;i<e.length;i++){let r=e[i];t[n++]=255&r,t[n++]=r>>8&255}}var xe=function(e){const t=e.src,r=e.width,n=e.height,i=e.toWidth,a=e.toHeight,o=e.scaleX||e.toWidth/e.width,s=e.scaleY||e.toHeight/e.height,l=e.offsetX||0,u=e.offsetY||0,h=e.dest||new Uint8Array(i*a*4),f=void 0===e.quality?3:e.quality,c=e.alpha||!1,_=ge(f,r,i,o,l),d=ge(f,n,a,s,u),g=this.__align(0+Math.max(t.byteLength,h.byteLength)),p=this.__align(g+n*i*4),A=this.__align(p+_.byteLength),m=A+d.byteLength,E=this.__instance("resize",m),v=new Uint8Array(this.__memory.buffer),y=new Uint32Array(this.__memory.buffer),I=new Uint32Array(t.buffer);return y.set(I),Ie(_,v,p),Ie(d,v,A),(E.exports.convolveHV||E.exports._convolveHV)(p,A,g,r,n,i,a),new Uint32Array(h.buffer).set(new Uint32Array(this.__memory.buffer,0,a*i)),c||function(e,t,r){let n=3,i=t*r*4|0;for(;n<i;)e[n]=255,n=n+4|0}(h,i,a),h},be=Object.freeze({default:xe,__moduleExports:xe}),Te="AGFzbQEAAAABFAJgBn9/f39/fwBgB39/f39/f38AAg8BA2VudgZtZW1vcnkCAAEDAwIAAQQEAXAAAAcZAghjb252b2x2ZQAACmNvbnZvbHZlSFYAAQkBAArmAwLBAwEQfwJAIANFDQAgBEUNACAFQQRqIRVBACEMQQAhDQNAIA0hDkEAIRFBACEHA0AgB0ECaiESAn8gBSAHQQF0IgdqIgZBAmouAQAiEwRAQQAhCEEAIBNrIRQgFSAHaiEPIAAgDCAGLgEAakECdGohEEEAIQlBACEKQQAhCwNAIBAoAgAiB0EYdiAPLgEAIgZsIAtqIQsgB0H/AXEgBmwgCGohCCAHQRB2Qf8BcSAGbCAKaiEKIAdBCHZB/wFxIAZsIAlqIQkgD0ECaiEPIBBBBGohECAUQQFqIhQNAAsgEiATagwBC0EAIQtBACEKQQAhCUEAIQggEgshByABIA5BAnRqIApBgMAAakEOdSIGQf8BIAZB/wFIG0EQdEGAgPwHcUEAIAZBAEobIAtBgMAAakEOdSIGQf8BIAZB/wFIG0EYdEEAIAZBAEobciAJQYDAAGpBDnUiBkH/ASAGQf8BSBtBCHRBgP4DcUEAIAZBAEobciAIQYDAAGpBDnUiBkH/ASAGQf8BSBtB/wFxQQAgBkEAShtyNgIAIA4gA2ohDiARQQFqIhEgBEcNAAsgDCACaiEMIA1BAWoiDSADRw0ACwsLIQACQEEAIAIgAyAEIAUgABAAIAJBACAEIAUgBiABEAALCw==",we=Object.freeze({default:Te,__moduleExports:Te}),Ce={name:"resize",fn:ve&&Ee||ve,wasm_fn:be&&xe||be,wasm_src:we?Te:we},Re=Ce.name,Se=Ce.fn,Be=Ce.wasm_fn,Me=Ce.wasm_src,Oe=Object.freeze({default:Ce,__moduleExports:Ce,name:Re,fn:Se,wasm_fn:Be,wasm_src:Me}),De=L&&F||L,Ne=re&&Z||re,Ue=Oe&&Ce||Oe;function Fe(e){const t=e||[];let r={js:t.indexOf("js")>=0,wasm:t.indexOf("wasm")>=0};De.call(this,r),this.features={js:r.js,wasm:r.wasm&&this.has_wasm},this.use(Ne),this.use(Ue)}(v&&E||v)(Fe,De),Fe.prototype.resizeAndUnsharp=function(e,t){let r=this.resize(e,t);return e.unsharpAmount&&this.unsharp_mask(r,e.toWidth,e.toHeight,e.unsharpAmount,e.unsharpRadius,e.unsharpThreshold),r};var Le=Fe,Pe=Object.freeze({default:Le,__moduleExports:Le});function je(e,t){this.create=e,this.available=[],this.acquired={},this.lastId=1,this.timeoutId=0,this.idle=t||2e3}je.prototype.acquire=function(){let e;return 0!==this.available.length?e=this.available.pop():((e=this.create()).id=this.lastId++,e.release=(()=>this.release(e))),this.acquired[e.id]=e,e},je.prototype.release=function(e){delete this.acquired[e.id],e.lastUsed=Date.now(),this.available.push(e),0===this.timeoutId&&(this.timeoutId=setTimeout(()=>this.gc(),100))},je.prototype.gc=function(){const e=Date.now();this.available=this.available.filter(t=>!(e-t.lastUsed>this.idle)||(t.destroy(),!1)),0!==this.available.length?this.timeoutId=setTimeout(()=>this.gc(),100):this.timeoutId=0};var Ve=je,ke=Object.freeze({default:Ve,__moduleExports:Ve});function Xe(e){return Object.prototype.toString.call(e)}var Qe=function(e){let t=Xe(e);return"[object HTMLCanvasElement]"===t||"[object Canvas]"===t},Ge=function(e){return"[object HTMLImageElement]"===Xe(e)},ze=function(e){let t=0,r=[];function n(){t<e&&r.length&&(t++,r.shift()())}return function(e){return new Promise((i,a)=>{r.push(()=>{e().then(e=>{i(e),t--,n()},e=>{a(e),t--,n()})}),n()})}},He=function(e){switch(e){case 0:return"pixelated";case 1:return"low";case 2:return"medium"}return"high"},qe=function(){return Promise.resolve().then(()=>{if("undefined"==typeof createImageBitmap||"undefined"==typeof document)return!1;let e=document.createElement("canvas");return e.width=100,e.height=100,createImageBitmap(e,0,0,100,100,{resizeWidth:10,resizeHeight:10,resizeQuality:"high"}).then(t=>{let r=10===t.width;return t.close(),e=null,r})}).catch(()=>!1)},Ye={isCanvas:Qe,isImage:Ge,limiter:ze,cib_quality_name:He,cib_support:qe},We=Object.freeze({default:Ye,__moduleExports:Ye,isCanvas:Qe,isImage:Ge,limiter:ze,cib_quality_name:He,cib_support:qe}),Ke=Pe&&Le||Pe,Ze=function(){const e=Ke;let t;onmessage=function(r){let n=r.data.opts;t||(t=new e(r.data.features));let i=t.resizeAndUnsharp(n);postMessage({result:i},[i.buffer])}},Je=Object.freeze({default:Ze,__moduleExports:Ze});var $e=function(e,t,r,n,i,a){let o=r/e,s=n/t,l=(2*a+2+1)/i;if(l>.5)return[[r,n]];let u=Math.ceil(Math.log(Math.min(o,s))/Math.log(l));if(u<=1)return[[r,n]];let h=[];for(let i=0;i<u;i++){let a=Math.round(Math.pow(Math.pow(e,u-i-1)*Math.pow(r,i+1),1/u)),o=Math.round(Math.pow(Math.pow(t,u-i-1)*Math.pow(n,i+1),1/u));h.push([a,o])}return h},et=Object.freeze({default:$e,__moduleExports:$e}),tt=1e-5;function rt(e){var t=Math.round(e);return Math.abs(e-t)<tt?t:Math.floor(e)}function nt(e){var t=Math.round(e);return Math.abs(e-t)<tt?t:Math.ceil(e)}var it=function(e){var t,r,n,i,a,o,s=e.toWidth/e.width,l=e.toHeight/e.height,u=rt(e.srcTileSize*s)-2*e.destTileBorder,h=rt(e.srcTileSize*l)-2*e.destTileBorder;if(u<1||h<1)throw new Error("Internal error in pica: target tile width/height is too small.");var f,c=[];for(i=0;i<e.toHeight;i+=h)for(n=0;n<e.toWidth;n+=u)(t=n-e.destTileBorder)<0&&(t=0),t+(a=n+u+e.destTileBorder-t)>=e.toWidth&&(a=e.toWidth-t),(r=i-e.destTileBorder)<0&&(r=0),r+(o=i+h+e.destTileBorder-r)>=e.toHeight&&(o=e.toHeight-r),f={toX:t,toY:r,toWidth:a,toHeight:o,toInnerX:n,toInnerY:i,toInnerWidth:u,toInnerHeight:h,offsetX:t/s-rt(t/s),offsetY:r/l-rt(r/l),scaleX:s,scaleY:l,x:rt(t/s),y:rt(r/l),width:nt(a/s),height:nt(o/l)},c.push(f);return c},at=Object.freeze({default:it,__moduleExports:it}),ot=f&&h||f,st=ke&&Ve||ke,lt=We&&Ye||We,ut=Je&&Ze||Je,ht=et&&$e||et,ft=at&&it||at;const ct={};let _t=!1;try{"undefined"!=typeof navigator&&navigator.userAgent&&(_t=navigator.userAgent.indexOf("Safari")>=0)}catch(e){}let dt=1;"undefined"!=typeof navigator&&(dt=Math.min(navigator.hardwareConcurrency||1,4));const gt={tile:1024,concurrency:dt,features:["js","wasm","ww"],idle:2e3},pt={quality:3,alpha:!1,unsharpAmount:0,unsharpRadius:0,unsharpThreshold:0};let At,mt;function Et(){return{value:ot(ut),destroy:function(){if(this.value.terminate(),"undefined"!=typeof window){let e=window.URL||window.webkitURL||window.mozURL||window.msURL;e&&e.revokeObjectURL&&this.value.objectURL&&e.revokeObjectURL(this.value.objectURL)}}}}function vt(e){if(!(this instanceof vt))return new vt(e);this.options=T({},gt,e||{});let t=`lk_${this.options.concurrency}`;this.__limit=ct[t]||lt.limiter(this.options.concurrency),ct[t]||(ct[t]=this.__limit),this.features={js:!1,wasm:!1,cib:!1,ww:!1},this.__workersPool=null,this.__requested_features=[],this.__mathlib=null}vt.prototype.init=function(){if(this.__initPromise)return this.__initPromise;if(!1!==At&&!0!==At&&(At=!1,"undefined"!=typeof ImageData&&"undefined"!=typeof Uint8ClampedArray))try{new ImageData(new Uint8ClampedArray(400),10,10),At=!0}catch(e){}!1!==mt&&!0!==mt&&(mt=!1,"undefined"!=typeof ImageBitmap&&(ImageBitmap.prototype&&ImageBitmap.prototype.close?mt=!0:this.debug("ImageBitmap does not support .close(), disabled")));let e=this.options.features.slice();if(e.indexOf("all")>=0&&(e=["cib","wasm","js","ww"]),this.__requested_features=e,this.__mathlib=new Ke(e),e.indexOf("ww")>=0&&"undefined"!=typeof window&&"Worker"in window)try{ot(function(){}).terminate(),this.features.ww=!0;let e=`wp_${JSON.stringify(this.options)}`;ct[e]?this.__workersPool=ct[e]:(this.__workersPool=new st(Et,this.options.idle),ct[e]=this.__workersPool)}catch(e){}let t,r=this.__mathlib.init().then(e=>{T(this.features,e.features)});return t=mt?lt.cib_support().then(t=>{this.features.cib&&e.indexOf("cib")<0?this.debug("createImageBitmap() resize supported, but disabled by config"):e.indexOf("cib")>=0&&(this.features.cib=t)}):Promise.resolve(!1),this.__initPromise=Promise.all([r,t]).then(()=>this),this.__initPromise},vt.prototype.resize=function(e,t,r){this.debug("Start resize...");let n=T({},pt);if(isNaN(r)?r&&(n=T(n,r)):n=T(n,{quality:r}),n.toWidth=t.width,n.toHeight=t.height,n.width=e.naturalWidth||e.width,n.height=e.naturalHeight||e.height,0===t.width||0===t.height)return Promise.reject(new Error(`Invalid output size: ${t.width}x${t.height}`));n.unsharpRadius>2&&(n.unsharpRadius=2);let i=!1,a=null;n.cancelToken&&(a=n.cancelToken.then(e=>{throw i=!0,e},e=>{throw i=!0,e}));let o=Math.ceil(Math.max(3,2.5*n.unsharpRadius|0));return this.init().then(()=>{if(i)return a;if(this.features.cib){let r=t.getContext("2d",{alpha:Boolean(n.alpha)});return this.debug("Resize via createImageBitmap()"),createImageBitmap(e,{resizeWidth:n.toWidth,resizeHeight:n.toHeight,resizeQuality:lt.cib_quality_name(n.quality)}).then(e=>{if(i)return a;if(!n.unsharpAmount)return r.drawImage(e,0,0),e.close(),r=null,this.debug("Finished!"),t;this.debug("Unsharp result");let o=document.createElement("canvas");o.width=n.toWidth,o.height=n.toHeight;let s=o.getContext("2d",{alpha:Boolean(n.alpha)});s.drawImage(e,0,0),e.close();let l=s.getImageData(0,0,n.toWidth,n.toHeight);return this.__mathlib.unsharp(l.data,n.toWidth,n.toHeight,n.unsharpAmount,n.unsharpRadius,n.unsharpThreshold),r.putImageData(l,0,0),l=s=o=r=null,this.debug("Finished!"),t})}let r={};const s=e=>Promise.resolve().then(()=>this.features.ww?new Promise((t,r)=>{let n=this.__workersPool.acquire();a&&a.catch(e=>r(e)),n.value.onmessage=(e=>{n.release(),e.data.err?r(e.data.err):t(e.data.result)}),n.value.postMessage({opts:e,features:this.__requested_features,preload:{wasm_nodule:this.__mathlib.__}},[e.src.buffer])}):this.__mathlib.resizeAndUnsharp(e,r)),l=(e,t,r)=>{let n,l,u;const h=t=>this.__limit(()=>{if(i)return a;let o;if(lt.isCanvas(e))this.debug("Get tile pixel data"),o=n.getImageData(t.x,t.y,t.width,t.height);else{this.debug("Draw tile imageBitmap/image to temporary canvas");let n=document.createElement("canvas");n.width=t.width,n.height=t.height;let i=n.getContext("2d",{alpha:Boolean(r.alpha)});i.globalCompositeOperation="copy",i.drawImage(l||e,t.x,t.y,t.width,t.height,0,0,t.width,t.height),this.debug("Get tile pixel data"),o=i.getImageData(0,0,t.width,t.height),i=n=null}let h={src:o.data,width:t.width,height:t.height,toWidth:t.toWidth,toHeight:t.toHeight,scaleX:t.scaleX,scaleY:t.scaleY,offsetX:t.offsetX,offsetY:t.offsetY,quality:r.quality,alpha:r.alpha,unsharpAmount:r.unsharpAmount,unsharpRadius:r.unsharpRadius,unsharpThreshold:r.unsharpThreshold};return this.debug("Invoke resize math"),Promise.resolve().then(()=>s(h)).then(e=>{if(i)return a;let r;if(o=null,this.debug("Convert raw rgba tile result to ImageData"),At)r=new ImageData(new Uint8ClampedArray(e),t.toWidth,t.toHeight);else if((r=u.createImageData(t.toWidth,t.toHeight)).data.set)r.data.set(e);else for(let t=r.data.length-1;t>=0;t--)r.data[t]=e[t];return this.debug("Draw tile"),_t?u.putImageData(r,t.toX,t.toY,t.toInnerX-t.toX,t.toInnerY-t.toY,t.toInnerWidth+1e-5,t.toInnerHeight+1e-5):u.putImageData(r,t.toX,t.toY,t.toInnerX-t.toX,t.toInnerY-t.toY,t.toInnerWidth,t.toInnerHeight),null})});return Promise.resolve().then(()=>{if(u=t.getContext("2d",{alpha:Boolean(r.alpha)}),lt.isCanvas(e))return n=e.getContext("2d",{alpha:Boolean(r.alpha)}),null;if(lt.isImage(e))return mt?(this.debug("Decode image via createImageBitmap"),createImageBitmap(e).then(e=>{l=e})):null;throw new Error('".from" should be image or canvas')}).then(()=>{if(i)return a;this.debug("Calculate tiles");let e=ft({width:r.width,height:r.height,srcTileSize:this.options.tile,toWidth:r.toWidth,toHeight:r.toHeight,destTileBorder:o}).map(e=>h(e));function n(){l&&(l.close(),l=null)}return this.debug("Process tiles"),Promise.all(e).then(()=>(this.debug("Finished!"),n(),t),e=>{throw n(),e})})},u=(e,t,r,n)=>{if(i)return a;let o,[s,h]=e.shift(),f=0===e.length;return n=T({},n,{toWidth:s,toHeight:h,quality:f?n.quality:Math.min(1,n.quality)}),f||((o=document.createElement("canvas")).width=s,o.height=h),l(t,f?r:o,n).then(()=>f?r:(n.width=s,n.height=h,u(e,o,r,n)))};let h=ht(n.width,n.height,n.toWidth,n.toHeight,this.options.tile,o);return u(h,e,t,n)})},vt.prototype.resizeBuffer=function(e){const t=T({},pt,e);return this.init().then(()=>this.__mathlib.resizeAndUnsharp(t))},vt.prototype.toBlob=function(e,t,r){return t=t||"image/png",new Promise(n=>{if(e.toBlob)return void e.toBlob(e=>n(e),t,r);const i=atob(e.toDataURL(t,r).split(",")[1]),a=i.length,o=new Uint8Array(a);for(let e=0;e<a;e++)o[e]=i.charCodeAt(e);n(new Blob([o],{type:t}))})},vt.prototype.debug=function(){};var yt=vt;var It=function(e){for(var t=new Array(e),r=0;r<e;++r)t[r]=r;return t},xt=Object.freeze({default:It,__moduleExports:It}),bt=function(e){return null!=e&&(Tt(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&Tt(e.slice(0,0))}(e)||!!e._isBuffer)};function Tt(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var wt=Object.freeze({default:bt,__moduleExports:bt}),Ct=xt&&It||xt,Rt=wt&&bt||wt,St="undefined"!=typeof Float64Array;function Bt(e,t){return e[0]-t[0]}function Mt(){var e,t=this.stride,r=new Array(t.length);for(e=0;e<r.length;++e)r[e]=[Math.abs(t[e]),e];r.sort(Bt);var n=new Array(r.length);for(e=0;e<n.length;++e)n[e]=r[e][1];return n}function Ot(e,t){var r=["View",t,"d",e].join("");t<0&&(r="View_Nil"+e);var n="generic"===e;if(-1===t){var i="function "+r+"(a){this.data=a;};var proto="+r+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+r+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+r+"(a){return new "+r+"(a);}";return new Function(i)()}if(0===t){i="function "+r+"(a,d) {this.data = a;this.offset = d};var proto="+r+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+r+"_copy() {return new "+r+"(this.data,this.offset)};proto.pick=function "+r+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+r+"_get(){return "+(n?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+r+"_set(v){return "+(n?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+r+"(a,b,c,d){return new "+r+"(a,d)}";return new Function("TrivialArray",i)(Dt[e][0])}i=["'use strict'"];var a=Ct(t),o=a.map(function(e){return"i"+e}),s="this.offset+"+a.map(function(e){return"this.stride["+e+"]*i"+e}).join("+"),l=a.map(function(e){return"b"+e}).join(","),u=a.map(function(e){return"c"+e}).join(",");i.push("function "+r+"(a,"+l+","+u+",d){this.data=a","this.shape=["+l+"]","this.stride=["+u+"]","this.offset=d|0}","var proto="+r+".prototype","proto.dtype='"+e+"'","proto.dimension="+t),i.push("Object.defineProperty(proto,'size',{get:function "+r+"_size(){return "+a.map(function(e){return"this.shape["+e+"]"}).join("*"),"}})"),1===t?i.push("proto.order=[0]"):(i.push("Object.defineProperty(proto,'order',{get:"),t<4?(i.push("function "+r+"_order(){"),2===t?i.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&i.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):i.push("ORDER})")),i.push("proto.set=function "+r+"_set("+o.join(",")+",v){"),n?i.push("return this.data.set("+s+",v)}"):i.push("return this.data["+s+"]=v}"),i.push("proto.get=function "+r+"_get("+o.join(",")+"){"),n?i.push("return this.data.get("+s+")}"):i.push("return this.data["+s+"]}"),i.push("proto.index=function "+r+"_index(",o.join(),"){return "+s+"}"),i.push("proto.hi=function "+r+"_hi("+o.join(",")+"){return new "+r+"(this.data,"+a.map(function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")}).join(",")+","+a.map(function(e){return"this.stride["+e+"]"}).join(",")+",this.offset)}");var h=a.map(function(e){return"a"+e+"=this.shape["+e+"]"}),f=a.map(function(e){return"c"+e+"=this.stride["+e+"]"});i.push("proto.lo=function "+r+"_lo("+o.join(",")+"){var b=this.offset,d=0,"+h.join(",")+","+f.join(","));for(var c=0;c<t;++c)i.push("if(typeof i"+c+"==='number'&&i"+c+">=0){d=i"+c+"|0;b+=c"+c+"*d;a"+c+"-=d}");i.push("return new "+r+"(this.data,"+a.map(function(e){return"a"+e}).join(",")+","+a.map(function(e){return"c"+e}).join(",")+",b)}"),i.push("proto.step=function "+r+"_step("+o.join(",")+"){var "+a.map(function(e){return"a"+e+"=this.shape["+e+"]"}).join(",")+","+a.map(function(e){return"b"+e+"=this.stride["+e+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(c=0;c<t;++c)i.push("if(typeof i"+c+"==='number'){d=i"+c+"|0;if(d<0){c+=b"+c+"*(a"+c+"-1);a"+c+"=ceil(-a"+c+"/d)}else{a"+c+"=ceil(a"+c+"/d)}b"+c+"*=d}");i.push("return new "+r+"(this.data,"+a.map(function(e){return"a"+e}).join(",")+","+a.map(function(e){return"b"+e}).join(",")+",c)}");var _=new Array(t),d=new Array(t);for(c=0;c<t;++c)_[c]="a[i"+c+"]",d[c]="b[i"+c+"]";i.push("proto.transpose=function "+r+"_transpose("+o+"){"+o.map(function(e,t){return e+"=("+e+"===undefined?"+t+":"+e+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+r+"(this.data,"+_.join(",")+","+d.join(",")+",this.offset)}"),i.push("proto.pick=function "+r+"_pick("+o+"){var a=[],b=[],c=this.offset");for(c=0;c<t;++c)i.push("if(typeof i"+c+"==='number'&&i"+c+">=0){c=(c+this.stride["+c+"]*i"+c+")|0}else{a.push(this.shape["+c+"]);b.push(this.stride["+c+"])}");return i.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),i.push("return function construct_"+r+"(data,shape,stride,offset){return new "+r+"(data,"+a.map(function(e){return"shape["+e+"]"}).join(",")+","+a.map(function(e){return"stride["+e+"]"}).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",i.join("\n"))(Dt[e],Mt)}var Dt={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]};var Nt=function(e,t,r,n){if(void 0===e)return(0,Dt.array[0])([]);"number"==typeof e&&(e=[e]),void 0===t&&(t=[e.length]);var i=t.length;if(void 0===r){r=new Array(i);for(var a=i-1,o=1;a>=0;--a)r[a]=o,o*=t[a]}if(void 0===n)for(n=0,a=0;a<i;++a)r[a]<0&&(n-=(t[a]-1)*r[a]);for(var s=function(e){if(Rt(e))return"buffer";if(St)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped"}return Array.isArray(e)?"array":"generic"}(e),l=Dt[s];l.length<=i+1;)l.push(Ot(s,l.length-1));return(0,l[i+1])(e,t,r,n)},Ut=Object.freeze({default:Nt,__moduleExports:Nt});var Ft=function(e,t,r){return 0===e.length?e:t?(r||e.sort(t),function(e,t){for(var r=1,n=e.length,i=e[0],a=e[0],o=1;o<n;++o)if(a=i,t(i=e[o],a)){if(o===r){r++;continue}e[r++]=i}return e.length=r,e}(e,t)):(r||e.sort(),function(e){for(var t=1,r=e.length,n=e[0],i=e[0],a=1;a<r;++a,i=n)if(i=n,(n=e[a])!==i){if(a===t){t++;continue}e[t++]=n}return e.length=t,e}(e))},Lt=Object.freeze({default:Ft,__moduleExports:Ft}),Pt=Lt&&Ft||Lt;function jt(e,t,r){var n,i,a=e.length,o=t.arrayArgs.length,s=t.indexArgs.length>0,l=[],u=[],h=0,f=0;for(n=0;n<a;++n)u.push(["i",n,"=0"].join(""));for(i=0;i<o;++i)for(n=0;n<a;++n)f=h,h=e[n],0===n?u.push(["d",i,"s",n,"=t",i,"p",h].join("")):u.push(["d",i,"s",n,"=(t",i,"p",h,"-s",f,"*t",i,"p",f,")"].join(""));for(u.length>0&&l.push("var "+u.join(",")),n=a-1;n>=0;--n)h=e[n],l.push(["for(i",n,"=0;i",n,"<s",h,";++i",n,"){"].join(""));for(l.push(r),n=0;n<a;++n){for(f=h,h=e[n],i=0;i<o;++i)l.push(["p",i,"+=d",i,"s",n].join(""));s&&(n>0&&l.push(["index[",f,"]-=s",f].join("")),l.push(["++index[",h,"]"].join(""))),l.push("}")}return l.join("\n")}function Vt(e,t,r){for(var n=e.body,i=[],a=[],o=0;o<e.args.length;++o){var s=e.args[o];if(!(s.count<=0)){var l=new RegExp(s.name,"g"),u="",h=t.arrayArgs.indexOf(o);switch(t.argTypes[o]){case"offset":var f=t.offsetArgIndex.indexOf(o);h=t.offsetArgs[f].array,u="+q"+f;case"array":u="p"+h+u;var c="l"+o,_="a"+h;if(0===t.arrayBlockIndices[h])1===s.count?"generic"===r[h]?s.lvalue?(i.push(["var ",c,"=",_,".get(",u,")"].join("")),n=n.replace(l,c),a.push([_,".set(",u,",",c,")"].join(""))):n=n.replace(l,[_,".get(",u,")"].join("")):n=n.replace(l,[_,"[",u,"]"].join("")):"generic"===r[h]?(i.push(["var ",c,"=",_,".get(",u,")"].join("")),n=n.replace(l,c),s.lvalue&&a.push([_,".set(",u,",",c,")"].join(""))):(i.push(["var ",c,"=",_,"[",u,"]"].join("")),n=n.replace(l,c),s.lvalue&&a.push([_,"[",u,"]=",c].join("")));else{for(var d=[s.name],g=[u],p=0;p<Math.abs(t.arrayBlockIndices[h]);p++)d.push("\\s*\\[([^\\]]+)\\]"),g.push("$"+(p+1)+"*t"+h+"b"+p);if(l=new RegExp(d.join(""),"g"),u=g.join("+"),"generic"===r[h])throw new Error("cwise: Generic arrays not supported in combination with blocks!");n=n.replace(l,[_,"[",u,"]"].join(""))}break;case"scalar":n=n.replace(l,"Y"+t.scalarArgs.indexOf(o));break;case"index":n=n.replace(l,"index");break;case"shape":n=n.replace(l,"shape")}}}return[i.join("\n"),n,a.join("\n")].join("\n").trim()}var kt=function(e,t){for(var r=t[1].length-Math.abs(e.arrayBlockIndices[0])|0,n=new Array(e.arrayArgs.length),i=new Array(e.arrayArgs.length),a=0;a<e.arrayArgs.length;++a)i[a]=t[2*a],n[a]=t[2*a+1];var o=[],s=[],l=[],u=[],h=[];for(a=0;a<e.arrayArgs.length;++a){e.arrayBlockIndices[a]<0?(l.push(0),u.push(r),o.push(r),s.push(r+e.arrayBlockIndices[a])):(l.push(e.arrayBlockIndices[a]),u.push(e.arrayBlockIndices[a]+r),o.push(0),s.push(e.arrayBlockIndices[a]));for(var f=[],c=0;c<n[a].length;c++)l[a]<=n[a][c]&&n[a][c]<u[a]&&f.push(n[a][c]-l[a]);h.push(f)}var _=["SS"],d=["'use strict'"],g=[];for(c=0;c<r;++c)g.push(["s",c,"=SS[",c,"]"].join(""));for(a=0;a<e.arrayArgs.length;++a){for(_.push("a"+a),_.push("t"+a),_.push("p"+a),c=0;c<r;++c)g.push(["t",a,"p",c,"=t",a,"[",l[a]+c,"]"].join(""));for(c=0;c<Math.abs(e.arrayBlockIndices[a]);++c)g.push(["t",a,"b",c,"=t",a,"[",o[a]+c,"]"].join(""))}for(a=0;a<e.scalarArgs.length;++a)_.push("Y"+a);if(e.shapeArgs.length>0&&g.push("shape=SS.slice(0)"),e.indexArgs.length>0){var p=new Array(r);for(a=0;a<r;++a)p[a]="0";g.push(["index=[",p.join(","),"]"].join(""))}for(a=0;a<e.offsetArgs.length;++a){var A=e.offsetArgs[a],m=[];for(c=0;c<A.offset.length;++c)0!==A.offset[c]&&(1===A.offset[c]?m.push(["t",A.array,"p",c].join("")):m.push([A.offset[c],"*t",A.array,"p",c].join("")));0===m.length?g.push("q"+a+"=0"):g.push(["q",a,"=",m.join("+")].join(""))}var E=Pt([].concat(e.pre.thisVars).concat(e.body.thisVars).concat(e.post.thisVars));for((g=g.concat(E)).length>0&&d.push("var "+g.join(",")),a=0;a<e.arrayArgs.length;++a)d.push("p"+a+"|=0");e.pre.body.length>3&&d.push(Vt(e.pre,e,i));var v=Vt(e.body,e,i),y=function(e){for(var t=0,r=e[0].length;t<r;){for(var n=1;n<e.length;++n)if(e[n][t]!==e[0][t])return t;++t}return t}(h);y<r?d.push(function(e,t,r,n){for(var i=t.length,a=r.arrayArgs.length,o=r.blockSize,s=r.indexArgs.length>0,l=[],u=0;u<a;++u)l.push(["var offset",u,"=p",u].join(""));for(u=e;u<i;++u)l.push(["for(var j"+u+"=SS[",t[u],"]|0;j",u,">0;){"].join("")),l.push(["if(j",u,"<",o,"){"].join("")),l.push(["s",t[u],"=j",u].join("")),l.push(["j",u,"=0"].join("")),l.push(["}else{s",t[u],"=",o].join("")),l.push(["j",u,"-=",o,"}"].join("")),s&&l.push(["index[",t[u],"]=j",u].join(""));for(u=0;u<a;++u){for(var h=["offset"+u],f=e;f<i;++f)h.push(["j",f,"*t",u,"p",t[f]].join(""));l.push(["p",u,"=(",h.join("+"),")"].join(""))}for(l.push(jt(t,r,n)),u=e;u<i;++u)l.push("}");return l.join("\n")}(y,h[0],e,v)):d.push(jt(h[0],e,v)),e.post.body.length>3&&d.push(Vt(e.post,e,i)),e.debug&&console.log("-----Generated cwise routine for ",t,":\n"+d.join("\n")+"\n----------");var I=[e.funcName||"unnamed","_cwise_loop_",n[0].join("s"),"m",y,function(e){for(var t=new Array(e.length),r=!0,n=0;n<e.length;++n){var i=e[n],a=i.match(/\d+/);a=a?a[0]:"",0===i.charAt(0)?t[n]="u"+i.charAt(1)+a:t[n]=i.charAt(0)+a,n>0&&(r=r&&t[n]===t[n-1])}return r?t[0]:t.join("")}(i)].join("");return new Function(["function ",I,"(",_.join(","),"){",d.join("\n"),"} return ",I].join(""))()},Xt=Object.freeze({default:kt,__moduleExports:kt}),Qt=Xt&&kt||Xt;var Gt=function(e){var t=["'use strict'","var CACHED={}"],r=[],n=e.funcName+"_cwise_thunk";t.push(["return function ",n,"(",e.shimArgs.join(","),"){"].join(""));for(var i=[],a=[],o=[["array",e.arrayArgs[0],".shape.slice(",Math.max(0,e.arrayBlockIndices[0]),e.arrayBlockIndices[0]<0?","+e.arrayBlockIndices[0]+")":")"].join("")],s=[],l=[],u=0;u<e.arrayArgs.length;++u){var h=e.arrayArgs[u];r.push(["t",h,"=array",h,".dtype,","r",h,"=array",h,".order"].join("")),i.push("t"+h),i.push("r"+h),a.push("t"+h),a.push("r"+h+".join()"),o.push("array"+h+".data"),o.push("array"+h+".stride"),o.push("array"+h+".offset|0"),u>0&&(s.push("array"+e.arrayArgs[0]+".shape.length===array"+h+".shape.length+"+(Math.abs(e.arrayBlockIndices[0])-Math.abs(e.arrayBlockIndices[u]))),l.push("array"+e.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[0])+"]===array"+h+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[u])+"]"))}for(e.arrayArgs.length>1&&(t.push("if (!("+s.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),t.push("for(var shapeIndex=array"+e.arrayArgs[0]+".shape.length-"+Math.abs(e.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),t.push("if (!("+l.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),t.push("}")),u=0;u<e.scalarArgs.length;++u)o.push("scalar"+e.scalarArgs[u]);return r.push(["type=[",a.join(","),"].join()"].join("")),r.push("proc=CACHED[type]"),t.push("var "+r.join(",")),t.push(["if(!proc){","CACHED[type]=proc=compile([",i.join(","),"])}","return proc(",o.join(","),")}"].join("")),e.debug&&console.log("-----Generated thunk:\n"+t.join("\n")+"\n----------"),new Function("compile",t.join("\n"))(Qt.bind(void 0,e))},zt=Object.freeze({default:Gt,__moduleExports:Gt}),Ht=zt&&Gt||zt;var qt=function(e){var t=new function(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1};t.pre=e.pre,t.body=e.body,t.post=e.post;var r=e.args.slice(0);t.argTypes=r;for(var n=0;n<r.length;++n){var i=r[n];if("array"===i||"object"==typeof i&&i.blockIndices){if(t.argTypes[n]="array",t.arrayArgs.push(n),t.arrayBlockIndices.push(i.blockIndices?i.blockIndices:0),t.shimArgs.push("array"+n),n<t.pre.args.length&&t.pre.args[n].count>0)throw new Error("cwise: pre() block may not reference array args");if(n<t.post.args.length&&t.post.args[n].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===i)t.scalarArgs.push(n),t.shimArgs.push("scalar"+n);else if("index"===i){if(t.indexArgs.push(n),n<t.pre.args.length&&t.pre.args[n].count>0)throw new Error("cwise: pre() block may not reference array index");if(n<t.body.args.length&&t.body.args[n].lvalue)throw new Error("cwise: body() block may not write to array index");if(n<t.post.args.length&&t.post.args[n].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===i){if(t.shapeArgs.push(n),n<t.pre.args.length&&t.pre.args[n].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(n<t.body.args.length&&t.body.args[n].lvalue)throw new Error("cwise: body() block may not write to array shape");if(n<t.post.args.length&&t.post.args[n].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof i||!i.offset)throw new Error("cwise: Unknown argument type "+r[n]);t.argTypes[n]="offset",t.offsetArgs.push({array:i.array,offset:i.offset}),t.offsetArgIndex.push(n)}}if(t.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(t.pre.args.length>r.length)throw new Error("cwise: Too many arguments in pre() block");if(t.body.args.length>r.length)throw new Error("cwise: Too many arguments in body() block");if(t.post.args.length>r.length)throw new Error("cwise: Too many arguments in post() block");return t.debug=!!e.printCode||!!e.debug,t.funcName=e.funcName||"cwise",t.blockSize=e.blockSize||64,Ht(t)},Yt=Object.freeze({default:qt,__moduleExports:qt}),Wt=Yt&&qt||Yt,Kt=d(function(e,t){var r={body:"",args:[],thisVars:[],localVars:[]};function n(e){if(!e)return r;for(var t=0;t<e.args.length;++t){var n=e.args[t];e.args[t]=0===t?{name:n,lvalue:!0,rvalue:!!e.rvalue,count:e.count||1}:{name:n,lvalue:!1,rvalue:!0,count:1}}return e.thisVars||(e.thisVars=[]),e.localVars||(e.localVars=[]),e}function i(e){for(var t=[],r=0;r<e.args.length;++r)t.push("a"+r);return new Function("P",["return function ",e.funcName,"_ndarrayops(",t.join(","),") {P(",t.join(","),");return a0}"].join(""))(function(e){return Wt({args:e.args,pre:n(e.pre),body:n(e.body),post:n(e.proc),funcName:e.funcName})}(e))}var a={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var e in a){var r=a[e];t[e]=i({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:e}),t[e+"eq"]=i({args:["array","array"],body:{args:["a","b"],body:"a"+r+"=b"},rvalue:!0,funcName:e+"eq"}),t[e+"s"]=i({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:e+"s"}),t[e+"seq"]=i({args:["array","scalar"],body:{args:["a","s"],body:"a"+r+"=s"},rvalue:!0,funcName:e+"seq"})}}();var o={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var e in o){var r=o[e];t[e]=i({args:["array","array"],body:{args:["a","b"],body:"a="+r+"b"},funcName:e}),t[e+"eq"]=i({args:["array"],body:{args:["a"],body:"a="+r+"a"},rvalue:!0,count:2,funcName:e+"eq"})}}();var s={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var e in s){var r=s[e];t[e]=i({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:e}),t[e+"s"]=i({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:e+"s"}),t[e+"eq"]=i({args:["array","array"],body:{args:["a","b"],body:"a=a"+r+"b"},rvalue:!0,count:2,funcName:e+"eq"}),t[e+"seq"]=i({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+r+"s"},rvalue:!0,count:2,funcName:e+"seq"})}}();var l=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var e=0;e<l.length;++e){var r=l[e];t[r]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:r}),t[r+"eq"]=i({args:["array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"eq"})}}();var u=["max","min","atan2","pow"];!function(){for(var e=0;e<u.length;++e){var r=u[e];t[r]=i({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r}),t[r+"s"]=i({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r+"s"}),t[r+"eq"]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"eq"}),t[r+"seq"]=i({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"seq"})}}();var h=["atan2","pow"];!function(){for(var e=0;e<h.length;++e){var r=h[e];t[r+"op"]=i({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"op"}),t[r+"ops"]=i({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"ops"}),t[r+"opeq"]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"opeq"}),t[r+"opseq"]=i({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"opseq"})}}(),t.any=Wt({args:["array"],pre:r,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),t.all=Wt({args:["array"],pre:r,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),t.sum=Wt({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),t.prod=Wt({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),t.norm2squared=Wt({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),t.norm2=Wt({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),t.norminf=Wt({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),t.norm1=Wt({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),t.sup=Wt({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.inf=Wt({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.argmin=Wt({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.argmax=Wt({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.random=i({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),t.assign=i({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),t.assigns=i({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),t.equals=Wt({args:["array","array"],pre:r,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})}),Zt=Kt.any,Jt=Kt.all,$t=Kt.sum,er=Kt.prod,tr=Kt.norm2squared,rr=Kt.norm2,nr=Kt.norminf,ir=Kt.norm1,ar=Kt.sup,or=Kt.inf,sr=Kt.argmin,lr=Kt.argmax,ur=Kt.random,hr=Kt.assign,fr=Kt.assigns,cr=Kt.equals,_r=Object.freeze({default:Kt,__moduleExports:Kt,any:Zt,all:Jt,sum:$t,prod:er,norm2squared:tr,norm2:rr,norminf:nr,norm1:ir,sup:ar,inf:or,argmin:sr,argmax:lr,random:ur,assign:hr,assigns:fr,equals:cr}),dr=function(e){return(e>0)-(e<0)},gr=function(e){var t=e>>31;return(e^t)-t},pr=function(e,t){return t^(e^t)&-(e<t)},Ar=function(e,t){return e^(e^t)&-(e<t)},mr=function(e){return!(e&e-1||!e)},Er=function(e){var t,r;return t=(e>65535)<<4,t|=r=((e>>>=t)>255)<<3,t|=r=((e>>>=r)>15)<<2,(t|=r=((e>>>=r)>3)<<1)|(e>>>=r)>>1},vr=function(e){return e>=1e9?9:e>=1e8?8:e>=1e7?7:e>=1e6?6:e>=1e5?5:e>=1e4?4:e>=1e3?3:e>=100?2:e>=10?1:0},yr=function(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24};function Ir(e){var t=32;return(e&=-e)&&t--,65535&e&&(t-=16),16711935&e&&(t-=8),252645135&e&&(t-=4),858993459&e&&(t-=2),1431655765&e&&(t-=1),t}var xr=Ir,br=function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1},Tr=function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},wr=function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,27030>>>(e&=15)&1},Cr=new Array(256);!function(e){for(var t=0;t<256;++t){var r=t,n=t,i=7;for(r>>>=1;r;r>>>=1)n<<=1,n|=1&r,--i;e[t]=n<<i&255}}(Cr);var Rr=function(e){return Cr[255&e]<<24|Cr[e>>>8&255]<<16|Cr[e>>>16&255]<<8|Cr[e>>>24&255]},Sr=function(e,t){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))<<1},Br=function(e,t){return(e=65535&((e=16711935&((e=252645135&((e=858993459&((e=e>>>t&1431655765)|e>>>1))|e>>>2))|e>>>4))|e>>>16))<<16>>16},Mr=function(e,t,r){return e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2),(e|=(t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2))<<1)|(r=1227133513&((r=3272356035&((r=251719695&((r=4278190335&((r&=1023)|r<<16))|r<<8))|r<<4))|r<<2))<<2},Or=function(e,t){return(e=1023&((e=4278190335&((e=251719695&((e=3272356035&((e=e>>>t&1227133513)|e>>>2))|e>>>4))|e>>>8))|e>>>16))<<22>>22},Dr=function(e){var t=e|e-1;return t+1|(~t&-~t)-1>>>Ir(e)+1},Nr={INT_BITS:32,INT_MAX:2147483647,INT_MIN:-1<<31,sign:dr,abs:gr,min:pr,max:Ar,isPow2:mr,log2:Er,log10:vr,popCount:yr,countTrailingZeros:xr,nextPow2:br,prevPow2:Tr,parity:wr,reverse:Rr,interleave2:Sr,deinterleave2:Br,interleave3:Mr,deinterleave3:Or,nextCombination:Dr},Ur=Object.freeze({default:Nr,__moduleExports:Nr,INT_BITS:32,INT_MAX:2147483647,INT_MIN:-1<<31,sign:dr,abs:gr,min:pr,max:Ar,isPow2:mr,log2:Er,log10:vr,popCount:yr,countTrailingZeros:xr,nextPow2:br,prevPow2:Tr,parity:wr,reverse:Rr,interleave2:Sr,deinterleave2:Br,interleave3:Mr,deinterleave3:Or,nextCombination:Dr});var Fr=function(e,t){switch(void 0===t&&(t=0),typeof e){case"number":if(e>0)return function(e,t){var r,n;for(r=new Array(e),n=0;n<e;++n)r[n]=t;return r}(0|e,t);break;case"object":if("number"==typeof e.length)return function e(t,r,n){var i=0|t[n];if(i<=0)return[];var a,o=new Array(i);if(n===t.length-1)for(a=0;a<i;++a)o[a]=r;else for(a=0;a<i;++a)o[a]=e(t,r,n+1);return o}(e,t,0)}return[]},Lr=Object.freeze({default:Fr,__moduleExports:Fr}),Pr=Ur&&Nr||Ur,jr=Lr&&Fr||Lr,Vr=d(function(e,t){c.__TYPEDARRAY_POOL||(c.__TYPEDARRAY_POOL={UINT8:jr([32,0]),UINT16:jr([32,0]),UINT32:jr([32,0]),INT8:jr([32,0]),INT16:jr([32,0]),INT32:jr([32,0]),FLOAT:jr([32,0]),DOUBLE:jr([32,0]),DATA:jr([32,0]),UINT8C:jr([32,0]),BUFFER:jr([32,0])});var r="undefined"!=typeof Uint8ClampedArray,n=c.__TYPEDARRAY_POOL;n.UINT8C||(n.UINT8C=jr([32,0])),n.BUFFER||(n.BUFFER=jr([32,0]));var i=n.DATA,a=n.BUFFER;function o(e){if(e){var t=e.length||e.byteLength,r=Pr.log2(t);i[r].push(e)}}function s(e){e=Pr.nextPow2(e);var t=Pr.log2(e),r=i[t];return r.length>0?r.pop():new ArrayBuffer(e)}function l(e){return new Uint8Array(s(e),0,e)}function u(e){return new Uint16Array(s(2*e),0,e)}function h(e){return new Uint32Array(s(4*e),0,e)}function f(e){return new Int8Array(s(e),0,e)}function _(e){return new Int16Array(s(2*e),0,e)}function d(e){return new Int32Array(s(4*e),0,e)}function g(e){return new Float32Array(s(4*e),0,e)}function p(e){return new Float64Array(s(8*e),0,e)}function A(e){return r?new Uint8ClampedArray(s(e),0,e):l(e)}function m(e){return new DataView(s(e),0,e)}function E(e){e=Pr.nextPow2(e);var t=Pr.log2(e),r=a[t];return r.length>0?r.pop():new Buffer(e)}t.free=function(e){if(Buffer.isBuffer(e))a[Pr.log2(e.length)].push(e);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(e)&&(e=e.buffer),!e)return;var t=e.length||e.byteLength,r=0|Pr.log2(t);i[r].push(e)}},t.freeUint8=t.freeUint16=t.freeUint32=t.freeInt8=t.freeInt16=t.freeInt32=t.freeFloat32=t.freeFloat=t.freeFloat64=t.freeDouble=t.freeUint8Clamped=t.freeDataView=function(e){o(e.buffer)},t.freeArrayBuffer=o,t.freeBuffer=function(e){a[Pr.log2(e.length)].push(e)},t.malloc=function(e,t){if(void 0===t||"arraybuffer"===t)return s(e);switch(t){case"uint8":return l(e);case"uint16":return u(e);case"uint32":return h(e);case"int8":return f(e);case"int16":return _(e);case"int32":return d(e);case"float":case"float32":return g(e);case"double":case"float64":return p(e);case"uint8_clamped":return A(e);case"buffer":return E(e);case"data":case"dataview":return m(e);default:return null}return null},t.mallocArrayBuffer=s,t.mallocUint8=l,t.mallocUint16=u,t.mallocUint32=h,t.mallocInt8=f,t.mallocInt16=_,t.mallocInt32=d,t.mallocFloat32=t.mallocFloat=g,t.mallocFloat64=t.mallocDouble=p,t.mallocUint8Clamped=A,t.mallocDataView=m,t.mallocBuffer=E,t.clearCache=function(){for(var e=0;e<32;++e)n.UINT8[e].length=0,n.UINT16[e].length=0,n.UINT32[e].length=0,n.INT8[e].length=0,n.INT16[e].length=0,n.INT32[e].length=0,n.FLOAT[e].length=0,n.DOUBLE[e].length=0,n.UINT8C[e].length=0,i[e].length=0,a[e].length=0}}),kr=Vr.free,Xr=Vr.freeUint8,Qr=Vr.freeUint16,Gr=Vr.freeUint32,zr=Vr.freeInt8,Hr=Vr.freeInt16,qr=Vr.freeInt32,Yr=Vr.freeFloat32,Wr=Vr.freeFloat,Kr=Vr.freeFloat64,Zr=Vr.freeDouble,Jr=Vr.freeUint8Clamped,$r=Vr.freeDataView,en=Vr.freeArrayBuffer,tn=Vr.freeBuffer,rn=Vr.malloc,nn=Vr.mallocArrayBuffer,an=Vr.mallocUint8,on=Vr.mallocUint16,sn=Vr.mallocUint32,ln=Vr.mallocInt8,un=Vr.mallocInt16,hn=Vr.mallocInt32,fn=Vr.mallocFloat32,cn=Vr.mallocFloat,_n=Vr.mallocFloat64,dn=Vr.mallocDouble,gn=Vr.mallocUint8Clamped,pn=Vr.mallocDataView,An=Vr.mallocBuffer,mn=Vr.clearCache,En=Object.freeze({default:Vr,__moduleExports:Vr,free:kr,freeUint8:Xr,freeUint16:Qr,freeUint32:Gr,freeInt8:zr,freeInt16:Hr,freeInt32:qr,freeFloat32:Yr,freeFloat:Wr,freeFloat64:Kr,freeDouble:Zr,freeUint8Clamped:Jr,freeDataView:$r,freeArrayBuffer:en,freeBuffer:tn,malloc:rn,mallocArrayBuffer:nn,mallocUint8:an,mallocUint16:on,mallocUint32:sn,mallocInt8:ln,mallocInt16:un,mallocInt32:hn,mallocFloat32:fn,mallocFloat:cn,mallocFloat64:_n,mallocDouble:dn,mallocUint8Clamped:gn,mallocDataView:pn,mallocBuffer:An,clearCache:mn}),vn=Ut&&Nt||Ut,yn=_r&&Kt||_r,In=En&&Vr||En,xn=function(e){if(arguments.length<=1)throw new Error("gl-texture2d: Missing arguments for texture2d constructor");bn||function(e){bn=[e.LINEAR,e.NEAREST_MIPMAP_LINEAR,e.LINEAR_MIPMAP_NEAREST,e.LINEAR_MIPMAP_NEAREST],Tn=[e.NEAREST,e.LINEAR,e.NEAREST_MIPMAP_NEAREST,e.NEAREST_MIPMAP_LINEAR,e.LINEAR_MIPMAP_NEAREST,e.LINEAR_MIPMAP_LINEAR],wn=[e.REPEAT,e.CLAMP_TO_EDGE,e.MIRRORED_REPEAT]}(e);if("number"==typeof arguments[1])return Nn(e,arguments[1],arguments[2],arguments[3]||e.RGBA,arguments[4]||e.UNSIGNED_BYTE);if(Array.isArray(arguments[1]))return Nn(e,0|arguments[1][0],0|arguments[1][1],arguments[2]||e.RGBA,arguments[3]||e.UNSIGNED_BYTE);if("object"==typeof arguments[1]){var t=arguments[1],r=Cn(t)?t:t.raw;if(r)return function(e,t,r,n,i,a){var o=Dn(e);return e.texImage2D(e.TEXTURE_2D,0,i,i,a,t),new Bn(e,o,r,n,i,a)}(e,r,0|t.width,0|t.height,arguments[2]||e.RGBA,arguments[3]||e.UNSIGNED_BYTE);if(t.shape&&t.data&&t.stride)return function(e,t){var r=t.dtype,n=t.shape.slice(),i=e.getParameter(e.MAX_TEXTURE_SIZE);if(n[0]<0||n[0]>i||n[1]<0||n[1]>i)throw new Error("gl-texture2d: Invalid texture size");var a=On(n,t.stride.slice()),o=0;"float32"===r?o=e.FLOAT:"float64"===r?(o=e.FLOAT,a=!1,r="float32"):"uint8"===r?o=e.UNSIGNED_BYTE:(o=e.UNSIGNED_BYTE,a=!1,r="uint8");var s,l,u=0;if(2===n.length)u=e.LUMINANCE,n=[n[0],n[1],1],t=vn(t.data,n,[t.stride[0],t.stride[1],1],t.offset);else{if(3!==n.length)throw new Error("gl-texture2d: Invalid shape for texture");if(1===n[2])u=e.ALPHA;else if(2===n[2])u=e.LUMINANCE_ALPHA;else if(3===n[2])u=e.RGB;else{if(4!==n[2])throw new Error("gl-texture2d: Invalid shape for pixel coords");u=e.RGBA}}o!==e.FLOAT||e.getExtension("OES_texture_float")||(o=e.UNSIGNED_BYTE,a=!1);var h=t.size;if(a)s=0===t.offset&&t.data.length===h?t.data:t.data.subarray(t.offset,t.offset+h);else{var f=[n[2],n[2]*n[0],1];l=In.malloc(h,r);var c=vn(l,n,f,0);"float32"!==r&&"float64"!==r||o!==e.UNSIGNED_BYTE?yn.assign(c,t):Rn(c,t),s=l.subarray(0,h)}var _=Dn(e);e.texImage2D(e.TEXTURE_2D,0,u,n[0],n[1],0,u,o,s),a||In.free(l);return new Bn(e,_,n[0],n[1],u,o)}(e,t)}throw new Error("gl-texture2d: Invalid arguments for texture2d constructor")},bn=null,Tn=null,wn=null;function Cn(e){return"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement||"undefined"!=typeof ImageData&&e instanceof ImageData}var Rn=function(e,t){yn.muls(e,t,255)};function Sn(e,t,r){var n=e.gl,i=n.getParameter(n.MAX_TEXTURE_SIZE);if(t<0||t>i||r<0||r>i)throw new Error("gl-texture2d: Invalid texture size");return e._shape=[t,r],e.bind(),n.texImage2D(n.TEXTURE_2D,0,e.format,t,r,0,e.format,e.type,null),e._mipLevels=[0],e}function Bn(e,t,r,n,i,a){this.gl=e,this.handle=t,this.format=i,this.type=a,this._shape=[r,n],this._mipLevels=[0],this._magFilter=e.NEAREST,this._minFilter=e.NEAREST,this._wrapS=e.CLAMP_TO_EDGE,this._wrapT=e.CLAMP_TO_EDGE,this._anisoSamples=1;var o=this,s=[this._wrapS,this._wrapT];Object.defineProperties(s,[{get:function(){return o._wrapS},set:function(e){return o.wrapS=e}},{get:function(){return o._wrapT},set:function(e){return o.wrapT=e}}]),this._wrapVector=s;var l=[this._shape[0],this._shape[1]];Object.defineProperties(l,[{get:function(){return o._shape[0]},set:function(e){return o.width=e}},{get:function(){return o._shape[1]},set:function(e){return o.height=e}}]),this._shapeVector=l}var Mn=Bn.prototype;function On(e,t){return 3===e.length?1===t[2]&&t[1]===e[0]*e[2]&&t[0]===e[2]:1===t[0]&&t[1]===e[0]}function Dn(e){var t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t}function Nn(e,t,r,n,i){var a=e.getParameter(e.MAX_TEXTURE_SIZE);if(t<0||t>a||r<0||r>a)throw new Error("gl-texture2d: Invalid texture shape");if(i===e.FLOAT&&!e.getExtension("OES_texture_float"))throw new Error("gl-texture2d: Floating point textures not supported on this platform");var o=Dn(e);return e.texImage2D(e.TEXTURE_2D,0,n,t,r,0,n,i,null),new Bn(e,o,t,r,n,i)}Object.defineProperties(Mn,{minFilter:{get:function(){return this._minFilter},set:function(e){this.bind();var t=this.gl;if(this.type===t.FLOAT&&bn.indexOf(e)>=0&&(t.getExtension("OES_texture_float_linear")||(e=t.NEAREST)),Tn.indexOf(e)<0)throw new Error("gl-texture2d: Unknown filter mode "+e);return t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e),this._minFilter=e}},magFilter:{get:function(){return this._magFilter},set:function(e){this.bind();var t=this.gl;if(this.type===t.FLOAT&&bn.indexOf(e)>=0&&(t.getExtension("OES_texture_float_linear")||(e=t.NEAREST)),Tn.indexOf(e)<0)throw new Error("gl-texture2d: Unknown filter mode "+e);return t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e),this._magFilter=e}},mipSamples:{get:function(){return this._anisoSamples},set:function(e){var t=this._anisoSamples;if(this._anisoSamples=0|Math.max(e,1),t!==this._anisoSamples){var r=this.gl.getExtension("EXT_texture_filter_anisotropic");r&&this.gl.texParameterf(this.gl.TEXTURE_2D,r.TEXTURE_MAX_ANISOTROPY_EXT,this._anisoSamples)}return this._anisoSamples}},wrapS:{get:function(){return this._wrapS},set:function(e){if(this.bind(),wn.indexOf(e)<0)throw new Error("gl-texture2d: Unknown wrap mode "+e);return this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,e),this._wrapS=e}},wrapT:{get:function(){return this._wrapT},set:function(e){if(this.bind(),wn.indexOf(e)<0)throw new Error("gl-texture2d: Unknown wrap mode "+e);return this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,e),this._wrapT=e}},wrap:{get:function(){return this._wrapVector},set:function(e){if(Array.isArray(e)||(e=[e,e]),2!==e.length)throw new Error("gl-texture2d: Must specify wrap mode for rows and columns");for(var t=0;t<2;++t)if(wn.indexOf(e[t])<0)throw new Error("gl-texture2d: Unknown wrap mode "+e);this._wrapS=e[0],this._wrapT=e[1];var r=this.gl;return this.bind(),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,this._wrapS),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,this._wrapT),e}},shape:{get:function(){return this._shapeVector},set:function(e){if(Array.isArray(e)){if(2!==e.length)throw new Error("gl-texture2d: Invalid texture shape")}else e=[0|e,0|e];return Sn(this,0|e[0],0|e[1]),[0|e[0],0|e[1]]}},width:{get:function(){return this._shape[0]},set:function(e){return Sn(this,e|=0,this._shape[1]),e}},height:{get:function(){return this._shape[1]},set:function(e){return e|=0,Sn(this,this._shape[0],e),e}}}),Mn.bind=function(e){var t=this.gl;return void 0!==e&&t.activeTexture(t.TEXTURE0+(0|e)),t.bindTexture(t.TEXTURE_2D,this.handle),void 0!==e?0|e:t.getParameter(t.ACTIVE_TEXTURE)-t.TEXTURE0},Mn.dispose=function(){this.gl.deleteTexture(this.handle)},Mn.generateMipmap=function(){this.bind(),this.gl.generateMipmap(this.gl.TEXTURE_2D);for(var e=Math.min(this._shape[0],this._shape[1]),t=0;e>0;++t,e>>>=1)this._mipLevels.indexOf(t)<0&&this._mipLevels.push(t)},Mn.setPixels=function(e,t,r,n){var i=this.gl;this.bind(),Array.isArray(t)?(n=r,r=0|t[1],t=0|t[0]):(t=t||0,r=r||0),n=n||0;var a=Cn(e)?e:e.raw;if(a){this._mipLevels.indexOf(n)<0?(i.texImage2D(i.TEXTURE_2D,0,this.format,this.format,this.type,a),this._mipLevels.push(n)):i.texSubImage2D(i.TEXTURE_2D,n,t,r,this.format,this.type,a)}else{if(!(e.shape&&e.stride&&e.data))throw new Error("gl-texture2d: Unsupported data type");if(e.shape.length<2||t+e.shape[1]>this._shape[1]>>>n||r+e.shape[0]>this._shape[0]>>>n||t<0||r<0)throw new Error("gl-texture2d: Texture dimensions are out of bounds");!function(e,t,r,n,i,a,o,s){var l=s.dtype,u=s.shape.slice();if(u.length<2||u.length>3)throw new Error("gl-texture2d: Invalid ndarray, must be 2d or 3d");var h=0,f=0,c=On(u,s.stride.slice());"float32"===l?h=e.FLOAT:"float64"===l?(h=e.FLOAT,c=!1,l="float32"):"uint8"===l?h=e.UNSIGNED_BYTE:(h=e.UNSIGNED_BYTE,c=!1,l="uint8");if(2===u.length)f=e.LUMINANCE,u=[u[0],u[1],1],s=vn(s.data,u,[s.stride[0],s.stride[1],1],s.offset);else{if(3!==u.length)throw new Error("gl-texture2d: Invalid shape for texture");if(1===u[2])f=e.ALPHA;else if(2===u[2])f=e.LUMINANCE_ALPHA;else if(3===u[2])f=e.RGB;else{if(4!==u[2])throw new Error("gl-texture2d: Invalid shape for pixel coords");f=e.RGBA}u[2]}f!==e.LUMINANCE&&f!==e.ALPHA||i!==e.LUMINANCE&&i!==e.ALPHA||(f=i);if(f!==i)throw new Error("gl-texture2d: Incompatible texture format for setPixels");var _=s.size,d=o.indexOf(n)<0;d&&o.push(n);if(h===a&&c)0===s.offset&&s.data.length===_?d?e.texImage2D(e.TEXTURE_2D,n,i,u[0],u[1],0,i,a,s.data):e.texSubImage2D(e.TEXTURE_2D,n,t,r,u[0],u[1],i,a,s.data):d?e.texImage2D(e.TEXTURE_2D,n,i,u[0],u[1],0,i,a,s.data.subarray(s.offset,s.offset+_)):e.texSubImage2D(e.TEXTURE_2D,n,t,r,u[0],u[1],i,a,s.data.subarray(s.offset,s.offset+_));else{var g;g=a===e.FLOAT?In.mallocFloat32(_):In.mallocUint8(_);var p=vn(g,u,[u[2],u[2]*u[0],1]);h===e.FLOAT&&a===e.UNSIGNED_BYTE?Rn(p,s):yn.assign(p,s),d?e.texImage2D(e.TEXTURE_2D,n,i,u[0],u[1],0,i,a,g.subarray(0,_)):e.texSubImage2D(e.TEXTURE_2D,n,t,r,u[0],u[1],i,a,g.subarray(0,_)),a===e.FLOAT?In.freeFloat32(g):In.freeUint8(g)}}(i,t,r,n,this.format,this.type,this._mipLevels,e)}};var Un=function(e,t){for(var r={},n=0;n<e.length;++n)for(var i=e[n].name,a=i.split("."),o=r,s=0;s<a.length;++s){var l=a[s].split("[");if(l.length>1){l[0]in o||(o[l[0]]=[]),o=o[l[0]];for(var u=1;u<l.length;++u){var h=parseInt(l[u]);u<l.length-1||s<a.length-1?(h in o||(u<l.length-1?o[h]=[]:o[h]={}),o=o[h]):o[h]=t?n:e[n].type}}else s<a.length-1?(l[0]in o||(o[l[0]]={}),o=o[l[0]]):o[l[0]]=t?n:e[n].type}return r};var Fn=Object.freeze({default:Un,__moduleExports:Un});function Ln(e,t,r){this.shortMessage=t||"",this.longMessage=r||"",this.rawError=e||"",this.message="gl-shader: "+(t||e||"")+(r?"\n"+r:""),this.stack=(new Error).stack}Ln.prototype=new Error,Ln.prototype.name="GLError",Ln.prototype.constructor=Ln;var Pn=Ln,jn=Object.freeze({default:Pn,__moduleExports:Pn}),Vn=Fn&&Un||Fn,kn=jn&&Pn||jn,Xn=function(e,t,r,n){function i(e,t,r){switch(r){case"bool":case"int":case"sampler2D":case"samplerCube":return"gl.uniform1i(locations["+t+"],obj"+e+")";case"float":return"gl.uniform1f(locations["+t+"],obj"+e+")";default:var n=r.indexOf("vec");if(!(0<=n&&n<=1&&r.length===4+n)){if(0===r.indexOf("mat")&&4===r.length){var i=r.charCodeAt(r.length-1)-48;if(i<2||i>4)throw new kn("","Invalid uniform dimension type for matrix "+name+": "+r);return"gl.uniformMatrix"+i+"fv(locations["+t+"],false,obj"+e+")"}throw new kn("","Unknown uniform data type for "+name+": "+r)}var i=r.charCodeAt(r.length-1)-48;if(i<2||i>4)throw new kn("","Invalid data type");switch(r.charAt(0)){case"b":case"i":return"gl.uniform"+i+"iv(locations["+t+"],obj"+e+")";case"v":return"gl.uniform"+i+"fv(locations["+t+"],obj"+e+")";default:throw new kn("","Unrecognized data type for vector "+name+": "+r)}}}function a(t){for(var a=["return function updateProperty(obj){"],o=function e(t,r){if("object"!=typeof r)return[[t,r]];var n=[];for(var i in r){var a=r[i],o=t;parseInt(i)+""===i?o+="["+i+"]":o+="."+i,"object"==typeof a?n.push.apply(n,e(o,a)):n.push([o,a])}return n}("",t),s=0;s<o.length;++s){var l=o[s],u=l[0],h=l[1];n[h]&&a.push(i(u,h,r[h].type))}a.push("return obj}");var f=new Function("gl","locations",a.join("\n"));return f(e,n)}function o(i,o,l){if("object"==typeof l){var u=s(l);Object.defineProperty(i,o,{get:Qn(u),set:a(l),enumerable:!0,configurable:!1})}else n[l]?Object.defineProperty(i,o,{get:(h=l,new Function("gl","wrapper","locations","return function(){return gl.getUniform(wrapper.program,locations["+h+"])}")(e,t,n)),set:a(l),enumerable:!0,configurable:!1}):i[o]=function(e){switch(e){case"bool":return!1;case"int":case"sampler2D":case"samplerCube":case"float":return 0;default:var t=e.indexOf("vec");if(0<=t&&t<=1&&e.length===4+t){var r=e.charCodeAt(e.length-1)-48;if(r<2||r>4)throw new kn("","Invalid data type");return"b"===e.charAt(0)?Gn(r,!1):Gn(r,0)}if(0===e.indexOf("mat")&&4===e.length){var r=e.charCodeAt(e.length-1)-48;if(r<2||r>4)throw new kn("","Invalid uniform dimension type for matrix "+name+": "+e);return Gn(r*r,0)}throw new kn("","Unknown uniform data type for "+name+": "+e)}}(r[l].type);var h}function s(e){var t;if(Array.isArray(e)){t=new Array(e.length);for(var r=0;r<e.length;++r)o(t,r,e[r])}else for(var n in t={},e)o(t,n,e[n]);return t}var l=Vn(r,!0);return{get:Qn(s(l)),set:a(l),enumerable:!0,configurable:!0}};function Qn(e){return new Function("y","return function(){return y}")(e)}function Gn(e,t){for(var r=new Array(e),n=0;n<e;++n)r[n]=t;return r}var zn=Object.freeze({default:Xn,__moduleExports:Xn}),Hn=function(e,t,r,n){for(var i={},a=0,o=r.length;a<o;++a){var s=r[a],l=s.name,u=s.type,h=s.locations;switch(u){case"bool":case"int":case"float":Wn(e,t,h[0],n,1,i,l);break;default:if(u.indexOf("vec")>=0){var f=u.charCodeAt(u.length-1)-48;if(f<2||f>4)throw new kn("","Invalid data type for attribute "+l+": "+u);Wn(e,t,h[0],n,f,i,l)}else{if(!(u.indexOf("mat")>=0))throw new kn("","Unknown data type for attribute "+l+": "+u);var f=u.charCodeAt(u.length-1)-48;if(f<2||f>4)throw new kn("","Invalid data type for attribute "+l+": "+u);Kn(e,t,h,n,f,i,l)}}}return i};function qn(e,t,r,n,i,a){this._gl=e,this._wrapper=t,this._index=r,this._locations=n,this._dimension=i,this._constFunc=a}var Yn=qn.prototype;function Wn(e,t,r,n,i,a,o){for(var s=["gl","v"],l=[],u=0;u<i;++u)s.push("x"+u),l.push("x"+u);s.push("if(x0.length===void 0){return gl.vertexAttrib"+i+"f(v,"+l.join()+")}else{return gl.vertexAttrib"+i+"fv(v,x0)}");var h=Function.apply(null,s),f=new qn(e,t,r,n,i,h);Object.defineProperty(a,o,{set:function(t){return e.disableVertexAttribArray(n[r]),h(e,n[r],t),t},get:function(){return f},enumerable:!0})}function Kn(e,t,r,n,i,a,o){for(var s=new Array(i),l=new Array(i),u=0;u<i;++u)Wn(e,t,r[u],n,i,s,u),l[u]=s[u];Object.defineProperty(s,"location",{set:function(e){if(Array.isArray(e))for(var t=0;t<i;++t)l[t].location=e[t];else for(t=0;t<i;++t)l[t].location=e+t;return e},get:function(){for(var e=new Array(i),t=0;t<i;++t)e[t]=n[r[t]];return e},enumerable:!0}),s.pointer=function(t,a,o,s){t=t||e.FLOAT,a=!!a,o=o||i*i,s=s||0;for(var l=0;l<i;++l){var u=n[r[l]];e.vertexAttribPointer(u,i,t,a,o,s+l*i),e.enableVertexAttribArray(u)}};var h=new Array(i),f=e["vertexAttrib"+i+"fv"];Object.defineProperty(a,o,{set:function(t){for(var a=0;a<i;++a){var o=n[r[a]];if(e.disableVertexAttribArray(o),Array.isArray(t[0]))f.call(e,o,t[a]);else{for(var s=0;s<i;++s)h[s]=t[i*a+s];f.call(e,o,h)}}return t},get:function(){return s},enumerable:!0})}Yn.pointer=function(e,t,r,n){var i=this._gl,a=this._locations[this._index];i.vertexAttribPointer(a,this._dimension,e||i.FLOAT,!!t,r||0,n||0),i.enableVertexAttribArray(a)},Yn.set=function(e,t,r,n){return this._constFunc(this._locations[this._index],e,t,r,n)},Object.defineProperty(Yn,"location",{get:function(){return this._locations[this._index]},set:function(e){return e!==this._locations[this._index]&&(this._locations[this._index]=0|e,this._wrapper.program=null),0|e}});var Zn=Object.freeze({default:Hn,__moduleExports:Hn}),Jn=d(function(e,t){!function(){var e={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function r(t){return function(t,n){var i,a,o,s,l,u,h,f,c,_=1,d=t.length,g="";for(a=0;a<d;a++)if("string"==typeof t[a])g+=t[a];else if("object"==typeof t[a]){if((s=t[a]).keys)for(i=n[_],o=0;o<s.keys.length;o++){if(void 0==i)throw new Error(r('[sprintf] Cannot access property "%s" of undefined value "%s"',s.keys[o],s.keys[o-1]));i=i[s.keys[o]]}else i=s.param_no?n[s.param_no]:n[_++];if(e.not_type.test(s.type)&&e.not_primitive.test(s.type)&&i instanceof Function&&(i=i()),e.numeric_arg.test(s.type)&&"number"!=typeof i&&isNaN(i))throw new TypeError(r("[sprintf] expecting number but found %T",i));switch(e.number.test(s.type)&&(f=i>=0),s.type){case"b":i=parseInt(i,10).toString(2);break;case"c":i=String.fromCharCode(parseInt(i,10));break;case"d":case"i":i=parseInt(i,10);break;case"j":i=JSON.stringify(i,null,s.width?parseInt(s.width):0);break;case"e":i=s.precision?parseFloat(i).toExponential(s.precision):parseFloat(i).toExponential();break;case"f":i=s.precision?parseFloat(i).toFixed(s.precision):parseFloat(i);break;case"g":i=s.precision?String(Number(i.toPrecision(s.precision))):parseFloat(i);break;case"o":i=(parseInt(i,10)>>>0).toString(8);break;case"s":i=String(i),i=s.precision?i.substring(0,s.precision):i;break;case"t":i=String(!!i),i=s.precision?i.substring(0,s.precision):i;break;case"T":i=Object.prototype.toString.call(i).slice(8,-1).toLowerCase(),i=s.precision?i.substring(0,s.precision):i;break;case"u":i=parseInt(i,10)>>>0;break;case"v":i=i.valueOf(),i=s.precision?i.substring(0,s.precision):i;break;case"x":i=(parseInt(i,10)>>>0).toString(16);break;case"X":i=(parseInt(i,10)>>>0).toString(16).toUpperCase()}e.json.test(s.type)?g+=i:(!e.number.test(s.type)||f&&!s.sign?c="":(c=f?"+":"-",i=i.toString().replace(e.sign,"")),u=s.pad_char?"0"===s.pad_char?"0":s.pad_char.charAt(1):" ",h=s.width-(c+i).length,l=s.width&&h>0?u.repeat(h):"",g+=s.align?c+i+l:"0"===u?c+l+i:l+c+i)}return g}(function(t){if(i[t])return i[t];var r,n=t,a=[],o=0;for(;n;){if(null!==(r=e.text.exec(n)))a.push(r[0]);else if(null!==(r=e.modulo.exec(n)))a.push("%");else{if(null===(r=e.placeholder.exec(n)))throw new SyntaxError("[sprintf] unexpected placeholder");if(r[2]){o|=1;var s=[],l=r[2],u=[];if(null===(u=e.key.exec(l)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(s.push(u[1]);""!==(l=l.substring(u[0].length));)if(null!==(u=e.key_access.exec(l)))s.push(u[1]);else{if(null===(u=e.index_access.exec(l)))throw new SyntaxError("[sprintf] failed to parse named argument key");s.push(u[1])}r[2]=s}else o|=2;if(3===o)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");a.push({placeholder:r[0],param_no:r[1],keys:r[2],sign:r[3],pad_char:r[4],align:r[5],width:r[6],precision:r[7],type:r[8]})}n=n.substring(r[0].length)}return i[t]=a}(t),arguments)}function n(e,t){return r.apply(null,[e].concat(t||[]))}var i=Object.create(null);t.sprintf=r,t.vsprintf=n,"undefined"!=typeof window&&(window.sprintf=r,window.vsprintf=n)}()}),$n=Object.freeze({default:Jn,__moduleExports:Jn}),ei={0:"NONE",1:"ONE",2:"LINE_LOOP",3:"LINE_STRIP",4:"TRIANGLES",5:"TRIANGLE_STRIP",6:"TRIANGLE_FAN",256:"DEPTH_BUFFER_BIT",512:"NEVER",513:"LESS",514:"EQUAL",515:"LEQUAL",516:"GREATER",517:"NOTEQUAL",518:"GEQUAL",519:"ALWAYS",768:"SRC_COLOR",769:"ONE_MINUS_SRC_COLOR",770:"SRC_ALPHA",771:"ONE_MINUS_SRC_ALPHA",772:"DST_ALPHA",773:"ONE_MINUS_DST_ALPHA",774:"DST_COLOR",775:"ONE_MINUS_DST_COLOR",776:"SRC_ALPHA_SATURATE",1024:"STENCIL_BUFFER_BIT",1028:"FRONT",1029:"BACK",1032:"FRONT_AND_BACK",1280:"INVALID_ENUM",1281:"INVALID_VALUE",1282:"INVALID_OPERATION",1285:"OUT_OF_MEMORY",1286:"INVALID_FRAMEBUFFER_OPERATION",2304:"CW",2305:"CCW",2849:"LINE_WIDTH",2884:"CULL_FACE",2885:"CULL_FACE_MODE",2886:"FRONT_FACE",2928:"DEPTH_RANGE",2929:"DEPTH_TEST",2930:"DEPTH_WRITEMASK",2931:"DEPTH_CLEAR_VALUE",2932:"DEPTH_FUNC",2960:"STENCIL_TEST",2961:"STENCIL_CLEAR_VALUE",2962:"STENCIL_FUNC",2963:"STENCIL_VALUE_MASK",2964:"STENCIL_FAIL",2965:"STENCIL_PASS_DEPTH_FAIL",2966:"STENCIL_PASS_DEPTH_PASS",2967:"STENCIL_REF",2968:"STENCIL_WRITEMASK",2978:"VIEWPORT",3024:"DITHER",3042:"BLEND",3088:"SCISSOR_BOX",3089:"SCISSOR_TEST",3106:"COLOR_CLEAR_VALUE",3107:"COLOR_WRITEMASK",3317:"UNPACK_ALIGNMENT",3333:"PACK_ALIGNMENT",3379:"MAX_TEXTURE_SIZE",3386:"MAX_VIEWPORT_DIMS",3408:"SUBPIXEL_BITS",3410:"RED_BITS",3411:"GREEN_BITS",3412:"BLUE_BITS",3413:"ALPHA_BITS",3414:"DEPTH_BITS",3415:"STENCIL_BITS",3553:"TEXTURE_2D",4352:"DONT_CARE",4353:"FASTEST",4354:"NICEST",5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5124:"INT",5125:"UNSIGNED_INT",5126:"FLOAT",5386:"INVERT",5890:"TEXTURE",6401:"STENCIL_INDEX",6402:"DEPTH_COMPONENT",6406:"ALPHA",6407:"RGB",6408:"RGBA",6409:"LUMINANCE",6410:"LUMINANCE_ALPHA",7680:"KEEP",7681:"REPLACE",7682:"INCR",7683:"DECR",7936:"VENDOR",7937:"RENDERER",7938:"VERSION",9728:"NEAREST",9729:"LINEAR",9984:"NEAREST_MIPMAP_NEAREST",9985:"LINEAR_MIPMAP_NEAREST",9986:"NEAREST_MIPMAP_LINEAR",9987:"LINEAR_MIPMAP_LINEAR",10240:"TEXTURE_MAG_FILTER",10241:"TEXTURE_MIN_FILTER",10242:"TEXTURE_WRAP_S",10243:"TEXTURE_WRAP_T",10497:"REPEAT",10752:"POLYGON_OFFSET_UNITS",16384:"COLOR_BUFFER_BIT",32769:"CONSTANT_COLOR",32770:"ONE_MINUS_CONSTANT_COLOR",32771:"CONSTANT_ALPHA",32772:"ONE_MINUS_CONSTANT_ALPHA",32773:"BLEND_COLOR",32774:"FUNC_ADD",32777:"BLEND_EQUATION_RGB",32778:"FUNC_SUBTRACT",32779:"FUNC_REVERSE_SUBTRACT",32819:"UNSIGNED_SHORT_4_4_4_4",32820:"UNSIGNED_SHORT_5_5_5_1",32823:"POLYGON_OFFSET_FILL",32824:"POLYGON_OFFSET_FACTOR",32854:"RGBA4",32855:"RGB5_A1",32873:"TEXTURE_BINDING_2D",32926:"SAMPLE_ALPHA_TO_COVERAGE",32928:"SAMPLE_COVERAGE",32936:"SAMPLE_BUFFERS",32937:"SAMPLES",32938:"SAMPLE_COVERAGE_VALUE",32939:"SAMPLE_COVERAGE_INVERT",32968:"BLEND_DST_RGB",32969:"BLEND_SRC_RGB",32970:"BLEND_DST_ALPHA",32971:"BLEND_SRC_ALPHA",33071:"CLAMP_TO_EDGE",33170:"GENERATE_MIPMAP_HINT",33189:"DEPTH_COMPONENT16",33306:"DEPTH_STENCIL_ATTACHMENT",33635:"UNSIGNED_SHORT_5_6_5",33648:"MIRRORED_REPEAT",33901:"ALIASED_POINT_SIZE_RANGE",33902:"ALIASED_LINE_WIDTH_RANGE",33984:"TEXTURE0",33985:"TEXTURE1",33986:"TEXTURE2",33987:"TEXTURE3",33988:"TEXTURE4",33989:"TEXTURE5",33990:"TEXTURE6",33991:"TEXTURE7",33992:"TEXTURE8",33993:"TEXTURE9",33994:"TEXTURE10",33995:"TEXTURE11",33996:"TEXTURE12",33997:"TEXTURE13",33998:"TEXTURE14",33999:"TEXTURE15",34000:"TEXTURE16",34001:"TEXTURE17",34002:"TEXTURE18",34003:"TEXTURE19",34004:"TEXTURE20",34005:"TEXTURE21",34006:"TEXTURE22",34007:"TEXTURE23",34008:"TEXTURE24",34009:"TEXTURE25",34010:"TEXTURE26",34011:"TEXTURE27",34012:"TEXTURE28",34013:"TEXTURE29",34014:"TEXTURE30",34015:"TEXTURE31",34016:"ACTIVE_TEXTURE",34024:"MAX_RENDERBUFFER_SIZE",34041:"DEPTH_STENCIL",34055:"INCR_WRAP",34056:"DECR_WRAP",34067:"TEXTURE_CUBE_MAP",34068:"TEXTURE_BINDING_CUBE_MAP",34069:"TEXTURE_CUBE_MAP_POSITIVE_X",34070:"TEXTURE_CUBE_MAP_NEGATIVE_X",34071:"TEXTURE_CUBE_MAP_POSITIVE_Y",34072:"TEXTURE_CUBE_MAP_NEGATIVE_Y",34073:"TEXTURE_CUBE_MAP_POSITIVE_Z",34074:"TEXTURE_CUBE_MAP_NEGATIVE_Z",34076:"MAX_CUBE_MAP_TEXTURE_SIZE",34338:"VERTEX_ATTRIB_ARRAY_ENABLED",34339:"VERTEX_ATTRIB_ARRAY_SIZE",34340:"VERTEX_ATTRIB_ARRAY_STRIDE",34341:"VERTEX_ATTRIB_ARRAY_TYPE",34342:"CURRENT_VERTEX_ATTRIB",34373:"VERTEX_ATTRIB_ARRAY_POINTER",34466:"NUM_COMPRESSED_TEXTURE_FORMATS",34467:"COMPRESSED_TEXTURE_FORMATS",34660:"BUFFER_SIZE",34661:"BUFFER_USAGE",34816:"STENCIL_BACK_FUNC",34817:"STENCIL_BACK_FAIL",34818:"STENCIL_BACK_PASS_DEPTH_FAIL",34819:"STENCIL_BACK_PASS_DEPTH_PASS",34877:"BLEND_EQUATION_ALPHA",34921:"MAX_VERTEX_ATTRIBS",34922:"VERTEX_ATTRIB_ARRAY_NORMALIZED",34930:"MAX_TEXTURE_IMAGE_UNITS",34962:"ARRAY_BUFFER",34963:"ELEMENT_ARRAY_BUFFER",34964:"ARRAY_BUFFER_BINDING",34965:"ELEMENT_ARRAY_BUFFER_BINDING",34975:"VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",35040:"STREAM_DRAW",35044:"STATIC_DRAW",35048:"DYNAMIC_DRAW",35632:"FRAGMENT_SHADER",35633:"VERTEX_SHADER",35660:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",35661:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",35663:"SHADER_TYPE",35664:"FLOAT_VEC2",35665:"FLOAT_VEC3",35666:"FLOAT_VEC4",35667:"INT_VEC2",35668:"INT_VEC3",35669:"INT_VEC4",35670:"BOOL",35671:"BOOL_VEC2",35672:"BOOL_VEC3",35673:"BOOL_VEC4",35674:"FLOAT_MAT2",35675:"FLOAT_MAT3",35676:"FLOAT_MAT4",35678:"SAMPLER_2D",35680:"SAMPLER_CUBE",35712:"DELETE_STATUS",35713:"COMPILE_STATUS",35714:"LINK_STATUS",35715:"VALIDATE_STATUS",35716:"INFO_LOG_LENGTH",35717:"ATTACHED_SHADERS",35718:"ACTIVE_UNIFORMS",35719:"ACTIVE_UNIFORM_MAX_LENGTH",35720:"SHADER_SOURCE_LENGTH",35721:"ACTIVE_ATTRIBUTES",35722:"ACTIVE_ATTRIBUTE_MAX_LENGTH",35724:"SHADING_LANGUAGE_VERSION",35725:"CURRENT_PROGRAM",36003:"STENCIL_BACK_REF",36004:"STENCIL_BACK_VALUE_MASK",36005:"STENCIL_BACK_WRITEMASK",36006:"FRAMEBUFFER_BINDING",36007:"RENDERBUFFER_BINDING",36048:"FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",36049:"FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",36050:"FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",36051:"FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",36053:"FRAMEBUFFER_COMPLETE",36054:"FRAMEBUFFER_INCOMPLETE_ATTACHMENT",36055:"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",36057:"FRAMEBUFFER_INCOMPLETE_DIMENSIONS",36061:"FRAMEBUFFER_UNSUPPORTED",36064:"COLOR_ATTACHMENT0",36096:"DEPTH_ATTACHMENT",36128:"STENCIL_ATTACHMENT",36160:"FRAMEBUFFER",36161:"RENDERBUFFER",36162:"RENDERBUFFER_WIDTH",36163:"RENDERBUFFER_HEIGHT",36164:"RENDERBUFFER_INTERNAL_FORMAT",36168:"STENCIL_INDEX8",36176:"RENDERBUFFER_RED_SIZE",36177:"RENDERBUFFER_GREEN_SIZE",36178:"RENDERBUFFER_BLUE_SIZE",36179:"RENDERBUFFER_ALPHA_SIZE",36180:"RENDERBUFFER_DEPTH_SIZE",36181:"RENDERBUFFER_STENCIL_SIZE",36194:"RGB565",36336:"LOW_FLOAT",36337:"MEDIUM_FLOAT",36338:"HIGH_FLOAT",36339:"LOW_INT",36340:"MEDIUM_INT",36341:"HIGH_INT",36346:"SHADER_COMPILER",36347:"MAX_VERTEX_UNIFORM_VECTORS",36348:"MAX_VARYING_VECTORS",36349:"MAX_FRAGMENT_UNIFORM_VECTORS",37440:"UNPACK_FLIP_Y_WEBGL",37441:"UNPACK_PREMULTIPLY_ALPHA_WEBGL",37442:"CONTEXT_LOST_WEBGL",37443:"UNPACK_COLORSPACE_CONVERSION_WEBGL",37444:"BROWSER_DEFAULT_WEBGL"},ti=Object.freeze({default:ei,__moduleExports:ei}),ri=ti&&ei||ti,ni=function(e){return ri[e]},ii=Object.freeze({default:ni,__moduleExports:ni}),ai=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","uint","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"],oi=Object.freeze({default:ai,__moduleExports:ai}),si=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"],li=Object.freeze({default:si,__moduleExports:si}),ui=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"],hi=Object.freeze({default:ui,__moduleExports:ui}),fi=oi&&ai||oi,ci=fi.slice().concat(["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray"]),_i=Object.freeze({default:ci,__moduleExports:ci}),di=hi&&ui||hi,gi=di,pi=(gi=gi.slice().filter(function(e){return!/^(gl\_|texture)/.test(e)})).concat(["gl_VertexID","gl_InstanceID","gl_Position","gl_PointSize","gl_FragCoord","gl_FrontFacing","gl_FragDepth","gl_PointCoord","gl_MaxVertexAttribs","gl_MaxVertexUniformVectors","gl_MaxVertexOutputVectors","gl_MaxFragmentInputVectors","gl_MaxVertexTextureImageUnits","gl_MaxCombinedTextureImageUnits","gl_MaxTextureImageUnits","gl_MaxFragmentUniformVectors","gl_MaxDrawBuffers","gl_MinProgramTexelOffset","gl_MaxProgramTexelOffset","gl_DepthRangeParameters","gl_DepthRange","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"]),Ai=Object.freeze({default:pi,__moduleExports:pi}),mi=li&&si||li,Ei=_i&&ci||_i,vi=Ai&&pi||Ai,yi=function(e){var t,r,n,i=0,a=0,o=Ii,s=[],l=[],u=1,h=0,f=0,c=!1,_=!1,d="",g=di,p=fi;"300 es"===(e=e||{}).version&&(g=vi,p=Ei);for(var A={},m={},i=0;i<g.length;i++)A[g[i]]=!0;for(var i=0;i<p.length;i++)m[p[i]]=!0;return function(e){return l=[],null!==e?function(e){i=0,e.toString&&(e=e.toString());var r;d+=e.replace(/\r\n/g,"\n"),n=d.length;for(;t=d[i],i<n;){switch(r=i,o){case bi:i=x();break;case Ti:case wi:i=I();break;case Ci:i=b();break;case Ri:i=C();break;case Ui:i=w();break;case Si:i=R();break;case xi:i=S();break;case Di:i=y();break;case Ii:i=v()}if(r!==i)switch(d[r]){case"\n":h=0,++u;break;default:++h}}return a+=i,d=d.slice(i),l}(e):function(e){s.length&&E(s.join(""));return o=Ni,E("(eof)"),l}()};function E(e){e.length&&l.push({type:Fi[o],data:e,position:f,line:u,column:h})}function v(){return s=s.length?[]:s,"/"===r&&"*"===t?(f=a+i-1,o=bi,r=t,i+1):"/"===r&&"/"===t?(f=a+i-1,o=Ti,r=t,i+1):"#"===t?(o=wi,f=a+i,i):/\s/.test(t)?(o=Di,f=a+i,i):(c=/\d/.test(t),_=/[^\w_]/.test(t),f=a+i,o=c?Ri:_?Ci:xi,i)}function y(){return/[^\s]/g.test(t)?(E(s.join("")),o=Ii,i):(s.push(t),r=t,i+1)}function I(){return"\r"!==t&&"\n"!==t||"\\"===r?(s.push(t),r=t,i+1):(E(s.join("")),o=Ii,i)}function x(){return"/"===t&&"*"===r?(s.push(t),E(s.join("")),o=Ii,i+1):(s.push(t),r=t,i+1)}function b(){if("."===r&&/\d/.test(t))return o=Si,i;if("/"===r&&"*"===t)return o=bi,i;if("/"===r&&"/"===t)return o=Ti,i;if("."===t&&s.length){for(;T(s););return o=Si,i}if(";"===t||")"===t||"("===t){if(s.length)for(;T(s););return E(t),o=Ii,i+1}var e=2===s.length&&"="!==t;if(/[\w_\d\s]/.test(t)||e){for(;T(s););return o=Ii,i}return s.push(t),r=t,i+1}function T(e){for(var t,r,n=0;;){if(t=mi.indexOf(e.slice(0,e.length+n).join("")),r=mi[t],-1===t){if(n--+e.length>0)continue;r=e.slice(0,1).join("")}return E(r),f+=r.length,(s=s.slice(r.length)).length}}function w(){return/[^a-fA-F0-9]/.test(t)?(E(s.join("")),o=Ii,i):(s.push(t),r=t,i+1)}function C(){return"."===t?(s.push(t),o=Si,r=t,i+1):/[eE]/.test(t)?(s.push(t),o=Si,r=t,i+1):"x"===t&&1===s.length&&"0"===s[0]?(o=Ui,s.push(t),r=t,i+1):/[^\d]/.test(t)?(E(s.join("")),o=Ii,i):(s.push(t),r=t,i+1)}function R(){return"f"===t&&(s.push(t),r=t,i+=1),/[eE]/.test(t)?(s.push(t),r=t,i+1):("-"!==t&&"+"!==t||!/[eE]/.test(r))&&/[^\d]/.test(t)?(E(s.join("")),o=Ii,i):(s.push(t),r=t,i+1)}function S(){if(/[^\d\w_]/.test(t)){var e=s.join("");return o=m[e]?Oi:A[e]?Mi:Bi,E(s.join("")),o=Ii,i}return s.push(t),r=t,i+1}},Ii=999,xi=9999,bi=0,Ti=1,wi=2,Ci=3,Ri=4,Si=5,Bi=6,Mi=7,Oi=8,Di=9,Ni=10,Ui=11,Fi=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];var Li=Object.freeze({default:yi,__moduleExports:yi}),Pi=Li&&yi||Li,ji=function(e,t){var r=Pi(t),n=[];return n=(n=n.concat(r(e))).concat(r(null))};var Vi=Object.freeze({default:ji,__moduleExports:ji}),ki=function(e){return new Buffer(e,"base64").toString("utf8")},Xi=Object.freeze({default:ki,__moduleExports:ki}),Qi=Vi&&ji||Vi,Gi=Xi&&ki||Xi,zi=function(e){for(var t=Array.isArray(e)?e:Qi(e),r=0;r<t.length;r++){var n=t[r];if("preprocessor"===n.type){var i=n.data.match(/\#define\s+SHADER_NAME(_B64)?\s+(.+)$/);if(i&&i[2]){var a=i[1],o=i[2];return(a?Gi(o):o).trim()}}}};var Hi,qi=Object.freeze({default:zi,__moduleExports:zi}),Yi="",Wi=function(e,t){if("string"!=typeof e)throw new TypeError("expected a string");if(1===t)return e;if(2===t)return e+e;var r=e.length*t;if(Hi!==e||void 0===Hi)Hi=e,Yi="";else if(Yi.length>=r)return Yi.substr(0,r);for(;r>Yi.length&&t>1;)1&t&&(Yi+=e),t>>=1,e+=e;return Yi=(Yi+=e).substr(0,r)};var Ki=Object.freeze({default:Wi,__moduleExports:Wi}),Zi=Ki&&Wi||Ki,Ji=function(e,t,r){return Zi(r=void 0!==r?r+"":" ",t)+e},$i=Object.freeze({default:Ji,__moduleExports:Ji}),ea=$i&&Ji||$i,ta=function(e,t,r){t="number"==typeof t?t:1,r=r||": ";var n=e.split(/\r?\n/),i=String(n.length+t-1).length;return n.map(function(e,n){var a=n+t,o=String(a).length,s=ea(a,i-o);return s+r+e}).join("\n")};var ra=Object.freeze({default:ta,__moduleExports:ta}),na=ii&&ni||ii,ia=qi&&zi||qi,aa=ra&&ta||ra,oa=($n&&Jn||$n).sprintf,sa=function(e,t,r){var n=ia(t)||"of unknown name (see npm glsl-shader-name)",i="unknown type";void 0!==r&&(i=r===na.FRAGMENT_SHADER?"fragment":"vertex");for(var a=oa("Error compiling %s shader %s:\n",i,n),o=oa("%s%s",a,e),s=e.split("\n"),l={},u=0;u<s.length;u++){var h=s[u];if(""!==h&&"\0"!==h){var f=parseInt(h.split(":")[2]);if(isNaN(f))throw new Error(oa("Could not parse error: %s",h));l[f]=h}}for(var c=aa(t).split("\n"),u=0;u<c.length;u++)if(l[u+3]||l[u+2]||l[u+1]){var _=c[u];if(a+=_+"\n",l[u+1]){var d=l[u+1];d=d.substr(d.split(":",3).join(":").length+1).trim(),a+=oa("^^^ %s\n\n",d)}}return{long:a.trim(),short:o.trim()}};var la=Object.freeze({default:sa,__moduleExports:sa}),ua=function(e,t){var r={identity:t},n=e.valueOf;return Object.defineProperty(e,"valueOf",{value:function(e){return e!==t?n.apply(this,arguments):r},writable:!0}),r};var ha=Object.freeze({default:ua,__moduleExports:ua}),fa=ha&&ua||ha,ca=function(){var e={};return function(t){if(("object"!=typeof t||null===t)&&"function"!=typeof t)throw new Error("Weakmap-shim: Key must be object");var r=t.valueOf(e);return r&&r.identity===e?r:fa(t,e)}};var _a=Object.freeze({default:ca,__moduleExports:ca}),da=_a&&ca||_a,ga=function(){var e=da();return{get:function(t,r){var n=e(t);return n.hasOwnProperty("value")?n.value:r},set:function(t,r){return e(t).value=r,this},has:function(t){return"value"in e(t)},delete:function(t){return delete e(t).value}}};var pa=Object.freeze({default:ga,__moduleExports:ga}),Aa=la&&sa||la,ma=function(e,t,r){return Ta(e).getShaderReference(t,r)},Ea=function(e,t,r,n,i){return Ta(e).getProgram(t,r,n,i)},va=new("undefined"==typeof WeakMap?pa&&ga||pa:WeakMap),ya=0;function Ia(e,t,r,n,i,a,o){this.id=e,this.src=t,this.type=r,this.shader=n,this.count=a,this.programs=[],this.cache=o}function xa(e){this.gl=e,this.shaders=[{},{}],this.programs={}}Ia.prototype.dispose=function(){if(0==--this.count){for(var e=this.cache,t=e.gl,r=this.programs,n=0,i=r.length;n<i;++n){var a=e.programs[r[n]];a&&(delete e.programs[n],t.deleteProgram(a))}t.deleteShader(this.shader),delete e.shaders[this.type===t.FRAGMENT_SHADER|0][this.src]}};var ba=xa.prototype;function Ta(e){var t=va.get(e);return t||(t=new xa(e),va.set(e,t)),t}ba.getShaderReference=function(e,t){var r=this.gl,n=this.shaders[e===r.FRAGMENT_SHADER|0],i=n[t];if(i&&r.isShader(i.shader))i.count+=1;else{var a=function(e,t,r){var n=e.createShader(t);if(e.shaderSource(n,r),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS)){var i=e.getShaderInfoLog(n);try{var a=Aa(i,r,t)}catch(e){throw console.warn("Failed to format compiler error: "+e),new kn(i,"Error compiling shader:\n"+i)}throw new kn(i,a.short,a.long)}return n}(r,e,t);i=n[t]=new Ia(ya++,t,e,a,[],1,this)}return i},ba.getProgram=function(e,t,r,n){var i=[e.id,t.id,r.join(":"),n.join(":")].join("@"),a=this.programs[i];return a&&this.gl.isProgram(a)||(this.programs[i]=a=function(e,t,r,n,i){var a=e.createProgram();e.attachShader(a,t),e.attachShader(a,r);for(var o=0;o<n.length;++o)e.bindAttribLocation(a,i[o],n[o]);if(e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS)){var s=e.getProgramInfoLog(a);throw new kn(s,"Error linking program: "+s)}return a}(this.gl,e.shader,t.shader,r,n),e.programs.push(i),t.programs.push(i)),a};var wa={shader:ma,program:Ea},Ca=Object.freeze({default:wa,__moduleExports:wa,shader:ma,program:Ea}),Ra=function(e,t){for(var r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),n=[],i=0;i<r;++i){var a=e.getActiveUniform(t,i);if(a){var o=Oa(e,a.type);if(a.size>1)for(var s=0;s<a.size;++s)n.push({name:a.name.replace("[0]","["+s+"]"),type:o});else n.push({name:a.name,type:o})}}return n},Sa=function(e,t){for(var r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),n=[],i=0;i<r;++i){var a=e.getActiveAttrib(t,i);a&&n.push({name:a.name,type:Oa(e,a.type)})}return n},Ba={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube"},Ma=null;function Oa(e,t){if(!Ma){var r=Object.keys(Ba);Ma={};for(var n=0;n<r.length;++n){var i=r[n];Ma[e[i]]=Ba[i]}}return Ma[t]}var Da={uniforms:Ra,attributes:Sa},Na=Object.freeze({default:Da,__moduleExports:Da,uniforms:Ra,attributes:Sa}),Ua=zn&&Xn||zn,Fa=Zn&&Hn||Zn,La=Ca&&wa||Ca,Pa=Na&&Da||Na;function ja(e){this.gl=e,this.gl.lastAttribCount=0,this._vref=this._fref=this._relink=this.vertShader=this.fragShader=this.program=this.attributes=this.uniforms=this.types=null}var Va=ja.prototype;function ka(e,t){return e.name<t.name?-1:1}Va.bind=function(){var e;this.program||this._relink();var t=this.gl.getProgramParameter(this.program,this.gl.ACTIVE_ATTRIBUTES),r=this.gl.lastAttribCount;if(t>r)for(e=r;e<t;e++)this.gl.enableVertexAttribArray(e);else if(r>t)for(e=t;e<r;e++)this.gl.disableVertexAttribArray(e);this.gl.lastAttribCount=t,this.gl.useProgram(this.program)},Va.dispose=function(){for(var e=this.gl.lastAttribCount,t=0;t<e;t++)this.gl.disableVertexAttribArray(t);this.gl.lastAttribCount=0,this._fref&&this._fref.dispose(),this._vref&&this._vref.dispose(),this.attributes=this.types=this.vertShader=this.fragShader=this.program=this._relink=this._fref=this._vref=null},Va.update=function(e,t,r,n){if(!t||1===arguments.length){var i=e;e=i.vertex,t=i.fragment,r=i.uniforms,n=i.attributes}var a=this,o=a.gl,s=a._vref;a._vref=La.shader(o,o.VERTEX_SHADER,e),s&&s.dispose(),a.vertShader=a._vref.shader;var l=this._fref;if(a._fref=La.shader(o,o.FRAGMENT_SHADER,t),l&&l.dispose(),a.fragShader=a._fref.shader,!r||!n){var u=o.createProgram();if(o.attachShader(u,a.fragShader),o.attachShader(u,a.vertShader),o.linkProgram(u),!o.getProgramParameter(u,o.LINK_STATUS)){var h=o.getProgramInfoLog(u);throw new kn(h,"Error linking program:"+h)}r=r||Pa.uniforms(o,u),n=n||Pa.attributes(o,u),o.deleteProgram(u)}(n=n.slice()).sort(ka);var f,c=[],_=[],d=[];for(f=0;f<n.length;++f){var g=n[f];if(g.type.indexOf("mat")>=0){for(var p=0|g.type.charAt(g.type.length-1),A=new Array(p),m=0;m<p;++m)A[m]=d.length,_.push(g.name+"["+m+"]"),"number"==typeof g.location?d.push(g.location+m):Array.isArray(g.location)&&g.location.length===p&&"number"==typeof g.location[m]?d.push(0|g.location[m]):d.push(-1);c.push({name:g.name,type:g.type,locations:A})}else c.push({name:g.name,type:g.type,locations:[d.length]}),_.push(g.name),"number"==typeof g.location?d.push(0|g.location):d.push(-1)}var E=0;for(f=0;f<d.length;++f)if(d[f]<0){for(;d.indexOf(E)>=0;)E+=1;d[f]=E}var v=new Array(r.length);function y(){a.program=La.program(o,a._vref,a._fref,_,d);for(var e=0;e<r.length;++e)v[e]=o.getUniformLocation(a.program,r[e].name)}y(),a._relink=y,a.types={uniforms:Vn(r),attributes:Vn(n)},a.attributes=Fa(o,a,c,d),Object.defineProperty(a,"uniforms",Ua(o,a,r,v))};var Xa=function(e,t,r,n,i){var a=new ja(e);return a.update(t,r,n,i),a},Qa=Object.freeze({default:Xa,__moduleExports:Xa}),Ga=Qa&&Xa||Qa,za="attribute vec2 position; void main() { gl_Position = vec4(2.0*position-1.0, 0.0, 1.0);}";function Ha(e,t){if(!(this instanceof Ha))return new Ha(e,t);this.gl=e,this.shader=Ga(e,za,t),this.buffer=e.createBuffer()}var qa=Ha;Ha.prototype={dispose:function(){this.shader.dispose(),this.gl.deleteBuffer(this.buffer),this.shader=null,this.buffer=null},render:function(e,t,r,n){var i=this.gl,a=this.shader,o=0;for(var s in a.bind(),this._checkViewport(),a.uniforms.progress=e,a.uniforms.from=t.bind(o++),a.uniforms.to=r.bind(o++),n){var l=n[s];l&&l.bind?a.uniforms[s]=l.bind(o++):a.uniforms[s]!==l&&(a.uniforms[s]=l)}i.drawArrays(i.TRIANGLES,0,6)},_checkViewport:function(){var e=this.gl.canvas,t=e.width,r=e.height;this._w===t&&this._h===r||(this._syncViewport(t,r),this._w=t,this._h=r)},_syncViewport:function(e,t){var r=this.gl,n=this.shader,i=this.buffer,a=e,o=t;n.uniforms.resolution=new Float32Array([e,t]),r.bindBuffer(r.ARRAY_BUFFER,i),n.attributes.position.pointer(),r.bufferData(r.ARRAY_BUFFER,new Float32Array([0,0,a,0,0,o,0,o,a,0,a,o]),r.STATIC_DRAW),r.viewport(0,0,a,o)}};var Ya=function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)},Wa=Object.freeze({default:Ya,__moduleExports:Ya});var Ka=function(e){var t=1.70158;return e*e*((t+1)*e-t)},Za=Object.freeze({default:Ka,__moduleExports:Ka});var Ja=function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},$a=Object.freeze({default:Ja,__moduleExports:Ja});var eo=function(e){var t=e*e;return e<4/11?7.5625*t:e<8/11?9.075*t-9.9*e+3.4:e<.9?4356/361*t-35442/1805*e+16061/1805:10.8*e*e-20.52*e+10.72},to=Object.freeze({default:eo,__moduleExports:eo}),ro=to&&eo||to;var no=function(e){return e<.5?.5*(1-ro(1-2*e)):.5*ro(2*e-1)+.5},io=Object.freeze({default:no,__moduleExports:no});var ao=function(e){return 1-ro(1-e)},oo=Object.freeze({default:ao,__moduleExports:ao});var so=function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},lo=Object.freeze({default:so,__moduleExports:so});var uo=function(e){return 1-Math.sqrt(1-e*e)},ho=Object.freeze({default:uo,__moduleExports:uo});var fo=function(e){return Math.sqrt(1- --e*e)},co=Object.freeze({default:fo,__moduleExports:fo});var _o=function(e){return e<.5?4*e*e*e:.5*Math.pow(2*e-2,3)+1},go=Object.freeze({default:_o,__moduleExports:_o});var po=function(e){return e*e*e},Ao=Object.freeze({default:po,__moduleExports:po});var mo=function(e){var t=e-1;return t*t*t+1},Eo=Object.freeze({default:mo,__moduleExports:mo});var vo=function(e){return e<.5?.5*Math.sin(13*Math.PI/2*2*e)*Math.pow(2,10*(2*e-1)):.5*Math.sin(-13*Math.PI/2*(2*e-1+1))*Math.pow(2,-10*(2*e-1))+1},yo=Object.freeze({default:vo,__moduleExports:vo});var Io=function(e){return Math.sin(13*e*Math.PI/2)*Math.pow(2,10*(e-1))},xo=Object.freeze({default:Io,__moduleExports:Io});var bo=function(e){return Math.sin(-13*(e+1)*Math.PI/2)*Math.pow(2,-10*e)+1},To=Object.freeze({default:bo,__moduleExports:bo});var wo=function(e){return 0===e||1===e?e:e<.5?.5*Math.pow(2,20*e-10):-.5*Math.pow(2,10-20*e)+1},Co=Object.freeze({default:wo,__moduleExports:wo});var Ro=function(e){return 0===e?e:Math.pow(2,10*(e-1))},So=Object.freeze({default:Ro,__moduleExports:Ro});var Bo=function(e){return 1===e?e:1-Math.pow(2,-10*e)},Mo=Object.freeze({default:Bo,__moduleExports:Bo});var Oo=function(e){return e},Do=Object.freeze({default:Oo,__moduleExports:Oo});var No=function(e){return(e/=.5)<1?.5*e*e:-.5*(--e*(e-2)-1)},Uo=Object.freeze({default:No,__moduleExports:No});var Fo=function(e){return e*e},Lo=Object.freeze({default:Fo,__moduleExports:Fo});var Po=function(e){return-e*(e-2)},jo=Object.freeze({default:Po,__moduleExports:Po});var Vo=function(e){return e<.5?8*Math.pow(e,4):-8*Math.pow(e-1,4)+1},ko=Object.freeze({default:Vo,__moduleExports:Vo});var Xo=function(e){return Math.pow(e,4)},Qo=Object.freeze({default:Xo,__moduleExports:Xo});var Go=function(e){return Math.pow(e-1,3)*(1-e)+1},zo=Object.freeze({default:Go,__moduleExports:Go});var Ho=function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},qo=Object.freeze({default:Ho,__moduleExports:Ho});var Yo=function(e){return e*e*e*e*e},Wo=Object.freeze({default:Yo,__moduleExports:Yo});var Ko=function(e){return--e*e*e*e*e+1},Zo=Object.freeze({default:Ko,__moduleExports:Ko});var Jo=function(e){return-.5*(Math.cos(Math.PI*e)-1)},$o=Object.freeze({default:Jo,__moduleExports:Jo});var es=function(e){var t=Math.cos(e*Math.PI*.5);return Math.abs(t)<1e-14?1:1-t},ts=Object.freeze({default:es,__moduleExports:es});var rs=function(e){return Math.sin(e*Math.PI/2)},ns=Object.freeze({default:rs,__moduleExports:rs}),is={backInOut:Wa&&Ya||Wa,backIn:Za&&Ka||Za,backOut:$a&&Ja||$a,bounceInOut:io&&no||io,bounceIn:oo&&ao||oo,bounceOut:ro,circInOut:lo&&so||lo,circIn:ho&&uo||ho,circOut:co&&fo||co,cubicInOut:go&&_o||go,cubicIn:Ao&&po||Ao,cubicOut:Eo&&mo||Eo,elasticInOut:yo&&vo||yo,elasticIn:xo&&Io||xo,elasticOut:To&&bo||To,expoInOut:Co&&wo||Co,expoIn:So&&Ro||So,expoOut:Mo&&Bo||Mo,linear:Do&&Oo||Do,quadInOut:Uo&&No||Uo,quadIn:Lo&&Fo||Lo,quadOut:jo&&Po||jo,quartInOut:ko&&Vo||ko,quartIn:Qo&&Xo||Qo,quartOut:zo&&Go||zo,quintInOut:qo&&Ho||qo,quintIn:Wo&&Yo||Wo,quintOut:Zo&&Ko||Zo,sineInOut:$o&&Jo||$o,sineIn:ts&&es||ts,sineOut:ns&&rs||ns},as={none:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      void main() {\n        vec2 p = gl_FragCoord.xy / resolution.xy;\n        gl_FragColor = texture2D(to, p);\n      }\n    ",uniforms:{}},crossfade:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      void main() {\n        vec2 p = gl_FragCoord.xy / resolution.xy;\n        gl_FragColor = mix(texture2D(from, p), texture2D(to, p), progress);\n      }\n    ",uniforms:{}},wipeUp:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      void main() {\n        vec2 p = gl_FragCoord.xy / resolution.xy;\n        vec4 a = texture2D(from, p);\n        vec4 b = texture2D(to, p);\n        gl_FragColor = mix(a, b, step(0.0 + p.y, progress));\n      }\n    ",uniforms:{}},wipeDown:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      void main() {\n        vec2 p = gl_FragCoord.xy / resolution.xy;\n        vec4 a = texture2D(from, p);\n        vec4 b = texture2D(to, p);\n        gl_FragColor = mix(a, b, step(1.0 - p.y, progress));\n      }\n    ",uniforms:{}},wipeRight:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      void main() {\n        vec2 p = gl_FragCoord.xy / resolution.xy;\n        vec4 a = texture2D(from, p);\n        vec4 b = texture2D(to, p);\n        gl_FragColor = mix(a, b, step(0.0 + p.x, progress));\n      }\n    ",uniforms:{}},wipeLeft:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      void main() {\n        vec2 p = gl_FragCoord.xy / resolution.xy;\n        vec4 a = texture2D(from, p);\n        vec4 b = texture2D(to, p);\n        gl_FragColor = mix(a, b, step(1.0 - p.x, progress));\n      }\n    ",uniforms:{}},circle:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      uniform float centerX;\n      uniform float centerY;\n      uniform float smoothness;\n      uniform bool grow;\n\n      vec2 center = vec2(centerX, 1.0 - centerY);\n      float scale = sqrt(min(resolution[0] / resolution[1], resolution[1] / resolution[0]) / max(centerX, 1.0 - centerY));\n\n      void main() {\n        vec2 p = gl_FragCoord.xy / resolution.xy;\n        float size = grow ? progress : 1.0 - progress;\n        float dist = distance(center, p);\n        float circle = smoothstep(-smoothness, 0.0, scale * dist - size * (1.0 + smoothness));\n        gl_FragColor = mix(texture2D(from, p), texture2D(to, p), grow ? 1.0 - circle : circle);\n      }\n    ",uniforms:{centerX:.5,centerY:.5,smoothness:0,grow:!0}},circleInOut:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      float maxRadius = resolution.x + resolution.y;\n\n      void main() {\n        vec2 p = gl_FragCoord.xy / resolution.xy;\n\n        float distX = gl_FragCoord.x - resolution.x / 2.0;\n        float distY = gl_FragCoord.y - resolution.y / 2.0;\n        float dist = sqrt(distX * distX + distY * distY);\n\n        float step = 2.0 * abs(progress - 0.5);\n        step = step * step * step;\n\n        if (dist < step * maxRadius)\n        {\n          if (progress < 0.5)\n            gl_FragColor = texture2D(from, p);\n          else\n            gl_FragColor = texture2D(to, p);\n        }\n        else\n          gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n      }\n    ",uniforms:{}},splitVertical:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n\n      // General parameters\n      uniform sampler2D from;\n      uniform sampler2D to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      uniform float reflection;\n      uniform float perspective;\n      uniform float depth;\n\n      const vec4 black = vec4(0.0, 0.0, 0.0, 1.0);\n      const vec2 boundMin = vec2(0.0, 0.0);\n      const vec2 boundMax = vec2(1.0, 1.0);\n\n      bool inBounds (vec2 p) {\n        return all(lessThan(boundMin, p)) && all(lessThan(p, boundMax));\n      }\n\n      vec2 project (vec2 p) {\n        return p * vec2(1.0, -1.2) + vec2(0.0, -0.02);\n      }\n\n      vec4 bgColor (vec2 p, vec2 pto) {\n        vec4 c = black;\n        pto = project(pto);\n        if (inBounds(pto)) {\n          c += mix(black, texture2D(to, pto), reflection * mix(1.0, 0.0, pto.y));\n        }\n        return c;\n      }\n\n      void main() {\n        vec2 p = gl_FragCoord.xy / resolution.xy;\n\n        vec2 pfr = vec2(-1.), pto = vec2(-1.);\n\n        float middleSlit = 2.0 * abs(p.x-0.5) - progress;\n        if (middleSlit > 0.0) {\n          pfr = p + (p.x > 0.5 ? -1.0 : 1.0) * vec2(0.5*progress, 0.0);\n          float d = 1.0/(1.0+perspective*progress*(1.0-middleSlit));\n          pfr.y -= d/2.;\n          pfr.y *= d;\n          pfr.y += d/2.;\n        }\n\n        float size = mix(1.0, depth, 1.-progress);\n        pto = (p + vec2(-0.5, -0.5)) * vec2(size, size) + vec2(0.5, 0.5);\n\n        if (inBounds(pfr)) {\n          gl_FragColor = texture2D(from, pfr);\n        }\n        else if (inBounds(pto)) {\n          gl_FragColor = texture2D(to, pto);\n        }\n        else {\n          gl_FragColor = bgColor(p, pto);\n        }\n      }\n    ",uniforms:{reflection:0,perspective:0,depth:1}},slideUp:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      uniform float translateX;\n      uniform float translateY;\n\n      void main() {\n          vec2 texCoord = gl_FragCoord.xy / resolution.xy;\n          float x = progress * translateX;\n          float y = progress * translateY;\n\n          if (x >= 0.0 && y >= 0.0) {\n              if (texCoord.x >= x && texCoord.y >= y) {\n                  gl_FragColor = texture2D(from, texCoord - vec2(x, y));\n              }\n              else {\n                  vec2 uv;\n                  if (x > 0.0)\n                      uv = vec2(x - 1.0, y);\n                  else if (y > 0.0)\n                      uv = vec2(x, y - 1.0);\n                  gl_FragColor = texture2D(to, texCoord - uv);\n              }\n          }\n          else if (x <= 0.0 && y <= 0.0) {\n              if (texCoord.x <= (1.0 + x) && texCoord.y <= (1.0 + y))\n                  gl_FragColor = texture2D(from, texCoord - vec2(x, y));\n              else {\n                  vec2 uv;\n                  if (x < 0.0)\n                      uv = vec2(x + 1.0, y);\n                  else if (y < 0.0)\n                      uv = vec2(x, y + 1.0);\n                  gl_FragColor = texture2D(to, texCoord - uv);\n              }\n          }\n          else\n              gl_FragColor = vec4(0.0);\n      }\n    ",uniforms:{translateX:0,translateY:1}},slideDown:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      uniform float translateX;\n      uniform float translateY;\n\n      void main() {\n          vec2 texCoord = gl_FragCoord.xy / resolution.xy;\n          float x = progress * translateX;\n          float y = progress * translateY;\n\n          if (x >= 0.0 && y >= 0.0) {\n              if (texCoord.x >= x && texCoord.y >= y) {\n                  gl_FragColor = texture2D(from, texCoord - vec2(x, y));\n              }\n              else {\n                  vec2 uv;\n                  if (x > 0.0)\n                      uv = vec2(x - 1.0, y);\n                  else if (y > 0.0)\n                      uv = vec2(x, y - 1.0);\n                  gl_FragColor = texture2D(to, texCoord - uv);\n              }\n          }\n          else if (x <= 0.0 && y <= 0.0) {\n              if (texCoord.x <= (1.0 + x) && texCoord.y <= (1.0 + y))\n                  gl_FragColor = texture2D(from, texCoord - vec2(x, y));\n              else {\n                  vec2 uv;\n                  if (x < 0.0)\n                      uv = vec2(x + 1.0, y);\n                  else if (y < 0.0)\n                      uv = vec2(x, y + 1.0);\n                  gl_FragColor = texture2D(to, texCoord - uv);\n              }\n          }\n          else\n              gl_FragColor = vec4(0.0);\n      }\n    ",uniforms:{translateX:0,translateY:-1}},slideLeft:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      uniform float translateX;\n      uniform float translateY;\n\n      void main() {\n          vec2 texCoord = gl_FragCoord.xy / resolution.xy;\n          float x = progress * translateX;\n          float y = progress * translateY;\n\n          if (x >= 0.0 && y >= 0.0) {\n              if (texCoord.x >= x && texCoord.y >= y) {\n                  gl_FragColor = texture2D(from, texCoord - vec2(x, y));\n              }\n              else {\n                  vec2 uv;\n                  if (x > 0.0)\n                      uv = vec2(x - 1.0, y);\n                  else if (y > 0.0)\n                      uv = vec2(x, y - 1.0);\n                  gl_FragColor = texture2D(to, texCoord - uv);\n              }\n          }\n          else if (x <= 0.0 && y <= 0.0) {\n              if (texCoord.x <= (1.0 + x) && texCoord.y <= (1.0 + y))\n                  gl_FragColor = texture2D(from, texCoord - vec2(x, y));\n              else {\n                  vec2 uv;\n                  if (x < 0.0)\n                      uv = vec2(x + 1.0, y);\n                  else if (y < 0.0)\n                      uv = vec2(x, y + 1.0);\n                  gl_FragColor = texture2D(to, texCoord - uv);\n              }\n          }\n          else\n              gl_FragColor = vec4(0.0);\n      }\n    ",uniforms:{translateX:1,translateY:0}},slideRight:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      uniform float translateX;\n      uniform float translateY;\n\n      void main() {\n          vec2 texCoord = gl_FragCoord.xy / resolution.xy;\n          float x = progress * translateX;\n          float y = progress * translateY;\n\n          if (x >= 0.0 && y >= 0.0) {\n              if (texCoord.x >= x && texCoord.y >= y) {\n                  gl_FragColor = texture2D(from, texCoord - vec2(x, y));\n              }\n              else {\n                  vec2 uv;\n                  if (x > 0.0)\n                      uv = vec2(x - 1.0, y);\n                  else if (y > 0.0)\n                      uv = vec2(x, y - 1.0);\n                  gl_FragColor = texture2D(to, texCoord - uv);\n              }\n          }\n          else if (x <= 0.0 && y <= 0.0) {\n              if (texCoord.x <= (1.0 + x) && texCoord.y <= (1.0 + y))\n                  gl_FragColor = texture2D(from, texCoord - vec2(x, y));\n              else {\n                  vec2 uv;\n                  if (x < 0.0)\n                      uv = vec2(x + 1.0, y);\n                  else if (y < 0.0)\n                      uv = vec2(x, y + 1.0);\n                  gl_FragColor = texture2D(to, texCoord - uv);\n              }\n          }\n          else\n              gl_FragColor = vec4(0.0);\n      }\n    ",uniforms:{translateX:-1,translateY:0}}},os=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var ss=yt();return window.HTMLMediaElement&&Object.defineProperty(HTMLMediaElement.prototype,"playing",{get:function(){return!!(this.currentTime>0&&!this.paused&&!this.ended&&this.readyState>2)}}),function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r={container:"body",slides:[],autoplay:!1,slideDuration:3e3,transitions:as,transition:{name:"random",duration:2e3,ease:"linear",priority:0}};this.config=_.merge({},r,t),"string"==typeof this.config.container?this.container=document.querySelector(this.config.container):this.container=this.config.container,this.container.style.display="block",this.container.style.position="absolute",this.container.style.top="0",this.container.style.left="0",this.container.style.width="100%",this.container.style.height="100%",this._slides=this.config.slides,this._currentSlideIndex=0,this._transitionToIndex=0,this._currentSlideRendered=!1,this._transitionProgress=0,this._imageMap={},this._videoMap={},this._slideContentMap={},this._ready=!1,this._destroyed=!1,this._playing=this.config.autoplay,this._width=0,this._height=0,this._regExp={image:/\.(jpe?g|webp|png)$/i,video:/\.(mp4|webm|ogg)$/i},this._createCanvases(),this._resizeHandler=this.resize.bind(this),window.addEventListener("resize",this._resizeHandler),this._lastFrameTime=0,window.requestAnimationFrame(this._animate.bind(this))}return os(e,[{key:"goToSlide",value:function(e,t){this._transitionToIndex=e,this._transitionDirection=t,this._currentSlideRendered=!1,this._autoPlayTimeout&&clearTimeout(this._autoPlayTimeout)}},{key:"nextSlide",value:function(){var e=void 0;e=this._transitionToIndex===this._currentSlideIndex-1||this._transitionToIndex===this._slides.length-1&&0===this._currentSlideIndex?this._currentSlideIndex:this._currentSlideIndex===this._slides.length-1?0:this._currentSlideIndex+1,this.goToSlide(e,"forwards")}},{key:"prevSlide",value:function(){var e=void 0;e=this._transitionToIndex===this._currentSlideIndex+1||0===this._transitionToIndex&&this._currentSlideIndex===this._slides.length-1?this._currentSlideIndex:0===this._currentSlideIndex?this._slides.length-1:this._currentSlideIndex-1,this.goToSlide(e,"backwards")}},{key:"play",value:function(){this._playing=!0,this.nextSlide()}},{key:"pause",value:function(){this._playing=!1,this._autoPlayTimeout&&clearTimeout(this._autoPlayTimeout)}},{key:"destroy",value:function(){var e=this;this._playing=!1,this._destroyed=!0,window.removeEventListener("resize",this._resizeHandler),_.forEach(this._videoMap,function(t){e.container.removeChild(t),t=null}),this._videoMap=null}},{key:"_transitionEnded",value:function(){}},{key:"_videoEnded",value:function(e,t){var r=this._slides[this._transitionToIndex];if(this._playing&&r.duration&&_.isFunction(r.duration)){var n=r.duration();this._isType(n,"video")&&this.nextSlide()}}},{key:"_slideLoaded",value:function(e,t){}},{key:"_slideRendered",value:function(){var e=this;this._ready||(this._ready=!0,this.container.classList.add("showy--ready"));var t=this._slides[this._transitionToIndex];if(this._playing){var r=this.config.slideDuration;if(t.duration){if(_.isFunction(t.duration)){var n=t.duration();if(this._isType(n,"video"))return}_.isNumber(t.duration)&&(r=t.duration)}this._autoPlayTimeout=setTimeout(function(){e.nextSlide()},r)}}},{key:"_animate",value:function(e){if(!this._destroyed){this._fps=1e3/(e-this._lastFrameTime);try{this._drawSlides(),window.requestAnimationFrame(this._animate.bind(this))}catch(e){console.error(e)}this._lastFrameTime=e}}},{key:"_createCanvas",value:function(){var e=document.createElement("canvas");return e.style.position="absolute",e.style.width="100%",e.style.height="100%",this._resizeCanvas(e),e}},{key:"_createCanvases",value:function(){this._currentCanvas=this._createCanvas(),this._currentContext=this._currentCanvas.getContext("2d"),this._nextCanvas=this._createCanvas(),this._nextContext=this._nextCanvas.getContext("2d"),this._prevCanvas=this._createCanvas(),this._prevContext=this._prevCanvas.getContext("2d"),this._renderCanvas=this._createCanvas(),this._renderContext=this._renderCanvas.getContext("webgl")||this._renderCanvas.getContext("experimental-webgl"),this._renderContext.pixelStorei(this._renderContext.UNPACK_FLIP_Y_WEBGL,!0),this.container.appendChild(this._renderCanvas)}},{key:"_resizeCanvas",value:function(e){this._scale=window.devicePixelRatio,this._width=this.container.clientWidth*this._scale,this._height=this.container.clientHeight*this._scale,e.width=this._width,e.height=this._height}},{key:"resize",value:function(){this._slideContentMap={},this._resizeCanvas(this._currentCanvas),this._resizeCanvas(this._nextCanvas),this._resizeCanvas(this._prevCanvas),this._resizeCanvas(this._renderCanvas),this._drawSlides(!0)}},{key:"_clearContext",value:function(e){e.clearRect(0,0,this._width,this._height)}},{key:"_transitionInProgress",value:function(){return this._transitionProgress>0&&this._transitionProgress<1}},{key:"_getTransition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=_.merge({},this.config.transition,e||{}),n=_.merge({},this.config.transition,t||{});return"random"===r.name?r.glsl=_.sample(this.config.transitions):r.glsl=this.config.transitions[r.name],"random"===n.name?n.glsl=_.sample(this.config.transitions):n.glsl=this.config.transitions[n.name],r.priority>=n.priority?r:n}},{key:"_drawSlides",value:function(e){var t=this._slides[this._currentSlideIndex],r=this._slides[this._currentSlideIndex===this._slides.length-1?0:this._currentSlideIndex+1],n=this._slides[0===this._currentSlideIndex?this._slides.length-1:this._currentSlideIndex-1],i=void 0;if(e&&(t._rendered=!1),t._hasVideo||!t._rendered||this._transitionInProgress()||this._currentSlideIndex!==this._transitionToIndex){if(this._drawSlide(this._currentContext,t),this._drawSlide(this._nextContext,r),this._drawSlide(this._prevContext,n),this._fromTexture&&this._fromTexture.dispose(),this._toTexture&&this._toTexture.dispose(),this._transitionToIndex!==this._currentSlideIndex||this._transitionInProgress()?((this._transitionToIndex!==this._currentSlideIndex&&"forwards"===this._transitionDirection||this._transitionToIndex===this._currentSlideIndex&&"backwards"===this._transitionDirection)&&(this._fromTexture=xn(this._renderContext,this._currentCanvas),this._toTexture=xn(this._renderContext,this._nextCanvas),i=this._getTransition(t.transitionNext,r.transitionPrev)),(this._transitionToIndex!==this._currentSlideIndex&&"backwards"===this._transitionDirection||this._transitionToIndex===this._currentSlideIndex&&"forwards"===this._transitionDirection)&&(this._fromTexture=xn(this._renderContext,this._prevCanvas),this._toTexture=xn(this._renderContext,this._currentCanvas),i=this._getTransition(t.transitionPrev,n.transitionNext))):(this._fromTexture=xn(this._renderContext,this._currentCanvas),this._toTexture=this._fromTexture),!i||this._transitionInProgress()||this._transitionOptions&&this._transitionOptions.name===i.name&&"random"!==this._transitionOptions.name||(this._transitionOptions=i,this._transition&&(this._transition.dispose(),this._transition=null)),this._transitionOptions){if(this._transition||(this._transition=qa(this._renderContext,this._transitionOptions.glsl.shader)),this._transitionToIndex!==this._currentSlideIndex||this._transitionInProgress()){var a=60/this._transitionOptions.duration;"forwards"===this._transitionDirection&&(this._transitionProgress=this._transitionInProgress()?this._transitionProgress+a:a),"backwards"===this._transitionDirection&&(this._transitionProgress=this._transitionInProgress()?this._transitionProgress-a:1-a)}this._transitionProgress>1&&(this._transitionProgress=1),this._transitionProgress<0&&(this._transitionProgress=0);var o=is[this._transitionOptions.ease](this._transitionProgress);this._transition.render(o,this._fromTexture,this._toTexture,this._transitionOptions.glsl.uniforms)}else this._transition||(this._transition=qa(this._renderContext,"\n  #ifdef GL_ES\n  precision highp float;\n  #endif\n  uniform sampler2D from, to;\n  uniform float progress;\n  uniform vec2 resolution;\n\n  void main() {\n    vec2 p = gl_FragCoord.xy / resolution.xy;\n    gl_FragColor = texture2D(to, p);\n  }\n")),this._transition.render(1,this._fromTexture,this._toTexture);t._ready&&(t._rendered=!0,this._currentSlideRendered||(this._currentSlideRendered=!0,this._playSlideContent(this._transitionToIndex),this._slideRendered())),this._transitionToIndex===this._currentSlideIndex||this._transitionInProgress()||(this._currentSlideIndex=this._transitionToIndex,this._clearContext(this._currentContext),this._clearContext(this._nextContext),this._clearContext(this._prevContext),this._pauseSlideContent(),this._transitionEnded())}}},{key:"_isType",value:function(e,t){return e.type===t||e[t]||this._regExp[t]&&e.url&&this._regExp[t].test(e.url)||this._regExp[t]&&e.sources&&this._regExp[t].test(e.sources[0].url)}},{key:"_drawSlide",value:function(e,t){var r=this;t._hasVideo=t.content.filter(function(e){return r._isType(e,"video")}).length>0,t._rendered=!1,t._ready=!1,t._loaded||(t._loaded=!1),t.background&&(e.fillStyle=t.background,e.fillRect(0,0,this._width,this._height)),t.content.length&&this._drawSlideContent(e,t,0)}},{key:"_drawSlideContent",value:function(e,t,r){var n=t.content[r];if(!n)return t._ready=!0,void(t._loaded||(t._loaded=!0,this._slideLoaded(t,this._slides.indexOf(t))));var i=this._drawSlideContent.bind(this,e,t,r+1);if(this._isType(n,"video"))this._drawVideo(e,n,i);else if(this._isType(n,"image"))this._drawImage(e,n,i);else{if(!this._isType(n,"text"))throw new Error("Unknown content type");this._drawText(e,n,i)}}},{key:"_position2Pixels",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=[];return e.forEach(function(e,i){var a=void 0,o=[t._width,t._height,t._width,t._height][i];o/=r,a=e>=0&&e<=1?i<2?e*o:e*o-n[i-2]:i<2?e:o-n[i-2]-Math.abs(e),n.push(a)}),{x:n[0]*r,y:n[1]*r,width:n[2]*r,height:n[3]*r}}},{key:"_getImage",value:function(e,t){var r=this,n="function"==typeof e.url?e.url():e.url;if(this._imageMap[n])t(this._imageMap[n]);else{var i=new Image;i.crossOrigin="Anonymous",i.src=n,i.onerror=function(e){throw r.destroy(),new Error("Image failed to load",n)},i.onload=function(e){r._imageMap[n]=i,t(i)}}}},{key:"_resizeImage",value:function(t,r,n,i){var a=this,o=JSON.stringify({src:t.src,dst:n});this._slideContentMap[o]?i(this._slideContentMap[o]):ss.resizeBuffer({src:e._getImageData(t,r.x,r.y,r.width,r.height),width:r.width,height:r.height,toWidth:n.width,toHeight:n.height,alpha:!1,unsharpAmount:0,unsharpRadius:.5,unsharpThreshold:0}).then(function(e){if(e.length)return a._resizedImageData=new ImageData(new Uint8ClampedArray(e),n.width,n.height),a._slideContentMap[o]=a._resizedImageData,void i(a._slideContentMap[o]);console.error(new Error("Resize failed"),t.src,r,n)},function(e){console.error(e)})}},{key:"_drawText",value:function(e,t,r){var n=this._position2Pixels(t.position,this._scale);e.font=t.font||"72px sans-serif",e.textAlign=t.align||"center",e.fillStyle=t.color||"rgba(0, 0, 0, 1)";var i=t.maxWidth?t.maxWidth*this._width:void 0;e.fillText(t.text,n.x,n.y,i),r()}},{key:"_drawImage",value:function(t,r,n){var i=this;this._getImage(r,function(a){var o={x:0,y:0,width:a.naturalWidth,height:a.naturalHeight},s=i._position2Pixels(r.position,i._scale);if(r.tile){var l=e._getTile(s,r.tile.size),u=e._updateCoords(o,l,r.tile.scaleMode);i._resizeImage(a,u.src,u.dst,function(i){e._drawTiles(s,u.dst,r.scaleMode,function(e){t.putImageData(i,e.x,e.y)}),n()})}else{var h=e._updateCoords(o,s,r.scaleMode);o=h.src,s=h.dst,i._resizeImage(a,o,s,function(e){t.putImageData(e,s.x,s.y),n()})}})}},{key:"_getVideo",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n="function"==typeof e.url?e.url():e.url,i="function"==typeof e.sources?e.sources():e.sources,a=JSON.stringify(n||i);if(this._videoMap[a])return r(this._videoMap[a]),this._videoMap[a];var o=document.createElement("video");return o.style.display="none",o.crossOrigin="anonymous",o.muted=!0,this.container.appendChild(o),i?(i.forEach(function(e){var t=document.createElement("source");t.src=e.url,e.type&&(t.type=e.type),t.crossOrigin="anonymous",o.appendChild(t)}),n&&(o.poster=n)):n&&(o.src=n),this._videoMap[a]=o,o.addEventListener("loadedmetadata",function(){r(o)}),o._playCount=0,o.addEventListener("ended",function(){o.play(),o._playCount+=1,t._videoEnded(o,e)}),o}},{key:"_drawVideo",value:function(t,r,n){var i=this;this._getVideo(r,function(a){if(0!==a.videoWidth&&0!==a.videoHeight){var o={x:0,y:0,width:a.videoWidth,height:a.videoHeight},s=i._position2Pixels(r.position,i._scale);if(r.tile){var l=e._getTile(s,r.tile.size),u=e._updateCoords(o,l,r.tile.scaleMode);return e._drawTiles(s,u.dst,r.scaleMode,function(e){t.drawImage(a,o.x,o.y,o.width,o.height,e.x,e.y,l.width,l.height)}),void n()}var h=e._updateCoords(o,s,r.scaleMode);o=h.src,s=h.dst,t.drawImage(a,o.x,o.y,o.width,o.height,s.x,s.y,s.width,s.height),n()}})}},{key:"_playSlideContent",value:function(e){var t=this;this._slides[e].content.forEach(function(e){t._isType(e,"video")&&t._getVideo(e,function(e){e._playCount=0,e.currentTime=0,e.play()})})}},{key:"_pauseSlideContent",value:function(){var e=this,t=[];this._slides[this._currentSlideIndex].content.forEach(function(r){e._isType(r,"video")&&t.push(e._getVideo(r))}),this._slides.forEach(function(r,n){n!==e._currentSlideIndex&&r.content.forEach(function(r){e._isType(r,"video")&&e._getVideo(r,function(e){-1===t.indexOf(e)&&(e._playCount=0,e.currentTime=0,e.pause())})})})}}],[{key:"_updateCoords",value:function(e,t,r){var n=e.width/e.height,i=t.width/t.height;if(r&&"fill"===r){if(n<i){var a=t.height*(e.width/t.width);e.y=e.y+.5*(e.height-a),e.height=a}if(n>i){var o=t.width*(e.height/t.height);e.x=e.x+.5*(e.width-o),e.width=o}}else{if(n>i){var s=t.width*(e.height/e.width);t.y=t.y+.5*(t.height-s),t.height=s}if(n<i){var l=t.height*n;t.x=t.x+.5*(t.width-l),t.width=l}}return["x","y","width","height"].forEach(function(r){e[r]=Math.round(e[r]),t[r]=Math.round(t[r])}),{src:e,dst:t}}},{key:"_getTile",value:function(e,t){return{x:e.x,y:e.y,width:t[0]<=1?e.width*t[0]:t[0],height:t[1]<=1?e.height*t[1]:t[1]}}},{key:"_drawTiles",value:function(e,t,r,n){var i=void 0,a=void 0,o=0,s=0;r&&"fill"===r?(i=Math.ceil(e.height/t.height),a=Math.ceil(e.width/t.width),o=.5*(t.width*a-e.width),s=.5*(t.height*i-e.height)):(i=Math.floor(e.height/t.height),a=Math.floor(e.width/t.width));for(var l=0,u=0,h=i*a,f=0;f<h;f++)n({x:t.x+u*t.width-o,y:t.y+l*t.height-s}),u===a-1&&l++,u=u<a-1?u+1:0}},{key:"_getImageData",value:function(e,t,r,n,i){var a=document.createElement("canvas");a.width=e.naturalWidth,a.height=e.naturalHeight;var o=a.getContext("2d");return o.drawImage(e,0,0,e.naturalWidth,e.naturalHeight),o.getImageData(t,r,n,i).data}},{key:"_getVideoData",value:function(e){var t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;var r=t.getContext("2d");return r.drawImage(e,0,0,e.videoWidth,e.videoHeight),r._getImageData(0,0,e.videoWidth,e.videoHeight).data}}]),e}()});
//# sourceMappingURL=showy.min.js.map
