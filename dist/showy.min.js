!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("util")):"function"==typeof define&&define.amd?define(["util"],e):t.Showy=e(t.util)}(this,function(t){"use strict";function e(t,e){return e={exports:{}},t(e,e.exports),e.exports}function r(t){if(!(this instanceof r))return new r(t);var e=nt({},ot,t||{});if(this.options=e,this.__cache={},this.has_wasm=at(),this.__init_promise=null,this.__modules=e.modules||{},this.__memory=null,this.__wasm={},this.__isLE=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0],!this.options.js&&!this.options.wasm)throw new Error('mathlib: at least "js" or "wasm" should be enabled')}function n(t,e,r,n,i,a){var o,s,l,h,u,f,c,_,g,d,p,A,E,m;for(g=0;g<a;g++){for(c=g,_=0,h=u=(o=t[f=g*i])*n[6],p=n[0],A=n[1],E=n[4],m=n[5],d=0;d<i;d++)l=(s=t[f])*p+o*A+h*E+u*m,u=h,h=l,o=s,r[_]=h,_++,f++;for(_--,c+=a*(i-1),h=u=(o=t[--f])*n[7],s=o,p=n[2],A=n[3],d=i-1;d>=0;d--)l=s*p+o*A+h*E+u*m,u=h,h=l,o=s,s=t[f],e[c]=r[_]+h,f--,_--,c-=a}}function i(t){return Math.round(t*((1<<mt)-1))}function a(t){return t<0?0:t>255?255:t}function o(t,e,r){if(Tt)e.set(function(t){return new Uint8Array(t.buffer,0,t.byteLength)}(t),r);else for(let n=r,i=0;i<t.length;i++){let r=t[i];e[n++]=255&r,e[n++]=r>>8&255}}function s(t){const e=t||[];let r={js:e.indexOf("js")>=0,wasm:e.indexOf("wasm")>=0};dt.call(this,r),this.features={js:r.js,wasm:r.wasm&&this.has_wasm},this.use(At),this.use(xt)}function l(t,e){this.create=t,this.available=[],this.acquired={},this.lastId=1,this.timeoutId=0,this.idle=e||2e3}function h(t){return Object.prototype.toString.call(t)}function u(t){var e=Math.round(t);return Math.abs(t-e)<Bt?e:Math.floor(t)}function f(t){var e=Math.round(t);return Math.abs(t-e)<Bt?e:Math.ceil(t)}function c(){return{value:Z(Rt),destroy:function(){if(this.value.terminate(),"undefined"!=typeof window){let t=window.URL||window.webkitURL||window.mozURL||window.msURL;t&&t.revokeObjectURL&&this.value.objectURL&&t.revokeObjectURL(this.value.objectURL)}}}}function g(t){if(!(this instanceof g))return new g(t);this.options=H(Nt,t||{});let e=`lk_${this.options.concurrency}`;this.__limit=St[e]||Ct.limiter(this.options.concurrency),St[e]||(St[e]=this.__limit),this.features={js:!1,wasm:!1,cib:!1,ww:!1},this.__workersPool=null,this.__requested_features=[],this.__mathlib=null}function d(t,e){return t[0]-e[0]}function p(){var t,e=this.stride,r=new Array(e.length);for(t=0;t<r.length;++t)r[t]=[Math.abs(e[t]),t];r.sort(d);var n=new Array(r.length);for(t=0;t<n.length;++t)n[t]=r[t][1];return n}function A(t,e){var r=["View",e,"d",t].join("");e<0&&(r="View_Nil"+t);var n="generic"===t;if(-1===e){i="function "+r+"(a){this.data=a;};var proto="+r+".prototype;proto.dtype='"+t+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+r+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+r+"(a){return new "+r+"(a);}";return(d=new Function(i))()}if(0===e){i="function "+r+"(a,d) {this.data = a;this.offset = d};var proto="+r+".prototype;proto.dtype='"+t+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+r+"_copy() {return new "+r+"(this.data,this.offset)};proto.pick=function "+r+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+r+"_get(){return "+(n?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+r+"_set(v){return "+(n?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+r+"(a,b,c,d){return new "+r+"(a,d)}";return(d=new Function("TrivialArray",i))(Qt[t][0])}var i=["'use strict'"],a=Pt(e),o=a.map(function(t){return"i"+t}),s="this.offset+"+a.map(function(t){return"this.stride["+t+"]*i"+t}).join("+"),l=a.map(function(t){return"b"+t}).join(","),h=a.map(function(t){return"c"+t}).join(",");i.push("function "+r+"(a,"+l+","+h+",d){this.data=a","this.shape=["+l+"]","this.stride=["+h+"]","this.offset=d|0}","var proto="+r+".prototype","proto.dtype='"+t+"'","proto.dimension="+e),i.push("Object.defineProperty(proto,'size',{get:function "+r+"_size(){return "+a.map(function(t){return"this.shape["+t+"]"}).join("*"),"}})"),1===e?i.push("proto.order=[0]"):(i.push("Object.defineProperty(proto,'order',{get:"),e<4?(i.push("function "+r+"_order(){"),2===e?i.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===e&&i.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):i.push("ORDER})")),i.push("proto.set=function "+r+"_set("+o.join(",")+",v){"),n?i.push("return this.data.set("+s+",v)}"):i.push("return this.data["+s+"]=v}"),i.push("proto.get=function "+r+"_get("+o.join(",")+"){"),n?i.push("return this.data.get("+s+")}"):i.push("return this.data["+s+"]}"),i.push("proto.index=function "+r+"_index(",o.join(),"){return "+s+"}"),i.push("proto.hi=function "+r+"_hi("+o.join(",")+"){return new "+r+"(this.data,"+a.map(function(t){return["(typeof i",t,"!=='number'||i",t,"<0)?this.shape[",t,"]:i",t,"|0"].join("")}).join(",")+","+a.map(function(t){return"this.stride["+t+"]"}).join(",")+",this.offset)}");var u=a.map(function(t){return"a"+t+"=this.shape["+t+"]"}),f=a.map(function(t){return"c"+t+"=this.stride["+t+"]"});i.push("proto.lo=function "+r+"_lo("+o.join(",")+"){var b=this.offset,d=0,"+u.join(",")+","+f.join(","));for(g=0;g<e;++g)i.push("if(typeof i"+g+"==='number'&&i"+g+">=0){d=i"+g+"|0;b+=c"+g+"*d;a"+g+"-=d}");i.push("return new "+r+"(this.data,"+a.map(function(t){return"a"+t}).join(",")+","+a.map(function(t){return"c"+t}).join(",")+",b)}"),i.push("proto.step=function "+r+"_step("+o.join(",")+"){var "+a.map(function(t){return"a"+t+"=this.shape["+t+"]"}).join(",")+","+a.map(function(t){return"b"+t+"=this.stride["+t+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(g=0;g<e;++g)i.push("if(typeof i"+g+"==='number'){d=i"+g+"|0;if(d<0){c+=b"+g+"*(a"+g+"-1);a"+g+"=ceil(-a"+g+"/d)}else{a"+g+"=ceil(a"+g+"/d)}b"+g+"*=d}");i.push("return new "+r+"(this.data,"+a.map(function(t){return"a"+t}).join(",")+","+a.map(function(t){return"b"+t}).join(",")+",c)}");for(var c=new Array(e),_=new Array(e),g=0;g<e;++g)c[g]="a[i"+g+"]",_[g]="b[i"+g+"]";i.push("proto.transpose=function "+r+"_transpose("+o+"){"+o.map(function(t,e){return t+"=("+t+"===undefined?"+e+":"+t+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+r+"(this.data,"+c.join(",")+","+_.join(",")+",this.offset)}"),i.push("proto.pick=function "+r+"_pick("+o+"){var a=[],b=[],c=this.offset");for(g=0;g<e;++g)i.push("if(typeof i"+g+"==='number'&&i"+g+">=0){c=(c+this.stride["+g+"]*i"+g+")|0}else{a.push(this.shape["+g+"]);b.push(this.stride["+g+"])}");i.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),i.push("return function construct_"+r+"(data,shape,stride,offset){return new "+r+"(data,"+a.map(function(t){return"shape["+t+"]"}).join(",")+","+a.map(function(t){return"stride["+t+"]"}).join(",")+",offset)}");var d=new Function("CTOR_LIST","ORDER",i.join("\n"));return d(Qt[t],p)}function E(t,e,r){var n,i,a=t.length,o=e.arrayArgs.length,s=e.indexArgs.length>0,l=[],h=[],u=0,f=0;for(n=0;n<a;++n)h.push(["i",n,"=0"].join(""));for(i=0;i<o;++i)for(n=0;n<a;++n)f=u,u=t[n],0===n?h.push(["d",i,"s",n,"=t",i,"p",u].join("")):h.push(["d",i,"s",n,"=(t",i,"p",u,"-s",f,"*t",i,"p",f,")"].join(""));for(h.length>0&&l.push("var "+h.join(",")),n=a-1;n>=0;--n)u=t[n],l.push(["for(i",n,"=0;i",n,"<s",u,";++i",n,"){"].join(""));for(l.push(r),n=0;n<a;++n){for(f=u,u=t[n],i=0;i<o;++i)l.push(["p",i,"+=d",i,"s",n].join(""));s&&(n>0&&l.push(["index[",f,"]-=s",f].join("")),l.push(["++index[",u,"]"].join(""))),l.push("}")}return l.join("\n")}function m(t,e,r){for(var n=t.body,i=[],a=[],o=0;o<t.args.length;++o){var s=t.args[o];if(!(s.count<=0)){var l=new RegExp(s.name,"g"),h="",u=e.arrayArgs.indexOf(o);switch(e.argTypes[o]){case"offset":var f=e.offsetArgIndex.indexOf(o);u=e.offsetArgs[f].array,h="+q"+f;case"array":h="p"+u+h;var c="l"+o,_="a"+u;if(0===e.arrayBlockIndices[u])1===s.count?"generic"===r[u]?s.lvalue?(i.push(["var ",c,"=",_,".get(",h,")"].join("")),n=n.replace(l,c),a.push([_,".set(",h,",",c,")"].join(""))):n=n.replace(l,[_,".get(",h,")"].join("")):n=n.replace(l,[_,"[",h,"]"].join("")):"generic"===r[u]?(i.push(["var ",c,"=",_,".get(",h,")"].join("")),n=n.replace(l,c),s.lvalue&&a.push([_,".set(",h,",",c,")"].join(""))):(i.push(["var ",c,"=",_,"[",h,"]"].join("")),n=n.replace(l,c),s.lvalue&&a.push([_,"[",h,"]=",c].join("")));else{for(var g=[s.name],d=[h],p=0;p<Math.abs(e.arrayBlockIndices[u]);p++)g.push("\\s*\\[([^\\]]+)\\]"),d.push("$"+(p+1)+"*t"+u+"b"+p);if(l=new RegExp(g.join(""),"g"),h=d.join("+"),"generic"===r[u])throw new Error("cwise: Generic arrays not supported in combination with blocks!");n=n.replace(l,[_,"[",h,"]"].join(""))}break;case"scalar":n=n.replace(l,"Y"+e.scalarArgs.indexOf(o));break;case"index":n=n.replace(l,"index");break;case"shape":n=n.replace(l,"shape")}}}return[i.join("\n"),n,a.join("\n")].join("\n").trim()}function y(t){var e=32;return(t&=-t)&&e--,65535&t&&(e-=16),16711935&t&&(e-=8),252645135&t&&(e-=4),858993459&t&&(e-=2),1431655765&t&&(e-=1),e}function v(t,e,r){var n=0|t[r];if(n<=0)return[];var i,a=new Array(n);if(r===t.length-1)for(i=0;i<n;++i)a[i]=e;else for(i=0;i<n;++i)a[i]=v(t,e,r+1);return a}function I(t){return"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement||"undefined"!=typeof ImageData&&t instanceof ImageData}function T(t,e,r){var n=t.gl,i=n.getParameter(n.MAX_TEXTURE_SIZE);if(e<0||e>i||r<0||r>i)throw new Error("gl-texture2d: Invalid texture size");return t._shape=[e,r],t.bind(),n.texImage2D(n.TEXTURE_2D,0,t.format,e,r,0,t.format,t.type,null),t._mipLevels=[0],t}function x(t,e,r,n,i,a){this.gl=t,this.handle=e,this.format=i,this.type=a,this._shape=[r,n],this._mipLevels=[0],this._magFilter=t.NEAREST,this._minFilter=t.NEAREST,this._wrapS=t.CLAMP_TO_EDGE,this._wrapT=t.CLAMP_TO_EDGE,this._anisoSamples=1;var o=this,s=[this._wrapS,this._wrapT];Object.defineProperties(s,[{get:function(){return o._wrapS},set:function(t){return o.wrapS=t}},{get:function(){return o._wrapT},set:function(t){return o.wrapT=t}}]),this._wrapVector=s;var l=[this._shape[0],this._shape[1]];Object.defineProperties(l,[{get:function(){return o._shape[0]},set:function(t){return o.width=t}},{get:function(){return o._shape[1]},set:function(t){return o.height=t}}]),this._shapeVector=l}function w(t,e){return 3===t.length?1===e[2]&&e[1]===t[0]*t[2]&&e[0]===t[2]:1===e[0]&&e[1]===t[0]}function b(t){var e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e}function C(t,e,r,n,i){var a=t.getParameter(t.MAX_TEXTURE_SIZE);if(e<0||e>a||r<0||r>a)throw new Error("gl-texture2d: Invalid texture shape");if(i===t.FLOAT&&!t.getExtension("OES_texture_float"))throw new Error("gl-texture2d: Floating point textures not supported on this platform");var o=b(t);return t.texImage2D(t.TEXTURE_2D,0,n,e,r,0,n,i,null),new x(t,o,e,r,n,i)}function R(t,e,r){this.shortMessage=e||"",this.longMessage=r||"",this.rawError=t||"",this.message="gl-shader: "+(e||t||"")+(r?"\n"+r:""),this.stack=(new Error).stack}function B(t){return new Function("y","return function(){return y}")(t)}function S(t,e){for(var r=new Array(t),n=0;n<t;++n)r[n]=e;return r}function M(t,e,r,n,i,a){this._gl=t,this._wrapper=e,this._index=r,this._locations=n,this._dimension=i,this._constFunc=a}function D(t,e,r,n,i,a,o){for(var s=["gl","v"],l=[],h=0;h<i;++h)s.push("x"+h),l.push("x"+h);s.push("if(x0.length===void 0){return gl.vertexAttrib"+i+"f(v,"+l.join()+")}else{return gl.vertexAttrib"+i+"fv(v,x0)}");var u=Function.apply(null,s),f=new M(t,e,r,n,i,u);Object.defineProperty(a,o,{set:function(e){return t.disableVertexAttribArray(n[r]),u(t,n[r],e),e},get:function(){return f},enumerable:!0})}function N(t,e,r,n,i,a,o){for(var s=new Array(i),l=new Array(i),h=0;h<i;++h)D(t,e,r[h],n,i,s,h),l[h]=s[h];Object.defineProperty(s,"location",{set:function(t){if(Array.isArray(t))for(e=0;e<i;++e)l[e].location=t[e];else for(var e=0;e<i;++e)l[e].location=t+e;return t},get:function(){for(var t=new Array(i),e=0;e<i;++e)t[e]=n[r[e]];return t},enumerable:!0}),s.pointer=function(e,a,o,s){e=e||t.FLOAT,a=!!a,o=o||i*i,s=s||0;for(var l=0;l<i;++l){var h=n[r[l]];t.vertexAttribPointer(h,i,e,a,o,s+l*i),t.enableVertexAttribArray(h)}};var u=new Array(i),f=t["vertexAttrib"+i+"fv"];Object.defineProperty(a,o,{set:function(e){for(var a=0;a<i;++a){var o=n[r[a]];if(t.disableVertexAttribArray(o),Array.isArray(e[0]))f.call(t,o,e[a]);else{for(var s=0;s<i;++s)u[s]=e[i*a+s];f.call(t,o,u)}}return e},get:function(){return s},enumerable:!0})}function U(t,e,r,n,i,a,o){this.id=t,this.src=e,this.type=r,this.shader=n,this.count=a,this.programs=[],this.cache=o}function F(t){this.gl=t,this.shaders=[{},{}],this.programs={}}function L(t){var e=Ze.get(t);return e||(e=new F(t),Ze.set(t,e)),e}function O(t,e){if(!er){var r=Object.keys(tr);er={};for(var n=0;n<r.length;++n){var i=r[n];er[t[i]]=tr[i]}}return er[e]}function P(t){this.gl=t,this._vref=this._fref=this._relink=this.vertShader=this.fragShader=this.program=this.attributes=this.uniforms=this.types=null}function j(t,e){return t.name<e.name?-1:1}function V(t,e){if(!(this instanceof V))return new V(t,e);this.gl=t,this.shader=ir(t,ar,e),this.buffer=t.createBuffer()}t=t&&t.hasOwnProperty("default")?t.default:t;var Q,k=Object.getOwnPropertySymbols,X=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable,H=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},r=0;r<10;r++)e["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(t){n[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var r,n,i=function(t){if(null===t||void 0===t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),a=1;a<arguments.length;a++){r=Object(arguments[a]);for(var o in r)X.call(r,o)&&(i[o]=r[o]);if(k){n=k(r);for(var s=0;s<n.length;s++)G.call(r,n[s])&&(i[n[s]]=r[n[s]])}}return i},q=arguments[3],Y=arguments[4],W=arguments[5],z=JSON.stringify,Z=function(t,e){function r(t){c[t]=!0;for(var e in Y[t][1]){var n=Y[t][1][e];c[n]||r(n)}}for(var n,i=Object.keys(W),a=0,o=i.length;a<o;a++){var s=i[a],l=W[s].exports;if(l===t||l&&l.default===t){n=s;break}}if(!n){n=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var h={},a=0,o=i.length;a<o;a++){h[s=i[a]]=s}Y[n]=["function(require,module,exports){"+t+"(self); }",h]}var u=Math.floor(Math.pow(16,8)*Math.random()).toString(16),f={};f[n]=n,Y[u]=["function(require,module,exports){var f = require("+z(n)+");(f.default ? f.default : f)(self);}",f];var c={};r(u);var _="("+q+")({"+Object.keys(c).map(function(t){return z(t)+":["+Y[t][0]+","+z(Y[t][1])+"]"}).join(",")+"},{},["+z(u)+"])",g=window.URL||window.webkitURL||window.mozURL||window.msURL,d=new Blob([_],{type:"text/javascript"});if(e&&e.bare)return d;var p=g.createObjectURL(d),A=new Worker(p);return A.objectURL=p,A},K="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},J=e(function(t){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}}),$=e(function(e){try{var r=t;if("function"!=typeof r.inherits)throw"";e.exports=r.inherits}catch(t){e.exports=J}}),tt=Object.getOwnPropertySymbols,et=Object.prototype.hasOwnProperty,rt=Object.prototype.propertyIsEnumerable,nt=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},r=0;r<10;r++)e["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(t){n[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var r,n,i=function(t){if(null===t||void 0===t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),a=1;a<arguments.length;a++){r=Object(arguments[a]);for(var o in r)et.call(r,o)&&(i[o]=r[o]);if(tt){n=tt(r);for(var s=0;s<n.length;s++)rt.call(r,n[s])&&(i[n[s]]=r[n[s]])}}return i},it=function(t){for(var e=t.replace(/[\r\n=]/g,""),r=e.length,n=new Uint8Array(3*r>>2),i=0,a=0,o=0;o<r;o++)o%4==0&&o&&(n[a++]=i>>16&255,n[a++]=i>>8&255,n[a++]=255&i),i=i<<6|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(o));var s=r%4*6;return 0===s?(n[a++]=i>>16&255,n[a++]=i>>8&255,n[a++]=255&i):18===s?(n[a++]=i>>10&255,n[a++]=i>>2&255):12===s&&(n[a++]=i>>4&255),n},at=function(){if(void 0!==Q)return Q;if(Q=!1,"undefined"==typeof WebAssembly)return Q;try{var t=new WebAssembly.Module(it("AGFzbQEAAAABBQFgAAF/Ag8BA2VudgZtZW1vcnkCAAEDAgEABAQBcAAABwoBBmRldGVjdAAACQEACgYBBABBAQs=")),e={memoryBase:0,memory:new WebAssembly.Memory({initial:1}),tableBase:0,table:new WebAssembly.Table({initial:0,element:"anyfunc"})};return 1===(0,new WebAssembly.Instance(t,{env:e}).exports.detect)()&&(Q=!0),Q}catch(t){}return Q},ot={js:!0,wasm:!0};r.prototype.use=function(t){return this.__modules[t.name]=t,this.has_wasm&&this.options.wasm&&t.wasm_fn?this[t.name]=t.wasm_fn:this[t.name]=t.fn,this},r.prototype.init=function(){if(this.__init_promise)return this.__init_promise;if(!this.options.js&&this.options.wasm&&!this.has_wasm)return Promise.reject(new Error('mathlib: only "wasm" was enabled, but it\'s not supported'));var t=this;return this.__init_promise=Promise.all(Object.keys(t.__modules).map(function(e){var r=t.__modules[e];return t.has_wasm&&t.options.wasm&&r.wasm_fn?t.__wasm[e]?null:WebAssembly.compile(t.__base64decode(r.wasm_src)).then(function(r){t.__wasm[e]=r}):null})).then(function(){return t}),this.__init_promise},r.prototype.__base64decode=it,r.prototype.__reallocate=function(t){if(!this.__memory)return this.__memory=new WebAssembly.Memory({initial:Math.ceil(t/65536)}),this.__memory;var e=this.__memory.buffer.byteLength;return e<t&&this.__memory.grow(Math.ceil((t-e)/65536)),this.__memory},r.prototype.__instance=function(t,e,r){if(e&&this.__reallocate(e),!this.__wasm[t]){var n=this.__modules[t];this.__wasm[t]=new WebAssembly.Module(this.__base64decode(n.wasm_src))}if(!this.__cache[t]){var i={memoryBase:0,memory:this.__memory,tableBase:0,table:new WebAssembly.Table({initial:0,element:"anyfunc"})};this.__cache[t]=new WebAssembly.Instance(this.__wasm[t],{env:nt(i,r||{})})}return this.__cache[t]},r.prototype.__align=function(t,e){var r=t%(e=e||8);return t+(r?e-r:0)};var st,lt,ht,ut,ft,ct,_t,gt,dt=r,pt=function(t,e,r,i){if(i){var a=new Uint16Array(t.length),o=new Float32Array(Math.max(e,r)),s=function(t){t<.5&&(t=.5);var e=Math.exp(.527076)/t,r=Math.exp(-e),n=Math.exp(-2*e),i=(1-r)*(1-r)/(1+2*e*r-n);return st=i,lt=i*(e-1)*r,ht=i*(e+1)*r,ut=-i*n,ft=2*r,ct=-n,_t=(st+lt)/(1-ft-ct),gt=(ht+ut)/(1-ft-ct),new Float32Array([st,lt,ht,ut,ft,ct,_t,gt])}(i);n(t,a,o,s,e,r),n(a,t,o,s,r,e)}},At={name:"unsharp_mask",fn:function(t,e,r,n,i,a){var o,s,l,h,u,f,c,_,g,d,p,A,E;if(!(0===n||i<.5)){i>2&&(i=2);var m=function(t,n,i){for(var a,o,s,l,h,u=e*r,f=new Uint16Array(u),c=0;c<u;c++)a=t[4*c],o=t[4*c+1],s=t[4*c+2],h=a>=o&&a>=s?a:o>=s&&o>=a?o:s,l=a<=o&&a<=s?a:o<=s&&o<=a?o:s,f[c]=257*(h+l)>>1;return f}(t),y=new Uint16Array(m);pt(y,e,r,i);for(var v=n/100*4096+.5|0,I=257*a|0,T=e*r,x=0;x<T;x++)A=2*(m[x]-y[x]),Math.abs(A)>=I&&(o=t[E=4*x],s=t[E+1],l=t[E+2],f=257*((_=o>=s&&o>=l?o:s>=o&&s>=l?s:l)+(c=o<=s&&o<=l?o:s<=o&&s<=l?s:l))>>1,c===_?h=u=0:(u=f<=32767?4095*(_-c)/(_+c)|0:4095*(_-c)/(510-_-c)|0,h=o===_?65535*(s-l)/(6*(_-c))|0:s===_?21845+(65535*(l-o)/(6*(_-c))|0):43690+(65535*(o-s)/(6*(_-c))|0)),(f+=v*A+2048>>12)>65535?f=65535:f<0&&(f=0),0===u?o=s=l=f>>8:(g=2*f-(d=f<=32767?f*(4096+u)+2048>>12:f+((65535-f)*u+2048>>12))>>8,d>>=8,o=(p=h+21845&65535)>=43690?g:p>=32767?g+(6*(d-g)*(43690-p)+32768>>16):p>=10922?d:g+(6*(d-g)*p+32768>>16),s=(p=65535&h)>=43690?g:p>=32767?g+(6*(d-g)*(43690-p)+32768>>16):p>=10922?d:g+(6*(d-g)*p+32768>>16),l=(p=h-21845&65535)>=43690?g:p>=32767?g+(6*(d-g)*(43690-p)+32768>>16):p>=10922?d:g+(6*(d-g)*p+32768>>16)),t[E]=o,t[E+1]=s,t[E+2]=l)}},wasm_fn:function(t,e,r,n,i,a){if(!(0===n||i<.5)){i>2&&(i=2);var o=e*r,s=4*o,l=2*o,h=2*o,u=4*Math.max(e,r),f=s,c=f+l,_=c+h,g=_+h,d=g+u,p=this.__instance("unsharp_mask",s+l+2*h+u+32,{exp:Math.exp}),A=new Uint32Array(t.buffer);new Uint32Array(this.__memory.buffer).set(A);var E=p.exports.hsl_l16||p.exports._hsl_l16;E(0,f,e,r),(E=p.exports.blurMono16||p.exports._blurMono16)(f,c,_,g,d,e,r,i),(E=p.exports.unsharp||p.exports._unsharp)(0,0,f,c,e,r,n,a),A.set(new Uint32Array(this.__memory.buffer,0,o))}},wasm_src:"AGFzbQEAAAABMQZgAXwBfGACfX8AYAZ/f39/f38AYAh/f39/f39/fQBgBH9/f38AYAh/f39/f39/fwACGQIDZW52A2V4cAAAA2VudgZtZW1vcnkCAAEDBgUBAgMEBQQEAXAAAAdMBRZfX2J1aWxkX2dhdXNzaWFuX2NvZWZzAAEOX19nYXVzczE2X2xpbmUAAgpibHVyTW9ubzE2AAMHaHNsX2wxNgAEB3Vuc2hhcnAABQkBAAqJEAXZAQEGfAJAIAFE24a6Q4Ia+z8gALujIgOaEAAiBCAEoCIGtjgCECABIANEAAAAAAAAAMCiEAAiBbaMOAIUIAFEAAAAAAAA8D8gBKEiAiACoiAEIAMgA6CiRAAAAAAAAPA/oCAFoaMiArY4AgAgASAEIANEAAAAAAAA8L+gIAKioiIHtjgCBCABIAQgA0QAAAAAAADwP6AgAqKiIgO2OAIIIAEgBSACoiIEtow4AgwgASACIAegIAVEAAAAAAAA8D8gBqGgIgKjtjgCGCABIAMgBKEgAqO2OAIcCwu3AwMDfwR9CHwCQCADKgIUIQkgAyoCECEKIAMqAgwhCyADKgIIIQwCQCAEQX9qIgdBAEgiCA0AIAIgAC8BALgiDSADKgIYu6IiDiAJuyIQoiAOIAq7IhGiIA0gAyoCBLsiEqIgAyoCALsiEyANoqCgoCIPtjgCACACQQRqIQIgAEECaiEAIAdFDQAgBCEGA0AgAiAOIBCiIA8iDiARoiANIBKiIBMgAC8BALgiDaKgoKAiD7Y4AgAgAkEEaiECIABBAmohACAGQX9qIgZBAUoNAAsLAkAgCA0AIAEgByAFbEEBdGogAEF+ai8BACIIuCINIAu7IhGiIA0gDLsiEqKgIA0gAyoCHLuiIg4gCrsiE6KgIA4gCbsiFKKgIg8gAkF8aioCALugqzsBACAHRQ0AIAJBeGohAiAAQXxqIQBBACAFQQF0ayEHIAEgBSAEQQF0QXxqbGohBgNAIAghAyAALwEAIQggBiANIBGiIAO4Ig0gEqKgIA8iECAToqAgDiAUoqAiDyACKgIAu6CrOwEAIAYgB2ohBiAAQX5qIQAgAkF8aiECIBAhDiAEQX9qIgRBAUoNAAsLCwvfAgIDfwZ8AkAgB0MAAAAAWw0AIARE24a6Q4Ia+z8gB0MAAAA/l7ujIgyaEAAiDSANoCIPtjgCECAEIAxEAAAAAAAAAMCiEAAiDraMOAIUIAREAAAAAAAA8D8gDaEiCyALoiANIAwgDKCiRAAAAAAAAPA/oCAOoaMiC7Y4AgAgBCANIAxEAAAAAAAA8L+gIAuioiIQtjgCBCAEIA0gDEQAAAAAAADwP6AgC6KiIgy2OAIIIAQgDiALoiINtow4AgwgBCALIBCgIA5EAAAAAAAA8D8gD6GgIgujtjgCGCAEIAwgDaEgC6O2OAIcIAYEQCAFQQF0IQogBiEJIAIhCANAIAAgCCADIAQgBSAGEAIgACAKaiEAIAhBAmohCCAJQX9qIgkNAAsLIAVFDQAgBkEBdCEIIAUhAANAIAIgASADIAQgBiAFEAIgAiAIaiECIAFBAmohASAAQX9qIgANAAsLC7wBAQV/IAMgAmwiAwRAQQAgA2shBgNAIAAoAgAiBEEIdiIHQf8BcSECAn8gBEH/AXEiAyAEQRB2IgRB/wFxIgVPBEAgAyIIIAMgAk8NARoLIAQgBCAHIAIgA0kbIAIgBUkbQf8BcQshCAJAIAMgAk0EQCADIAVNDQELIAQgByAEIAMgAk8bIAIgBUsbQf8BcSEDCyAAQQRqIQAgASADIAhqQYECbEEBdjsBACABQQJqIQEgBkEBaiIGDQALCwvTBgEKfwJAIAazQwAAgEWUQwAAyEKVu0QAAAAAAADgP6CqIQ0gBSAEbCILBEAgB0GBAmwhDgNAQQAgAi8BACADLwEAayIGQQF0IgdrIAcgBkEASBsgDk8EQCAAQQJqLQAAIQUCfyAALQAAIgYgAEEBai0AACIESSIJRQRAIAYiCCAGIAVPDQEaCyAFIAUgBCAEIAVJGyAGIARLGwshCAJ/IAYgBE0EQCAGIgogBiAFTQ0BGgsgBSAFIAQgBCAFSxsgCRsLIgogCGoiD0GBAmwiEEEBdiERQQAhDAJ/QQAiCSAIIApGDQAaIAggCmsiCUH/H2wgD0H+AyAIayAKayAQQYCABEkbbSEMIAYgCEYEQCAEIAVrQf//A2wgCUEGbG0MAQsgBSAGayAGIARrIAQgCEYiBhtB//8DbCAJQQZsbUHVqgFBqtUCIAYbagshCSARIAcgDWxBgBBqQQx1aiIGQQAgBkEAShsiBkH//wMgBkH//wNIGyEGAkACfwJAIAxB//8DcSIFBEAgBkH//wFKDQEgBUGAIGogBmxBgBBqQQx2DAILIAZBCHYiBiEFIAYhBAwCCyAFIAZB//8Dc2xBgBBqQQx2IAZqCyIFQQh2IQcgBkEBdCAFa0EIdiIGIQQCQCAJQdWqAWpB//8DcSIFQanVAksNACAFQf//AU8EQEGq1QIgBWsgByAGa2xBBmxBgIACakEQdiAGaiEEDAELIAchBCAFQanVAEsNACAFIAcgBmtsQQZsQYCAAmpBEHYgBmohBAsCfyAGIgUgCUH//wNxIghBqdUCSw0AGkGq1QIgCGsgByAGa2xBBmxBgIACakEQdiAGaiAIQf//AU8NABogByIFIAhBqdUASw0AGiAIIAcgBmtsQQZsQYCAAmpBEHYgBmoLIQUgCUGr1QJqQf//A3EiCEGp1QJLDQAgCEH//wFPBEBBqtUCIAhrIAcgBmtsQQZsQYCAAmpBEHYgBmohBgwBCyAIQanVAEsEQCAHIQYMAQsgCCAHIAZrbEEGbEGAgAJqQRB2IAZqIQYLIAEgBDoAACABQQFqIAU6AAAgAUECaiAGOgAACyADQQJqIQMgAkECaiECIABBBGohACABQQRqIQEgC0F/aiILDQALCwsL"},Et=[{win:.5,filter:function(t){return t>=-.5&&t<.5?1:0}},{win:1,filter:function(t){if(t<=-1||t>=1)return 0;if(t>-1.1920929e-7&&t<1.1920929e-7)return 1;var e=t*Math.PI;return Math.sin(e)/e*(.54+.46*Math.cos(e/1))}},{win:2,filter:function(t){if(t<=-2||t>=2)return 0;if(t>-1.1920929e-7&&t<1.1920929e-7)return 1;var e=t*Math.PI;return Math.sin(e)/e*Math.sin(e/2)/(e/2)}},{win:3,filter:function(t){if(t<=-3||t>=3)return 0;if(t>-1.1920929e-7&&t<1.1920929e-7)return 1;var e=t*Math.PI;return Math.sin(e)/e*Math.sin(e/3)/(e/3)}}],mt=14,yt=function(t,e,r,n,a){var o,s,l,h,u,f,c,_,g,d,p,A,E,m,y,v,I,T=Et[t].filter,x=1/n,w=Math.min(1,n),b=Et[t].win/w,C=Math.floor(2*(b+1)),R=new Int16Array((C+2)*r),B=0,S=!R.subarray||!R.set;for(o=0;o<r;o++){for(s=(o+.5)*x+a,l=Math.max(0,Math.floor(s-b)),u=(h=Math.min(e-1,Math.ceil(s+b)))-l+1,f=new Float32Array(u),c=new Int16Array(u),_=0,g=l,d=0;g<=h;g++,d++)_+=p=T((g+.5-s)*w),f[d]=p;for(A=0,d=0;d<f.length;d++)A+=E=f[d]/_,c[d]=i(E);for(c[r>>1]+=i(1-A),m=0;m<c.length&&0===c[m];)m++;if(m<c.length){for(y=c.length-1;y>0&&0===c[y];)y--;if(v=l+m,I=y-m+1,R[B++]=v,R[B++]=I,S)for(d=m;d<=y;d++)R[B++]=c[d];else R.set(c.subarray(m,y+1),B),B+=I}else R[B++]=0,R[B++]=0}return R};const vt=function(t,e,r,n,i,o){var s,l,h,u,f,c,_,g,d,p,A,E=0,m=0;for(d=0;d<n;d++){for(f=0,p=0;p<i;p++){for(c=o[f++],_=o[f++],g=E+4*c|0,s=l=h=u=0;_>0;_--)u=u+(A=o[f++])*t[g+3]|0,h=h+A*t[g+2]|0,l=l+A*t[g+1]|0,s=s+A*t[g]|0,g=g+4|0;e[m+3]=a(u+8192>>14),e[m+2]=a(h+8192>>14),e[m+1]=a(l+8192>>14),e[m]=a(s+8192>>14),m=m+4*n|0}m=4*(d+1)|0,E=(d+1)*r*4|0}},It=function(t,e,r,n,i,o){var s,l,h,u,f,c,_,g,d,p,A,E=0,m=0;for(d=0;d<n;d++){for(f=0,p=0;p<i;p++){for(c=o[f++],_=o[f++],g=E+4*c|0,s=l=h=u=0;_>0;_--)u=u+(A=o[f++])*t[g+3]|0,h=h+A*t[g+2]|0,l=l+A*t[g+1]|0,s=s+A*t[g]|0,g=g+4|0;e[m+3]=a(u+8192>>14),e[m+2]=a(h+8192>>14),e[m+1]=a(l+8192>>14),e[m]=a(s+8192>>14),m=m+4*n|0}m=4*(d+1)|0,E=(d+1)*r*4|0}};let Tt=!0;try{Tt=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]}catch(t){}var xt={name:"resize",fn:function(t){const e=t.src,r=t.width,n=t.height,i=t.toWidth,a=t.toHeight,o=t.scaleX||t.toWidth/t.width,s=t.scaleY||t.toHeight/t.height,l=t.offsetX||0,h=t.offsetY||0,u=t.dest||new Uint8Array(i*a*4),f=void 0===t.quality?3:t.quality,c=t.alpha||!1,_=yt(f,r,i,o,l),g=yt(f,n,a,s,h),d=new Uint8Array(i*n*4);return vt(e,d,r,n,i,_),It(d,u,n,i,a,g),c||function(t,e,r){let n=3,o=i*a*4|0;for(;n<o;)t[n]=255,n=n+4|0}(u),u},wasm_fn:function(t){const e=t.src,r=t.width,n=t.height,i=t.toWidth,a=t.toHeight,s=t.scaleX||t.toWidth/t.width,l=t.scaleY||t.toHeight/t.height,h=t.offsetX||0,u=t.offsetY||0,f=t.dest||new Uint8Array(i*a*4),c=void 0===t.quality?3:t.quality,_=t.alpha||!1,g=yt(c,r,i,s,h),d=yt(c,n,a,l,u),p=this.__align(0+Math.max(e.byteLength,f.byteLength),8),A=this.__align(p+n*i*4,8),E=this.__align(A+g.byteLength,8),m=E+d.byteLength,y=this.__instance("resize",m),v=new Uint8Array(this.__memory.buffer),I=new Uint32Array(this.__memory.buffer),T=new Uint32Array(e.buffer);I.set(T),o(g,v,A),o(d,v,E);(y.exports.convolveHV||y.exports._convolveHV)(A,E,p,r,n,i,a);return new Uint32Array(f.buffer).set(new Uint32Array(this.__memory.buffer,0,a*i)),_||function(t,e,r){let n=3,o=i*a*4|0;for(;n<o;)t[n]=255,n=n+4|0}(f),f},wasm_src:"AGFzbQEAAAABFAJgBn9/f39/fwBgB39/f39/f38AAg8BA2VudgZtZW1vcnkCAAEDAwIAAQQEAXAAAAcZAghjb252b2x2ZQAACmNvbnZvbHZlSFYAAQkBAArmAwLBAwEQfwJAIANFDQAgBEUNACAFQQRqIRVBACEMQQAhDQNAIA0hDkEAIRFBACEHA0AgB0ECaiESAn8gBSAHQQF0IgdqIgZBAmouAQAiEwRAQQAhCEEAIBNrIRQgFSAHaiEPIAAgDCAGLgEAakECdGohEEEAIQlBACEKQQAhCwNAIBAoAgAiB0EYdiAPLgEAIgZsIAtqIQsgB0H/AXEgBmwgCGohCCAHQRB2Qf8BcSAGbCAKaiEKIAdBCHZB/wFxIAZsIAlqIQkgD0ECaiEPIBBBBGohECAUQQFqIhQNAAsgEiATagwBC0EAIQtBACEKQQAhCUEAIQggEgshByABIA5BAnRqIApBgMAAakEOdSIGQf8BIAZB/wFIG0EQdEGAgPwHcUEAIAZBAEobIAtBgMAAakEOdSIGQf8BIAZB/wFIG0EYdEEAIAZBAEobciAJQYDAAGpBDnUiBkH/ASAGQf8BSBtBCHRBgP4DcUEAIAZBAEobciAIQYDAAGpBDnUiBkH/ASAGQf8BSBtB/wFxQQAgBkEAShtyNgIAIA4gA2ohDiARQQFqIhEgBEcNAAsgDCACaiEMIA1BAWoiDSADRw0ACwsLIQACQEEAIAIgAyAEIAUgABAAIAJBACAEIAUgBiABEAALCw=="};$(s,dt),s.prototype.resizeAndUnsharp=function(t,e){let r=this.resize(t,e);return t.unsharpAmount&&this.unsharp_mask(r,t.toWidth,t.toHeight,t.unsharpAmount,t.unsharpRadius,t.unsharpThreshold),r};var wt=s;l.prototype.acquire=function(){let t;return 0!==this.available.length?t=this.available.pop():((t=this.create()).id=this.lastId++,t.release=(()=>this.release(t))),this.acquired[t.id]=t,t},l.prototype.release=function(t){delete this.acquired[t.id],t.lastUsed=Date.now(),this.available.push(t),0===this.timeoutId&&(this.timeoutId=setTimeout(()=>this.gc(),100))},l.prototype.gc=function(){const t=Date.now();this.available=this.available.filter(e=>!(t-e.lastUsed>this.idle)||(e.destroy(),!1)),0!==this.available.length?this.timeoutId=setTimeout(()=>this.gc(),100):this.timeoutId=0};var bt=l,Ct={isCanvas:function(t){let e=h(t);return"[object HTMLCanvasElement]"===e||"[object Canvas]"===e},isImage:function(t){return"[object HTMLImageElement]"===h(t)},limiter:function(t){function e(){r<t&&n.length&&(r++,n.shift()())}let r=0,n=[];return function(t){return new Promise((i,a)=>{n.push(()=>{t().then(t=>{i(t),r--,e()},t=>{a(t),r--,e()})}),e()})}},cib_quality_name:function(t){switch(t){case 0:return"pixelated";case 1:return"low";case 2:return"medium"}return"high"},cib_support:function(){return Promise.resolve().then(()=>{if("undefined"==typeof createImageBitmap||"undefined"==typeof document)return!1;let t=document.createElement("canvas");return t.width=100,t.height=100,createImageBitmap(t,0,0,100,100,{resizeWidth:10,resizeHeight:10,resizeQuality:"high"}).then(e=>{let r=10===e.width;return e.close(),t=null,r})}).catch(()=>!1)}},Rt=function(){const t=wt;let e;onmessage=function(r){let n=r.data.opts;e||(e=new t(r.data.features));let i=e.resizeAndUnsharp(n);postMessage({result:i},[i.buffer])}},Bt=1e-5;const St={};let Mt=!1;try{"undefined"!=typeof navigator&&navigator.userAgent&&(Mt=navigator.userAgent.indexOf("Safari")>=0)}catch(t){}let Dt=1;"undefined"!=typeof navigator&&(Dt=Math.min(navigator.hardwareConcurrency||1,4));const Nt={tile:1024,concurrency:Dt,features:["js","wasm","ww"],idle:2e3},Ut={quality:3,alpha:!1,unsharpAmount:0,unsharpRadius:0,unsharpThreshold:0};let Ft,Lt;g.prototype.init=function(){if(this.__initPromise)return this.__initPromise;if(!1!==Ft&&!0!==Ft&&(Ft=!1,"undefined"!=typeof ImageData&&"undefined"!=typeof Uint8ClampedArray))try{new ImageData(new Uint8ClampedArray(400),10,10),Ft=!0}catch(t){}!1!==Lt&&!0!==Lt&&(Lt=!1,"undefined"!=typeof ImageBitmap&&(ImageBitmap.prototype&&ImageBitmap.prototype.close?Lt=!0:this.debug("ImageBitmap does not support .close(), disabled")));let t=this.options.features.slice();if(t.indexOf("all")>=0&&(t=["cib","wasm","js","ww"]),this.__requested_features=t,this.__mathlib=new wt(t),t.indexOf("ww")>=0&&"undefined"!=typeof window&&"Worker"in window)try{Z(function(){}).terminate(),this.features.ww=!0;let t=`wp_${JSON.stringify(this.options)}`;St[t]?this.__workersPool=St[t]:(this.__workersPool=new bt(c,this.options.idle),St[t]=this.__workersPool)}catch(t){}let e,r=this.__mathlib.init().then(t=>{H(this.features,t.features)});return e=Lt?Ct.cib_support().then(e=>{this.features.cib&&t.indexOf("cib")<0?this.debug("createImageBitmap() resize supported, but disabled by config"):t.indexOf("cib")>=0&&(this.features.cib=e)}):Promise.resolve(!1),this.__initPromise=Promise.all([r,e]).then(()=>this),this.__initPromise},g.prototype.resize=function(t,e,r){this.debug("Start resize...");let n=Ut;isNaN(r)?r&&(n=H(n,r)):n=H(n,{quality:r}),n.toWidth=e.width,n.toHeigth=e.height,n.width=t.naturalWidth||t.width,n.height=t.naturalHeight||t.height;let i=!1,a=null;n.cancelToken&&(a=n.cancelToken.then(t=>{throw i=!0,t},t=>{throw i=!0,t}));let o=e.getContext("2d",{alpha:Boolean(n.alpha)});return this.init().then(()=>{if(i)return a;if(this.features.cib)return this.debug("Resize via createImageBitmap()"),createImageBitmap(t,{resizeWidth:n.toWidth,resizeHeight:n.toHeigth,resizeQuality:Ct.cib_quality_name(n.quality)}).then(t=>{if(i)return a;if(!n.unsharpAmount)return o.drawImage(t,0,0),t.close(),o=null,this.debug("Finished!"),e;this.debug("Unsharp result");let r=document.createElement("canvas");r.width=n.toWidth,r.height=n.toHeigth;let s=r.getContext("2d",{alpha:Boolean(n.alpha)});s.drawImage(t,0,0),t.close();let l=s.getImageData(0,0,n.toWidth,n.toHeigth);return this.__mathlib.unsharp(l.data,n.toWidth,n.toHeigth,n.unsharpAmount,n.unsharpRadius,n.unsharpThreshold),o.putImageData(l,0,0),l=s=r=o=null,this.debug("Finished!"),e});let r,s,l={};const h=t=>Promise.resolve().then(()=>this.features.ww?new Promise((e,r)=>{let n=this.__workersPool.acquire();a&&a.catch(t=>r(t)),n.value.onmessage=(t=>{n.release(),t.data.err?r(t.data.err):e(t.data.result)}),n.value.postMessage({opts:t,features:this.__requested_features,preload:{wasm_nodule:this.__mathlib.__}},[t.src.buffer])}):this.__mathlib.resizeAndUnsharp(t,l)),c=e=>this.__limit(()=>{if(i)return a;let l;if(Ct.isCanvas(t))this.debug("Get tile pixel data"),l=r.getImageData(e.x,e.y,e.width,e.height);else{this.debug("Draw tile imageBitmap/image to temporary canvas");let r=document.createElement("canvas");r.width=e.width,r.height=e.height;let i=r.getContext("2d",{alpha:Boolean(n.alpha)});i.globalCompositeOperation="copy",i.drawImage(s||t,e.x,e.y,e.width,e.height,0,0,e.width,e.height),this.debug("Get tile pixel data"),l=i.getImageData(0,0,e.width,e.height),i=r=null}let u={src:l.data,width:e.width,height:e.height,toWidth:e.toWidth,toHeight:e.toHeight,scaleX:e.scaleX,scaleY:e.scaleY,offsetX:e.offsetX,offsetY:e.offsetY,quality:n.quality,alpha:n.alpha,unsharpAmount:n.unsharpAmount,unsharpRadius:n.unsharpRadius,unsharpThreshold:n.unsharpThreshold};return this.debug("Invoke resize math"),Promise.resolve().then(()=>h(u)).then(t=>{if(i)return a;l=null;let r;if(this.debug("Convert raw rgba tile result to ImageData"),Ft)r=new ImageData(new Uint8ClampedArray(t),e.toWidth,e.toHeight);else if((r=o.createImageData(e.toWidth,e.toHeight)).data.set)r.data.set(t);else for(let e=r.data.length-1;e>=0;e--)r.data[e]=t[e];return this.debug("Draw tile"),Mt?o.putImageData(r,e.toX,e.toY,e.toInnerX-e.toX,e.toInnerY-e.toY,e.toInnerWidth+1e-5,e.toInnerHeight+1e-5):o.putImageData(r,e.toX,e.toY,e.toInnerX-e.toX,e.toInnerY-e.toY,e.toInnerWidth,e.toInnerHeight),null})});return Promise.resolve().then(()=>{if(Ct.isCanvas(t))return r=t.getContext("2d",{alpha:Boolean(n.alpha)}),null;if(Ct.isImage(t))return Lt?(this.debug("Decode image via createImageBitmap"),createImageBitmap(t).then(t=>{s=t})):null;throw new Error('".from" should be image or canvas')}).then(()=>{function t(){s&&(s.close(),s=null)}if(i)return a;this.debug("Calculate tiles");let r=function(t){var e,r,n,i,a,o,s,l=t.toWidth/t.width,h=t.toHeight/t.height,c=u(t.srcTileSize*l)-2*t.destTileBorder,_=u(t.srcTileSize*h)-2*t.destTileBorder,g=[];for(i=0;i<t.toHeight;i+=_)for(n=0;n<t.toWidth;n+=c)(e=n-t.destTileBorder)<0&&(e=0),e+(a=n+c+t.destTileBorder-e)>=t.toWidth&&(a=t.toWidth-e),(r=i-t.destTileBorder)<0&&(r=0),r+(o=i+_+t.destTileBorder-r)>=t.toHeight&&(o=t.toHeight-r),s={toX:e,toY:r,toWidth:a,toHeight:o,toInnerX:n,toInnerY:i,toInnerWidth:c,toInnerHeight:_,offsetX:e/l-u(e/l),offsetY:r/h-u(r/h),scaleX:l,scaleY:h,x:u(e/l),y:u(r/h),width:f(a/l),height:f(o/h)},g.push(s);return g}({width:n.width,height:n.height,srcTileSize:this.options.tile,toWidth:n.toWidth,toHeight:n.toHeigth,destTileBorder:Math.ceil(Math.max(3,2.5*n.unsharpRadius|0))}).map(t=>c(t));return this.debug("Process tiles"),Promise.all(r).then(()=>(this.debug("Finished!"),t(),e),e=>{throw t(),e})})})},g.prototype.resizeBuffer=function(t){const e=H(Ut,t);return this.init().then(()=>this.__mathlib.resizeAndUnsharp(e))},g.prototype.toBlob=function(t,e,r){return e=e||"image/png",new Promise(n=>{if(t.toBlob)return void t.toBlob(t=>n(t),e,r);const i=atob(t.toDataURL(e,r).split(",")[1]),a=i.length,o=new Uint8Array(a);for(let t=0;t<a;t++)o[t]=i.charCodeAt(t);n(new Blob([o],{type:e}))})},g.prototype.debug=function(){};var Ot=g,Pt=function(t){for(var e=new Array(t),r=0;r<t;++r)e[r]=r;return e},jt=function(t){return!(null==t||!(t._isBuffer||t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)))},Vt="undefined"!=typeof Float64Array,Qt={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]},kt=function(t,e,r,n){if(void 0===t)return(h=Qt.array[0])([]);"number"==typeof t&&(t=[t]),void 0===e&&(e=[t.length]);var i=e.length;if(void 0===r){r=new Array(i);for(var a=i-1,o=1;a>=0;--a)r[a]=o,o*=e[a]}if(void 0===n)for(n=0,a=0;a<i;++a)r[a]<0&&(n-=(e[a]-1)*r[a]);for(var s=function(t){if(jt(t))return"buffer";if(Vt)switch(Object.prototype.toString.call(t)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped"}return Array.isArray(t)?"array":"generic"}(t),l=Qt[s];l.length<=i+1;)l.push(A(s,l.length-1));var h=l[i+1];return h(t,e,r,n)},Xt=function(t,e,r){return 0===t.length?t:e?(r||t.sort(e),function(t,e){for(var r=1,n=t.length,i=t[0],a=t[0],o=1;o<n;++o)if(a=i,i=t[o],e(i,a)){if(o===r){r++;continue}t[r++]=i}return t.length=r,t}(t,e)):(r||t.sort(),function(t){for(var e=1,r=t.length,n=t[0],i=t[0],a=1;a<r;++a,i=n)if(i=n,(n=t[a])!==i){if(a===e){e++;continue}t[e++]=n}return t.length=e,t}(t))},Gt=function(t,e){for(var r=e[1].length-Math.abs(t.arrayBlockIndices[0])|0,n=new Array(t.arrayArgs.length),i=new Array(t.arrayArgs.length),a=0;a<t.arrayArgs.length;++a)i[a]=e[2*a],n[a]=e[2*a+1];for(var o=[],s=[],l=[],h=[],u=[],a=0;a<t.arrayArgs.length;++a){t.arrayBlockIndices[a]<0?(l.push(0),h.push(r),o.push(r),s.push(r+t.arrayBlockIndices[a])):(l.push(t.arrayBlockIndices[a]),h.push(t.arrayBlockIndices[a]+r),o.push(0),s.push(t.arrayBlockIndices[a]));for(var f=[],c=0;c<n[a].length;c++)l[a]<=n[a][c]&&n[a][c]<h[a]&&f.push(n[a][c]-l[a]);u.push(f)}for(var _=["SS"],g=["'use strict'"],d=[],c=0;c<r;++c)d.push(["s",c,"=SS[",c,"]"].join(""));for(a=0;a<t.arrayArgs.length;++a){for(_.push("a"+a),_.push("t"+a),_.push("p"+a),c=0;c<r;++c)d.push(["t",a,"p",c,"=t",a,"[",l[a]+c,"]"].join(""));for(c=0;c<Math.abs(t.arrayBlockIndices[a]);++c)d.push(["t",a,"b",c,"=t",a,"[",o[a]+c,"]"].join(""))}for(a=0;a<t.scalarArgs.length;++a)_.push("Y"+a);if(t.shapeArgs.length>0&&d.push("shape=SS.slice(0)"),t.indexArgs.length>0){for(var p=new Array(r),a=0;a<r;++a)p[a]="0";d.push(["index=[",p.join(","),"]"].join(""))}for(a=0;a<t.offsetArgs.length;++a){for(var A=t.offsetArgs[a],y=[],c=0;c<A.offset.length;++c)0!==A.offset[c]&&(1===A.offset[c]?y.push(["t",A.array,"p",c].join("")):y.push([A.offset[c],"*t",A.array,"p",c].join("")));0===y.length?d.push("q"+a+"=0"):d.push(["q",a,"=",y.join("+")].join(""))}var v=Xt([].concat(t.pre.thisVars).concat(t.body.thisVars).concat(t.post.thisVars));for((d=d.concat(v)).length>0&&g.push("var "+d.join(",")),a=0;a<t.arrayArgs.length;++a)g.push("p"+a+"|=0");t.pre.body.length>3&&g.push(m(t.pre,t,i));var I=m(t.body,t,i),T=function(t){for(var e=0,r=t[0].length;e<r;){for(var n=1;n<t.length;++n)if(t[n][e]!==t[0][e])return e;++e}return e}(u);T<r?g.push(function(t,e,r,n){for(var i=e.length,a=r.arrayArgs.length,o=r.blockSize,s=r.indexArgs.length>0,l=[],h=0;h<a;++h)l.push(["var offset",h,"=p",h].join(""));for(h=t;h<i;++h)l.push(["for(var j"+h+"=SS[",e[h],"]|0;j",h,">0;){"].join("")),l.push(["if(j",h,"<",o,"){"].join("")),l.push(["s",e[h],"=j",h].join("")),l.push(["j",h,"=0"].join("")),l.push(["}else{s",e[h],"=",o].join("")),l.push(["j",h,"-=",o,"}"].join("")),s&&l.push(["index[",e[h],"]=j",h].join(""));for(h=0;h<a;++h){for(var u=["offset"+h],f=t;f<i;++f)u.push(["j",f,"*t",h,"p",e[f]].join(""));l.push(["p",h,"=(",u.join("+"),")"].join(""))}for(l.push(E(e,r,n)),h=t;h<i;++h)l.push("}");return l.join("\n")}(T,u[0],t,I)):g.push(E(u[0],t,I)),t.post.body.length>3&&g.push(m(t.post,t,i)),t.debug&&console.log("-----Generated cwise routine for ",e,":\n"+g.join("\n")+"\n----------");var x=[t.funcName||"unnamed","_cwise_loop_",n[0].join("s"),"m",T,function(t){for(var e=new Array(t.length),r=!0,n=0;n<t.length;++n){var i=t[n],a=i.match(/\d+/);a=a?a[0]:"",0===i.charAt(0)?e[n]="u"+i.charAt(1)+a:e[n]=i.charAt(0)+a,n>0&&(r=r&&e[n]===e[n-1])}return r?e[0]:e.join("")}(i)].join("");return new Function(["function ",x,"(",_.join(","),"){",g.join("\n"),"} return ",x].join(""))()},Ht=function(t){var e=["'use strict'","var CACHED={}"],r=[],n=t.funcName+"_cwise_thunk";e.push(["return function ",n,"(",t.shimArgs.join(","),"){"].join(""));for(var i=[],a=[],o=[["array",t.arrayArgs[0],".shape.slice(",Math.max(0,t.arrayBlockIndices[0]),t.arrayBlockIndices[0]<0?","+t.arrayBlockIndices[0]+")":")"].join("")],s=[],l=[],h=0;h<t.arrayArgs.length;++h){var u=t.arrayArgs[h];r.push(["t",u,"=array",u,".dtype,","r",u,"=array",u,".order"].join("")),i.push("t"+u),i.push("r"+u),a.push("t"+u),a.push("r"+u+".join()"),o.push("array"+u+".data"),o.push("array"+u+".stride"),o.push("array"+u+".offset|0"),h>0&&(s.push("array"+t.arrayArgs[0]+".shape.length===array"+u+".shape.length+"+(Math.abs(t.arrayBlockIndices[0])-Math.abs(t.arrayBlockIndices[h]))),l.push("array"+t.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,t.arrayBlockIndices[0])+"]===array"+u+".shape[shapeIndex+"+Math.max(0,t.arrayBlockIndices[h])+"]"))}for(t.arrayArgs.length>1&&(e.push("if (!("+s.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),e.push("for(var shapeIndex=array"+t.arrayArgs[0]+".shape.length-"+Math.abs(t.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),e.push("if (!("+l.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),e.push("}")),h=0;h<t.scalarArgs.length;++h)o.push("scalar"+t.scalarArgs[h]);return r.push(["type=[",a.join(","),"].join()"].join("")),r.push("proc=CACHED[type]"),e.push("var "+r.join(",")),e.push(["if(!proc){","CACHED[type]=proc=compile([",i.join(","),"])}","return proc(",o.join(","),")}"].join("")),t.debug&&console.log("-----Generated thunk:\n"+e.join("\n")+"\n----------"),new Function("compile",e.join("\n"))(Gt.bind(void 0,t))},qt=function(t){var e=new function(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1};e.pre=t.pre,e.body=t.body,e.post=t.post;var r=t.args.slice(0);e.argTypes=r;for(var n=0;n<r.length;++n){var i=r[n];if("array"===i||"object"==typeof i&&i.blockIndices){if(e.argTypes[n]="array",e.arrayArgs.push(n),e.arrayBlockIndices.push(i.blockIndices?i.blockIndices:0),e.shimArgs.push("array"+n),n<e.pre.args.length&&e.pre.args[n].count>0)throw new Error("cwise: pre() block may not reference array args");if(n<e.post.args.length&&e.post.args[n].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===i)e.scalarArgs.push(n),e.shimArgs.push("scalar"+n);else if("index"===i){if(e.indexArgs.push(n),n<e.pre.args.length&&e.pre.args[n].count>0)throw new Error("cwise: pre() block may not reference array index");if(n<e.body.args.length&&e.body.args[n].lvalue)throw new Error("cwise: body() block may not write to array index");if(n<e.post.args.length&&e.post.args[n].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===i){if(e.shapeArgs.push(n),n<e.pre.args.length&&e.pre.args[n].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(n<e.body.args.length&&e.body.args[n].lvalue)throw new Error("cwise: body() block may not write to array shape");if(n<e.post.args.length&&e.post.args[n].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof i||!i.offset)throw new Error("cwise: Unknown argument type "+r[n]);e.argTypes[n]="offset",e.offsetArgs.push({array:i.array,offset:i.offset}),e.offsetArgIndex.push(n)}}if(e.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(e.pre.args.length>r.length)throw new Error("cwise: Too many arguments in pre() block");if(e.body.args.length>r.length)throw new Error("cwise: Too many arguments in body() block");if(e.post.args.length>r.length)throw new Error("cwise: Too many arguments in post() block");return e.debug=!!t.printCode||!!t.debug,e.funcName=t.funcName||"cwise",e.blockSize=t.blockSize||64,Ht(e)},Yt=e(function(t,e){function r(t){if(!t)return i;for(var e=0;e<t.args.length;++e){var r=t.args[e];t.args[e]=0===e?{name:r,lvalue:!0,rvalue:!!t.rvalue,count:t.count||1}:{name:r,lvalue:!1,rvalue:!0,count:1}}return t.thisVars||(t.thisVars=[]),t.localVars||(t.localVars=[]),t}function n(t){for(var e=[],n=0;n<t.args.length;++n)e.push("a"+n);return new Function("P",["return function ",t.funcName,"_ndarrayops(",e.join(","),") {P(",e.join(","),");return a0}"].join(""))(function(t){return qt({args:t.args,pre:r(t.pre),body:r(t.body),post:r(t.proc),funcName:t.funcName})}(t))}var i={body:"",args:[],thisVars:[],localVars:[]},a={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var t in a){var r=a[t];e[t]=n({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:t}),e[t+"eq"]=n({args:["array","array"],body:{args:["a","b"],body:"a"+r+"=b"},rvalue:!0,funcName:t+"eq"}),e[t+"s"]=n({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:t+"s"}),e[t+"seq"]=n({args:["array","scalar"],body:{args:["a","s"],body:"a"+r+"=s"},rvalue:!0,funcName:t+"seq"})}}();var o={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var t in o){var r=o[t];e[t]=n({args:["array","array"],body:{args:["a","b"],body:"a="+r+"b"},funcName:t}),e[t+"eq"]=n({args:["array"],body:{args:["a"],body:"a="+r+"a"},rvalue:!0,count:2,funcName:t+"eq"})}}();var s={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var t in s){var r=s[t];e[t]=n({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:t}),e[t+"s"]=n({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:t+"s"}),e[t+"eq"]=n({args:["array","array"],body:{args:["a","b"],body:"a=a"+r+"b"},rvalue:!0,count:2,funcName:t+"eq"}),e[t+"seq"]=n({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+r+"s"},rvalue:!0,count:2,funcName:t+"seq"})}}();var l=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var t=0;t<l.length;++t){var r=l[t];e[r]=n({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:r}),e[r+"eq"]=n({args:["array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"eq"})}}();var h=["max","min","atan2","pow"];!function(){for(var t=0;t<h.length;++t){var r=h[t];e[r]=n({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r}),e[r+"s"]=n({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r+"s"}),e[r+"eq"]=n({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"eq"}),e[r+"seq"]=n({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"seq"})}}();var u=["atan2","pow"];!function(){for(var t=0;t<u.length;++t){var r=u[t];e[r+"op"]=n({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"op"}),e[r+"ops"]=n({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"ops"}),e[r+"opeq"]=n({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"opeq"}),e[r+"opseq"]=n({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"opseq"})}}(),e.any=qt({args:["array"],pre:i,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),e.all=qt({args:["array"],pre:i,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),e.sum=qt({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),e.prod=qt({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),e.norm2squared=qt({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),e.norm2=qt({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),e.norminf=qt({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),e.norm1=qt({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),e.sup=qt({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),e.inf=qt({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),e.argmin=qt({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),e.argmax=qt({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),e.random=n({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),e.assign=n({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),e.assigns=n({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),e.equals=qt({args:["array","array"],pre:i,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})}),Wt=(Yt.any,Yt.all,Yt.sum,Yt.prod,Yt.norm2squared,Yt.norm2,Yt.norminf,Yt.norm1,Yt.sup,Yt.inf,Yt.argmin,Yt.argmax,Yt.random,Yt.assign,Yt.assigns,Yt.equals,y),zt=new Array(256);!function(t){for(var e=0;e<256;++e){var r=e,n=e,i=7;for(r>>>=1;r;r>>>=1)n<<=1,n|=1&r,--i;t[e]=n<<i&255}}(zt);var Zt={INT_BITS:32,INT_MAX:2147483647,INT_MIN:-1<<31,sign:function(t){return(t>0)-(t<0)},abs:function(t){var e=t>>31;return(t^e)-e},min:function(t,e){return e^(t^e)&-(t<e)},max:function(t,e){return t^(t^e)&-(t<e)},isPow2:function(t){return!(t&t-1||!t)},log2:function(t){var e,r;return e=(t>65535)<<4,t>>>=e,r=(t>255)<<3,t>>>=r,e|=r,r=(t>15)<<2,t>>>=r,e|=r,r=(t>3)<<1,t>>>=r,(e|=r)|t>>1},log10:function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},popCount:function(t){return t-=t>>>1&1431655765,16843009*((t=(858993459&t)+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},countTrailingZeros:Wt,nextPow2:function(t){return t+=0===t,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,1+(t|=t>>>16)},prevPow2:function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},parity:function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1},reverse:function(t){return zt[255&t]<<24|zt[t>>>8&255]<<16|zt[t>>>16&255]<<8|zt[t>>>24&255]},interleave2:function(t,e){return t&=65535,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e&=65535,e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1},deinterleave2:function(t,e){return t=t>>>e&1431655765,t=858993459&(t|t>>>1),t=252645135&(t|t>>>2),t=16711935&(t|t>>>4),(t=65535&(t|t>>>16))<<16>>16},interleave3:function(t,e,r){return t&=1023,t=4278190335&(t|t<<16),t=251719695&(t|t<<8),t=3272356035&(t|t<<4),t=1227133513&(t|t<<2),e&=1023,e=4278190335&(e|e<<16),e=251719695&(e|e<<8),e=3272356035&(e|e<<4),e=1227133513&(e|e<<2),t|=e<<1,r&=1023,r=4278190335&(r|r<<16),r=251719695&(r|r<<8),r=3272356035&(r|r<<4),r=1227133513&(r|r<<2),t|r<<2},deinterleave3:function(t,e){return t=t>>>e&1227133513,t=3272356035&(t|t>>>2),t=251719695&(t|t>>>4),t=4278190335&(t|t>>>8),(t=1023&(t|t>>>16))<<22>>22},nextCombination:function(t){var e=t|t-1;return e+1|(~e&-~e)-1>>>y(t)+1}},Kt=function(t,e){switch(void 0===e&&(e=0),typeof t){case"number":if(t>0)return function(t,e){var r,n;for(r=new Array(t),n=0;n<t;++n)r[n]=e;return r}(0|t,e);break;case"object":if("number"==typeof t.length)return v(t,e,0)}return[]},Jt=e(function(t,e){function r(t){if(t){var e=t.length||t.byteLength,r=Zt.log2(e);A[r].push(t)}}function n(t){var t=Zt.nextPow2(t),e=Zt.log2(t),r=A[e];return r.length>0?r.pop():new ArrayBuffer(t)}function i(t){return new Uint8Array(n(t),0,t)}function a(t){return new Uint16Array(n(2*t),0,t)}function o(t){return new Uint32Array(n(4*t),0,t)}function s(t){return new Int8Array(n(t),0,t)}function l(t){return new Int16Array(n(2*t),0,t)}function h(t){return new Int32Array(n(4*t),0,t)}function u(t){return new Float32Array(n(4*t),0,t)}function f(t){return new Float64Array(n(8*t),0,t)}function c(t){return d?new Uint8ClampedArray(n(t),0,t):i(t)}function _(t){return new DataView(n(t),0,t)}function g(t){t=Zt.nextPow2(t);var e=Zt.log2(t),r=E[e];return r.length>0?r.pop():new Buffer(t)}K.__TYPEDARRAY_POOL||(K.__TYPEDARRAY_POOL={UINT8:Kt([32,0]),UINT16:Kt([32,0]),UINT32:Kt([32,0]),INT8:Kt([32,0]),INT16:Kt([32,0]),INT32:Kt([32,0]),FLOAT:Kt([32,0]),DOUBLE:Kt([32,0]),DATA:Kt([32,0]),UINT8C:Kt([32,0]),BUFFER:Kt([32,0])});var d="undefined"!=typeof Uint8ClampedArray,p=K.__TYPEDARRAY_POOL;p.UINT8C||(p.UINT8C=Kt([32,0])),p.BUFFER||(p.BUFFER=Kt([32,0]));var A=p.DATA,E=p.BUFFER;e.free=function(t){if(Buffer.isBuffer(t))E[Zt.log2(t.length)].push(t);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(t)&&(t=t.buffer),!t)return;var e=t.length||t.byteLength,r=0|Zt.log2(e);A[r].push(t)}},e.freeUint8=e.freeUint16=e.freeUint32=e.freeInt8=e.freeInt16=e.freeInt32=e.freeFloat32=e.freeFloat=e.freeFloat64=e.freeDouble=e.freeUint8Clamped=e.freeDataView=function(t){r(t.buffer)},e.freeArrayBuffer=r,e.freeBuffer=function(t){E[Zt.log2(t.length)].push(t)},e.malloc=function(t,e){if(void 0===e||"arraybuffer"===e)return n(t);switch(e){case"uint8":return i(t);case"uint16":return a(t);case"uint32":return o(t);case"int8":return s(t);case"int16":return l(t);case"int32":return h(t);case"float":case"float32":return u(t);case"double":case"float64":return f(t);case"uint8_clamped":return c(t);case"buffer":return g(t);case"data":case"dataview":return _(t);default:return null}return null},e.mallocArrayBuffer=n,e.mallocUint8=i,e.mallocUint16=a,e.mallocUint32=o,e.mallocInt8=s,e.mallocInt16=l,e.mallocInt32=h,e.mallocFloat32=e.mallocFloat=u,e.mallocFloat64=e.mallocDouble=f,e.mallocUint8Clamped=c,e.mallocDataView=_,e.mallocBuffer=g,e.clearCache=function(){for(var t=0;t<32;++t)p.UINT8[t].length=0,p.UINT16[t].length=0,p.UINT32[t].length=0,p.INT8[t].length=0,p.INT16[t].length=0,p.INT32[t].length=0,p.FLOAT[t].length=0,p.DOUBLE[t].length=0,p.UINT8C[t].length=0,A[t].length=0,E[t].length=0}}),$t=(Jt.free,Jt.freeUint8,Jt.freeUint16,Jt.freeUint32,Jt.freeInt8,Jt.freeInt16,Jt.freeInt32,Jt.freeFloat32,Jt.freeFloat,Jt.freeFloat64,Jt.freeDouble,Jt.freeUint8Clamped,Jt.freeDataView,Jt.freeArrayBuffer,Jt.freeBuffer,Jt.malloc,Jt.mallocArrayBuffer,Jt.mallocUint8,Jt.mallocUint16,Jt.mallocUint32,Jt.mallocInt8,Jt.mallocInt16,Jt.mallocInt32,Jt.mallocFloat32,Jt.mallocFloat,Jt.mallocFloat64,Jt.mallocDouble,Jt.mallocUint8Clamped,Jt.mallocDataView,Jt.mallocBuffer,Jt.clearCache,function(t){if(arguments.length<=1)throw new Error("gl-texture2d: Missing arguments for texture2d constructor");if(te||function(t){te=[t.LINEAR,t.NEAREST_MIPMAP_LINEAR,t.LINEAR_MIPMAP_NEAREST,t.LINEAR_MIPMAP_NEAREST],ee=[t.NEAREST,t.LINEAR,t.NEAREST_MIPMAP_NEAREST,t.NEAREST_MIPMAP_LINEAR,t.LINEAR_MIPMAP_NEAREST,t.LINEAR_MIPMAP_LINEAR],re=[t.REPEAT,t.CLAMP_TO_EDGE,t.MIRRORED_REPEAT]}(t),"number"==typeof arguments[1])return C(t,arguments[1],arguments[2],arguments[3]||t.RGBA,arguments[4]||t.UNSIGNED_BYTE);if(Array.isArray(arguments[1]))return C(t,0|arguments[1][0],0|arguments[1][1],arguments[2]||t.RGBA,arguments[3]||t.UNSIGNED_BYTE);if("object"==typeof arguments[1]){var e=arguments[1],r=I(e)?e:e.raw;if(r)return function(t,e,r,n,i,a){var o=b(t);return t.texImage2D(t.TEXTURE_2D,0,i,i,a,e),new x(t,o,r,n,i,a)}(t,r,0|e.width,0|e.height,arguments[2]||t.RGBA,arguments[3]||t.UNSIGNED_BYTE);if(e.shape&&e.data&&e.stride)return function(t,e){var r=e.dtype,n=e.shape.slice(),i=t.getParameter(t.MAX_TEXTURE_SIZE);if(n[0]<0||n[0]>i||n[1]<0||n[1]>i)throw new Error("gl-texture2d: Invalid texture size");var a=w(n,e.stride.slice()),o=0;"float32"===r?o=t.FLOAT:"float64"===r?(o=t.FLOAT,a=!1,r="float32"):"uint8"===r?o=t.UNSIGNED_BYTE:(o=t.UNSIGNED_BYTE,a=!1,r="uint8");var s=0;if(2===n.length)s=t.LUMINANCE,n=[n[0],n[1],1],e=kt(e.data,n,[e.stride[0],e.stride[1],1],e.offset);else{if(3!==n.length)throw new Error("gl-texture2d: Invalid shape for texture");if(1===n[2])s=t.ALPHA;else if(2===n[2])s=t.LUMINANCE_ALPHA;else if(3===n[2])s=t.RGB;else{if(4!==n[2])throw new Error("gl-texture2d: Invalid shape for pixel coords");s=t.RGBA}}o!==t.FLOAT||t.getExtension("OES_texture_float")||(o=t.UNSIGNED_BYTE,a=!1);var l,h,u=e.size;if(a)l=0===e.offset&&e.data.length===u?e.data:e.data.subarray(e.offset,e.offset+u);else{var f=[n[2],n[2]*n[0],1];h=Jt.malloc(u,r);var c=kt(h,n,f,0);"float32"!==r&&"float64"!==r||o!==t.UNSIGNED_BYTE?Yt.assign(c,e):ne(c,e),l=h.subarray(0,u)}var _=b(t);return t.texImage2D(t.TEXTURE_2D,0,s,n[0],n[1],0,s,o,l),a||Jt.free(h),new x(t,_,n[0],n[1],s,o)}(t,e)}throw new Error("gl-texture2d: Invalid arguments for texture2d constructor")}),te=null,ee=null,re=null,ne=function(t,e){Yt.muls(t,e,255)},ie=x.prototype;Object.defineProperties(ie,{minFilter:{get:function(){return this._minFilter},set:function(t){this.bind();var e=this.gl;if(this.type===e.FLOAT&&te.indexOf(t)>=0&&(e.getExtension("OES_texture_float_linear")||(t=e.NEAREST)),ee.indexOf(t)<0)throw new Error("gl-texture2d: Unknown filter mode "+t);return e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t),this._minFilter=t}},magFilter:{get:function(){return this._magFilter},set:function(t){this.bind();var e=this.gl;if(this.type===e.FLOAT&&te.indexOf(t)>=0&&(e.getExtension("OES_texture_float_linear")||(t=e.NEAREST)),ee.indexOf(t)<0)throw new Error("gl-texture2d: Unknown filter mode "+t);return e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t),this._magFilter=t}},mipSamples:{get:function(){return this._anisoSamples},set:function(t){var e=this._anisoSamples;if(this._anisoSamples=0|Math.max(t,1),e!==this._anisoSamples){var r=this.gl.getExtension("EXT_texture_filter_anisotropic");r&&this.gl.texParameterf(this.gl.TEXTURE_2D,r.TEXTURE_MAX_ANISOTROPY_EXT,this._anisoSamples)}return this._anisoSamples}},wrapS:{get:function(){return this._wrapS},set:function(t){if(this.bind(),re.indexOf(t)<0)throw new Error("gl-texture2d: Unknown wrap mode "+t);return this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,t),this._wrapS=t}},wrapT:{get:function(){return this._wrapT},set:function(t){if(this.bind(),re.indexOf(t)<0)throw new Error("gl-texture2d: Unknown wrap mode "+t);return this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,t),this._wrapT=t}},wrap:{get:function(){return this._wrapVector},set:function(t){if(Array.isArray(t)||(t=[t,t]),2!==t.length)throw new Error("gl-texture2d: Must specify wrap mode for rows and columns");for(var e=0;e<2;++e)if(re.indexOf(t[e])<0)throw new Error("gl-texture2d: Unknown wrap mode "+t);this._wrapS=t[0],this._wrapT=t[1];var r=this.gl;return this.bind(),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,this._wrapS),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,this._wrapT),t}},shape:{get:function(){return this._shapeVector},set:function(t){if(Array.isArray(t)){if(2!==t.length)throw new Error("gl-texture2d: Invalid texture shape")}else t=[0|t,0|t];return T(this,0|t[0],0|t[1]),[0|t[0],0|t[1]]}},width:{get:function(){return this._shape[0]},set:function(t){return t|=0,T(this,t,this._shape[1]),t}},height:{get:function(){return this._shape[1]},set:function(t){return t|=0,T(this,this._shape[0],t),t}}}),ie.bind=function(t){var e=this.gl;return void 0!==t&&e.activeTexture(e.TEXTURE0+(0|t)),e.bindTexture(e.TEXTURE_2D,this.handle),void 0!==t?0|t:e.getParameter(e.ACTIVE_TEXTURE)-e.TEXTURE0},ie.dispose=function(){this.gl.deleteTexture(this.handle)},ie.generateMipmap=function(){this.bind(),this.gl.generateMipmap(this.gl.TEXTURE_2D);for(var t=Math.min(this._shape[0],this._shape[1]),e=0;t>0;++e,t>>>=1)this._mipLevels.indexOf(e)<0&&this._mipLevels.push(e)},ie.setPixels=function(t,e,r,n){var i=this.gl;this.bind(),Array.isArray(e)?(n=r,r=0|e[1],e=0|e[0]):(e=e||0,r=r||0),n=n||0;var a=I(t)?t:t.raw;if(a){this._mipLevels.indexOf(n)<0?(i.texImage2D(i.TEXTURE_2D,0,this.format,this.format,this.type,a),this._mipLevels.push(n)):i.texSubImage2D(i.TEXTURE_2D,n,e,r,this.format,this.type,a)}else{if(!(t.shape&&t.stride&&t.data))throw new Error("gl-texture2d: Unsupported data type");if(t.shape.length<2||e+t.shape[1]>this._shape[1]>>>n||r+t.shape[0]>this._shape[0]>>>n||e<0||r<0)throw new Error("gl-texture2d: Texture dimensions are out of bounds");!function(t,e,r,n,i,a,o,s){var l=s.dtype,h=s.shape.slice();if(h.length<2||h.length>3)throw new Error("gl-texture2d: Invalid ndarray, must be 2d or 3d");var u=0,f=0,c=w(h,s.stride.slice());if("float32"===l?u=t.FLOAT:"float64"===l?(u=t.FLOAT,c=!1,l="float32"):"uint8"===l?u=t.UNSIGNED_BYTE:(u=t.UNSIGNED_BYTE,c=!1,l="uint8"),2===h.length)f=t.LUMINANCE,h=[h[0],h[1],1],s=kt(s.data,h,[s.stride[0],s.stride[1],1],s.offset);else{if(3!==h.length)throw new Error("gl-texture2d: Invalid shape for texture");if(1===h[2])f=t.ALPHA;else if(2===h[2])f=t.LUMINANCE_ALPHA;else if(3===h[2])f=t.RGB;else{if(4!==h[2])throw new Error("gl-texture2d: Invalid shape for pixel coords");f=t.RGBA}h[2]}if(f!==t.LUMINANCE&&f!==t.ALPHA||i!==t.LUMINANCE&&i!==t.ALPHA||(f=i),f!==i)throw new Error("gl-texture2d: Incompatible texture format for setPixels");var _=s.size,g=o.indexOf(n)<0;if(g&&o.push(n),u===a&&c)0===s.offset&&s.data.length===_?g?t.texImage2D(t.TEXTURE_2D,n,i,h[0],h[1],0,i,a,s.data):t.texSubImage2D(t.TEXTURE_2D,n,e,r,h[0],h[1],i,a,s.data):g?t.texImage2D(t.TEXTURE_2D,n,i,h[0],h[1],0,i,a,s.data.subarray(s.offset,s.offset+_)):t.texSubImage2D(t.TEXTURE_2D,n,e,r,h[0],h[1],i,a,s.data.subarray(s.offset,s.offset+_));else{var d;d=a===t.FLOAT?Jt.mallocFloat32(_):Jt.mallocUint8(_);var p=kt(d,h,[h[2],h[2]*h[0],1]);u===t.FLOAT&&a===t.UNSIGNED_BYTE?ne(p,s):Yt.assign(p,s),g?t.texImage2D(t.TEXTURE_2D,n,i,h[0],h[1],0,i,a,d.subarray(0,_)):t.texSubImage2D(t.TEXTURE_2D,n,e,r,h[0],h[1],i,a,d.subarray(0,_)),a===t.FLOAT?Jt.freeFloat32(d):Jt.freeUint8(d)}}(i,e,r,n,this.format,this.type,this._mipLevels,t)}};var ae=function(t,e){for(var r={},n=0;n<t.length;++n)for(var i=t[n].name.split("."),a=r,o=0;o<i.length;++o){var s=i[o].split("[");if(s.length>1){s[0]in a||(a[s[0]]=[]),a=a[s[0]];for(var l=1;l<s.length;++l){var h=parseInt(s[l]);l<s.length-1||o<i.length-1?(h in a||(l<s.length-1?a[h]=[]:a[h]={}),a=a[h]):a[h]=e?n:t[n].type}}else o<i.length-1?(s[0]in a||(a[s[0]]={}),a=a[s[0]]):a[s[0]]=e?n:t[n].type}return r};(R.prototype=new Error).name="GLError",R.prototype.constructor=R;var oe=R,se=function(t,e,r,n){function i(t,e,r){switch(r){case"bool":case"int":case"sampler2D":case"samplerCube":return"gl.uniform1i(locations["+e+"],obj"+t+")";case"float":return"gl.uniform1f(locations["+e+"],obj"+t+")";default:var n=r.indexOf("vec");if(!(0<=n&&n<=1&&r.length===4+n)){if(0===r.indexOf("mat")&&4===r.length){if((i=r.charCodeAt(r.length-1)-48)<2||i>4)throw new oe("","Invalid uniform dimension type for matrix "+name+": "+r);return"gl.uniformMatrix"+i+"fv(locations["+e+"],false,obj"+t+")"}throw new oe("","Unknown uniform data type for "+name+": "+r)}var i;if((i=r.charCodeAt(r.length-1)-48)<2||i>4)throw new oe("","Invalid data type");switch(r.charAt(0)){case"b":case"i":return"gl.uniform"+i+"iv(locations["+e+"],obj"+t+")";case"v":return"gl.uniform"+i+"fv(locations["+e+"],obj"+t+")";default:throw new oe("","Unrecognized data type for vector "+name+": "+r)}}}function a(t,e){if("object"!=typeof e)return[[t,e]];var r=[];for(var n in e){var i=e[n],o=t;parseInt(n)+""===n?o+="["+n+"]":o+="."+n,"object"==typeof i?r.push.apply(r,a(o,i)):r.push([o,i])}return r}function o(e){for(var o=["return function updateProperty(obj){"],s=a("",e),l=0;l<s.length;++l){var h=s[l],u=h[0],f=h[1];n[f]&&o.push(i(u,f,r[f].type))}return o.push("return obj}"),new Function("gl","locations",o.join("\n"))(t,n)}function s(t){switch(t){case"bool":return!1;case"int":case"sampler2D":case"samplerCube":case"float":return 0;default:var e=t.indexOf("vec");if(0<=e&&e<=1&&t.length===4+e){if((r=t.charCodeAt(t.length-1)-48)<2||r>4)throw new oe("","Invalid data type");return"b"===t.charAt(0)?S(r,!1):S(r,0)}if(0===t.indexOf("mat")&&4===t.length){var r=t.charCodeAt(t.length-1)-48;if(r<2||r>4)throw new oe("","Invalid uniform dimension type for matrix "+name+": "+t);return S(r*r,0)}throw new oe("","Unknown uniform data type for "+name+": "+t)}}function l(i,a,l){if("object"==typeof l){var u=h(l);Object.defineProperty(i,a,{get:B(u),set:o(l),enumerable:!0,configurable:!1})}else n[l]?Object.defineProperty(i,a,{get:function(r){return new Function("gl","wrapper","locations","return function(){return gl.getUniform(wrapper.program,locations["+r+"])}")(t,e,n)}(l),set:o(l),enumerable:!0,configurable:!1}):i[a]=s(r[l].type)}function h(t){var e;if(Array.isArray(t)){e=new Array(t.length);for(var r=0;r<t.length;++r)l(e,r,t[r])}else{e={};for(var n in t)l(e,n,t[n])}return e}var u=ae(r,!0);return{get:B(h(u)),set:o(u),enumerable:!0,configurable:!0}},le=function(t,e,r,n){for(var i={},a=0,o=r.length;a<o;++a){var s=r[a],l=s.name,h=s.type,u=s.locations;switch(h){case"bool":case"int":case"float":D(t,e,u[0],n,1,i,l);break;default:if(h.indexOf("vec")>=0){if((f=h.charCodeAt(h.length-1)-48)<2||f>4)throw new oe("","Invalid data type for attribute "+l+": "+h);D(t,e,u[0],n,f,i,l)}else{if(!(h.indexOf("mat")>=0))throw new oe("","Unknown data type for attribute "+l+": "+h);var f=h.charCodeAt(h.length-1)-48;if(f<2||f>4)throw new oe("","Invalid data type for attribute "+l+": "+h);N(t,e,u,n,f,i,l)}}}return i},he=M.prototype;he.pointer=function(t,e,r,n){var i=this._gl,a=this._locations[this._index];i.vertexAttribPointer(a,this._dimension,t||i.FLOAT,!!e,r||0,n||0),i.enableVertexAttribArray(a)},he.set=function(t,e,r,n){return this._constFunc(this._locations[this._index],t,e,r,n)},Object.defineProperty(he,"location",{get:function(){return this._locations[this._index]},set:function(t){return t!==this._locations[this._index]&&(this._locations[this._index]=0|t,this._wrapper.program=null),0|t}});var ue,fe=e(function(t,e){!function(t){function r(){var t=arguments[0],e=r.cache;return e[t]&&e.hasOwnProperty(t)||(e[t]=r.parse(t)),r.format.call(null,e[t],arguments)}function n(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}var i={not_string:/[^s]/,number:/[diefg]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijosuxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[\+\-]/};r.format=function(t,e){var a,o,s,l,h,u,f,c=1,_=t.length,g="",d=[],p=!0,A="";for(o=0;o<_;o++)if("string"===(g=n(t[o])))d[d.length]=t[o];else if("array"===g){if((l=t[o])[2])for(a=e[c],s=0;s<l[2].length;s++){if(!a.hasOwnProperty(l[2][s]))throw new Error(r("[sprintf] property '%s' does not exist",l[2][s]));a=a[l[2][s]]}else a=l[1]?e[l[1]]:e[c++];if("function"==n(a)&&(a=a()),i.not_string.test(l[8])&&i.not_json.test(l[8])&&"number"!=n(a)&&isNaN(a))throw new TypeError(r("[sprintf] expecting number but found %s",n(a)));switch(i.number.test(l[8])&&(p=a>=0),l[8]){case"b":a=a.toString(2);break;case"c":a=String.fromCharCode(a);break;case"d":case"i":a=parseInt(a,10);break;case"j":a=JSON.stringify(a,null,l[6]?parseInt(l[6]):0);break;case"e":a=l[7]?a.toExponential(l[7]):a.toExponential();break;case"f":a=l[7]?parseFloat(a).toFixed(l[7]):parseFloat(a);break;case"g":a=l[7]?parseFloat(a).toPrecision(l[7]):parseFloat(a);break;case"o":a=a.toString(8);break;case"s":a=(a=String(a))&&l[7]?a.substring(0,l[7]):a;break;case"u":a>>>=0;break;case"x":a=a.toString(16);break;case"X":a=a.toString(16).toUpperCase()}i.json.test(l[8])?d[d.length]=a:(!i.number.test(l[8])||p&&!l[3]?A="":(A=p?"+":"-",a=a.toString().replace(i.sign,"")),u=l[4]?"0"===l[4]?"0":l[4].charAt(1):" ",f=l[6]-(A+a).length,h=l[6]&&f>0?function(t,e){return Array(e+1).join(t)}(u,f):"",d[d.length]=l[5]?A+a+h:"0"===u?A+h+a:h+A+a)}return d.join("")},r.cache={},r.parse=function(t){for(var e=t,r=[],n=[],a=0;e;){if(null!==(r=i.text.exec(e)))n[n.length]=r[0];else if(null!==(r=i.modulo.exec(e)))n[n.length]="%";else{if(null===(r=i.placeholder.exec(e)))throw new SyntaxError("[sprintf] unexpected placeholder");if(r[2]){a|=1;var o=[],s=r[2],l=[];if(null===(l=i.key.exec(s)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(o[o.length]=l[1];""!==(s=s.substring(l[0].length));)if(null!==(l=i.key_access.exec(s)))o[o.length]=l[1];else{if(null===(l=i.index_access.exec(s)))throw new SyntaxError("[sprintf] failed to parse named argument key");o[o.length]=l[1]}r[2]=o}else a|=2;if(3===a)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");n[n.length]=r}e=e.substring(r[0].length)}return n};var a=function(t,e,n){return(n=(e||[]).slice(0)).splice(0,0,t),r.apply(null,n)};e.sprintf=r,e.vsprintf=a}("undefined"==typeof window||window)}),ce=(fe.sprintf,fe.vsprintf,{0:"NONE",1:"ONE",2:"LINE_LOOP",3:"LINE_STRIP",4:"TRIANGLES",5:"TRIANGLE_STRIP",6:"TRIANGLE_FAN",256:"DEPTH_BUFFER_BIT",512:"NEVER",513:"LESS",514:"EQUAL",515:"LEQUAL",516:"GREATER",517:"NOTEQUAL",518:"GEQUAL",519:"ALWAYS",768:"SRC_COLOR",769:"ONE_MINUS_SRC_COLOR",770:"SRC_ALPHA",771:"ONE_MINUS_SRC_ALPHA",772:"DST_ALPHA",773:"ONE_MINUS_DST_ALPHA",774:"DST_COLOR",775:"ONE_MINUS_DST_COLOR",776:"SRC_ALPHA_SATURATE",1024:"STENCIL_BUFFER_BIT",1028:"FRONT",1029:"BACK",1032:"FRONT_AND_BACK",1280:"INVALID_ENUM",1281:"INVALID_VALUE",1282:"INVALID_OPERATION",1285:"OUT_OF_MEMORY",1286:"INVALID_FRAMEBUFFER_OPERATION",2304:"CW",2305:"CCW",2849:"LINE_WIDTH",2884:"CULL_FACE",2885:"CULL_FACE_MODE",2886:"FRONT_FACE",2928:"DEPTH_RANGE",2929:"DEPTH_TEST",2930:"DEPTH_WRITEMASK",2931:"DEPTH_CLEAR_VALUE",2932:"DEPTH_FUNC",2960:"STENCIL_TEST",2961:"STENCIL_CLEAR_VALUE",2962:"STENCIL_FUNC",2963:"STENCIL_VALUE_MASK",2964:"STENCIL_FAIL",2965:"STENCIL_PASS_DEPTH_FAIL",2966:"STENCIL_PASS_DEPTH_PASS",2967:"STENCIL_REF",2968:"STENCIL_WRITEMASK",2978:"VIEWPORT",3024:"DITHER",3042:"BLEND",3088:"SCISSOR_BOX",3089:"SCISSOR_TEST",3106:"COLOR_CLEAR_VALUE",3107:"COLOR_WRITEMASK",3317:"UNPACK_ALIGNMENT",3333:"PACK_ALIGNMENT",3379:"MAX_TEXTURE_SIZE",3386:"MAX_VIEWPORT_DIMS",3408:"SUBPIXEL_BITS",3410:"RED_BITS",3411:"GREEN_BITS",3412:"BLUE_BITS",3413:"ALPHA_BITS",3414:"DEPTH_BITS",3415:"STENCIL_BITS",3553:"TEXTURE_2D",4352:"DONT_CARE",4353:"FASTEST",4354:"NICEST",5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5124:"INT",5125:"UNSIGNED_INT",5126:"FLOAT",5386:"INVERT",5890:"TEXTURE",6401:"STENCIL_INDEX",6402:"DEPTH_COMPONENT",6406:"ALPHA",6407:"RGB",6408:"RGBA",6409:"LUMINANCE",6410:"LUMINANCE_ALPHA",7680:"KEEP",7681:"REPLACE",7682:"INCR",7683:"DECR",7936:"VENDOR",7937:"RENDERER",7938:"VERSION",9728:"NEAREST",9729:"LINEAR",9984:"NEAREST_MIPMAP_NEAREST",9985:"LINEAR_MIPMAP_NEAREST",9986:"NEAREST_MIPMAP_LINEAR",9987:"LINEAR_MIPMAP_LINEAR",10240:"TEXTURE_MAG_FILTER",10241:"TEXTURE_MIN_FILTER",10242:"TEXTURE_WRAP_S",10243:"TEXTURE_WRAP_T",10497:"REPEAT",10752:"POLYGON_OFFSET_UNITS",16384:"COLOR_BUFFER_BIT",32769:"CONSTANT_COLOR",32770:"ONE_MINUS_CONSTANT_COLOR",32771:"CONSTANT_ALPHA",32772:"ONE_MINUS_CONSTANT_ALPHA",32773:"BLEND_COLOR",32774:"FUNC_ADD",32777:"BLEND_EQUATION_RGB",32778:"FUNC_SUBTRACT",32779:"FUNC_REVERSE_SUBTRACT",32819:"UNSIGNED_SHORT_4_4_4_4",32820:"UNSIGNED_SHORT_5_5_5_1",32823:"POLYGON_OFFSET_FILL",32824:"POLYGON_OFFSET_FACTOR",32854:"RGBA4",32855:"RGB5_A1",32873:"TEXTURE_BINDING_2D",32926:"SAMPLE_ALPHA_TO_COVERAGE",32928:"SAMPLE_COVERAGE",32936:"SAMPLE_BUFFERS",32937:"SAMPLES",32938:"SAMPLE_COVERAGE_VALUE",32939:"SAMPLE_COVERAGE_INVERT",32968:"BLEND_DST_RGB",32969:"BLEND_SRC_RGB",32970:"BLEND_DST_ALPHA",32971:"BLEND_SRC_ALPHA",33071:"CLAMP_TO_EDGE",33170:"GENERATE_MIPMAP_HINT",33189:"DEPTH_COMPONENT16",33306:"DEPTH_STENCIL_ATTACHMENT",33635:"UNSIGNED_SHORT_5_6_5",33648:"MIRRORED_REPEAT",33901:"ALIASED_POINT_SIZE_RANGE",33902:"ALIASED_LINE_WIDTH_RANGE",33984:"TEXTURE0",33985:"TEXTURE1",33986:"TEXTURE2",33987:"TEXTURE3",33988:"TEXTURE4",33989:"TEXTURE5",33990:"TEXTURE6",33991:"TEXTURE7",33992:"TEXTURE8",33993:"TEXTURE9",33994:"TEXTURE10",33995:"TEXTURE11",33996:"TEXTURE12",33997:"TEXTURE13",33998:"TEXTURE14",33999:"TEXTURE15",34e3:"TEXTURE16",34001:"TEXTURE17",34002:"TEXTURE18",34003:"TEXTURE19",34004:"TEXTURE20",34005:"TEXTURE21",34006:"TEXTURE22",34007:"TEXTURE23",34008:"TEXTURE24",34009:"TEXTURE25",34010:"TEXTURE26",34011:"TEXTURE27",34012:"TEXTURE28",34013:"TEXTURE29",34014:"TEXTURE30",34015:"TEXTURE31",34016:"ACTIVE_TEXTURE",34024:"MAX_RENDERBUFFER_SIZE",34041:"DEPTH_STENCIL",34055:"INCR_WRAP",34056:"DECR_WRAP",34067:"TEXTURE_CUBE_MAP",34068:"TEXTURE_BINDING_CUBE_MAP",34069:"TEXTURE_CUBE_MAP_POSITIVE_X",34070:"TEXTURE_CUBE_MAP_NEGATIVE_X",34071:"TEXTURE_CUBE_MAP_POSITIVE_Y",34072:"TEXTURE_CUBE_MAP_NEGATIVE_Y",34073:"TEXTURE_CUBE_MAP_POSITIVE_Z",34074:"TEXTURE_CUBE_MAP_NEGATIVE_Z",34076:"MAX_CUBE_MAP_TEXTURE_SIZE",34338:"VERTEX_ATTRIB_ARRAY_ENABLED",34339:"VERTEX_ATTRIB_ARRAY_SIZE",34340:"VERTEX_ATTRIB_ARRAY_STRIDE",34341:"VERTEX_ATTRIB_ARRAY_TYPE",34342:"CURRENT_VERTEX_ATTRIB",34373:"VERTEX_ATTRIB_ARRAY_POINTER",34466:"NUM_COMPRESSED_TEXTURE_FORMATS",34467:"COMPRESSED_TEXTURE_FORMATS",34660:"BUFFER_SIZE",34661:"BUFFER_USAGE",34816:"STENCIL_BACK_FUNC",34817:"STENCIL_BACK_FAIL",34818:"STENCIL_BACK_PASS_DEPTH_FAIL",34819:"STENCIL_BACK_PASS_DEPTH_PASS",34877:"BLEND_EQUATION_ALPHA",34921:"MAX_VERTEX_ATTRIBS",34922:"VERTEX_ATTRIB_ARRAY_NORMALIZED",34930:"MAX_TEXTURE_IMAGE_UNITS",34962:"ARRAY_BUFFER",34963:"ELEMENT_ARRAY_BUFFER",34964:"ARRAY_BUFFER_BINDING",34965:"ELEMENT_ARRAY_BUFFER_BINDING",34975:"VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",35040:"STREAM_DRAW",35044:"STATIC_DRAW",35048:"DYNAMIC_DRAW",35632:"FRAGMENT_SHADER",35633:"VERTEX_SHADER",35660:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",35661:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",35663:"SHADER_TYPE",35664:"FLOAT_VEC2",35665:"FLOAT_VEC3",35666:"FLOAT_VEC4",35667:"INT_VEC2",35668:"INT_VEC3",35669:"INT_VEC4",35670:"BOOL",35671:"BOOL_VEC2",35672:"BOOL_VEC3",35673:"BOOL_VEC4",35674:"FLOAT_MAT2",35675:"FLOAT_MAT3",35676:"FLOAT_MAT4",35678:"SAMPLER_2D",35680:"SAMPLER_CUBE",35712:"DELETE_STATUS",35713:"COMPILE_STATUS",35714:"LINK_STATUS",35715:"VALIDATE_STATUS",35716:"INFO_LOG_LENGTH",35717:"ATTACHED_SHADERS",35718:"ACTIVE_UNIFORMS",35719:"ACTIVE_UNIFORM_MAX_LENGTH",35720:"SHADER_SOURCE_LENGTH",35721:"ACTIVE_ATTRIBUTES",35722:"ACTIVE_ATTRIBUTE_MAX_LENGTH",35724:"SHADING_LANGUAGE_VERSION",35725:"CURRENT_PROGRAM",36003:"STENCIL_BACK_REF",36004:"STENCIL_BACK_VALUE_MASK",36005:"STENCIL_BACK_WRITEMASK",36006:"FRAMEBUFFER_BINDING",36007:"RENDERBUFFER_BINDING",36048:"FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",36049:"FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",36050:"FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",36051:"FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",36053:"FRAMEBUFFER_COMPLETE",36054:"FRAMEBUFFER_INCOMPLETE_ATTACHMENT",36055:"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",36057:"FRAMEBUFFER_INCOMPLETE_DIMENSIONS",36061:"FRAMEBUFFER_UNSUPPORTED",36064:"COLOR_ATTACHMENT0",36096:"DEPTH_ATTACHMENT",36128:"STENCIL_ATTACHMENT",36160:"FRAMEBUFFER",36161:"RENDERBUFFER",36162:"RENDERBUFFER_WIDTH",36163:"RENDERBUFFER_HEIGHT",36164:"RENDERBUFFER_INTERNAL_FORMAT",36168:"STENCIL_INDEX8",36176:"RENDERBUFFER_RED_SIZE",36177:"RENDERBUFFER_GREEN_SIZE",36178:"RENDERBUFFER_BLUE_SIZE",36179:"RENDERBUFFER_ALPHA_SIZE",36180:"RENDERBUFFER_DEPTH_SIZE",36181:"RENDERBUFFER_STENCIL_SIZE",36194:"RGB565",36336:"LOW_FLOAT",36337:"MEDIUM_FLOAT",36338:"HIGH_FLOAT",36339:"LOW_INT",36340:"MEDIUM_INT",36341:"HIGH_INT",36346:"SHADER_COMPILER",36347:"MAX_VERTEX_UNIFORM_VECTORS",36348:"MAX_VARYING_VECTORS",36349:"MAX_FRAGMENT_UNIFORM_VECTORS",37440:"UNPACK_FLIP_Y_WEBGL",37441:"UNPACK_PREMULTIPLY_ALPHA_WEBGL",37442:"CONTEXT_LOST_WEBGL",37443:"UNPACK_COLORSPACE_CONVERSION_WEBGL",37444:"BROWSER_DEFAULT_WEBGL"}),_e=function(t){return ce[t]},ge=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"],de=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"],pe=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"],Ae=ge.slice().concat(["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray"]),Ee=pe,me=(Ee=Ee.slice().filter(function(t){return!/^(gl\_|texture)/.test(t)})).concat(["gl_VertexID","gl_InstanceID","gl_Position","gl_PointSize","gl_FragCoord","gl_FrontFacing","gl_FragDepth","gl_PointCoord","gl_MaxVertexAttribs","gl_MaxVertexUniformVectors","gl_MaxVertexOutputVectors","gl_MaxFragmentInputVectors","gl_MaxVertexTextureImageUnits","gl_MaxCombinedTextureImageUnits","gl_MaxTextureImageUnits","gl_MaxFragmentUniformVectors","gl_MaxDrawBuffers","gl_MinProgramTexelOffset","gl_MaxProgramTexelOffset","gl_DepthRangeParameters","gl_DepthRange","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"]),ye=function(t){function e(t){t.length&&c.push({type:Fe[u],data:t,position:d,line:_,column:g})}function r(t){l=0,s=(E+=t).length;for(var r;a=E[l],l<s;){switch(r=l,u){case Te:l="/"===a&&"*"===o?(f.push(a),e(f.join("")),u=ve,l+1):(f.push(a),o=a,l+1);break;case xe:case we:l=n();break;case be:l=function(){if("."===o&&/\d/.test(a))return u=Re,l;if("/"===o&&"*"===a)return u=Te,l;if("/"===o&&"/"===a)return u=xe,l;if("."===a&&f.length){for(;i(f););return u=Re,l}if(";"===a||")"===a||"("===a){if(f.length)for(;i(f););return e(a),u=ve,l+1}var t=2===f.length&&"="!==a;if(/[\w_\d\s]/.test(a)||t){for(;i(f););return u=ve,l}return f.push(a),o=a,l+1}();break;case Ce:l="."===a?(f.push(a),u=Re,o=a,l+1):/[eE]/.test(a)?(f.push(a),u=Re,o=a,l+1):"x"===a&&1===f.length&&"0"===f[0]?(u=Ue,f.push(a),o=a,l+1):/[^\d]/.test(a)?(e(f.join("")),u=ve,l):(f.push(a),o=a,l+1);break;case Ue:l=/[^a-fA-F0-9]/.test(a)?(e(f.join("")),u=ve,l):(f.push(a),o=a,l+1);break;case Re:"f"===a&&(f.push(a),o=a,l+=1),l=/[eE]/.test(a)?(f.push(a),o=a,l+1):"-"===a&&/[eE]/.test(o)?(f.push(a),o=a,l+1):/[^\d]/.test(a)?(e(f.join("")),u=ve,l):(f.push(a),o=a,l+1);break;case Ie:l=function(){if(/[^\d\w_]/.test(a)){var t=f.join("");return u=y.indexOf(t)>-1?Me:m.indexOf(t)>-1?Se:Be,e(f.join("")),u=ve,l}return f.push(a),o=a,l+1}();break;case De:l=/[^\s]/g.test(a)?(e(f.join("")),u=ve,l):(f.push(a),o=a,l+1);break;case ve:f=f.length?[]:f,l="/"===o&&"*"===a?(d=h+l-1,u=Te,o=a,l+1):"/"===o&&"/"===a?(d=h+l-1,u=xe,o=a,l+1):"#"===a?(u=we,d=h+l,l):/\s/.test(a)?(u=De,d=h+l,l):(p=/\d/.test(a),A=/[^\w_]/.test(a),d=h+l,u=p?Ce:A?be:Ie,l)}if(r!==l)switch(E[r]){case"\n":g=0,++_;break;default:++g}}return h+=l,E=E.slice(l),c}function n(){return"\r"!==a&&"\n"!==a||"\\"===o?(f.push(a),o=a,l+1):(e(f.join("")),u=ve,l)}function i(t){for(var r,n,i=0;;){if(r=de.indexOf(t.slice(0,t.length+i).join("")),n=de[r],-1===r){if(i--+t.length>0)continue;n=t.slice(0,1).join("")}return e(n),d+=n.length,(f=f.slice(n.length)).length}}var a,o,s,l=0,h=0,u=ve,f=[],c=[],_=1,g=0,d=0,p=!1,A=!1,E="",m=pe,y=ge;return"300 es"===(t=t||{}).version&&(m=me,y=Ae),function(t){return c=[],null!==t?r(t.replace?t.replace(/\r\n/g,"\n"):t):(f.length&&e(f.join("")),u=Ne,e("(eof)"),c)}},ve=999,Ie=9999,Te=0,xe=1,we=2,be=3,Ce=4,Re=5,Be=6,Se=7,Me=8,De=9,Ne=10,Ue=11,Fe=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"],Le=function(t,e){var r=ye(e),n=[];return n=n.concat(r(t)),n=n.concat(r(null))},Oe=function(t){return new Buffer(t,"base64").toString("utf8")},Pe=function(t){for(var e=Array.isArray(t)?t:Le(t),r=0;r<e.length;r++){var n=e[r];if("preprocessor"===n.type){var i=n.data.match(/\#define\s+SHADER_NAME(_B64)?\s+(.+)$/);if(i&&i[2]){var a=i[1],o=i[2];return(a?Oe(o):o).trim()}}}},je="",Ve=function(t,e){if("string"!=typeof t)throw new TypeError("repeat-string expects a string.");if(1===e)return t;if(2===e)return t+t;var r=t.length*e;for(ue===t&&void 0!==ue||(ue=t,je="");r>je.length&&e>0&&(1&e&&(je+=t),e>>=1);)t+=t;return je.substr(0,r)},Qe=function(t,e,r){return r=void 0!==r?r+"":" ",Ve(r,e)+t},ke=function(t,e,r){e="number"==typeof e?e:1,r=r||": ";var n=t.split(/\r?\n/),i=String(n.length+e-1).length;return n.map(function(t,n){var a=n+e,o=String(a).length;return Qe(a,i-o)+r+t}).join("\n")},Xe=fe.sprintf,Ge=function(t,e,r){var n=Pe(e)||"of unknown name (see npm glsl-shader-name)",i="unknown type";void 0!==r&&(i=r===_e.FRAGMENT_SHADER?"fragment":"vertex");for(var a=Xe("Error compiling %s shader %s:\n",i,n),o=Xe("%s%s",a,t),s=t.split("\n"),l={},h=0;h<s.length;h++){var u=s[h];if(""!==u){var f=parseInt(u.split(":")[2]);if(isNaN(f))throw new Error(Xe("Could not parse error: %s",u));l[f]=u}}for(var c=ke(e).split("\n"),h=0;h<c.length;h++)if((l[h+3]||l[h+2]||l[h+1])&&(a+=c[h]+"\n",l[h+1])){var _=l[h+1];_=_.substr(_.split(":",3).join(":").length+1).trim(),a+=Xe("^^^ %s\n\n",_)}return{long:a.trim(),short:o.trim()}},He=function(t,e){var r={identity:e},n=t.valueOf;return Object.defineProperty(t,"valueOf",{value:function(t){return t!==e?n.apply(this,arguments):r},writable:!0}),r},qe=function(){var t={};return function(e){if(("object"!=typeof e||null===e)&&"function"!=typeof e)throw new Error("Weakmap-shim: Key must be object");var r=e.valueOf(t);return r&&r.identity===t?r:He(e,t)}},Ye=function(){var t=qe();return{get:function(e,r){var n=t(e);return n.hasOwnProperty("value")?n.value:r},set:function(e,r){t(e).value=r},has:function(e){return"value"in t(e)},delete:function(e){return delete t(e).value}}},We=function(t,e,r){return L(t).getShaderReference(e,r)},ze=function(t,e,r,n,i){return L(t).getProgram(e,r,n,i)},Ze=new("undefined"==typeof WeakMap?Ye:WeakMap),Ke=0;U.prototype.dispose=function(){if(0==--this.count){for(var t=this.cache,e=t.gl,r=this.programs,n=0,i=r.length;n<i;++n){var a=t.programs[r[n]];a&&(delete t.programs[n],e.deleteProgram(a))}e.deleteShader(this.shader),delete t.shaders[this.type===e.FRAGMENT_SHADER|0][this.src]}};var Je=F.prototype;Je.getShaderReference=function(t,e){var r=this.gl,n=this.shaders[t===r.FRAGMENT_SHADER|0],i=n[e];if(i&&r.isShader(i.shader))i.count+=1;else{var a=function(t,e,r){var n=t.createShader(e);if(t.shaderSource(n,r),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS)){var i=t.getShaderInfoLog(n);try{var a=Ge(i,r,e)}catch(t){throw console.warn("Failed to format compiler error: "+t),new oe(i,"Error compiling shader:\n"+i)}throw new oe(i,a.short,a.long)}return n}(r,t,e);i=n[e]=new U(Ke++,e,t,a,[],1,this)}return i},Je.getProgram=function(t,e,r,n){var i=[t.id,e.id,r.join(":"),n.join(":")].join("@"),a=this.programs[i];return a&&this.gl.isProgram(a)||(this.programs[i]=a=function(t,e,r,n,i){var a=t.createProgram();t.attachShader(a,e),t.attachShader(a,r);for(var o=0;o<n.length;++o)t.bindAttribLocation(a,i[o],n[o]);if(t.linkProgram(a),!t.getProgramParameter(a,t.LINK_STATUS)){var s=t.getProgramInfoLog(a);throw new oe(s,"Error linking program: "+s)}return a}(this.gl,t.shader,e.shader,r,n),t.programs.push(i),e.programs.push(i)),a};var $e={shader:We,program:ze},tr={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube"},er=null,rr={uniforms:function(t,e){for(var r=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),n=[],i=0;i<r;++i){var a=t.getActiveUniform(e,i);if(a){var o=O(t,a.type);if(a.size>1)for(var s=0;s<a.size;++s)n.push({name:a.name.replace("[0]","["+s+"]"),type:o});else n.push({name:a.name,type:o})}}return n},attributes:function(t,e){for(var r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),n=[],i=0;i<r;++i){var a=t.getActiveAttrib(e,i);a&&n.push({name:a.name,type:O(t,a.type)})}return n}},nr=P.prototype;nr.bind=function(){this.program||this._relink(),this.gl.useProgram(this.program)},nr.dispose=function(){this._fref&&this._fref.dispose(),this._vref&&this._vref.dispose(),this.attributes=this.types=this.vertShader=this.fragShader=this.program=this._relink=this._fref=this._vref=null},nr.update=function(t,e,r,n){function i(){o.program=$e.program(s,o._vref,o._fref,_,g);for(var t=0;t<r.length;++t)v[t]=s.getUniformLocation(o.program,r[t].name)}if(!e||1===arguments.length){var a=t;t=a.vertex,e=a.fragment,r=a.uniforms,n=a.attributes}var o=this,s=o.gl,l=o._vref;o._vref=$e.shader(s,s.VERTEX_SHADER,t),l&&l.dispose(),o.vertShader=o._vref.shader;var h=this._fref;if(o._fref=$e.shader(s,s.FRAGMENT_SHADER,e),h&&h.dispose(),o.fragShader=o._fref.shader,!r||!n){var u=s.createProgram();if(s.attachShader(u,o.fragShader),s.attachShader(u,o.vertShader),s.linkProgram(u),!s.getProgramParameter(u,s.LINK_STATUS)){var f=s.getProgramInfoLog(u);throw new oe(f,"Error linking program:"+f)}r=r||rr.uniforms(s,u),n=n||rr.attributes(s,u),s.deleteProgram(u)}(n=n.slice()).sort(j);for(var c=[],_=[],g=[],d=0;d<n.length;++d){var p=n[d];if(p.type.indexOf("mat")>=0){for(var A=0|p.type.charAt(p.type.length-1),E=new Array(A),m=0;m<A;++m)E[m]=g.length,_.push(p.name+"["+m+"]"),"number"==typeof p.location?g.push(p.location+m):Array.isArray(p.location)&&p.location.length===A&&"number"==typeof p.location[m]?g.push(0|p.location[m]):g.push(-1);c.push({name:p.name,type:p.type,locations:E})}else c.push({name:p.name,type:p.type,locations:[g.length]}),_.push(p.name),"number"==typeof p.location?g.push(0|p.location):g.push(-1)}for(var y=0,d=0;d<g.length;++d)if(g[d]<0){for(;g.indexOf(y)>=0;)y+=1;g[d]=y}var v=new Array(r.length);i(),o._relink=i,o.types={uniforms:ae(r),attributes:ae(n)},o.attributes=le(s,o,c,g),Object.defineProperty(o,"uniforms",se(s,o,r,v))};var ir=function(t,e,r,n,i){var a=new P(t);return a.update(e,r,n,i),a},ar="attribute vec2 position; void main() { gl_Position = vec4(2.0*position-1.0, 0.0, 1.0);}",or=V;V.prototype={dispose:function(){this.shader.dispose(),this.gl.deleteBuffer(this.buffer),this.shader=null,this.buffer=null},render:function(t,e,r,n){var i=this.gl,a=this.shader,o=0;a.bind(),this._checkViewport(),a.uniforms.progress=t,a.uniforms.from=e.bind(o++),a.uniforms.to=r.bind(o++);for(var s in n){var l=n[s];l&&l.bind?a.uniforms[s]=l.bind(o++):a.uniforms[s]!==l&&(a.uniforms[s]=l)}i.drawArrays(i.TRIANGLES,0,6)},_checkViewport:function(){var t=this.gl.canvas,e=t.width,r=t.height;this._w===e&&this._h===r||(this._syncViewport(e,r),this._w=e,this._h=r)},_syncViewport:function(t,e){var r=this.gl,n=this.shader,i=this.buffer,a=t,o=e;n.uniforms.resolution=new Float32Array([t,e]),r.bindBuffer(r.ARRAY_BUFFER,i),n.attributes.position.pointer(),r.bufferData(r.ARRAY_BUFFER,new Float32Array([0,0,a,0,0,o,0,o,a,0,a,o]),r.STATIC_DRAW),r.viewport(0,0,a,o)}};var sr=function(t){var e=t*t;return t<4/11?7.5625*e:t<8/11?9.075*e-9.9*t+3.4:t<.9?4356/361*e-35442/1805*t+16061/1805:10.8*t*t-20.52*t+10.72},lr={backInOut:function(t){return(t*=2)<1?t*t*(3.5949095*t-2.5949095)*.5:.5*((t-=2)*t*(3.5949095*t+2.5949095)+2)},backIn:function(t){return t*t*(2.70158*t-1.70158)},backOut:function(t){return--t*t*(2.70158*t+1.70158)+1},bounceInOut:function(t){return t<.5?.5*(1-sr(1-2*t)):.5*sr(2*t-1)+.5},bounceIn:function(t){return 1-sr(1-t)},bounceOut:sr,circInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},circIn:function(t){return 1-Math.sqrt(1-t*t)},circOut:function(t){return Math.sqrt(1- --t*t)},cubicInOut:function(t){return t<.5?4*t*t*t:.5*Math.pow(2*t-2,3)+1},cubicIn:function(t){return t*t*t},cubicOut:function(t){var e=t-1;return e*e*e+1},elasticInOut:function(t){return t<.5?.5*Math.sin(13*Math.PI/2*2*t)*Math.pow(2,10*(2*t-1)):.5*Math.sin(-13*Math.PI/2*(2*t-1+1))*Math.pow(2,-10*(2*t-1))+1},elasticIn:function(t){return Math.sin(13*t*Math.PI/2)*Math.pow(2,10*(t-1))},elasticOut:function(t){return Math.sin(-13*(t+1)*Math.PI/2)*Math.pow(2,-10*t)+1},expoInOut:function(t){return 0===t||1===t?t:t<.5?.5*Math.pow(2,20*t-10):-.5*Math.pow(2,10-20*t)+1},expoIn:function(t){return 0===t?t:Math.pow(2,10*(t-1))},expoOut:function(t){return 1===t?t:1-Math.pow(2,-10*t)},linear:function(t){return t},quadInOut:function(t){return(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1)},quadIn:function(t){return t*t},quadOut:function(t){return-t*(t-2)},quartInOut:function(t){return t<.5?8*Math.pow(t,4):-8*Math.pow(t-1,4)+1},quartIn:function(t){return Math.pow(t,4)},quartOut:function(t){return Math.pow(t-1,3)*(1-t)+1},quintInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},quintIn:function(t){return t*t*t*t*t},quintOut:function(t){return--t*t*t*t*t+1},sineInOut:function(t){return-.5*(Math.cos(Math.PI*t)-1)},sineIn:function(t){var e=Math.cos(t*Math.PI*.5);return Math.abs(e)<1e-14?1:1-e},sineOut:function(t){return Math.sin(t*Math.PI/2)}};const hr={none:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      void main() {\n        vec2 p = gl_FragCoord.xy / resolution.xy;\n        gl_FragColor = texture2D(to, p);\n      }\n    ",uniforms:{}},crossfade:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      void main() {\n        vec2 p = gl_FragCoord.xy / resolution.xy;\n        gl_FragColor = mix(texture2D(from, p), texture2D(to, p), progress);\n      }\n    ",uniforms:{}},wipeUp:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      void main() {\n        vec2 p = gl_FragCoord.xy / resolution.xy;\n        vec4 a = texture2D(from, p);\n        vec4 b = texture2D(to, p);\n        gl_FragColor = mix(a, b, step(0.0 + p.y, progress));\n      }\n    ",uniforms:{}},wipeDown:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      void main() {\n        vec2 p = gl_FragCoord.xy / resolution.xy;\n        vec4 a = texture2D(from, p);\n        vec4 b = texture2D(to, p);\n        gl_FragColor = mix(a, b, step(1.0 - p.y, progress));\n      }\n    ",uniforms:{}},wipeRight:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      void main() {\n        vec2 p = gl_FragCoord.xy / resolution.xy;\n        vec4 a = texture2D(from, p);\n        vec4 b = texture2D(to, p);\n        gl_FragColor = mix(a, b, step(0.0 + p.x, progress));\n      }\n    ",uniforms:{}},wipeLeft:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      void main() {\n        vec2 p = gl_FragCoord.xy / resolution.xy;\n        vec4 a = texture2D(from, p);\n        vec4 b = texture2D(to, p);\n        gl_FragColor = mix(a, b, step(1.0 - p.x, progress));\n      }\n    ",uniforms:{}},circle:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      uniform float centerX;\n      uniform float centerY;\n      uniform float smoothness;\n      uniform bool grow;\n\n      vec2 center = vec2(centerX, 1.0 - centerY);\n      float scale = sqrt(min(resolution[0] / resolution[1], resolution[1] / resolution[0]) / max(centerX, 1.0 - centerY));\n\n      void main() {\n        vec2 p = gl_FragCoord.xy / resolution.xy;\n        float size = grow ? progress : 1.0 - progress;\n        float dist = distance(center, p);\n        float circle = smoothstep(-smoothness, 0.0, scale * dist - size * (1.0 + smoothness));\n        gl_FragColor = mix(texture2D(from, p), texture2D(to, p), grow ? 1.0 - circle : circle);\n      }\n    ",uniforms:{centerX:.5,centerY:.5,smoothness:0,grow:!0}},circleInOut:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      float maxRadius = resolution.x + resolution.y;\n\n      void main() {\n        vec2 p = gl_FragCoord.xy / resolution.xy;\n\n        float distX = gl_FragCoord.x - resolution.x / 2.0;\n        float distY = gl_FragCoord.y - resolution.y / 2.0;\n        float dist = sqrt(distX * distX + distY * distY);\n\n        float step = 2.0 * abs(progress - 0.5);\n        step = step * step * step;\n\n        if (dist < step * maxRadius)\n        {\n          if (progress < 0.5)\n            gl_FragColor = texture2D(from, p);\n          else\n            gl_FragColor = texture2D(to, p);\n        }\n        else\n          gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n      }\n    ",uniforms:{}},splitVertical:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n\n      // General parameters\n      uniform sampler2D from;\n      uniform sampler2D to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      uniform float reflection;\n      uniform float perspective;\n      uniform float depth;\n\n      const vec4 black = vec4(0.0, 0.0, 0.0, 1.0);\n      const vec2 boundMin = vec2(0.0, 0.0);\n      const vec2 boundMax = vec2(1.0, 1.0);\n\n      bool inBounds (vec2 p) {\n        return all(lessThan(boundMin, p)) && all(lessThan(p, boundMax));\n      }\n\n      vec2 project (vec2 p) {\n        return p * vec2(1.0, -1.2) + vec2(0.0, -0.02);\n      }\n\n      vec4 bgColor (vec2 p, vec2 pto) {\n        vec4 c = black;\n        pto = project(pto);\n        if (inBounds(pto)) {\n          c += mix(black, texture2D(to, pto), reflection * mix(1.0, 0.0, pto.y));\n        }\n        return c;\n      }\n\n      void main() {\n        vec2 p = gl_FragCoord.xy / resolution.xy;\n\n        vec2 pfr = vec2(-1.), pto = vec2(-1.);\n\n        float middleSlit = 2.0 * abs(p.x-0.5) - progress;\n        if (middleSlit > 0.0) {\n          pfr = p + (p.x > 0.5 ? -1.0 : 1.0) * vec2(0.5*progress, 0.0);\n          float d = 1.0/(1.0+perspective*progress*(1.0-middleSlit));\n          pfr.y -= d/2.;\n          pfr.y *= d;\n          pfr.y += d/2.;\n        }\n\n        float size = mix(1.0, depth, 1.-progress);\n        pto = (p + vec2(-0.5, -0.5)) * vec2(size, size) + vec2(0.5, 0.5);\n\n        if (inBounds(pfr)) {\n          gl_FragColor = texture2D(from, pfr);\n        }\n        else if (inBounds(pto)) {\n          gl_FragColor = texture2D(to, pto);\n        }\n        else {\n          gl_FragColor = bgColor(p, pto);\n        }\n      }\n    ",uniforms:{reflection:0,perspective:0,depth:1}},slideUp:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      uniform float translateX;\n      uniform float translateY;\n\n      void main() {\n          vec2 texCoord = gl_FragCoord.xy / resolution.xy;\n          float x = progress * translateX;\n          float y = progress * translateY;\n\n          if (x >= 0.0 && y >= 0.0) {\n              if (texCoord.x >= x && texCoord.y >= y) {\n                  gl_FragColor = texture2D(from, texCoord - vec2(x, y));\n              }\n              else {\n                  vec2 uv;\n                  if (x > 0.0)\n                      uv = vec2(x - 1.0, y);\n                  else if (y > 0.0)\n                      uv = vec2(x, y - 1.0);\n                  gl_FragColor = texture2D(to, texCoord - uv);\n              }\n          }\n          else if (x <= 0.0 && y <= 0.0) {\n              if (texCoord.x <= (1.0 + x) && texCoord.y <= (1.0 + y))\n                  gl_FragColor = texture2D(from, texCoord - vec2(x, y));\n              else {\n                  vec2 uv;\n                  if (x < 0.0)\n                      uv = vec2(x + 1.0, y);\n                  else if (y < 0.0)\n                      uv = vec2(x, y + 1.0);\n                  gl_FragColor = texture2D(to, texCoord - uv);\n              }\n          }\n          else\n              gl_FragColor = vec4(0.0);\n      }\n    ",uniforms:{translateX:0,translateY:1}},slideDown:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      uniform float translateX;\n      uniform float translateY;\n\n      void main() {\n          vec2 texCoord = gl_FragCoord.xy / resolution.xy;\n          float x = progress * translateX;\n          float y = progress * translateY;\n\n          if (x >= 0.0 && y >= 0.0) {\n              if (texCoord.x >= x && texCoord.y >= y) {\n                  gl_FragColor = texture2D(from, texCoord - vec2(x, y));\n              }\n              else {\n                  vec2 uv;\n                  if (x > 0.0)\n                      uv = vec2(x - 1.0, y);\n                  else if (y > 0.0)\n                      uv = vec2(x, y - 1.0);\n                  gl_FragColor = texture2D(to, texCoord - uv);\n              }\n          }\n          else if (x <= 0.0 && y <= 0.0) {\n              if (texCoord.x <= (1.0 + x) && texCoord.y <= (1.0 + y))\n                  gl_FragColor = texture2D(from, texCoord - vec2(x, y));\n              else {\n                  vec2 uv;\n                  if (x < 0.0)\n                      uv = vec2(x + 1.0, y);\n                  else if (y < 0.0)\n                      uv = vec2(x, y + 1.0);\n                  gl_FragColor = texture2D(to, texCoord - uv);\n              }\n          }\n          else\n              gl_FragColor = vec4(0.0);\n      }\n    ",uniforms:{translateX:0,translateY:-1}},slideLeft:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      uniform float translateX;\n      uniform float translateY;\n\n      void main() {\n          vec2 texCoord = gl_FragCoord.xy / resolution.xy;\n          float x = progress * translateX;\n          float y = progress * translateY;\n\n          if (x >= 0.0 && y >= 0.0) {\n              if (texCoord.x >= x && texCoord.y >= y) {\n                  gl_FragColor = texture2D(from, texCoord - vec2(x, y));\n              }\n              else {\n                  vec2 uv;\n                  if (x > 0.0)\n                      uv = vec2(x - 1.0, y);\n                  else if (y > 0.0)\n                      uv = vec2(x, y - 1.0);\n                  gl_FragColor = texture2D(to, texCoord - uv);\n              }\n          }\n          else if (x <= 0.0 && y <= 0.0) {\n              if (texCoord.x <= (1.0 + x) && texCoord.y <= (1.0 + y))\n                  gl_FragColor = texture2D(from, texCoord - vec2(x, y));\n              else {\n                  vec2 uv;\n                  if (x < 0.0)\n                      uv = vec2(x + 1.0, y);\n                  else if (y < 0.0)\n                      uv = vec2(x, y + 1.0);\n                  gl_FragColor = texture2D(to, texCoord - uv);\n              }\n          }\n          else\n              gl_FragColor = vec4(0.0);\n      }\n    ",uniforms:{translateX:1,translateY:0}},slideRight:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      uniform float translateX;\n      uniform float translateY;\n\n      void main() {\n          vec2 texCoord = gl_FragCoord.xy / resolution.xy;\n          float x = progress * translateX;\n          float y = progress * translateY;\n\n          if (x >= 0.0 && y >= 0.0) {\n              if (texCoord.x >= x && texCoord.y >= y) {\n                  gl_FragColor = texture2D(from, texCoord - vec2(x, y));\n              }\n              else {\n                  vec2 uv;\n                  if (x > 0.0)\n                      uv = vec2(x - 1.0, y);\n                  else if (y > 0.0)\n                      uv = vec2(x, y - 1.0);\n                  gl_FragColor = texture2D(to, texCoord - uv);\n              }\n          }\n          else if (x <= 0.0 && y <= 0.0) {\n              if (texCoord.x <= (1.0 + x) && texCoord.y <= (1.0 + y))\n                  gl_FragColor = texture2D(from, texCoord - vec2(x, y));\n              else {\n                  vec2 uv;\n                  if (x < 0.0)\n                      uv = vec2(x + 1.0, y);\n                  else if (y < 0.0)\n                      uv = vec2(x, y + 1.0);\n                  gl_FragColor = texture2D(to, texCoord - uv);\n              }\n          }\n          else\n              gl_FragColor = vec4(0.0);\n      }\n    ",uniforms:{translateX:-1,translateY:0}}},ur=Ot(),fr="forwards",cr="backwards";window.HTMLMediaElement&&Object.defineProperty(HTMLMediaElement.prototype,"playing",{get(){return!!(this.currentTime>0&&!this.paused&&!this.ended&&this.readyState>2)}});class _r{constructor(t){const e={container:"body",slides:[],autoplay:!1,slideDuration:3e3,transitions:hr,transition:{name:"random",duration:2e3,ease:"linear",priority:0}};this.config=_.merge({},e,t),"string"==typeof this.config.container?this.container=document.querySelector(this.config.container):this.container=this.config.container,this.container.style.display="block",this.container.style.position="absolute",this.container.style.top="0",this.container.style.left="0",this.container.style.width="100%",this.container.style.height="100%",this._slides=this.config.slides,this._currentSlideIndex=0,this._transitionToIndex=0,this._currentSlideRendered=!1,this._transitionProgress=0,this._imageMap={},this._videoMap={},this._slideContentMap={},this._ready=!1,this._destroyed=!1,this._playing=this.config.autoplay,this._width=0,this._height=0,this._regExp={image:/\.(jpe?g|webp|png)$/i,video:/\.(mp4|webm|ogg)$/i},this._createCanvases(),this._resizeHandler=this.resize.bind(this),window.addEventListener("resize",this._resizeHandler),this._lastFrameTime=0,window.requestAnimationFrame(this._animate.bind(this))}goToSlide(t,e){this._transitionToIndex=t,this._transitionDirection=e,this._currentSlideRendered=!1,this._autoPlayTimeout&&clearTimeout(this._autoPlayTimeout)}nextSlide(){let t;t=this._transitionToIndex===this._currentSlideIndex-1||this._transitionToIndex===this._slides.length-1&&0===this._currentSlideIndex?this._currentSlideIndex:this._currentSlideIndex===this._slides.length-1?0:this._currentSlideIndex+1,this.goToSlide(t,fr)}prevSlide(){let t;t=this._transitionToIndex===this._currentSlideIndex+1||0===this._transitionToIndex&&this._currentSlideIndex===this._slides.length-1?this._currentSlideIndex:0===this._currentSlideIndex?this._slides.length-1:this._currentSlideIndex-1,this.goToSlide(t,cr)}play(){this._playing=!0,this.nextSlide()}pause(){this._playing=!1,this._autoPlayTimeout&&clearTimeout(this._autoPlayTimeout)}destroy(){this._playing=!1,this._destroyed=!0,window.removeEventListener("resize",this._resizeHandler),_.forEach(this._videoMap,t=>{this.container.removeChild(t),t=null}),this._videoMap=null}static _updateCoords(t,e,r){const n=t.width/t.height,i=e.width/e.height;if(r&&"fill"===r){if(n<i){const r=e.height*(t.width/e.width);t.y=t.y+.5*(t.height-r),t.height=r}if(n>i){const r=e.width*(t.height/e.height);t.x=t.x+.5*(t.width-r),t.width=r}}else{if(n>i){const r=e.width*(t.height/t.width);e.y=e.y+.5*(e.height-r),e.height=r}if(n<i){const t=e.height*n;e.x=e.x+.5*(e.width-t),e.width=t}}return["x","y","width","height"].forEach(r=>{t[r]=Math.round(t[r]),e[r]=Math.round(e[r])}),{src:t,dst:e}}static _getTile(t,e){return{x:t.x,y:t.y,width:e[0]<=1?t.width*e[0]:e[0],height:e[1]<=1?t.height*e[1]:e[1]}}static _drawTiles(t,e,r,n){let i,a,o=0,s=0;r&&"fill"===r?(i=Math.ceil(t.height/e.height),a=Math.ceil(t.width/e.width),o=.5*(e.width*a-t.width),s=.5*(e.height*i-t.height)):(i=Math.floor(t.height/e.height),a=Math.floor(t.width/e.width));let l=0,h=0;const u=i*a;for(let t=0;t<u;t++)n({x:e.x+h*e.width-o,y:e.y+l*e.height-s}),h===a-1&&l++,h=h<a-1?h+1:0}static _getImageData(t,e,r,n,i){const a=document.createElement("canvas");a.width=t.naturalWidth,a.height=t.naturalHeight;const o=a.getContext("2d");return o.drawImage(t,0,0,t.naturalWidth,t.naturalHeight),o.getImageData(e,r,n,i).data}static _getVideoData(t){const e=document.createElement("canvas");e.width=t.videoWidth,e.height=t.videoHeight;const r=e.getContext("2d");return r.drawImage(t,0,0,t.videoWidth,t.videoHeight),r._getImageData(0,0,t.videoWidth,t.videoHeight).data}_transitionEnded(){}_videoEnded(t,e){const r=this._slides[this._transitionToIndex];if(this._playing&&r.duration&&_.isFunction(r.duration)){let t=r.duration();this._isType(t,"video")&&this.nextSlide()}}_slideLoaded(t,e){}_slideRendered(){this._ready||(this._ready=!0,this.container.classList.add("showy--ready"));const t=this._slides[this._transitionToIndex];if(this._playing){let e=this.config.slideDuration;if(t.duration){if(_.isFunction(t.duration)){let e=t.duration();if(this._isType(e,"video"))return}_.isNumber(t.duration)&&(e=t.duration)}this._autoPlayTimeout=setTimeout(()=>{this.nextSlide()},e)}}_animate(t){if(!this._destroyed){this._fps=1e3/(t-this._lastFrameTime);try{this._drawSlides(),window.requestAnimationFrame(this._animate.bind(this))}catch(t){console.error(t)}this._lastFrameTime=t}}_createCanvas(){const t=document.createElement("canvas");return t.style.position="absolute",t.style.width="100%",t.style.height="100%",this._resizeCanvas(t),t}_createCanvases(){this._currentCanvas=this._createCanvas(),this._currentContext=this._currentCanvas.getContext("2d"),this._nextCanvas=this._createCanvas(),this._nextContext=this._nextCanvas.getContext("2d"),this._prevCanvas=this._createCanvas(),this._prevContext=this._prevCanvas.getContext("2d"),this._renderCanvas=this._createCanvas(),this._renderContext=this._renderCanvas.getContext("webgl")||this._renderCanvas.getContext("experimental-webgl"),this._renderContext.pixelStorei(this._renderContext.UNPACK_FLIP_Y_WEBGL,!0),this.container.appendChild(this._renderCanvas)}_resizeCanvas(t){this._scale=window.devicePixelRatio,this._width=this.container.clientWidth*this._scale,this._height=this.container.clientHeight*this._scale,t.width=this._width,t.height=this._height}resize(){this._slideContentMap={},this._resizeCanvas(this._currentCanvas),this._resizeCanvas(this._nextCanvas),this._resizeCanvas(this._prevCanvas),this._resizeCanvas(this._renderCanvas),this._drawSlides(!0)}_clearContext(t){t.clearRect(0,0,this._width,this._height)}_transitionInProgress(){return this._transitionProgress>0&&this._transitionProgress<1}_getTransition(t={},e={}){const r=_.merge({},this.config.transition,t||{}),n=_.merge({},this.config.transition,e||{});"random"===r.name?r.glsl=_.sample(this.config.transitions):r.glsl=this.config.transitions[r.name],"random"===n.name?n.glsl=_.sample(this.config.transitions):n.glsl=this.config.transitions[n.name];return r.priority>=n.priority?r:n}_drawSlides(t){const e=this._slides[this._currentSlideIndex],r=this._slides[this._currentSlideIndex===this._slides.length-1?0:this._currentSlideIndex+1],n=this._slides[0===this._currentSlideIndex?this._slides.length-1:this._currentSlideIndex-1];let i;if(t&&(e._rendered=!1),e._hasVideo||!e._rendered||this._transitionInProgress()||this._currentSlideIndex!==this._transitionToIndex){if(this._drawSlide(this._currentContext,e),this._drawSlide(this._nextContext,r),this._drawSlide(this._prevContext,n),this._fromTexture&&this._fromTexture.dispose(),this._toTexture&&this._toTexture.dispose(),this._transitionToIndex!==this._currentSlideIndex||this._transitionInProgress()?((this._transitionToIndex!==this._currentSlideIndex&&this._transitionDirection===fr||this._transitionToIndex===this._currentSlideIndex&&this._transitionDirection===cr)&&(this._fromTexture=$t(this._renderContext,this._currentCanvas),this._toTexture=$t(this._renderContext,this._nextCanvas),i=this._getTransition(e.transitionNext,r.transitionPrev)),(this._transitionToIndex!==this._currentSlideIndex&&this._transitionDirection===cr||this._transitionToIndex===this._currentSlideIndex&&this._transitionDirection===fr)&&(this._fromTexture=$t(this._renderContext,this._prevCanvas),this._toTexture=$t(this._renderContext,this._currentCanvas),i=this._getTransition(e.transitionPrev,n.transitionNext))):(this._fromTexture=$t(this._renderContext,this._currentCanvas),this._toTexture=this._fromTexture),!i||this._transitionInProgress()||this._transitionOptions&&this._transitionOptions.name===i.name&&"random"!==this._transitionOptions.name||(this._transitionOptions=i,this._transition&&(this._transition.dispose(),this._transition=null)),this._transitionOptions){if(this._transition||(this._transition=or(this._renderContext,this._transitionOptions.glsl.shader)),this._transitionToIndex!==this._currentSlideIndex||this._transitionInProgress()){const t=60/this._transitionOptions.duration;this._transitionDirection===fr&&(this._transitionProgress=this._transitionInProgress()?this._transitionProgress+t:t),this._transitionDirection===cr&&(this._transitionProgress=this._transitionInProgress()?this._transitionProgress-t:1-t)}this._transitionProgress>1&&(this._transitionProgress=1),this._transitionProgress<0&&(this._transitionProgress=0);const t=lr[this._transitionOptions.ease](this._transitionProgress);this._transition.render(t,this._fromTexture,this._toTexture,this._transitionOptions.glsl.uniforms)}else this._transition||(this._transition=or(this._renderContext,"\n  #ifdef GL_ES\n  precision highp float;\n  #endif\n  uniform sampler2D from, to;\n  uniform float progress;\n  uniform vec2 resolution;\n\n  void main() {\n    vec2 p = gl_FragCoord.xy / resolution.xy;\n    gl_FragColor = texture2D(to, p);\n  }\n")),this._transition.render(1,this._fromTexture,this._toTexture);e._ready&&(e._rendered=!0,this._currentSlideRendered||(this._currentSlideRendered=!0,this._playSlideContent(this._transitionToIndex),this._slideRendered())),this._transitionToIndex===this._currentSlideIndex||this._transitionInProgress()||(this._currentSlideIndex=this._transitionToIndex,this._clearContext(this._currentContext),this._clearContext(this._nextContext),this._clearContext(this._prevContext),this._pauseSlideContent(),this._transitionEnded())}}_isType(t,e){return t.type===e||t[e]||this._regExp[e].test(t.url)}_drawSlide(t,e){e._hasVideo=e.content.filter(t=>this._isType(t,"video")).length>0,e._rendered=!1,e._ready=!1,e._loaded||(e._loaded=!1),e.background&&(t.fillStyle=e.background,t.fillRect(0,0,this._width,this._height)),e.content.length&&this._drawSlideContent(t,e,0)}_drawSlideContent(t,e,r){const n=e.content[r];if(!n)return e._ready=!0,void(e._loaded||(e._loaded=!0,this._slideLoaded(e,this._slides.indexOf(e))));const i=this._drawSlideContent.bind(this,t,e,r+1);if(this._isType(n,"image"))this._drawImage(t,n,i);else if(this._isType(n,"video"))this._drawVideo(t,n,i);else{if(!this._isType(n,"text"))throw new Error("Unknown content type");this._drawText(t,n,i)}}_position2Pixels(t,e=1){const r=[];t.forEach((t,n)=>{let i,a=[this._width,this._height,this._width,this._height][n];a/=e,i=t>=0&&t<=1?n<2?t*a:t*a-r[n-2]:n<2?t:a-r[n-2]-Math.abs(t),r.push(i)});return{x:r[0]*e,y:r[1]*e,width:r[2]*e,height:r[3]*e}}_getImage(t,e){const r="function"==typeof t.url?t.url():t.url;if(this._imageMap[r])return void e(this._imageMap[r]);const n=new Image;n.crossOrigin="Anonymous",n.src=r,n.onerror=(t=>{throw this.destroy(),new Error("Image failed to load",r)}),n.onload=(t=>{this._imageMap[r]=n,e(n)})}_resizeImage(t,e,r,n){const i=JSON.stringify({src:t.src,dst:r});this._slideContentMap[i]?n(this._slideContentMap[i]):ur.resizeBuffer({src:_r._getImageData(t,e.x,e.y,e.width,e.height),width:e.width,height:e.height,toWidth:r.width,toHeight:r.height,quality:1,alpha:!1,unsharpAmount:0,unsharpRadius:.5,unsharpThreshold:0}).then(a=>{if(a.length)return this._resizedImageData=new ImageData(new Uint8ClampedArray(a),r.width,r.height),this._slideContentMap[i]=this._resizedImageData,void n(this._slideContentMap[i]);console.error(new Error("Resize failed"),t.src,e,r)},t=>{console.error(t)})}_drawText(t,e,r){let n=this._position2Pixels(e.position,this._scale);t.font=e.font||"72px sans-serif",t.textAlign=e.align||"center",t.fillStyle=e.color||"rgba(0, 0, 0, 1)";let i=e.maxWidth?e.maxWidth*this._width:void 0;t.fillText(e.text,n.x,n.y,i),r()}_drawImage(t,e,r){this._getImage(e,n=>{let i={x:0,y:0,width:n.naturalWidth,height:n.naturalHeight},a=this._position2Pixels(e.position,this._scale);if(e.tile){let o=_r._getTile(a,e.tile.size);const s=_r._updateCoords(i,o,e.tile.scaleMode);return void this._resizeImage(n,s.src,s.dst,n=>{_r._drawTiles(a,s.dst,e.scaleMode,e=>{t.putImageData(n,e.x,e.y)}),r()})}const o=_r._updateCoords(i,a,e.scaleMode);i=o.src,a=o.dst,this._resizeImage(n,i,a,e=>{t.putImageData(e,a.x,a.y),r()})})}_getVideo(t,e=(()=>{})){const r="function"==typeof t.url?t.url():t.url,n="function"==typeof t.sources?t.sources():t.sources,i=JSON.stringify(r||n);if(this._videoMap[i])return e(this._videoMap[i]),this._videoMap[i];const a=document.createElement("video");return a.style.display="none",a.crossOrigin="anonymous",a.muted=!0,this.container.appendChild(a),r&&(a.src=r),n&&n.forEach(t=>{const e=document.createElement("source");e.src=t.url,t.type&&(e.type=t.type),e.crossOrigin="anonymous",a.appendChild(e)}),this._videoMap[i]=a,a.addEventListener("loadedmetadata",()=>{e(a)}),a._playCount=0,a.addEventListener("ended",()=>{a.play(),a._playCount+=1,this._videoEnded(a,t)}),a}_drawVideo(t,e,r){this._getVideo(e,n=>{if(0===n.videoWidth||0===n.videoHeight)return;let i={x:0,y:0,width:n.videoWidth,height:n.videoHeight},a=this._position2Pixels(e.position,this._scale);if(e.tile){let o=_r._getTile(a,e.tile.size);const s=_r._updateCoords(i,o,e.tile.scaleMode);return _r._drawTiles(a,s.dst,e.scaleMode,e=>{t.drawImage(n,i.x,i.y,i.width,i.height,e.x,e.y,o.width,o.height)}),void r()}const o=_r._updateCoords(i,a,e.scaleMode);i=o.src,a=o.dst,t.drawImage(n,i.x,i.y,i.width,i.height,a.x,a.y,a.width,a.height),r()})}_playSlideContent(t){this._slides[t].content.forEach(t=>{this._isType(t,"video")&&this._getVideo(t,t=>{t._playCount=0,t.currentTime=0,t.play()})})}_pauseSlideContent(){const t=[];this._slides[this._currentSlideIndex].content.forEach(e=>{this._isType(e,"video")&&t.push(this._getVideo(e))}),this._slides.forEach((e,r)=>{r!==this._currentSlideIndex&&e.content.forEach(e=>{this._isType(e,"video")&&this._getVideo(e,e=>{-1===t.indexOf(e)&&(e._playCount=0,e.currentTime=0,e.pause())})})})}}return _r});
//# sourceMappingURL=showy.min.js.map
