!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).showy=e()}(this,function(){var t=Object.getOwnPropertySymbols,e=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;function n(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function i(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},r=0;r<10;r++)e["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(t){n[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}var o=i()?Object.assign:function(i,o){for(var a,s,u=n(i),h=1;h<arguments.length;h++){for(var f in a=Object(arguments[h]))e.call(a,f)&&(u[f]=a[f]);if(t){s=t(a);for(var l=0;l<s.length;l++)r.call(a,s[l])&&(u[s[l]]=a[s[l]])}}return u},a=arguments[3],s=arguments[4],u=arguments[5],h=JSON.stringify,f=function(t,e){for(var r,n=Object.keys(u),i=0,o=n.length;i<o;i++){var f=u[c=n[i]].exports;if(f===t||f&&f.default===t){r=c;break}}if(!r){r=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var l={};for(i=0,o=n.length;i<o;i++){var c;l[c=n[i]]=c}s[r]=["function(require,module,exports){"+t+"(self); }",l]}var g=Math.floor(Math.pow(16,8)*Math.random()).toString(16),d={};d[r]=r,s[g]=["function(require,module,exports){var f = require("+h(r)+");(f.default ? f.default : f)(self);}",d];var p={};!function t(e){for(var r in p[e]=!0,s[e][1]){var n=s[e][1][r];p[n]||t(n)}}(g);var _="("+a+")({"+Object.keys(p).map(function(t){return h(t)+":["+s[t][0]+","+h(s[t][1])+"]"}).join(",")+"},{},["+h(g)+"])",A=window.URL||window.webkitURL||window.mozURL||window.msURL,E=new Blob([_],{type:"text/javascript"});if(e&&e.bare)return E;var y=A.createObjectURL(E),m=new Worker(y);return m.objectURL=y,m},l="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function c(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function g(t,e,r){return t(r={path:e,exports:{},require:function(t,e){return d()}},r.exports),r.exports}function d(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var p,A=g(function(t){t.exports="function"==typeof Object.create?function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:function(t,e){if(e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}}}),E="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",y=function(t){for(var e=t.replace(/[\r\n=]/g,""),r=e.length,n=new Uint8Array(3*r>>2),i=0,o=0,a=0;a<r;a++)a%4==0&&a&&(n[o++]=i>>16&255,n[o++]=i>>8&255,n[o++]=255&i),i=i<<6|E.indexOf(e.charAt(a));var s=r%4*6;return 0===s?(n[o++]=i>>16&255,n[o++]=i>>8&255,n[o++]=255&i):18===s?(n[o++]=i>>10&255,n[o++]=i>>2&255):12===s&&(n[o++]=i>>4&255),n},m=function(){if(void 0!==p)return p;if(p=!1,"undefined"==typeof WebAssembly)return p;try{var t=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),e=new WebAssembly.Module(t);return 0!==new WebAssembly.Instance(e,{}).exports.test(4)&&(p=!0),p}catch(t){}return p},v={js:!0,wasm:!0};function I(t){if(!(this instanceof I))return new I(t);var e=o({},v,t||{});if(this.options=e,this.__cache={},this.__init_promise=null,this.__modules=e.modules||{},this.__memory=null,this.__wasm={},this.__isLE=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0],!this.options.js&&!this.options.wasm)throw new Error('mathlib: at least "js" or "wasm" should be enabled')}I.prototype.has_wasm=m,I.prototype.use=function(t){return this.__modules[t.name]=t,this[t.name]=this.options.wasm&&this.has_wasm()&&t.wasm_fn?t.wasm_fn:t.fn,this},I.prototype.init=function(){if(this.__init_promise)return this.__init_promise;if(!this.options.js&&this.options.wasm&&!this.has_wasm())return Promise.reject(new Error('mathlib: only "wasm" was enabled, but it\'s not supported'));var t=this;return this.__init_promise=Promise.all(Object.keys(t.__modules).map(function(e){var r=t.__modules[e];return t.options.wasm&&t.has_wasm()&&r.wasm_fn?t.__wasm[e]?null:WebAssembly.compile(t.__base64decode(r.wasm_src)).then(function(r){t.__wasm[e]=r}):null})).then(function(){return t}),this.__init_promise},I.prototype.__base64decode=y,I.prototype.__reallocate=function(t){if(!this.__memory)return this.__memory=new WebAssembly.Memory({initial:Math.ceil(t/65536)}),this.__memory;var e=this.__memory.buffer.byteLength;return e<t&&this.__memory.grow(Math.ceil((t-e)/65536)),this.__memory},I.prototype.__instance=function(t,e,r){if(e&&this.__reallocate(e),this.__wasm[t]||(this.__wasm[t]=new WebAssembly.Module(this.__base64decode(this.__modules[t].wasm_src))),!this.__cache[t]){var n={memoryBase:0,memory:this.__memory,tableBase:0,table:new WebAssembly.Table({initial:0,element:"anyfunc"})};this.__cache[t]=new WebAssembly.Instance(this.__wasm[t],{env:o(n,r||{})})}return this.__cache[t]},I.prototype.__align=function(t,e){var r=t%(e=e||8);return t+(r?e-r:0)};var w,T,b,x,C,B,R,S,M=I;function U(t){t<.5&&(t=.5);var e=Math.exp(.527076)/t,r=Math.exp(-e),n=Math.exp(-2*e),i=(1-r)*(1-r)/(1+2*e*r-n);return R=((w=i)+(T=i*(e-1)*r))/(1-(C=2*r)-(B=-n)),S=((b=i*(e+1)*r)+(x=-i*n))/(1-C-B),new Float32Array([w,T,b,x,C,B,R,S])}function N(t,e,r,n,i,o){var a,s,u,h,f,l,c,g,d,p,_,A,E,y;for(d=0;d<o;d++){for(c=d,g=0,h=f=(a=t[l=d*i])*n[6],_=n[0],A=n[1],E=n[4],y=n[5],p=0;p<i;p++)u=(s=t[l])*_+a*A+h*E+f*y,f=h,a=s,r[g]=h=u,g++,l++;for(g--,c+=o*(i-1),h=f=(a=t[--l])*n[7],s=a,_=n[2],A=n[3],p=i-1;p>=0;p--)u=s*_+a*A+h*E+f*y,f=h,a=s,s=t[l],e[c]=r[g]+(h=u),l--,g--,c-=o}}function L(t,e,r,n){if(n){var i=new Uint16Array(t.length),o=new Float32Array(Math.max(e,r)),a=U(n);N(t,i,o,a,e,r),N(i,t,o,a,r,e)}}var D=L,O=function(t,e,r){for(var n,i,o,a=e*r,s=new Uint16Array(a),u=0;u<a;u++)o=t[4*u+2],s[u]=257*(((n=t[4*u])>=(i=t[4*u+1])&&n>=o?n:i>=o&&i>=n?i:o)+(n<=i&&n<=o?n:i<=o&&i<=n?i:o))>>1;return s},P=function(t,e,r,n,i,o){var a,s,u,h,f,l,c,g,d,p,_,A,E;if(!(0===n||i<.5)){i>2&&(i=2);var y=O(t,e,r),m=new Uint16Array(y);D(m,e,r,i);for(var v=n/100*4096+.5|0,I=257*o|0,w=e*r,T=0;T<w;T++)A=2*(y[T]-m[T]),Math.abs(A)>=I&&(u=t[2+(E=4*T)],l=257*((g=(a=t[E])>=(s=t[E+1])&&a>=u?a:s>=a&&s>=u?s:u)+(c=a<=s&&a<=u?a:s<=a&&s<=u?s:u))>>1,c===g?h=f=0:(f=l<=32767?4095*(g-c)/(g+c)|0:4095*(g-c)/(510-g-c)|0,h=a===g?65535*(s-u)/(6*(g-c))|0:s===g?21845+(65535*(u-a)/(6*(g-c))|0):43690+(65535*(a-s)/(6*(g-c))|0)),(l+=v*A+2048>>12)>65535?l=65535:l<0&&(l=0),0===f?a=s=u=l>>8:(d=2*l-(p=l<=32767?l*(4096+f)+2048>>12:l+((65535-l)*f+2048>>12))>>8,p>>=8,a=(_=h+21845&65535)>=43690?d:_>=32767?d+(6*(p-d)*(43690-_)+32768>>16):_>=10922?p:d+(6*(p-d)*_+32768>>16),s=(_=65535&h)>=43690?d:_>=32767?d+(6*(p-d)*(43690-_)+32768>>16):_>=10922?p:d+(6*(p-d)*_+32768>>16),u=(_=h-21845&65535)>=43690?d:_>=32767?d+(6*(p-d)*(43690-_)+32768>>16):_>=10922?p:d+(6*(p-d)*_+32768>>16)),t[E]=a,t[E+1]=s,t[E+2]=u)}},F=function(t,e,r,n,i,o){if(!(0===n||i<.5)){i>2&&(i=2);var a=e*r,s=4*a,u=2*a,h=2*a,f=4*Math.max(e,r),l=s,c=l+u,g=c+h,d=g+h,p=d+f,_=this.__instance("unsharp_mask",s+u+2*h+f+32,{exp:Math.exp}),A=new Uint32Array(t.buffer);new Uint32Array(this.__memory.buffer).set(A);var E=_.exports.hsl_l16||_.exports._hsl_l16;E(0,l,e,r),(E=_.exports.blurMono16||_.exports._blurMono16)(l,c,g,d,p,e,r,i),(E=_.exports.unsharp||_.exports._unsharp)(0,0,l,c,e,r,n,o),A.set(new Uint32Array(this.__memory.buffer,0,a))}},j="AGFzbQEAAAABMQZgAXwBfGACfX8AYAZ/f39/f38AYAh/f39/f39/fQBgBH9/f38AYAh/f39/f39/fwACGQIDZW52A2V4cAAAA2VudgZtZW1vcnkCAAEDBgUBAgMEBQQEAXAAAAdMBRZfX2J1aWxkX2dhdXNzaWFuX2NvZWZzAAEOX19nYXVzczE2X2xpbmUAAgpibHVyTW9ubzE2AAMHaHNsX2wxNgAEB3Vuc2hhcnAABQkBAAqJEAXZAQEGfAJAIAFE24a6Q4Ia+z8gALujIgOaEAAiBCAEoCIGtjgCECABIANEAAAAAAAAAMCiEAAiBbaMOAIUIAFEAAAAAAAA8D8gBKEiAiACoiAEIAMgA6CiRAAAAAAAAPA/oCAFoaMiArY4AgAgASAEIANEAAAAAAAA8L+gIAKioiIHtjgCBCABIAQgA0QAAAAAAADwP6AgAqKiIgO2OAIIIAEgBSACoiIEtow4AgwgASACIAegIAVEAAAAAAAA8D8gBqGgIgKjtjgCGCABIAMgBKEgAqO2OAIcCwu3AwMDfwR9CHwCQCADKgIUIQkgAyoCECEKIAMqAgwhCyADKgIIIQwCQCAEQX9qIgdBAEgiCA0AIAIgAC8BALgiDSADKgIYu6IiDiAJuyIQoiAOIAq7IhGiIA0gAyoCBLsiEqIgAyoCALsiEyANoqCgoCIPtjgCACACQQRqIQIgAEECaiEAIAdFDQAgBCEGA0AgAiAOIBCiIA8iDiARoiANIBKiIBMgAC8BALgiDaKgoKAiD7Y4AgAgAkEEaiECIABBAmohACAGQX9qIgZBAUoNAAsLAkAgCA0AIAEgByAFbEEBdGogAEF+ai8BACIIuCINIAu7IhGiIA0gDLsiEqKgIA0gAyoCHLuiIg4gCrsiE6KgIA4gCbsiFKKgIg8gAkF8aioCALugqzsBACAHRQ0AIAJBeGohAiAAQXxqIQBBACAFQQF0ayEHIAEgBSAEQQF0QXxqbGohBgNAIAghAyAALwEAIQggBiANIBGiIAO4Ig0gEqKgIA8iECAToqAgDiAUoqAiDyACKgIAu6CrOwEAIAYgB2ohBiAAQX5qIQAgAkF8aiECIBAhDiAEQX9qIgRBAUoNAAsLCwvfAgIDfwZ8AkAgB0MAAAAAWw0AIARE24a6Q4Ia+z8gB0MAAAA/l7ujIgyaEAAiDSANoCIPtjgCECAEIAxEAAAAAAAAAMCiEAAiDraMOAIUIAREAAAAAAAA8D8gDaEiCyALoiANIAwgDKCiRAAAAAAAAPA/oCAOoaMiC7Y4AgAgBCANIAxEAAAAAAAA8L+gIAuioiIQtjgCBCAEIA0gDEQAAAAAAADwP6AgC6KiIgy2OAIIIAQgDiALoiINtow4AgwgBCALIBCgIA5EAAAAAAAA8D8gD6GgIgujtjgCGCAEIAwgDaEgC6O2OAIcIAYEQCAFQQF0IQogBiEJIAIhCANAIAAgCCADIAQgBSAGEAIgACAKaiEAIAhBAmohCCAJQX9qIgkNAAsLIAVFDQAgBkEBdCEIIAUhAANAIAIgASADIAQgBiAFEAIgAiAIaiECIAFBAmohASAAQX9qIgANAAsLC7wBAQV/IAMgAmwiAwRAQQAgA2shBgNAIAAoAgAiBEEIdiIHQf8BcSECAn8gBEH/AXEiAyAEQRB2IgRB/wFxIgVPBEAgAyIIIAMgAk8NARoLIAQgBCAHIAIgA0kbIAIgBUkbQf8BcQshCAJAIAMgAk0EQCADIAVNDQELIAQgByAEIAMgAk8bIAIgBUsbQf8BcSEDCyAAQQRqIQAgASADIAhqQYECbEEBdjsBACABQQJqIQEgBkEBaiIGDQALCwvTBgEKfwJAIAazQwAAgEWUQwAAyEKVu0QAAAAAAADgP6CqIQ0gBSAEbCILBEAgB0GBAmwhDgNAQQAgAi8BACADLwEAayIGQQF0IgdrIAcgBkEASBsgDk8EQCAAQQJqLQAAIQUCfyAALQAAIgYgAEEBai0AACIESSIJRQRAIAYiCCAGIAVPDQEaCyAFIAUgBCAEIAVJGyAGIARLGwshCAJ/IAYgBE0EQCAGIgogBiAFTQ0BGgsgBSAFIAQgBCAFSxsgCRsLIgogCGoiD0GBAmwiEEEBdiERQQAhDAJ/QQAiCSAIIApGDQAaIAggCmsiCUH/H2wgD0H+AyAIayAKayAQQYCABEkbbSEMIAYgCEYEQCAEIAVrQf//A2wgCUEGbG0MAQsgBSAGayAGIARrIAQgCEYiBhtB//8DbCAJQQZsbUHVqgFBqtUCIAYbagshCSARIAcgDWxBgBBqQQx1aiIGQQAgBkEAShsiBkH//wMgBkH//wNIGyEGAkACfwJAIAxB//8DcSIFBEAgBkH//wFKDQEgBUGAIGogBmxBgBBqQQx2DAILIAZBCHYiBiEFIAYhBAwCCyAFIAZB//8Dc2xBgBBqQQx2IAZqCyIFQQh2IQcgBkEBdCAFa0EIdiIGIQQCQCAJQdWqAWpB//8DcSIFQanVAksNACAFQf//AU8EQEGq1QIgBWsgByAGa2xBBmxBgIACakEQdiAGaiEEDAELIAchBCAFQanVAEsNACAFIAcgBmtsQQZsQYCAAmpBEHYgBmohBAsCfyAGIgUgCUH//wNxIghBqdUCSw0AGkGq1QIgCGsgByAGa2xBBmxBgIACakEQdiAGaiAIQf//AU8NABogByIFIAhBqdUASw0AGiAIIAcgBmtsQQZsQYCAAmpBEHYgBmoLIQUgCUGr1QJqQf//A3EiCEGp1QJLDQAgCEH//wFPBEBBqtUCIAhrIAcgBmtsQQZsQYCAAmpBEHYgBmohBgwBCyAIQanVAEsEQCAHIQYMAQsgCCAHIAZrbEEGbEGAgAJqQRB2IAZqIQYLIAEgBDoAACABQQFqIAU6AAAgAUECaiAGOgAACyADQQJqIQMgAkECaiECIABBBGohACABQQRqIQEgC0F/aiILDQALCwsL",V={name:"unsharp_mask",fn:P,wasm_fn:F,wasm_src:j},k=[{win:.5,filter:function(t){return t>=-.5&&t<.5?1:0}},{win:1,filter:function(t){if(t<=-1||t>=1)return 0;if(t>-1.1920929e-7&&t<1.1920929e-7)return 1;var e=t*Math.PI;return Math.sin(e)/e*(.54+.46*Math.cos(e/1))}},{win:2,filter:function(t){if(t<=-2||t>=2)return 0;if(t>-1.1920929e-7&&t<1.1920929e-7)return 1;var e=t*Math.PI;return Math.sin(e)/e*Math.sin(e/2)/(e/2)}},{win:3,filter:function(t){if(t<=-3||t>=3)return 0;if(t>-1.1920929e-7&&t<1.1920929e-7)return 1;var e=t*Math.PI;return Math.sin(e)/e*Math.sin(e/3)/(e/3)}}],Q=14;function X(t){return Math.round(t*((1<<Q)-1))}var G=function(t,e,r,n,i){var o,a,s,u,h,f,l,c,g,d,p,_,A,E,y,m,v=k[t].filter,I=1/n,w=Math.min(1,n),T=k[t].win/w,b=Math.floor(2*(T+1)),x=new Int16Array((b+2)*r),C=0,B=!x.subarray||!x.set;for(o=0;o<r;o++){for(a=(o+.5)*I+i,s=Math.max(0,Math.floor(a-T)),h=(u=Math.min(e-1,Math.ceil(a+T)))-s+1,f=new Float32Array(h),l=new Int16Array(h),c=0,g=s,d=0;g<=u;g++,d++)c+=p=v((g+.5-a)*w),f[d]=p;for(_=0,d=0;d<f.length;d++)_+=A=f[d]/c,l[d]=X(A);for(l[r>>1]+=X(1-_),E=0;E<l.length&&0===l[E];)E++;if(E<l.length){for(y=l.length-1;y>0&&0===l[y];)y--;if(m=y-E+1,x[C++]=s+E,x[C++]=m,B)for(d=E;d<=y;d++)x[C++]=l[d];else x.set(l.subarray(E,y+1),C),C+=m}else x[C++]=0,x[C++]=0}return x};function H(t){return t<0?0:t>255?255:t}function q(t,e,r,n,i,o){var a,s,u,h,f,l,c,g,d,p,_,A=0,E=0;for(d=0;d<n;d++){for(f=0,p=0;p<i;p++){for(l=o[f++],c=o[f++],g=A+4*l|0,a=s=u=h=0;c>0;c--)h=h+(_=o[f++])*t[g+3]|0,u=u+_*t[g+2]|0,s=s+_*t[g+1]|0,a=a+_*t[g]|0,g=g+4|0;e[E+3]=H(h+8192>>14),e[E+2]=H(u+8192>>14),e[E+1]=H(s+8192>>14),e[E]=H(a+8192>>14),E=E+4*n|0}E=4*(d+1)|0,A=(d+1)*r*4|0}}function Y(t,e,r,n,i,o){var a,s,u,h,f,l,c,g,d,p,_,A=0,E=0;for(d=0;d<n;d++){for(f=0,p=0;p<i;p++){for(l=o[f++],c=o[f++],g=A+4*l|0,a=s=u=h=0;c>0;c--)h=h+(_=o[f++])*t[g+3]|0,u=u+_*t[g+2]|0,s=s+_*t[g+1]|0,a=a+_*t[g]|0,g=g+4|0;e[E+3]=H(h+8192>>14),e[E+2]=H(u+8192>>14),e[E+1]=H(s+8192>>14),e[E]=H(a+8192>>14),E=E+4*n|0}E=4*(d+1)|0,A=(d+1)*r*4|0}}var W={convolveHorizontally:q,convolveVertically:Y};const z=W.convolveHorizontally,K=W.convolveVertically;function Z(t,e,r){let n=3,i=e*r*4|0;for(;n<i;)t[n]=255,n=n+4|0}var $=function(t){const e=t.src,r=t.width,n=t.height,i=t.toWidth,o=t.toHeight,a=t.scaleX||t.toWidth/t.width,s=t.scaleY||t.toHeight/t.height,u=t.offsetX||0,h=t.offsetY||0,f=t.dest||new Uint8Array(i*o*4),l=void 0===t.quality?3:t.quality,c=t.alpha||!1,g=G(l,r,i,a,u),d=G(l,n,o,s,h),p=new Uint8Array(i*n*4);return z(e,p,r,n,i,g),K(p,f,n,i,o,d),c||Z(f,i,o),f};function J(t,e,r){let n=3,i=e*r*4|0;for(;n<i;)t[n]=255,n=n+4|0}function tt(t){return new Uint8Array(t.buffer,0,t.byteLength)}let et=!0;try{et=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]}catch(t){}function rt(t,e,r){if(et)e.set(tt(t),r);else for(let n=r,i=0;i<t.length;i++){let r=t[i];e[n++]=255&r,e[n++]=r>>8&255}}var nt=function(t){const e=t.src,r=t.width,n=t.height,i=t.toWidth,o=t.toHeight,a=t.scaleX||t.toWidth/t.width,s=t.scaleY||t.toHeight/t.height,u=t.offsetX||0,h=t.offsetY||0,f=t.dest||new Uint8Array(i*o*4),l=void 0===t.quality?3:t.quality,c=t.alpha||!1,g=G(l,r,i,a,u),d=G(l,n,o,s,h),p=this.__align(0+Math.max(e.byteLength,f.byteLength)),_=this.__align(p+n*i*4),A=this.__align(_+g.byteLength),E=this.__instance("resize",A+d.byteLength),y=new Uint8Array(this.__memory.buffer),m=new Uint32Array(this.__memory.buffer),v=new Uint32Array(e.buffer);return m.set(v),rt(g,y,_),rt(d,y,A),(E.exports.convolveHV||E.exports._convolveHV)(_,A,p,r,n,i,o),new Uint32Array(f.buffer).set(new Uint32Array(this.__memory.buffer,0,o*i)),c||J(f,i,o),f},it="AGFzbQEAAAABFAJgBn9/f39/fwBgB39/f39/f38AAg8BA2VudgZtZW1vcnkCAAEDAwIAAQQEAXAAAAcZAghjb252b2x2ZQAACmNvbnZvbHZlSFYAAQkBAArmAwLBAwEQfwJAIANFDQAgBEUNACAFQQRqIRVBACEMQQAhDQNAIA0hDkEAIRFBACEHA0AgB0ECaiESAn8gBSAHQQF0IgdqIgZBAmouAQAiEwRAQQAhCEEAIBNrIRQgFSAHaiEPIAAgDCAGLgEAakECdGohEEEAIQlBACEKQQAhCwNAIBAoAgAiB0EYdiAPLgEAIgZsIAtqIQsgB0H/AXEgBmwgCGohCCAHQRB2Qf8BcSAGbCAKaiEKIAdBCHZB/wFxIAZsIAlqIQkgD0ECaiEPIBBBBGohECAUQQFqIhQNAAsgEiATagwBC0EAIQtBACEKQQAhCUEAIQggEgshByABIA5BAnRqIApBgMAAakEOdSIGQf8BIAZB/wFIG0EQdEGAgPwHcUEAIAZBAEobIAtBgMAAakEOdSIGQf8BIAZB/wFIG0EYdEEAIAZBAEobciAJQYDAAGpBDnUiBkH/ASAGQf8BSBtBCHRBgP4DcUEAIAZBAEobciAIQYDAAGpBDnUiBkH/ASAGQf8BSBtB/wFxQQAgBkEAShtyNgIAIA4gA2ohDiARQQFqIhEgBEcNAAsgDCACaiEMIA1BAWoiDSADRw0ACwsLIQACQEEAIAIgAyAEIAUgABAAIAJBACAEIAUgBiABEAALCw==",ot={name:"resize",fn:$,wasm_fn:nt,wasm_src:it};function at(t){const e=t||[];let r={js:e.indexOf("js")>=0,wasm:e.indexOf("wasm")>=0};M.call(this,r),this.features={js:r.js,wasm:r.wasm&&this.has_wasm()},this.use(V),this.use(ot)}A(at,M),at.prototype.resizeAndUnsharp=function(t,e){let r=this.resize(t,e);return t.unsharpAmount&&this.unsharp_mask(r,t.toWidth,t.toHeight,t.unsharpAmount,t.unsharpRadius,t.unsharpThreshold),r};var st=at;const ut=100;function ht(t,e){this.create=t,this.available=[],this.acquired={},this.lastId=1,this.timeoutId=0,this.idle=e||2e3}ht.prototype.acquire=function(){let t;return 0!==this.available.length?t=this.available.pop():(t=this.create(),t.id=this.lastId++,t.release=()=>this.release(t)),this.acquired[t.id]=t,t},ht.prototype.release=function(t){delete this.acquired[t.id],t.lastUsed=Date.now(),this.available.push(t),0===this.timeoutId&&(this.timeoutId=setTimeout(()=>this.gc(),ut))},ht.prototype.gc=function(){const t=Date.now();this.available=this.available.filter(e=>!(t-e.lastUsed>this.idle&&(e.destroy(),1))),this.timeoutId=0!==this.available.length?setTimeout(()=>this.gc(),ut):0};var ft=ht;function lt(t){return Object.prototype.toString.call(t)}var ct=function(t){let e=lt(t);return"[object HTMLCanvasElement]"===e||"[object OffscreenCanvas]"===e||"[object Canvas]"===e},gt=function(t){return"[object HTMLImageElement]"===lt(t)},dt=function(t){let e=0,r=[];function n(){e<t&&r.length&&(e++,r.shift()())}return function(t){return new Promise((i,o)=>{r.push(()=>{t().then(t=>{i(t),e--,n()},t=>{o(t),e--,n()})}),n()})}},pt=function(t){switch(t){case 0:return"pixelated";case 1:return"low";case 2:return"medium"}return"high"},_t=function(){return Promise.resolve().then(()=>{if("undefined"==typeof createImageBitmap||"undefined"==typeof document)return!1;let t=document.createElement("canvas");return t.width=100,t.height=100,createImageBitmap(t,0,0,100,100,{resizeWidth:10,resizeHeight:10,resizeQuality:"high"}).then(e=>{let r=10===e.width;return e.close(),t=null,r})}).catch(()=>!1)},At={isCanvas:ct,isImage:gt,limiter:dt,cib_quality_name:pt,cib_support:_t},Et=function(){const t=st;let e;onmessage=function(r){let n=r.data.opts;e||(e=new t(r.data.features));let i=e.resizeAndUnsharp(n);postMessage({result:i},[i.buffer])}};const yt=2;var mt=function(t,e,r,n,i,o){let a=(2*o+yt+1)/i;if(a>.5)return[[r,n]];let s=Math.ceil(Math.log(Math.min(r/t,n/e))/Math.log(a));if(s<=1)return[[r,n]];let u=[];for(let i=0;i<s;i++){let o=Math.round(Math.pow(Math.pow(t,s-i-1)*Math.pow(r,i+1),1/s)),a=Math.round(Math.pow(Math.pow(e,s-i-1)*Math.pow(n,i+1),1/s));u.push([o,a])}return u},vt=1e-5;function It(t){var e=Math.round(t);return Math.abs(t-e)<vt?e:Math.floor(t)}function wt(t){var e=Math.round(t);return Math.abs(t-e)<vt?e:Math.ceil(t)}var Tt=function(t){var e,r,n,i,o,a,s=t.toWidth/t.width,u=t.toHeight/t.height,h=It(t.srcTileSize*s)-2*t.destTileBorder,f=It(t.srcTileSize*u)-2*t.destTileBorder;if(h<1||f<1)throw new Error("Internal error in pica: target tile width/height is too small.");var l,c=[];for(i=0;i<t.toHeight;i+=f)for(n=0;n<t.toWidth;n+=h)(e=n-t.destTileBorder)<0&&(e=0),e+(o=n+h+t.destTileBorder-e)>=t.toWidth&&(o=t.toWidth-e),(r=i-t.destTileBorder)<0&&(r=0),r+(a=i+f+t.destTileBorder-r)>=t.toHeight&&(a=t.toHeight-r),l={toX:e,toY:r,toWidth:o,toHeight:a,toInnerX:n,toInnerY:i,toInnerWidth:h,toInnerHeight:f,offsetX:e/s-It(e/s),offsetY:r/u-It(r/u),scaleX:s,scaleY:u,x:It(e/s),y:It(r/u),width:wt(o/s),height:wt(a/u)},c.push(l);return c};const bt={};let xt=!1;try{"undefined"!=typeof navigator&&navigator.userAgent&&(xt=navigator.userAgent.indexOf("Safari")>=0)}catch(t){}let Ct=1;"undefined"!=typeof navigator&&(Ct=Math.min(navigator.hardwareConcurrency||1,4));const Bt={tile:1024,concurrency:Ct,features:["js","wasm","ww"],idle:2e3},Rt={quality:3,alpha:!1,unsharpAmount:0,unsharpRadius:0,unsharpThreshold:0};let St,Mt;function Ut(){return{value:f(Et),destroy:function(){if(this.value.terminate(),"undefined"!=typeof window){let t=window.URL||window.webkitURL||window.mozURL||window.msURL;t&&t.revokeObjectURL&&this.value.objectURL&&t.revokeObjectURL(this.value.objectURL)}}}}function Nt(t){if(!(this instanceof Nt))return new Nt(t);this.options=o({},Bt,t||{});let e="lk_"+this.options.concurrency;this.__limit=bt[e]||At.limiter(this.options.concurrency),bt[e]||(bt[e]=this.__limit),this.features={js:!1,wasm:!1,cib:!1,ww:!1},this.__workersPool=null,this.__requested_features=[],this.__mathlib=null}Nt.prototype.init=function(){if(this.__initPromise)return this.__initPromise;if(!1!==St&&!0!==St&&(St=!1,"undefined"!=typeof ImageData&&"undefined"!=typeof Uint8ClampedArray))try{new ImageData(new Uint8ClampedArray(400),10,10),St=!0}catch(t){}!1!==Mt&&!0!==Mt&&(Mt=!1,"undefined"!=typeof ImageBitmap&&(ImageBitmap.prototype&&ImageBitmap.prototype.close?Mt=!0:this.debug("ImageBitmap does not support .close(), disabled")));let t=this.options.features.slice();if(t.indexOf("all")>=0&&(t=["cib","wasm","js","ww"]),this.__requested_features=t,this.__mathlib=new st(t),t.indexOf("ww")>=0&&"undefined"!=typeof window&&"Worker"in window)try{f(function(){}).terminate(),this.features.ww=!0;let t="wp_"+JSON.stringify(this.options);bt[t]?this.__workersPool=bt[t]:(this.__workersPool=new ft(Ut,this.options.idle),bt[t]=this.__workersPool)}catch(t){}let e,r=this.__mathlib.init().then(t=>{o(this.features,t.features)});return e=Mt?At.cib_support().then(e=>{this.features.cib&&t.indexOf("cib")<0?this.debug("createImageBitmap() resize supported, but disabled by config"):t.indexOf("cib")>=0&&(this.features.cib=e)}):Promise.resolve(!1),this.__initPromise=Promise.all([r,e]).then(()=>this),this.__initPromise},Nt.prototype.resize=function(t,e,r){this.debug("Start resize...");let n=o({},Rt);if(isNaN(r)?r&&(n=o(n,r)):n=o(n,{quality:r}),n.toWidth=e.width,n.toHeight=e.height,n.width=t.naturalWidth||t.width,n.height=t.naturalHeight||t.height,0===e.width||0===e.height)return Promise.reject(new Error(`Invalid output size: ${e.width}x${e.height}`));n.unsharpRadius>2&&(n.unsharpRadius=2);let i=!1,a=null;n.cancelToken&&(a=n.cancelToken.then(t=>{throw i=!0,t},t=>{throw i=!0,t}));let s=Math.ceil(Math.max(3,2.5*n.unsharpRadius|0));return this.init().then(()=>{if(i)return a;if(this.features.cib){let r=e.getContext("2d",{alpha:Boolean(n.alpha)});return this.debug("Resize via createImageBitmap()"),createImageBitmap(t,{resizeWidth:n.toWidth,resizeHeight:n.toHeight,resizeQuality:At.cib_quality_name(n.quality)}).then(t=>{if(i)return a;if(!n.unsharpAmount)return r.drawImage(t,0,0),t.close(),r=null,this.debug("Finished!"),e;this.debug("Unsharp result");let o=document.createElement("canvas");o.width=n.toWidth,o.height=n.toHeight;let s=o.getContext("2d",{alpha:Boolean(n.alpha)});s.drawImage(t,0,0),t.close();let u=s.getImageData(0,0,n.toWidth,n.toHeight);return this.__mathlib.unsharp_mask(u.data,n.toWidth,n.toHeight,n.unsharpAmount,n.unsharpRadius,n.unsharpThreshold),r.putImageData(u,0,0),u=s=o=r=null,this.debug("Finished!"),e})}let r={};const u=t=>Promise.resolve().then(()=>this.features.ww?new Promise((e,r)=>{let n=this.__workersPool.acquire();a&&a.catch(t=>r(t)),n.value.onmessage=t=>{n.release(),t.data.err?r(t.data.err):e(t.data.result)},n.value.postMessage({opts:t,features:this.__requested_features,preload:{wasm_nodule:this.__mathlib.__}},[t.src.buffer])}):this.__mathlib.resizeAndUnsharp(t,r)),h=(t,e,r)=>{let n,o,h;const f=e=>this.__limit(()=>{if(i)return a;let s;if(At.isCanvas(t))this.debug("Get tile pixel data"),s=n.getImageData(e.x,e.y,e.width,e.height);else{this.debug("Draw tile imageBitmap/image to temporary canvas");let n=document.createElement("canvas");n.width=e.width,n.height=e.height;let i=n.getContext("2d",{alpha:Boolean(r.alpha)});i.globalCompositeOperation="copy",i.drawImage(o||t,e.x,e.y,e.width,e.height,0,0,e.width,e.height),this.debug("Get tile pixel data"),s=i.getImageData(0,0,e.width,e.height),i=n=null}let f={src:s.data,width:e.width,height:e.height,toWidth:e.toWidth,toHeight:e.toHeight,scaleX:e.scaleX,scaleY:e.scaleY,offsetX:e.offsetX,offsetY:e.offsetY,quality:r.quality,alpha:r.alpha,unsharpAmount:r.unsharpAmount,unsharpRadius:r.unsharpRadius,unsharpThreshold:r.unsharpThreshold};return this.debug("Invoke resize math"),Promise.resolve().then(()=>u(f)).then(t=>{if(i)return a;let r;if(s=null,this.debug("Convert raw rgba tile result to ImageData"),St)r=new ImageData(new Uint8ClampedArray(t),e.toWidth,e.toHeight);else if(r=h.createImageData(e.toWidth,e.toHeight),r.data.set)r.data.set(t);else for(let e=r.data.length-1;e>=0;e--)r.data[e]=t[e];return this.debug("Draw tile"),xt?h.putImageData(r,e.toX,e.toY,e.toInnerX-e.toX,e.toInnerY-e.toY,e.toInnerWidth+1e-5,e.toInnerHeight+1e-5):h.putImageData(r,e.toX,e.toY,e.toInnerX-e.toX,e.toInnerY-e.toY,e.toInnerWidth,e.toInnerHeight),null})});return Promise.resolve().then(()=>{if(h=e.getContext("2d",{alpha:Boolean(r.alpha)}),At.isCanvas(t))return n=t.getContext("2d",{alpha:Boolean(r.alpha)}),null;if(At.isImage(t))return Mt?(this.debug("Decode image via createImageBitmap"),createImageBitmap(t).then(t=>{o=t}).catch(t=>null)):null;throw new Error('".from" should be image or canvas')}).then(()=>{if(i)return a;this.debug("Calculate tiles");let t=Tt({width:r.width,height:r.height,srcTileSize:this.options.tile,toWidth:r.toWidth,toHeight:r.toHeight,destTileBorder:s}).map(t=>f(t));function n(){o&&(o.close(),o=null)}return this.debug("Process tiles"),Promise.all(t).then(()=>(this.debug("Finished!"),n(),e),t=>{throw n(),t})})},f=(t,e,r,n)=>{if(i)return a;let s,[u,l]=t.shift(),c=0===t.length;return n=o({},n,{toWidth:u,toHeight:l,quality:c?n.quality:Math.min(1,n.quality)}),c||(s=document.createElement("canvas"),s.width=u,s.height=l),h(e,c?r:s,n).then(()=>c?r:(n.width=u,n.height=l,f(t,s,r,n)))};let l=mt(n.width,n.height,n.toWidth,n.toHeight,this.options.tile,s);return f(l,t,e,n)})},Nt.prototype.resizeBuffer=function(t){const e=o({},Rt,t);return this.init().then(()=>this.__mathlib.resizeAndUnsharp(e))},Nt.prototype.toBlob=function(t,e,r){return e=e||"image/png",new Promise(n=>{if(t.toBlob)return void t.toBlob(t=>n(t),e,r);if(t.convertToBlob)return void n(t.convertToBlob({type:e,quality:r}));const i=atob(t.toDataURL(e,r).split(",")[1]),o=i.length,a=new Uint8Array(o);for(let t=0;t<o;t++)a[t]=i.charCodeAt(t);n(new Blob([a],{type:e}))})},Nt.prototype.debug=function(){};var Lt=Nt;function Dt(t){for(var e=new Array(t),r=0;r<t;++r)e[r]=r;return e}var Ot=Dt,Pt=function(t){return null!=t&&(Ft(t)||jt(t)||!!t._isBuffer)};function Ft(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function jt(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&Ft(t.slice(0,0))}var Vt="undefined"!=typeof Float64Array;function kt(t,e){return t[0]-e[0]}function Qt(){var t,e=this.stride,r=new Array(e.length);for(t=0;t<r.length;++t)r[t]=[Math.abs(e[t]),t];r.sort(kt);var n=new Array(r.length);for(t=0;t<n.length;++t)n[t]=r[t][1];return n}function Xt(t,e){var r=["View",e,"d",t].join("");e<0&&(r="View_Nil"+t);var n="generic"===t;if(-1===e){var i="function "+r+"(a){this.data=a;};var proto="+r+".prototype;proto.dtype='"+t+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+r+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+r+"(a){return new "+r+"(a);}";return new Function(i)()}if(0===e)return i="function "+r+"(a,d) {this.data = a;this.offset = d};var proto="+r+".prototype;proto.dtype='"+t+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+r+"_copy() {return new "+r+"(this.data,this.offset)};proto.pick=function "+r+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+r+"_get(){return "+(n?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+r+"_set(v){return "+(n?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+r+"(a,b,c,d){return new "+r+"(a,d)}",new Function("TrivialArray",i)(Ht[t][0]);i=["'use strict'"];var o=Ot(e),a=o.map(function(t){return"i"+t}),s="this.offset+"+o.map(function(t){return"this.stride["+t+"]*i"+t}).join("+"),u=o.map(function(t){return"b"+t}).join(","),h=o.map(function(t){return"c"+t}).join(",");i.push("function "+r+"(a,"+u+","+h+",d){this.data=a","this.shape=["+u+"]","this.stride=["+h+"]","this.offset=d|0}","var proto="+r+".prototype","proto.dtype='"+t+"'","proto.dimension="+e),i.push("Object.defineProperty(proto,'size',{get:function "+r+"_size(){return "+o.map(function(t){return"this.shape["+t+"]"}).join("*"),"}})"),1===e?i.push("proto.order=[0]"):(i.push("Object.defineProperty(proto,'order',{get:"),e<4?(i.push("function "+r+"_order(){"),2===e?i.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===e&&i.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):i.push("ORDER})")),i.push("proto.set=function "+r+"_set("+a.join(",")+",v){"),i.push(n?"return this.data.set("+s+",v)}":"return this.data["+s+"]=v}"),i.push("proto.get=function "+r+"_get("+a.join(",")+"){"),i.push(n?"return this.data.get("+s+")}":"return this.data["+s+"]}"),i.push("proto.index=function "+r+"_index(",a.join(),"){return "+s+"}"),i.push("proto.hi=function "+r+"_hi("+a.join(",")+"){return new "+r+"(this.data,"+o.map(function(t){return["(typeof i",t,"!=='number'||i",t,"<0)?this.shape[",t,"]:i",t,"|0"].join("")}).join(",")+","+o.map(function(t){return"this.stride["+t+"]"}).join(",")+",this.offset)}");var f=o.map(function(t){return"a"+t+"=this.shape["+t+"]"}),l=o.map(function(t){return"c"+t+"=this.stride["+t+"]"});i.push("proto.lo=function "+r+"_lo("+a.join(",")+"){var b=this.offset,d=0,"+f.join(",")+","+l.join(","));for(var c=0;c<e;++c)i.push("if(typeof i"+c+"==='number'&&i"+c+">=0){d=i"+c+"|0;b+=c"+c+"*d;a"+c+"-=d}");for(i.push("return new "+r+"(this.data,"+o.map(function(t){return"a"+t}).join(",")+","+o.map(function(t){return"c"+t}).join(",")+",b)}"),i.push("proto.step=function "+r+"_step("+a.join(",")+"){var "+o.map(function(t){return"a"+t+"=this.shape["+t+"]"}).join(",")+","+o.map(function(t){return"b"+t+"=this.stride["+t+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil"),c=0;c<e;++c)i.push("if(typeof i"+c+"==='number'){d=i"+c+"|0;if(d<0){c+=b"+c+"*(a"+c+"-1);a"+c+"=ceil(-a"+c+"/d)}else{a"+c+"=ceil(a"+c+"/d)}b"+c+"*=d}");i.push("return new "+r+"(this.data,"+o.map(function(t){return"a"+t}).join(",")+","+o.map(function(t){return"b"+t}).join(",")+",c)}");var g=new Array(e),d=new Array(e);for(c=0;c<e;++c)g[c]="a[i"+c+"]",d[c]="b[i"+c+"]";for(i.push("proto.transpose=function "+r+"_transpose("+a+"){"+a.map(function(t,e){return t+"=("+t+"===undefined?"+e+":"+t+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+r+"(this.data,"+g.join(",")+","+d.join(",")+",this.offset)}"),i.push("proto.pick=function "+r+"_pick("+a+"){var a=[],b=[],c=this.offset"),c=0;c<e;++c)i.push("if(typeof i"+c+"==='number'&&i"+c+">=0){c=(c+this.stride["+c+"]*i"+c+")|0}else{a.push(this.shape["+c+"]);b.push(this.stride["+c+"])}");return i.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),i.push("return function construct_"+r+"(data,shape,stride,offset){return new "+r+"(data,"+o.map(function(t){return"shape["+t+"]"}).join(",")+","+o.map(function(t){return"stride["+t+"]"}).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",i.join("\n"))(Ht[t],Qt)}function Gt(t){if(Pt(t))return"buffer";if(Vt)switch(Object.prototype.toString.call(t)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(t)?"array":"generic"}var Ht={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};function qt(t,e,r,n){if(void 0===t)return(0,Ht.array[0])([]);"number"==typeof t&&(t=[t]),void 0===e&&(e=[t.length]);var i=e.length;if(void 0===r){r=new Array(i);for(var o=i-1,a=1;o>=0;--o)r[o]=a,a*=e[o]}if(void 0===n)for(n=0,o=0;o<i;++o)r[o]<0&&(n-=(e[o]-1)*r[o]);for(var s=Gt(t),u=Ht[s];u.length<=i+1;)u.push(Xt(s,u.length-1));return(0,u[i+1])(t,e,r,n)}var Yt=qt;function Wt(t,e){for(var r=1,n=t.length,i=t[0],o=t[0],a=1;a<n;++a)if(o=i,e(i=t[a],o)){if(a===r){r++;continue}t[r++]=i}return t.length=r,t}function zt(t){for(var e=1,r=t.length,n=t[0],i=t[0],o=1;o<r;++o,i=n)if(i=n,(n=t[o])!==i){if(o===e){e++;continue}t[e++]=n}return t.length=e,t}function Kt(t,e,r){return 0===t.length?t:e?(r||t.sort(e),Wt(t,e)):(r||t.sort(),zt(t))}var Zt=Kt;function $t(t,e,r){var n,i,o=t.length,a=e.arrayArgs.length,s=e.indexArgs.length>0,u=[],h=[],f=0,l=0;for(n=0;n<o;++n)h.push(["i",n,"=0"].join(""));for(i=0;i<a;++i)for(n=0;n<o;++n)l=f,f=t[n],h.push(0===n?["d",i,"s",n,"=t",i,"p",f].join(""):["d",i,"s",n,"=(t",i,"p",f,"-s",l,"*t",i,"p",l,")"].join(""));for(h.length>0&&u.push("var "+h.join(",")),n=o-1;n>=0;--n)u.push(["for(i",n,"=0;i",n,"<s",f=t[n],";++i",n,"){"].join(""));for(u.push(r),n=0;n<o;++n){for(l=f,f=t[n],i=0;i<a;++i)u.push(["p",i,"+=d",i,"s",n].join(""));s&&(n>0&&u.push(["index[",l,"]-=s",l].join("")),u.push(["++index[",f,"]"].join(""))),u.push("}")}return u.join("\n")}function Jt(t,e,r,n){for(var i=e.length,o=r.arrayArgs.length,a=r.blockSize,s=r.indexArgs.length>0,u=[],h=0;h<o;++h)u.push(["var offset",h,"=p",h].join(""));for(h=t;h<i;++h)u.push(["for(var j"+h+"=SS[",e[h],"]|0;j",h,">0;){"].join("")),u.push(["if(j",h,"<",a,"){"].join("")),u.push(["s",e[h],"=j",h].join("")),u.push(["j",h,"=0"].join("")),u.push(["}else{s",e[h],"=",a].join("")),u.push(["j",h,"-=",a,"}"].join("")),s&&u.push(["index[",e[h],"]=j",h].join(""));for(h=0;h<o;++h){for(var f=["offset"+h],l=t;l<i;++l)f.push(["j",l,"*t",h,"p",e[l]].join(""));u.push(["p",h,"=(",f.join("+"),")"].join(""))}for(u.push($t(e,r,n)),h=t;h<i;++h)u.push("}");return u.join("\n")}function te(t){for(var e=0,r=t[0].length;e<r;){for(var n=1;n<t.length;++n)if(t[n][e]!==t[0][e])return e;++e}return e}function ee(t,e,r){for(var n=t.body,i=[],o=[],a=0;a<t.args.length;++a){var s=t.args[a];if(!(s.count<=0)){var u=new RegExp(s.name,"g"),h="",f=e.arrayArgs.indexOf(a);switch(e.argTypes[a]){case"offset":var l=e.offsetArgIndex.indexOf(a);f=e.offsetArgs[l].array,h="+q"+l;case"array":h="p"+f+h;var c="l"+a,g="a"+f;if(0===e.arrayBlockIndices[f])1===s.count?"generic"===r[f]?s.lvalue?(i.push(["var ",c,"=",g,".get(",h,")"].join("")),n=n.replace(u,c),o.push([g,".set(",h,",",c,")"].join(""))):n=n.replace(u,[g,".get(",h,")"].join("")):n=n.replace(u,[g,"[",h,"]"].join("")):"generic"===r[f]?(i.push(["var ",c,"=",g,".get(",h,")"].join("")),n=n.replace(u,c),s.lvalue&&o.push([g,".set(",h,",",c,")"].join(""))):(i.push(["var ",c,"=",g,"[",h,"]"].join("")),n=n.replace(u,c),s.lvalue&&o.push([g,"[",h,"]=",c].join("")));else{for(var d=[s.name],p=[h],_=0;_<Math.abs(e.arrayBlockIndices[f]);_++)d.push("\\s*\\[([^\\]]+)\\]"),p.push("$"+(_+1)+"*t"+f+"b"+_);if(u=new RegExp(d.join(""),"g"),h=p.join("+"),"generic"===r[f])throw new Error("cwise: Generic arrays not supported in combination with blocks!");n=n.replace(u,[g,"[",h,"]"].join(""))}break;case"scalar":n=n.replace(u,"Y"+e.scalarArgs.indexOf(a));break;case"index":n=n.replace(u,"index");break;case"shape":n=n.replace(u,"shape")}}}return[i.join("\n"),n,o.join("\n")].join("\n").trim()}function re(t){for(var e=new Array(t.length),r=!0,n=0;n<t.length;++n){var i=t[n],o=i.match(/\d+/);o=o?o[0]:"",e[n]=0===i.charAt(0)?"u"+i.charAt(1)+o:i.charAt(0)+o,n>0&&(r=r&&e[n]===e[n-1])}return r?e[0]:e.join("")}function ne(t,e){for(var r=e[1].length-Math.abs(t.arrayBlockIndices[0])|0,n=new Array(t.arrayArgs.length),i=new Array(t.arrayArgs.length),o=0;o<t.arrayArgs.length;++o)i[o]=e[2*o],n[o]=e[2*o+1];var a=[],s=[],u=[],h=[];for(o=0;o<t.arrayArgs.length;++o){t.arrayBlockIndices[o]<0?(s.push(0),u.push(r),a.push(r)):(s.push(t.arrayBlockIndices[o]),u.push(t.arrayBlockIndices[o]+r),a.push(0));for(var f=[],l=0;l<n[o].length;l++)s[o]<=n[o][l]&&n[o][l]<u[o]&&f.push(n[o][l]-s[o]);h.push(f)}var c=["SS"],g=["'use strict'"],d=[];for(l=0;l<r;++l)d.push(["s",l,"=SS[",l,"]"].join(""));for(o=0;o<t.arrayArgs.length;++o){for(c.push("a"+o),c.push("t"+o),c.push("p"+o),l=0;l<r;++l)d.push(["t",o,"p",l,"=t",o,"[",s[o]+l,"]"].join(""));for(l=0;l<Math.abs(t.arrayBlockIndices[o]);++l)d.push(["t",o,"b",l,"=t",o,"[",a[o]+l,"]"].join(""))}for(o=0;o<t.scalarArgs.length;++o)c.push("Y"+o);if(t.shapeArgs.length>0&&d.push("shape=SS.slice(0)"),t.indexArgs.length>0){var p=new Array(r);for(o=0;o<r;++o)p[o]="0";d.push(["index=[",p.join(","),"]"].join(""))}for(o=0;o<t.offsetArgs.length;++o){var _=t.offsetArgs[o],A=[];for(l=0;l<_.offset.length;++l)0!==_.offset[l]&&A.push(1===_.offset[l]?["t",_.array,"p",l].join(""):[_.offset[l],"*t",_.array,"p",l].join(""));d.push(0===A.length?"q"+o+"=0":["q",o,"=",A.join("+")].join(""))}var E=Zt([].concat(t.pre.thisVars).concat(t.body.thisVars).concat(t.post.thisVars));for((d=d.concat(E)).length>0&&g.push("var "+d.join(",")),o=0;o<t.arrayArgs.length;++o)g.push("p"+o+"|=0");t.pre.body.length>3&&g.push(ee(t.pre,t,i));var y=ee(t.body,t,i),m=te(h);g.push(m<r?Jt(m,h[0],t,y):$t(h[0],t,y)),t.post.body.length>3&&g.push(ee(t.post,t,i)),t.debug&&console.log("-----Generated cwise routine for ",e,":\n"+g.join("\n")+"\n----------");var v=[t.funcName||"unnamed","_cwise_loop_",n[0].join("s"),"m",m,re(i)].join("");return new Function(["function ",v,"(",c.join(","),"){",g.join("\n"),"} return ",v].join(""))()}var ie=ne;function oe(t){var e=["'use strict'","var CACHED={}"],r=[];e.push(["return function ",t.funcName+"_cwise_thunk","(",t.shimArgs.join(","),"){"].join(""));for(var n=[],i=[],o=[["array",t.arrayArgs[0],".shape.slice(",Math.max(0,t.arrayBlockIndices[0]),t.arrayBlockIndices[0]<0?","+t.arrayBlockIndices[0]+")":")"].join("")],a=[],s=[],u=0;u<t.arrayArgs.length;++u){var h=t.arrayArgs[u];r.push(["t",h,"=array",h,".dtype,","r",h,"=array",h,".order"].join("")),n.push("t"+h),n.push("r"+h),i.push("t"+h),i.push("r"+h+".join()"),o.push("array"+h+".data"),o.push("array"+h+".stride"),o.push("array"+h+".offset|0"),u>0&&(a.push("array"+t.arrayArgs[0]+".shape.length===array"+h+".shape.length+"+(Math.abs(t.arrayBlockIndices[0])-Math.abs(t.arrayBlockIndices[u]))),s.push("array"+t.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,t.arrayBlockIndices[0])+"]===array"+h+".shape[shapeIndex+"+Math.max(0,t.arrayBlockIndices[u])+"]"))}for(t.arrayArgs.length>1&&(e.push("if (!("+a.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),e.push("for(var shapeIndex=array"+t.arrayArgs[0]+".shape.length-"+Math.abs(t.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),e.push("if (!("+s.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),e.push("}")),u=0;u<t.scalarArgs.length;++u)o.push("scalar"+t.scalarArgs[u]);return r.push(["type=[",i.join(","),"].join()"].join("")),r.push("proc=CACHED[type]"),e.push("var "+r.join(",")),e.push(["if(!proc){","CACHED[type]=proc=compile([",n.join(","),"])}","return proc(",o.join(","),")}"].join("")),t.debug&&console.log("-----Generated thunk:\n"+e.join("\n")+"\n----------"),new Function("compile",e.join("\n"))(ie.bind(void 0,t))}var ae=oe;function se(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}function ue(t){var e=new se;e.pre=t.pre,e.body=t.body,e.post=t.post;var r=t.args.slice(0);e.argTypes=r;for(var n=0;n<r.length;++n){var i=r[n];if("array"===i||"object"==typeof i&&i.blockIndices){if(e.argTypes[n]="array",e.arrayArgs.push(n),e.arrayBlockIndices.push(i.blockIndices?i.blockIndices:0),e.shimArgs.push("array"+n),n<e.pre.args.length&&e.pre.args[n].count>0)throw new Error("cwise: pre() block may not reference array args");if(n<e.post.args.length&&e.post.args[n].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===i)e.scalarArgs.push(n),e.shimArgs.push("scalar"+n);else if("index"===i){if(e.indexArgs.push(n),n<e.pre.args.length&&e.pre.args[n].count>0)throw new Error("cwise: pre() block may not reference array index");if(n<e.body.args.length&&e.body.args[n].lvalue)throw new Error("cwise: body() block may not write to array index");if(n<e.post.args.length&&e.post.args[n].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===i){if(e.shapeArgs.push(n),n<e.pre.args.length&&e.pre.args[n].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(n<e.body.args.length&&e.body.args[n].lvalue)throw new Error("cwise: body() block may not write to array shape");if(n<e.post.args.length&&e.post.args[n].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof i||!i.offset)throw new Error("cwise: Unknown argument type "+r[n]);e.argTypes[n]="offset",e.offsetArgs.push({array:i.array,offset:i.offset}),e.offsetArgIndex.push(n)}}if(e.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(e.pre.args.length>r.length)throw new Error("cwise: Too many arguments in pre() block");if(e.body.args.length>r.length)throw new Error("cwise: Too many arguments in body() block");if(e.post.args.length>r.length)throw new Error("cwise: Too many arguments in post() block");return e.debug=!!t.printCode||!!t.debug,e.funcName=t.funcName||"cwise",e.blockSize=t.blockSize||64,ae(e)}var he=ue,fe=g(function(t,e){var r={body:"",args:[],thisVars:[],localVars:[]};function n(t){if(!t)return r;for(var e=0;e<t.args.length;++e){var n=t.args[e];t.args[e]=0===e?{name:n,lvalue:!0,rvalue:!!t.rvalue,count:t.count||1}:{name:n,lvalue:!1,rvalue:!0,count:1}}return t.thisVars||(t.thisVars=[]),t.localVars||(t.localVars=[]),t}function i(t){for(var e=[],r=0;r<t.args.length;++r)e.push("a"+r);return new Function("P",["return function ",t.funcName,"_ndarrayops(",e.join(","),") {P(",e.join(","),");return a0}"].join(""))(function(t){return he({args:t.args,pre:n(t.pre),body:n(t.body),post:n(t.proc),funcName:t.funcName})}(t))}var o={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var t in o){var r=o[t];e[t]=i({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:t}),e[t+"eq"]=i({args:["array","array"],body:{args:["a","b"],body:"a"+r+"=b"},rvalue:!0,funcName:t+"eq"}),e[t+"s"]=i({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:t+"s"}),e[t+"seq"]=i({args:["array","scalar"],body:{args:["a","s"],body:"a"+r+"=s"},rvalue:!0,funcName:t+"seq"})}}();var a={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var t in a){var r=a[t];e[t]=i({args:["array","array"],body:{args:["a","b"],body:"a="+r+"b"},funcName:t}),e[t+"eq"]=i({args:["array"],body:{args:["a"],body:"a="+r+"a"},rvalue:!0,count:2,funcName:t+"eq"})}}();var s={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var t in s){var r=s[t];e[t]=i({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+r+"c"},funcName:t}),e[t+"s"]=i({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+r+"s"},funcName:t+"s"}),e[t+"eq"]=i({args:["array","array"],body:{args:["a","b"],body:"a=a"+r+"b"},rvalue:!0,count:2,funcName:t+"eq"}),e[t+"seq"]=i({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+r+"s"},rvalue:!0,count:2,funcName:t+"seq"})}}();var u=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var t=0;t<u.length;++t){var r=u[t];e[r]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:r}),e[r+"eq"]=i({args:["array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"eq"})}}();var h=["max","min","atan2","pow"];!function(){for(var t=0;t<h.length;++t){var r=h[t];e[r]=i({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r}),e[r+"s"]=i({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:r+"s"}),e[r+"eq"]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"eq"}),e[r+"seq"]=i({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"seq"})}}();var f=["atan2","pow"];!function(){for(var t=0;t<f.length;++t){var r=f[t];e[r+"op"]=i({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"op"}),e[r+"ops"]=i({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:r+"ops"}),e[r+"opeq"]=i({args:["array","array"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"opeq"}),e[r+"opseq"]=i({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+r,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:r+"opseq"})}}(),e.any=he({args:["array"],pre:r,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),e.all=he({args:["array"],pre:r,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),e.sum=he({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),e.prod=he({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),e.norm2squared=he({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),e.norm2=he({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),e.norminf=he({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),e.norm1=he({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),e.sup=he({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),e.inf=he({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),e.argmin=he({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),e.argmax=he({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),e.random=i({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),e.assign=i({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),e.assigns=i({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),e.equals=he({args:["array","array"],pre:r,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})}),le=32,ce=le,ge=2147483647,de=-1<<le-1,pe=function(t){return(t>0)-(t<0)},_e=function(t){var e=t>>le-1;return(t^e)-e},Ae=function(t,e){return e^(t^e)&-(t<e)},Ee=function(t,e){return t^(t^e)&-(t<e)},ye=function(t){return!(t&t-1||!t)},me=function(t){var e,r;return e=(t>65535)<<4,e|=r=((t>>>=e)>255)<<3,e|=r=((t>>>=r)>15)<<2,(e|=r=((t>>>=r)>3)<<1)|(t>>>=r)>>1},ve=function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},Ie=function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24};function we(t){var e=32;return(t&=-t)&&e--,65535&t&&(e-=16),16711935&t&&(e-=8),252645135&t&&(e-=4),858993459&t&&(e-=2),1431655765&t&&(e-=1),e}var Te=we,be=function(t){return t+=0===t,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,1+((t|=t>>>8)|t>>>16)},xe=function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},Ce=function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1},Be=new Array(256);!function(t){for(var e=0;e<256;++e){var r=e,n=e,i=7;for(r>>>=1;r;r>>>=1)n<<=1,n|=1&r,--i;t[e]=n<<i&255}}(Be);var Re=function(t){return Be[255&t]<<24|Be[t>>>8&255]<<16|Be[t>>>16&255]<<8|Be[t>>>24&255]},Se=function(t,e){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))<<1},Me=function(t,e){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>e&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16},Ue=function(t,e,r){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2))<<1)|(r=1227133513&((r=3272356035&((r=251719695&((r=4278190335&((r&=1023)|r<<16))|r<<8))|r<<4))|r<<2))<<2},Ne=function(t,e){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>e&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22},Le=function(t){var e=t|t-1;return e+1|(~e&-~e)-1>>>we(t)+1},De={INT_BITS:ce,INT_MAX:ge,INT_MIN:de,sign:pe,abs:_e,min:Ae,max:Ee,isPow2:ye,log2:me,log10:ve,popCount:Ie,countTrailingZeros:Te,nextPow2:be,prevPow2:xe,parity:Ce,reverse:Re,interleave2:Se,deinterleave2:Me,interleave3:Ue,deinterleave3:Ne,nextCombination:Le};function Oe(t,e,r){var n=0|t[r];if(n<=0)return[];var i,o=new Array(n);if(r===t.length-1)for(i=0;i<n;++i)o[i]=e;else for(i=0;i<n;++i)o[i]=Oe(t,e,r+1);return o}function Pe(t,e){var r,n;for(r=new Array(t),n=0;n<t;++n)r[n]=e;return r}function Fe(t,e){switch(void 0===e&&(e=0),typeof t){case"number":if(t>0)return Pe(0|t,e);break;case"object":if("number"==typeof t.length)return Oe(t,e,0)}return[]}for(var je=Fe,Ve=Ke,ke=$e,Qe=er,Xe=[],Ge=[],He="undefined"!=typeof Uint8Array?Uint8Array:Array,qe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ye=0,We=qe.length;Ye<We;++Ye)Xe[Ye]=qe[Ye],Ge[qe.charCodeAt(Ye)]=Ye;function ze(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function Ke(t){var e=ze(t),r=e[1];return 3*(e[0]+r)/4-r}function Ze(t,e,r){return 3*(e+r)/4-r}function $e(t){var e,r,n=ze(t),i=n[0],o=n[1],a=new He(Ze(0,i,o)),s=0,u=o>0?i-4:i;for(r=0;r<u;r+=4)e=Ge[t.charCodeAt(r)]<<18|Ge[t.charCodeAt(r+1)]<<12|Ge[t.charCodeAt(r+2)]<<6|Ge[t.charCodeAt(r+3)],a[s++]=e>>16&255,a[s++]=e>>8&255,a[s++]=255&e;return 2===o&&(e=Ge[t.charCodeAt(r)]<<2|Ge[t.charCodeAt(r+1)]>>4,a[s++]=255&e),1===o&&(e=Ge[t.charCodeAt(r)]<<10|Ge[t.charCodeAt(r+1)]<<4|Ge[t.charCodeAt(r+2)]>>2,a[s++]=e>>8&255,a[s++]=255&e),a}function Je(t){return Xe[t>>18&63]+Xe[t>>12&63]+Xe[t>>6&63]+Xe[63&t]}function tr(t,e,r){for(var n=[],i=e;i<r;i+=3)n.push(Je((t[i]<<16&16711680)+(t[i+1]<<8&65280)+(255&t[i+2])));return n.join("")}function er(t){for(var e,r=t.length,n=r%3,i=[],o=0,a=r-n;o<a;o+=16383)i.push(tr(t,o,o+16383>a?a:o+16383));return 1===n?i.push(Xe[(e=t[r-1])>>2]+Xe[e<<4&63]+"=="):2===n&&i.push(Xe[(e=(t[r-2]<<8)+t[r-1])>>10]+Xe[e>>4&63]+Xe[e<<2&63]+"="),i.join("")}Ge["-".charCodeAt(0)]=62,Ge["_".charCodeAt(0)]=63;var rr={byteLength:Ve,toByteArray:ke,fromByteArray:Qe},nr=function(t,e,r,n,i){var o,a,s=8*i-n-1,u=(1<<s)-1,h=u>>1,f=-7,l=r?i-1:0,c=r?-1:1,g=t[e+l];for(l+=c,o=g&(1<<-f)-1,g>>=-f,f+=s;f>0;o=256*o+t[e+l],l+=c,f-=8);for(a=o&(1<<-f)-1,o>>=-f,f+=n;f>0;a=256*a+t[e+l],l+=c,f-=8);if(0===o)o=1-h;else{if(o===u)return a?NaN:Infinity*(g?-1:1);a+=Math.pow(2,n),o-=h}return(g?-1:1)*a*Math.pow(2,o-n)},ir=function(t,e,r,n,i,o){var a,s,u,h=8*o-i-1,f=(1<<h)-1,l=f>>1,c=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,g=n?0:o-1,d=n?1:-1,p=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||Infinity===e?(s=isNaN(e)?1:0,a=f):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),(e+=a+l>=1?c/u:c*Math.pow(2,1-l))*u>=2&&(a++,u/=2),a+l>=f?(s=0,a=f):a+l>=1?(s=(e*u-1)*Math.pow(2,i),a+=l):(s=e*Math.pow(2,l-1)*Math.pow(2,i),a=0));i>=8;t[r+g]=255&s,g+=d,s/=256,i-=8);for(a=a<<i|s,h+=i;h>0;t[r+g]=255&a,g+=d,a/=256,h-=8);t[r+g-d]|=128*p},or={read:nr,write:ir},ar=g(function(t,e){const r="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function n(t){if(t>2147483647)throw new RangeError('The value "'+t+'" is invalid for option "size"');const e=new Uint8Array(t);return Object.setPrototypeOf(e,i.prototype),e}function i(t,e,r){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return s(t)}return o(t,e,r)}function o(t,e,r){if("string"==typeof t)return function(t,e){if("string"==typeof e&&""!==e||(e="utf8"),!i.isEncoding(e))throw new TypeError("Unknown encoding: "+e);const r=0|l(t,e);let o=n(r);const a=o.write(t,e);return a!==r&&(o=o.slice(0,a)),o}(t,e);if(ArrayBuffer.isView(t))return function(t){if(G(t,Uint8Array)){const e=new Uint8Array(t);return h(e.buffer,e.byteOffset,e.byteLength)}return u(t)}(t);if(null==t)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(G(t,ArrayBuffer)||t&&G(t.buffer,ArrayBuffer))return h(t,e,r);if("undefined"!=typeof SharedArrayBuffer&&(G(t,SharedArrayBuffer)||t&&G(t.buffer,SharedArrayBuffer)))return h(t,e,r);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');const o=t.valueOf&&t.valueOf();if(null!=o&&o!==t)return i.from(o,e,r);const a=function(t){if(i.isBuffer(t)){const e=0|f(t.length),r=n(e);return 0===r.length||t.copy(r,0,0,e),r}return void 0!==t.length?"number"!=typeof t.length||H(t.length)?n(0):u(t):"Buffer"===t.type&&Array.isArray(t.data)?u(t.data):void 0}(t);if(a)return a;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return i.from(t[Symbol.toPrimitive]("string"),e,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function a(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function s(t){return a(t),n(t<0?0:0|f(t))}function u(t){const e=t.length<0?0:0|f(t.length),r=n(e);for(let n=0;n<e;n+=1)r[n]=255&t[n];return r}function h(t,e,r){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw new RangeError('"length" is outside of buffer bounds');let n;return n=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r),Object.setPrototypeOf(n,i.prototype),n}function f(t){if(t>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647..toString(16)+" bytes");return 0|t}function l(t,e){if(i.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||G(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);const r=t.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;let o=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return k(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return Q(t).length;default:if(o)return n?-1:k(t).length;e=(""+e).toLowerCase(),o=!0}}function c(t,e,r){let n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return b(this,e,r);case"utf8":case"utf-8":return I(this,e,r);case"ascii":return w(this,e,r);case"latin1":case"binary":return T(this,e,r);case"base64":return v(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function g(t,e,r){const n=t[e];t[e]=t[r],t[r]=n}function d(t,e,r,n,o){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),H(r=+r)&&(r=o?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(o)return-1;r=t.length-1}else if(r<0){if(!o)return-1;r=0}if("string"==typeof e&&(e=i.from(e,n)),i.isBuffer(e))return 0===e.length?-1:p(t,e,r,n,o);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):p(t,[e],r,n,o);throw new TypeError("val must be string, number or Buffer")}function p(t,e,r,n,i){let o,a=1,s=t.length,u=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;a=2,s/=2,u/=2,r/=2}function h(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(i){let n=-1;for(o=r;o<s;o++)if(h(t,o)===h(e,-1===n?0:o-n)){if(-1===n&&(n=o),o-n+1===u)return n*a}else-1!==n&&(o-=o-n),n=-1}else for(r+u>s&&(r=s-u),o=r;o>=0;o--){let r=!0;for(let n=0;n<u;n++)if(h(t,o+n)!==h(e,n)){r=!1;break}if(r)return o}return-1}function _(t,e,r,n){r=Number(r)||0;const i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;const o=e.length;let a;for(n>o/2&&(n=o/2),a=0;a<n;++a){const n=parseInt(e.substr(2*a,2),16);if(H(n))return a;t[r+a]=n}return a}function A(t,e,r,n){return X(k(e,t.length-r),t,r,n)}function E(t,e,r,n){return X(function(t){const e=[];for(let r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function y(t,e,r,n){return X(Q(e),t,r,n)}function m(t,e,r,n){return X(function(t,e){let r,n,i;const o=[];for(let a=0;a<t.length&&!((e-=2)<0);++a)r=t.charCodeAt(a),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(e,t.length-r),t,r,n)}function v(t,e,r){return rr.fromByteArray(0===e&&r===t.length?t:t.slice(e,r))}function I(t,e,r){r=Math.min(t.length,r);const n=[];let i=e;for(;i<r;){const e=t[i];let o=null,a=e>239?4:e>223?3:e>191?2:1;if(i+a<=r){let r,n,s,u;switch(a){case 1:e<128&&(o=e);break;case 2:r=t[i+1],128==(192&r)&&(u=(31&e)<<6|63&r,u>127&&(o=u));break;case 3:r=t[i+1],n=t[i+2],128==(192&r)&&128==(192&n)&&(u=(15&e)<<12|(63&r)<<6|63&n,u>2047&&(u<55296||u>57343)&&(o=u));break;case 4:r=t[i+1],n=t[i+2],s=t[i+3],128==(192&r)&&128==(192&n)&&128==(192&s)&&(u=(15&e)<<18|(63&r)<<12|(63&n)<<6|63&s,u>65535&&u<1114112&&(o=u))}}null===o?(o=65533,a=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|1023&o),n.push(o),i+=a}return function(t){const e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);let r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=4096));return r}(n)}function w(t,e,r){let n="";r=Math.min(t.length,r);for(let i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function T(t,e,r){let n="";r=Math.min(t.length,r);for(let i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function b(t,e,r){const n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);let i="";for(let n=e;n<r;++n)i+=q[t[n]];return i}function x(t,e,r){const n=t.slice(e,r);let i="";for(let t=0;t<n.length-1;t+=2)i+=String.fromCharCode(n[t]+256*n[t+1]);return i}function C(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function B(t,e,r,n,o,a){if(!i.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>o||e<a)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function R(t,e,r,n,i){P(e,n,i,t,r,7);let o=Number(e&BigInt(4294967295));t[r++]=o,o>>=8,t[r++]=o,o>>=8,t[r++]=o,o>>=8,t[r++]=o;let a=Number(e>>BigInt(32)&BigInt(4294967295));return t[r++]=a,a>>=8,t[r++]=a,a>>=8,t[r++]=a,a>>=8,t[r++]=a,r}function S(t,e,r,n,i){P(e,n,i,t,r,7);let o=Number(e&BigInt(4294967295));t[r+7]=o,o>>=8,t[r+6]=o,o>>=8,t[r+5]=o,o>>=8,t[r+4]=o;let a=Number(e>>BigInt(32)&BigInt(4294967295));return t[r+3]=a,a>>=8,t[r+2]=a,a>>=8,t[r+1]=a,a>>=8,t[r]=a,r+8}function M(t,e,r,n,i,o){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function U(t,e,r,n,i){return e=+e,r>>>=0,i||M(t,0,r,4),or.write(t,e,r,n,23,4),r+4}function N(t,e,r,n,i){return e=+e,r>>>=0,i||M(t,0,r,8),or.write(t,e,r,n,52,8),r+8}e.Buffer=i,e.SlowBuffer=function(t){return+t!=t&&(t=0),i.alloc(+t)},e.INSPECT_MAX_BYTES=50,e.kMaxLength=2147483647,(i.TYPED_ARRAY_SUPPORT=function(){try{const t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(i.prototype,"parent",{enumerable:!0,get:function(){if(i.isBuffer(this))return this.buffer}}),Object.defineProperty(i.prototype,"offset",{enumerable:!0,get:function(){if(i.isBuffer(this))return this.byteOffset}}),i.poolSize=8192,i.from=function(t,e,r){return o(t,e,r)},Object.setPrototypeOf(i.prototype,Uint8Array.prototype),Object.setPrototypeOf(i,Uint8Array),i.alloc=function(t,e,r){return function(t,e,r){return a(t),t<=0?n(t):void 0!==e?"string"==typeof r?n(t).fill(e,r):n(t).fill(e):n(t)}(t,e,r)},i.allocUnsafe=function(t){return s(t)},i.allocUnsafeSlow=function(t){return s(t)},i.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==i.prototype},i.compare=function(t,e){if(G(t,Uint8Array)&&(t=i.from(t,t.offset,t.byteLength)),G(e,Uint8Array)&&(e=i.from(e,e.offset,e.byteLength)),!i.isBuffer(t)||!i.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;let r=t.length,n=e.length;for(let i=0,o=Math.min(r,n);i<o;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},i.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},i.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return i.alloc(0);let r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;const n=i.allocUnsafe(e);let o=0;for(r=0;r<t.length;++r){let e=t[r];if(G(e,Uint8Array))o+e.length>n.length?(i.isBuffer(e)||(e=i.from(e)),e.copy(n,o)):Uint8Array.prototype.set.call(n,e,o);else{if(!i.isBuffer(e))throw new TypeError('"list" argument must be an Array of Buffers');e.copy(n,o)}o+=e.length}return n},i.byteLength=l,i.prototype._isBuffer=!0,i.prototype.swap16=function(){const t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)g(this,e,e+1);return this},i.prototype.swap32=function(){const t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)g(this,e,e+3),g(this,e+1,e+2);return this},i.prototype.swap64=function(){const t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)g(this,e,e+7),g(this,e+1,e+6),g(this,e+2,e+5),g(this,e+3,e+4);return this},i.prototype.toLocaleString=i.prototype.toString=function(){const t=this.length;return 0===t?"":0===arguments.length?I(this,0,t):c.apply(this,arguments)},i.prototype.equals=function(t){if(!i.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===i.compare(this,t)},i.prototype.inspect=function(){let t="";const r=e.INSPECT_MAX_BYTES;return t=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(t+=" ... "),"<Buffer "+t+">"},r&&(i.prototype[r]=i.prototype.inspect),i.prototype.compare=function(t,e,r,n,o){if(G(t,Uint8Array)&&(t=i.from(t,t.offset,t.byteLength)),!i.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===o&&(o=this.length),e<0||r>t.length||n<0||o>this.length)throw new RangeError("out of range index");if(n>=o&&e>=r)return 0;if(n>=o)return-1;if(e>=r)return 1;if(this===t)return 0;let a=(o>>>=0)-(n>>>=0),s=(r>>>=0)-(e>>>=0);const u=Math.min(a,s),h=this.slice(n,o),f=t.slice(e,r);for(let t=0;t<u;++t)if(h[t]!==f[t]){a=h[t],s=f[t];break}return a<s?-1:s<a?1:0},i.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},i.prototype.indexOf=function(t,e,r){return d(this,t,e,r,!0)},i.prototype.lastIndexOf=function(t,e,r){return d(this,t,e,r,!1)},i.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}const i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");let o=!1;for(;;)switch(n){case"hex":return _(this,t,e,r);case"utf8":case"utf-8":return A(this,t,e,r);case"ascii":case"latin1":case"binary":return E(this,t,e,r);case"base64":return y(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return m(this,t,e,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},i.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},i.prototype.slice=function(t,e){const r=this.length;(t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t);const n=this.subarray(t,e);return Object.setPrototypeOf(n,i.prototype),n},i.prototype.readUintLE=i.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||C(t,e,this.length);let n=this[t],i=1,o=0;for(;++o<e&&(i*=256);)n+=this[t+o]*i;return n},i.prototype.readUintBE=i.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||C(t,e,this.length);let n=this[t+--e],i=1;for(;e>0&&(i*=256);)n+=this[t+--e]*i;return n},i.prototype.readUint8=i.prototype.readUInt8=function(t,e){return t>>>=0,e||C(t,1,this.length),this[t]},i.prototype.readUint16LE=i.prototype.readUInt16LE=function(t,e){return t>>>=0,e||C(t,2,this.length),this[t]|this[t+1]<<8},i.prototype.readUint16BE=i.prototype.readUInt16BE=function(t,e){return t>>>=0,e||C(t,2,this.length),this[t]<<8|this[t+1]},i.prototype.readUint32LE=i.prototype.readUInt32LE=function(t,e){return t>>>=0,e||C(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},i.prototype.readUint32BE=i.prototype.readUInt32BE=function(t,e){return t>>>=0,e||C(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},i.prototype.readBigUInt64LE=Y(function(t){F(t>>>=0,"offset");const e=this[t],r=this[t+7];void 0!==e&&void 0!==r||j(t,this.length-8);const n=e+256*this[++t]+65536*this[++t]+this[++t]*2**24,i=this[++t]+256*this[++t]+65536*this[++t]+r*2**24;return BigInt(n)+(BigInt(i)<<BigInt(32))}),i.prototype.readBigUInt64BE=Y(function(t){F(t>>>=0,"offset");const e=this[t],r=this[t+7];void 0!==e&&void 0!==r||j(t,this.length-8);const n=e*2**24+65536*this[++t]+256*this[++t]+this[++t],i=this[++t]*2**24+65536*this[++t]+256*this[++t]+r;return(BigInt(n)<<BigInt(32))+BigInt(i)}),i.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||C(t,e,this.length);let n=this[t],i=1,o=0;for(;++o<e&&(i*=256);)n+=this[t+o]*i;return i*=128,n>=i&&(n-=Math.pow(2,8*e)),n},i.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||C(t,e,this.length);let n=e,i=1,o=this[t+--n];for(;n>0&&(i*=256);)o+=this[t+--n]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*e)),o},i.prototype.readInt8=function(t,e){return t>>>=0,e||C(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},i.prototype.readInt16LE=function(t,e){t>>>=0,e||C(t,2,this.length);const r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},i.prototype.readInt16BE=function(t,e){t>>>=0,e||C(t,2,this.length);const r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},i.prototype.readInt32LE=function(t,e){return t>>>=0,e||C(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},i.prototype.readInt32BE=function(t,e){return t>>>=0,e||C(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},i.prototype.readBigInt64LE=Y(function(t){F(t>>>=0,"offset");const e=this[t],r=this[t+7];return void 0!==e&&void 0!==r||j(t,this.length-8),(BigInt(this[t+4]+256*this[t+5]+65536*this[t+6]+(r<<24))<<BigInt(32))+BigInt(e+256*this[++t]+65536*this[++t]+this[++t]*2**24)}),i.prototype.readBigInt64BE=Y(function(t){F(t>>>=0,"offset");const e=this[t],r=this[t+7];void 0!==e&&void 0!==r||j(t,this.length-8);const n=(e<<24)+65536*this[++t]+256*this[++t]+this[++t];return(BigInt(n)<<BigInt(32))+BigInt(this[++t]*2**24+65536*this[++t]+256*this[++t]+r)}),i.prototype.readFloatLE=function(t,e){return t>>>=0,e||C(t,4,this.length),or.read(this,t,!0,23,4)},i.prototype.readFloatBE=function(t,e){return t>>>=0,e||C(t,4,this.length),or.read(this,t,!1,23,4)},i.prototype.readDoubleLE=function(t,e){return t>>>=0,e||C(t,8,this.length),or.read(this,t,!0,52,8)},i.prototype.readDoubleBE=function(t,e){return t>>>=0,e||C(t,8,this.length),or.read(this,t,!1,52,8)},i.prototype.writeUintLE=i.prototype.writeUIntLE=function(t,e,r,n){t=+t,e>>>=0,r>>>=0,n||B(this,t,e,r,Math.pow(2,8*r)-1,0);let i=1,o=0;for(this[e]=255&t;++o<r&&(i*=256);)this[e+o]=t/i&255;return e+r},i.prototype.writeUintBE=i.prototype.writeUIntBE=function(t,e,r,n){t=+t,e>>>=0,r>>>=0,n||B(this,t,e,r,Math.pow(2,8*r)-1,0);let i=r-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+r},i.prototype.writeUint8=i.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||B(this,t,e,1,255,0),this[e]=255&t,e+1},i.prototype.writeUint16LE=i.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||B(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},i.prototype.writeUint16BE=i.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||B(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},i.prototype.writeUint32LE=i.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||B(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},i.prototype.writeUint32BE=i.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||B(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},i.prototype.writeBigUInt64LE=Y(function(t,e=0){return R(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))}),i.prototype.writeBigUInt64BE=Y(function(t,e=0){return S(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))}),i.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e>>>=0,!n){const n=Math.pow(2,8*r-1);B(this,t,e,r,n-1,-n)}let i=0,o=1,a=0;for(this[e]=255&t;++i<r&&(o*=256);)t<0&&0===a&&0!==this[e+i-1]&&(a=1),this[e+i]=(t/o>>0)-a&255;return e+r},i.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e>>>=0,!n){const n=Math.pow(2,8*r-1);B(this,t,e,r,n-1,-n)}let i=r-1,o=1,a=0;for(this[e+i]=255&t;--i>=0&&(o*=256);)t<0&&0===a&&0!==this[e+i+1]&&(a=1),this[e+i]=(t/o>>0)-a&255;return e+r},i.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||B(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},i.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||B(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},i.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||B(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},i.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||B(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},i.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||B(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},i.prototype.writeBigInt64LE=Y(function(t,e=0){return R(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),i.prototype.writeBigInt64BE=Y(function(t,e=0){return S(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),i.prototype.writeFloatLE=function(t,e,r){return U(this,t,e,!0,r)},i.prototype.writeFloatBE=function(t,e,r){return U(this,t,e,!1,r)},i.prototype.writeDoubleLE=function(t,e,r){return N(this,t,e,!0,r)},i.prototype.writeDoubleBE=function(t,e,r){return N(this,t,e,!1,r)},i.prototype.copy=function(t,e,r,n){if(!i.isBuffer(t))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);const o=n-r;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,r,n):Uint8Array.prototype.set.call(t,this.subarray(r,n),e),o},i.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!i.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===t.length){const e=t.charCodeAt(0);("utf8"===n&&e<128||"latin1"===n)&&(t=e)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;let o;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(o=e;o<r;++o)this[o]=t;else{const a=i.isBuffer(t)?t:i.from(t,n),s=a.length;if(0===s)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(o=0;o<r-e;++o)this[o+e]=a[o%s]}return this};const L={};function D(t,e,r){L[t]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${t}]`,delete this.name}get code(){return t}set code(t){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:t,writable:!0})}toString(){return`${this.name} [${t}]: ${this.message}`}}}function O(t){let e="",r=t.length;const n="-"===t[0]?1:0;for(;r>=n+4;r-=3)e=`_${t.slice(r-3,r)}${e}`;return`${t.slice(0,r)}${e}`}function P(t,e,r,n,i,o){if(t>r||t<e){const n="bigint"==typeof e?"n":"";let i;throw i=o>3?0===e||e===BigInt(0)?`>= 0${n} and < 2${n} ** ${8*(o+1)}${n}`:`>= -(2${n} ** ${8*(o+1)-1}${n}) and < 2 ** ${8*(o+1)-1}${n}`:`>= ${e}${n} and <= ${r}${n}`,new L.ERR_OUT_OF_RANGE("value",i,t)}!function(t,e,r){F(e,"offset"),void 0!==t[e]&&void 0!==t[e+r]||j(e,t.length-(r+1))}(n,i,o)}function F(t,e){if("number"!=typeof t)throw new L.ERR_INVALID_ARG_TYPE(e,"number",t)}function j(t,e,r){if(Math.floor(t)!==t)throw F(t,r),new L.ERR_OUT_OF_RANGE(r||"offset","an integer",t);if(e<0)throw new L.ERR_BUFFER_OUT_OF_BOUNDS;throw new L.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= ${e}`,t)}D("ERR_BUFFER_OUT_OF_BOUNDS",function(t){return t?t+" is outside of buffer bounds":"Attempt to access memory outside buffer bounds"},RangeError),D("ERR_INVALID_ARG_TYPE",function(t,e){return`The "${t}" argument must be of type number. Received type ${typeof e}`},TypeError),D("ERR_OUT_OF_RANGE",function(t,e,r){let n=`The value of "${t}" is out of range.`,i=r;return Number.isInteger(r)&&Math.abs(r)>2**32?i=O(String(r)):"bigint"==typeof r&&(i=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(i=O(i)),i+="n"),n+=` It must be ${e}. Received ${i}`,n},RangeError);const V=/[^+/0-9A-Za-z-_]/g;function k(t,e){let r;e=e||Infinity;const n=t.length;let i=null;const o=[];for(let a=0;a<n;++a){if(r=t.charCodeAt(a),r>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(a+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function Q(t){return rr.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(V,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function X(t,e,r,n){let i;for(i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}function G(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function H(t){return t!=t}const q=function(){const t=new Array(256);for(let e=0;e<16;++e){const r=16*e;for(let n=0;n<16;++n)t[r+n]="0123456789abcdef"[e]+"0123456789abcdef"[n]}return t}();function Y(t){return"undefined"==typeof BigInt?W:t}function W(){throw new Error("BigInt not supported")}}),sr=g(function(t,e){var r=ar.Buffer;l.__TYPEDARRAY_POOL||(l.__TYPEDARRAY_POOL={UINT8:je([32,0]),UINT16:je([32,0]),UINT32:je([32,0]),BIGUINT64:je([32,0]),INT8:je([32,0]),INT16:je([32,0]),INT32:je([32,0]),BIGINT64:je([32,0]),FLOAT:je([32,0]),DOUBLE:je([32,0]),DATA:je([32,0]),UINT8C:je([32,0]),BUFFER:je([32,0])});var n="undefined"!=typeof Uint8ClampedArray,i="undefined"!=typeof BigUint64Array,o="undefined"!=typeof BigInt64Array,a=l.__TYPEDARRAY_POOL;a.UINT8C||(a.UINT8C=je([32,0])),a.BIGUINT64||(a.BIGUINT64=je([32,0])),a.BIGINT64||(a.BIGINT64=je([32,0])),a.BUFFER||(a.BUFFER=je([32,0]));var s=a.DATA,u=a.BUFFER;function h(t){if(t){var e=De.log2(t.length||t.byteLength);s[e].push(t)}}function f(t){t=De.nextPow2(t);var e=De.log2(t),r=s[e];return r.length>0?r.pop():new ArrayBuffer(t)}function c(t){return new Uint8Array(f(t),0,t)}function g(t){return new Uint16Array(f(2*t),0,t)}function d(t){return new Uint32Array(f(4*t),0,t)}function p(t){return new Int8Array(f(t),0,t)}function _(t){return new Int16Array(f(2*t),0,t)}function A(t){return new Int32Array(f(4*t),0,t)}function E(t){return new Float32Array(f(4*t),0,t)}function y(t){return new Float64Array(f(8*t),0,t)}function m(t){return n?new Uint8ClampedArray(f(t),0,t):c(t)}function v(t){return i?new BigUint64Array(f(8*t),0,t):null}function I(t){return o?new BigInt64Array(f(8*t),0,t):null}function w(t){return new DataView(f(t),0,t)}function T(t){t=De.nextPow2(t);var e=De.log2(t),n=u[e];return n.length>0?n.pop():new r(t)}e.free=function(t){if(r.isBuffer(t))u[De.log2(t.length)].push(t);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(t)&&(t=t.buffer),!t)return;var e=0|De.log2(t.length||t.byteLength);s[e].push(t)}},e.freeUint8=e.freeUint16=e.freeUint32=e.freeBigUint64=e.freeInt8=e.freeInt16=e.freeInt32=e.freeBigInt64=e.freeFloat32=e.freeFloat=e.freeFloat64=e.freeDouble=e.freeUint8Clamped=e.freeDataView=function(t){h(t.buffer)},e.freeArrayBuffer=h,e.freeBuffer=function(t){u[De.log2(t.length)].push(t)},e.malloc=function(t,e){if(void 0===e||"arraybuffer"===e)return f(t);switch(e){case"uint8":return c(t);case"uint16":return g(t);case"uint32":return d(t);case"int8":return p(t);case"int16":return _(t);case"int32":return A(t);case"float":case"float32":return E(t);case"double":case"float64":return y(t);case"uint8_clamped":return m(t);case"bigint64":return I(t);case"biguint64":return v(t);case"buffer":return T(t);case"data":case"dataview":return w(t);default:return null}return null},e.mallocArrayBuffer=f,e.mallocUint8=c,e.mallocUint16=g,e.mallocUint32=d,e.mallocInt8=p,e.mallocInt16=_,e.mallocInt32=A,e.mallocFloat32=e.mallocFloat=E,e.mallocFloat64=e.mallocDouble=y,e.mallocUint8Clamped=m,e.mallocBigUint64=v,e.mallocBigInt64=I,e.mallocDataView=w,e.mallocBuffer=T,e.clearCache=function(){for(var t=0;t<32;++t)a.UINT8[t].length=0,a.UINT16[t].length=0,a.UINT32[t].length=0,a.INT8[t].length=0,a.INT16[t].length=0,a.INT32[t].length=0,a.FLOAT[t].length=0,a.DOUBLE[t].length=0,a.BIGUINT64[t].length=0,a.BIGINT64[t].length=0,a.UINT8C[t].length=0,s[t].length=0,u[t].length=0}}),ur=Tr,hr=null,fr=null,lr=null;function cr(t){hr=[t.LINEAR,t.NEAREST_MIPMAP_LINEAR,t.LINEAR_MIPMAP_NEAREST,t.LINEAR_MIPMAP_NEAREST],fr=[t.NEAREST,t.LINEAR,t.NEAREST_MIPMAP_NEAREST,t.NEAREST_MIPMAP_LINEAR,t.LINEAR_MIPMAP_NEAREST,t.LINEAR_MIPMAP_LINEAR],lr=[t.REPEAT,t.CLAMP_TO_EDGE,t.MIRRORED_REPEAT]}function gr(t){return"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement||"undefined"!=typeof ImageData&&t instanceof ImageData}var dr=function(t,e){fe.muls(t,e,255)};function pr(t,e,r){var n=t.gl,i=n.getParameter(n.MAX_TEXTURE_SIZE);if(e<0||e>i||r<0||r>i)throw new Error("gl-texture2d: Invalid texture size");return t._shape=[e,r],t.bind(),n.texImage2D(n.TEXTURE_2D,0,t.format,e,r,0,t.format,t.type,null),t._mipLevels=[0],t}function _r(t,e,r,n,i,o){this.gl=t,this.handle=e,this.format=i,this.type=o,this._shape=[r,n],this._mipLevels=[0],this._magFilter=t.NEAREST,this._minFilter=t.NEAREST,this._wrapS=t.CLAMP_TO_EDGE,this._wrapT=t.CLAMP_TO_EDGE,this._anisoSamples=1;var a=this,s=[this._wrapS,this._wrapT];Object.defineProperties(s,[{get:function(){return a._wrapS},set:function(t){return a.wrapS=t}},{get:function(){return a._wrapT},set:function(t){return a.wrapT=t}}]),this._wrapVector=s;var u=[this._shape[0],this._shape[1]];Object.defineProperties(u,[{get:function(){return a._shape[0]},set:function(t){return a.width=t}},{get:function(){return a._shape[1]},set:function(t){return a.height=t}}]),this._shapeVector=u}var Ar=_r.prototype;function Er(t,e){return 3===t.length?1===e[2]&&e[1]===t[0]*t[2]&&e[0]===t[2]:1===e[0]&&e[1]===t[0]}function yr(t,e,r,n,i,o,a,s){var u=s.dtype,h=s.shape.slice();if(h.length<2||h.length>3)throw new Error("gl-texture2d: Invalid ndarray, must be 2d or 3d");var f=0,l=0,c=Er(h,s.stride.slice());if("float32"===u?f=t.FLOAT:"float64"===u?(f=t.FLOAT,c=!1,u="float32"):"uint8"===u?f=t.UNSIGNED_BYTE:(f=t.UNSIGNED_BYTE,c=!1,u="uint8"),2===h.length)l=t.LUMINANCE,s=Yt(s.data,h=[h[0],h[1],1],[s.stride[0],s.stride[1],1],s.offset);else{if(3!==h.length)throw new Error("gl-texture2d: Invalid shape for texture");if(1===h[2])l=t.ALPHA;else if(2===h[2])l=t.LUMINANCE_ALPHA;else if(3===h[2])l=t.RGB;else{if(4!==h[2])throw new Error("gl-texture2d: Invalid shape for pixel coords");l=t.RGBA}}if(l!==t.LUMINANCE&&l!==t.ALPHA||i!==t.LUMINANCE&&i!==t.ALPHA||(l=i),l!==i)throw new Error("gl-texture2d: Incompatible texture format for setPixels");var g=s.size,d=a.indexOf(n)<0;if(d&&a.push(n),f===o&&c)0===s.offset&&s.data.length===g?d?t.texImage2D(t.TEXTURE_2D,n,i,h[0],h[1],0,i,o,s.data):t.texSubImage2D(t.TEXTURE_2D,n,e,r,h[0],h[1],i,o,s.data):d?t.texImage2D(t.TEXTURE_2D,n,i,h[0],h[1],0,i,o,s.data.subarray(s.offset,s.offset+g)):t.texSubImage2D(t.TEXTURE_2D,n,e,r,h[0],h[1],i,o,s.data.subarray(s.offset,s.offset+g));else{var p;p=o===t.FLOAT?sr.mallocFloat32(g):sr.mallocUint8(g);var _=Yt(p,h,[h[2],h[2]*h[0],1]);f===t.FLOAT&&o===t.UNSIGNED_BYTE?dr(_,s):fe.assign(_,s),d?t.texImage2D(t.TEXTURE_2D,n,i,h[0],h[1],0,i,o,p.subarray(0,g)):t.texSubImage2D(t.TEXTURE_2D,n,e,r,h[0],h[1],i,o,p.subarray(0,g)),o===t.FLOAT?sr.freeFloat32(p):sr.freeUint8(p)}}function mr(t){var e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e}function vr(t,e,r,n,i){var o=t.getParameter(t.MAX_TEXTURE_SIZE);if(e<0||e>o||r<0||r>o)throw new Error("gl-texture2d: Invalid texture shape");if(i===t.FLOAT&&!t.getExtension("OES_texture_float"))throw new Error("gl-texture2d: Floating point textures not supported on this platform");var a=mr(t);return t.texImage2D(t.TEXTURE_2D,0,n,e,r,0,n,i,null),new _r(t,a,e,r,n,i)}function Ir(t,e,r,n,i,o){var a=mr(t);return t.texImage2D(t.TEXTURE_2D,0,i,i,o,e),new _r(t,a,r,n,i,o)}function wr(t,e){var r=e.dtype,n=e.shape.slice(),i=t.getParameter(t.MAX_TEXTURE_SIZE);if(n[0]<0||n[0]>i||n[1]<0||n[1]>i)throw new Error("gl-texture2d: Invalid texture size");var o=Er(n,e.stride.slice()),a=0;"float32"===r?a=t.FLOAT:"float64"===r?(a=t.FLOAT,o=!1,r="float32"):"uint8"===r?a=t.UNSIGNED_BYTE:(a=t.UNSIGNED_BYTE,o=!1,r="uint8");var s,u,h=0;if(2===n.length)h=t.LUMINANCE,e=Yt(e.data,n=[n[0],n[1],1],[e.stride[0],e.stride[1],1],e.offset);else{if(3!==n.length)throw new Error("gl-texture2d: Invalid shape for texture");if(1===n[2])h=t.ALPHA;else if(2===n[2])h=t.LUMINANCE_ALPHA;else if(3===n[2])h=t.RGB;else{if(4!==n[2])throw new Error("gl-texture2d: Invalid shape for pixel coords");h=t.RGBA}}a!==t.FLOAT||t.getExtension("OES_texture_float")||(a=t.UNSIGNED_BYTE,o=!1);var f=e.size;if(o)s=0===e.offset&&e.data.length===f?e.data:e.data.subarray(e.offset,e.offset+f);else{var l=[n[2],n[2]*n[0],1];u=sr.malloc(f,r);var c=Yt(u,n,l,0);"float32"!==r&&"float64"!==r||a!==t.UNSIGNED_BYTE?fe.assign(c,e):dr(c,e),s=u.subarray(0,f)}var g=mr(t);return t.texImage2D(t.TEXTURE_2D,0,h,n[0],n[1],0,h,a,s),o||sr.free(u),new _r(t,g,n[0],n[1],h,a)}function Tr(t){if(arguments.length<=1)throw new Error("gl-texture2d: Missing arguments for texture2d constructor");if(hr||cr(t),"number"==typeof arguments[1])return vr(t,arguments[1],arguments[2],arguments[3]||t.RGBA,arguments[4]||t.UNSIGNED_BYTE);if(Array.isArray(arguments[1]))return vr(t,0|arguments[1][0],0|arguments[1][1],arguments[2]||t.RGBA,arguments[3]||t.UNSIGNED_BYTE);if("object"==typeof arguments[1]){var e=arguments[1],r=gr(e)?e:e.raw;if(r)return Ir(t,r,0|e.width,0|e.height,arguments[2]||t.RGBA,arguments[3]||t.UNSIGNED_BYTE);if(e.shape&&e.data&&e.stride)return wr(t,e)}throw new Error("gl-texture2d: Invalid arguments for texture2d constructor")}Object.defineProperties(Ar,{minFilter:{get:function(){return this._minFilter},set:function(t){this.bind();var e=this.gl;if(this.type===e.FLOAT&&hr.indexOf(t)>=0&&(e.getExtension("OES_texture_float_linear")||(t=e.NEAREST)),fr.indexOf(t)<0)throw new Error("gl-texture2d: Unknown filter mode "+t);return e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t),this._minFilter=t}},magFilter:{get:function(){return this._magFilter},set:function(t){this.bind();var e=this.gl;if(this.type===e.FLOAT&&hr.indexOf(t)>=0&&(e.getExtension("OES_texture_float_linear")||(t=e.NEAREST)),fr.indexOf(t)<0)throw new Error("gl-texture2d: Unknown filter mode "+t);return e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t),this._magFilter=t}},mipSamples:{get:function(){return this._anisoSamples},set:function(t){var e=this._anisoSamples;if(this._anisoSamples=0|Math.max(t,1),e!==this._anisoSamples){var r=this.gl.getExtension("EXT_texture_filter_anisotropic");r&&this.gl.texParameterf(this.gl.TEXTURE_2D,r.TEXTURE_MAX_ANISOTROPY_EXT,this._anisoSamples)}return this._anisoSamples}},wrapS:{get:function(){return this._wrapS},set:function(t){if(this.bind(),lr.indexOf(t)<0)throw new Error("gl-texture2d: Unknown wrap mode "+t);return this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,t),this._wrapS=t}},wrapT:{get:function(){return this._wrapT},set:function(t){if(this.bind(),lr.indexOf(t)<0)throw new Error("gl-texture2d: Unknown wrap mode "+t);return this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,t),this._wrapT=t}},wrap:{get:function(){return this._wrapVector},set:function(t){if(Array.isArray(t)||(t=[t,t]),2!==t.length)throw new Error("gl-texture2d: Must specify wrap mode for rows and columns");for(var e=0;e<2;++e)if(lr.indexOf(t[e])<0)throw new Error("gl-texture2d: Unknown wrap mode "+t);this._wrapS=t[0],this._wrapT=t[1];var r=this.gl;return this.bind(),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,this._wrapS),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,this._wrapT),t}},shape:{get:function(){return this._shapeVector},set:function(t){if(Array.isArray(t)){if(2!==t.length)throw new Error("gl-texture2d: Invalid texture shape")}else t=[0|t,0|t];return pr(this,0|t[0],0|t[1]),[0|t[0],0|t[1]]}},width:{get:function(){return this._shape[0]},set:function(t){return pr(this,t|=0,this._shape[1]),t}},height:{get:function(){return this._shape[1]},set:function(t){return pr(this,this._shape[0],t|=0),t}}}),Ar.bind=function(t){var e=this.gl;return void 0!==t&&e.activeTexture(e.TEXTURE0+(0|t)),e.bindTexture(e.TEXTURE_2D,this.handle),void 0!==t?0|t:e.getParameter(e.ACTIVE_TEXTURE)-e.TEXTURE0},Ar.dispose=function(){this.gl.deleteTexture(this.handle)},Ar.generateMipmap=function(){this.bind(),this.gl.generateMipmap(this.gl.TEXTURE_2D);for(var t=Math.min(this._shape[0],this._shape[1]),e=0;t>0;++e,t>>>=1)this._mipLevels.indexOf(e)<0&&this._mipLevels.push(e)},Ar.setPixels=function(t,e,r,n){var i=this.gl;this.bind(),Array.isArray(e)?(n=r,r=0|e[1],e=0|e[0]):(e=e||0,r=r||0),n=n||0;var o=gr(t)?t:t.raw;if(o)this._mipLevels.indexOf(n)<0?(i.texImage2D(i.TEXTURE_2D,0,this.format,this.format,this.type,o),this._mipLevels.push(n)):i.texSubImage2D(i.TEXTURE_2D,n,e,r,this.format,this.type,o);else{if(!(t.shape&&t.stride&&t.data))throw new Error("gl-texture2d: Unsupported data type");if(t.shape.length<2||e+t.shape[1]>this._shape[1]>>>n||r+t.shape[0]>this._shape[0]>>>n||e<0||r<0)throw new Error("gl-texture2d: Texture dimensions are out of bounds");yr(i,e,r,n,this.format,this.type,this._mipLevels,t)}};var br=xr;function xr(t,e){for(var r={},n=0;n<t.length;++n)for(var i=t[n].name.split("."),o=r,a=0;a<i.length;++a){var s=i[a].split("[");if(s.length>1){s[0]in o||(o[s[0]]=[]),o=o[s[0]];for(var u=1;u<s.length;++u){var h=parseInt(s[u]);u<s.length-1||a<i.length-1?(h in o||(o[h]=u<s.length-1?[]:{}),o=o[h]):o[h]=e?n:t[n].type}}else a<i.length-1?(s[0]in o||(o[s[0]]={}),o=o[s[0]]):o[s[0]]=e?n:t[n].type}return r}function Cr(t,e,r){this.shortMessage=e||"",this.longMessage=r||"",this.rawError=t||"",this.message="gl-shader: "+(e||t||"")+(r?"\n"+r:""),this.stack=(new Error).stack}(Cr.prototype=new Error).name="GLError",Cr.prototype.constructor=Cr;var Br=Cr,Rr=Ur;function Sr(t){return function(){return t}}function Mr(t,e){for(var r=new Array(t),n=0;n<t;++n)r[n]=e;return r}function Ur(t,e,r,n){function i(e){return function(i){for(var o=function t(e,r){if("object"!=typeof r)return[[e,r]];var n=[];for(var i in r){var o=r[i],a=e;parseInt(i)+""===i?a+="["+i+"]":a+="."+i,"object"==typeof o?n.push.apply(n,t(a,o)):n.push([a,o])}return n}("",e),a=0;a<o.length;++a){var s=o[a],u=s[0],h=s[1];if(n[h]){var f=i;if("string"==typeof u&&(0===u.indexOf(".")||0===u.indexOf("["))){var l=u;if(0===u.indexOf(".")&&(l=u.slice(1)),l.indexOf("]")===l.length-1){var c=l.indexOf("["),g=l.slice(0,c),d=l.slice(c+1,l.length-1);f=g?i[g][d]:i[d]}else f=i[l]}var p,_=r[h].type;switch(_){case"bool":case"int":case"sampler2D":case"samplerCube":t.uniform1i(n[h],f);break;case"float":t.uniform1f(n[h],f);break;default:var A=_.indexOf("vec");if(!(0<=A&&A<=1&&_.length===4+A)){if(0===_.indexOf("mat")&&4===_.length){if((p=_.charCodeAt(_.length-1)-48)<2||p>4)throw new Br("","Invalid uniform dimension type for matrix "+name+": "+_);t["uniformMatrix"+p+"fv"](n[h],!1,f);break}throw new Br("","Unknown uniform data type for "+name+": "+_)}if((p=_.charCodeAt(_.length-1)-48)<2||p>4)throw new Br("","Invalid data type");switch(_.charAt(0)){case"b":case"i":t["uniform"+p+"iv"](n[h],f);break;case"v":t["uniform"+p+"fv"](n[h],f);break;default:throw new Br("","Unrecognized data type for vector "+name+": "+_)}}}}}}function o(t,e,o){if("object"==typeof o){var s=a(o);Object.defineProperty(t,e,{get:Sr(s),set:i(o),enumerable:!0,configurable:!1})}else n[o]?Object.defineProperty(t,e,{get:(u=o,function(t,e,r){return t.getUniform(e.program,r[u])}),set:i(o),enumerable:!0,configurable:!1}):t[e]=function(t){switch(t){case"bool":return!1;case"int":case"sampler2D":case"samplerCube":case"float":return 0;default:var e=t.indexOf("vec");if(0<=e&&e<=1&&t.length===4+e){if((r=t.charCodeAt(t.length-1)-48)<2||r>4)throw new Br("","Invalid data type");return"b"===t.charAt(0)?Mr(r,!1):Mr(r,0)}if(0===t.indexOf("mat")&&4===t.length){var r;if((r=t.charCodeAt(t.length-1)-48)<2||r>4)throw new Br("","Invalid uniform dimension type for matrix "+name+": "+t);return Mr(r*r,0)}throw new Br("","Unknown uniform data type for "+name+": "+t)}}(r[o].type);var u}function a(t){var e;if(Array.isArray(t)){e=new Array(t.length);for(var r=0;r<t.length;++r)o(e,r,t[r])}else for(var n in e={},t)o(e,n,t[n]);return e}var s=br(r,!0);return{get:Sr(a(s)),set:i(s),enumerable:!0,configurable:!0}}var Nr=jr;function Lr(t,e,r,n,i,o){this._gl=t,this._wrapper=e,this._index=r,this._locations=n,this._dimension=i,this._constFunc=o}var Dr=Lr.prototype;Dr.pointer=function(t,e,r,n){var i=this._gl,o=this._locations[this._index];i.vertexAttribPointer(o,this._dimension,t||i.FLOAT,!!e,r||0,n||0),i.enableVertexAttribArray(o)},Dr.set=function(t,e,r,n){return this._constFunc(this._locations[this._index],t,e,r,n)},Object.defineProperty(Dr,"location",{get:function(){return this._locations[this._index]},set:function(t){return t!==this._locations[this._index]&&(this._locations[this._index]=0|t,this._wrapper.program=null),0|t}});var Or=[function(t,e,r){return void 0===r.length?t.vertexAttrib1f(e,r):t.vertexAttrib1fv(e,r)},function(t,e,r,n){return void 0===r.length?t.vertexAttrib2f(e,r,n):t.vertexAttrib2fv(e,r)},function(t,e,r,n,i){return void 0===r.length?t.vertexAttrib3f(e,r,n,i):t.vertexAttrib3fv(e,r)},function(t,e,r,n,i,o){return void 0===r.length?t.vertexAttrib4f(e,r,n,i,o):t.vertexAttrib4fv(e,r)}];function Pr(t,e,r,n,i,o,a){var s=Or[i],u=new Lr(t,e,r,n,i,s);Object.defineProperty(o,a,{set:function(e){return t.disableVertexAttribArray(n[r]),s(t,n[r],e),e},get:function(){return u},enumerable:!0})}function Fr(t,e,r,n,i,o,a){for(var s=new Array(i),u=new Array(i),h=0;h<i;++h)Pr(t,e,r[h],n,i,s,h),u[h]=s[h];Object.defineProperty(s,"location",{set:function(t){if(Array.isArray(t))for(var e=0;e<i;++e)u[e].location=t[e];else for(e=0;e<i;++e)u[e].location=t+e;return t},get:function(){for(var t=new Array(i),e=0;e<i;++e)t[e]=n[r[e]];return t},enumerable:!0}),s.pointer=function(e,o,a,s){e=e||t.FLOAT,o=!!o,a=a||i*i,s=s||0;for(var u=0;u<i;++u){var h=n[r[u]];t.vertexAttribPointer(h,i,e,o,a,s+u*i),t.enableVertexAttribArray(h)}};var f=new Array(i),l=t["vertexAttrib"+i+"fv"];Object.defineProperty(o,a,{set:function(e){for(var o=0;o<i;++o){var a=n[r[o]];if(t.disableVertexAttribArray(a),Array.isArray(e[0]))l.call(t,a,e[o]);else{for(var s=0;s<i;++s)f[s]=e[i*o+s];l.call(t,a,f)}}return e},get:function(){return s},enumerable:!0})}function jr(t,e,r,n){for(var i={},o=0,a=r.length;o<a;++o){var s=r[o],u=s.name,h=s.type,f=s.locations;switch(h){case"bool":case"int":case"float":Pr(t,e,f[0],n,1,i,u);break;default:if(h.indexOf("vec")>=0){if((l=h.charCodeAt(h.length-1)-48)<2||l>4)throw new Br("","Invalid data type for attribute "+u+": "+h);Pr(t,e,f[0],n,l,i,u)}else{if(!(h.indexOf("mat")>=0))throw new Br("","Unknown data type for attribute "+u+": "+h);var l;if((l=h.charCodeAt(h.length-1)-48)<2||l>4)throw new Br("","Invalid data type for attribute "+u+": "+h);Fr(t,e,f,n,l,i,u)}}}return i}var Vr=g(function(t,e){!function(){var t={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function r(t){return i(a(t),arguments)}function n(t,e){return r.apply(null,[t].concat(e||[]))}function i(e,n){var i,o,a,s,u,h,f,l,c,g=1,d=e.length,p="";for(o=0;o<d;o++)if("string"==typeof e[o])p+=e[o];else if("object"==typeof e[o]){if((s=e[o]).keys)for(i=n[g],a=0;a<s.keys.length;a++){if(null==i)throw new Error(r('[sprintf] Cannot access property "%s" of undefined value "%s"',s.keys[a],s.keys[a-1]));i=i[s.keys[a]]}else i=s.param_no?n[s.param_no]:n[g++];if(t.not_type.test(s.type)&&t.not_primitive.test(s.type)&&i instanceof Function&&(i=i()),t.numeric_arg.test(s.type)&&"number"!=typeof i&&isNaN(i))throw new TypeError(r("[sprintf] expecting number but found %T",i));switch(t.number.test(s.type)&&(l=i>=0),s.type){case"b":i=parseInt(i,10).toString(2);break;case"c":i=String.fromCharCode(parseInt(i,10));break;case"d":case"i":i=parseInt(i,10);break;case"j":i=JSON.stringify(i,null,s.width?parseInt(s.width):0);break;case"e":i=s.precision?parseFloat(i).toExponential(s.precision):parseFloat(i).toExponential();break;case"f":i=s.precision?parseFloat(i).toFixed(s.precision):parseFloat(i);break;case"g":i=s.precision?String(Number(i.toPrecision(s.precision))):parseFloat(i);break;case"o":i=(parseInt(i,10)>>>0).toString(8);break;case"s":i=String(i),i=s.precision?i.substring(0,s.precision):i;break;case"t":i=String(!!i),i=s.precision?i.substring(0,s.precision):i;break;case"T":i=Object.prototype.toString.call(i).slice(8,-1).toLowerCase(),i=s.precision?i.substring(0,s.precision):i;break;case"u":i=parseInt(i,10)>>>0;break;case"v":i=i.valueOf(),i=s.precision?i.substring(0,s.precision):i;break;case"x":i=(parseInt(i,10)>>>0).toString(16);break;case"X":i=(parseInt(i,10)>>>0).toString(16).toUpperCase()}t.json.test(s.type)?p+=i:(!t.number.test(s.type)||l&&!s.sign?c="":(c=l?"+":"-",i=i.toString().replace(t.sign,"")),h=s.pad_char?"0"===s.pad_char?"0":s.pad_char.charAt(1):" ",f=s.width-(c+i).length,u=s.width&&f>0?h.repeat(f):"",p+=s.align?c+i+u:"0"===h?c+u+i:u+c+i)}return p}var o=Object.create(null);function a(e){if(o[e])return o[e];for(var r,n=e,i=[],a=0;n;){if(null!==(r=t.text.exec(n)))i.push(r[0]);else if(null!==(r=t.modulo.exec(n)))i.push("%");else{if(null===(r=t.placeholder.exec(n)))throw new SyntaxError("[sprintf] unexpected placeholder");if(r[2]){a|=1;var s=[],u=r[2],h=[];if(null===(h=t.key.exec(u)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(s.push(h[1]);""!==(u=u.substring(h[0].length));)if(null!==(h=t.key_access.exec(u)))s.push(h[1]);else{if(null===(h=t.index_access.exec(u)))throw new SyntaxError("[sprintf] failed to parse named argument key");s.push(h[1])}r[2]=s}else a|=2;if(3===a)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");i.push({placeholder:r[0],param_no:r[1],keys:r[2],sign:r[3],pad_char:r[4],align:r[5],width:r[6],precision:r[7],type:r[8]})}n=n.substring(r[0].length)}return o[e]=i}e.sprintf=r,e.vsprintf=n,"undefined"!=typeof window&&(window.sprintf=r,window.vsprintf=n)}()}),kr={0:"NONE",1:"ONE",2:"LINE_LOOP",3:"LINE_STRIP",4:"TRIANGLES",5:"TRIANGLE_STRIP",6:"TRIANGLE_FAN",256:"DEPTH_BUFFER_BIT",512:"NEVER",513:"LESS",514:"EQUAL",515:"LEQUAL",516:"GREATER",517:"NOTEQUAL",518:"GEQUAL",519:"ALWAYS",768:"SRC_COLOR",769:"ONE_MINUS_SRC_COLOR",770:"SRC_ALPHA",771:"ONE_MINUS_SRC_ALPHA",772:"DST_ALPHA",773:"ONE_MINUS_DST_ALPHA",774:"DST_COLOR",775:"ONE_MINUS_DST_COLOR",776:"SRC_ALPHA_SATURATE",1024:"STENCIL_BUFFER_BIT",1028:"FRONT",1029:"BACK",1032:"FRONT_AND_BACK",1280:"INVALID_ENUM",1281:"INVALID_VALUE",1282:"INVALID_OPERATION",1285:"OUT_OF_MEMORY",1286:"INVALID_FRAMEBUFFER_OPERATION",2304:"CW",2305:"CCW",2849:"LINE_WIDTH",2884:"CULL_FACE",2885:"CULL_FACE_MODE",2886:"FRONT_FACE",2928:"DEPTH_RANGE",2929:"DEPTH_TEST",2930:"DEPTH_WRITEMASK",2931:"DEPTH_CLEAR_VALUE",2932:"DEPTH_FUNC",2960:"STENCIL_TEST",2961:"STENCIL_CLEAR_VALUE",2962:"STENCIL_FUNC",2963:"STENCIL_VALUE_MASK",2964:"STENCIL_FAIL",2965:"STENCIL_PASS_DEPTH_FAIL",2966:"STENCIL_PASS_DEPTH_PASS",2967:"STENCIL_REF",2968:"STENCIL_WRITEMASK",2978:"VIEWPORT",3024:"DITHER",3042:"BLEND",3088:"SCISSOR_BOX",3089:"SCISSOR_TEST",3106:"COLOR_CLEAR_VALUE",3107:"COLOR_WRITEMASK",3317:"UNPACK_ALIGNMENT",3333:"PACK_ALIGNMENT",3379:"MAX_TEXTURE_SIZE",3386:"MAX_VIEWPORT_DIMS",3408:"SUBPIXEL_BITS",3410:"RED_BITS",3411:"GREEN_BITS",3412:"BLUE_BITS",3413:"ALPHA_BITS",3414:"DEPTH_BITS",3415:"STENCIL_BITS",3553:"TEXTURE_2D",4352:"DONT_CARE",4353:"FASTEST",4354:"NICEST",5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5124:"INT",5125:"UNSIGNED_INT",5126:"FLOAT",5386:"INVERT",5890:"TEXTURE",6401:"STENCIL_INDEX",6402:"DEPTH_COMPONENT",6406:"ALPHA",6407:"RGB",6408:"RGBA",6409:"LUMINANCE",6410:"LUMINANCE_ALPHA",7680:"KEEP",7681:"REPLACE",7682:"INCR",7683:"DECR",7936:"VENDOR",7937:"RENDERER",7938:"VERSION",9728:"NEAREST",9729:"LINEAR",9984:"NEAREST_MIPMAP_NEAREST",9985:"LINEAR_MIPMAP_NEAREST",9986:"NEAREST_MIPMAP_LINEAR",9987:"LINEAR_MIPMAP_LINEAR",10240:"TEXTURE_MAG_FILTER",10241:"TEXTURE_MIN_FILTER",10242:"TEXTURE_WRAP_S",10243:"TEXTURE_WRAP_T",10497:"REPEAT",10752:"POLYGON_OFFSET_UNITS",16384:"COLOR_BUFFER_BIT",32769:"CONSTANT_COLOR",32770:"ONE_MINUS_CONSTANT_COLOR",32771:"CONSTANT_ALPHA",32772:"ONE_MINUS_CONSTANT_ALPHA",32773:"BLEND_COLOR",32774:"FUNC_ADD",32777:"BLEND_EQUATION_RGB",32778:"FUNC_SUBTRACT",32779:"FUNC_REVERSE_SUBTRACT",32819:"UNSIGNED_SHORT_4_4_4_4",32820:"UNSIGNED_SHORT_5_5_5_1",32823:"POLYGON_OFFSET_FILL",32824:"POLYGON_OFFSET_FACTOR",32854:"RGBA4",32855:"RGB5_A1",32873:"TEXTURE_BINDING_2D",32926:"SAMPLE_ALPHA_TO_COVERAGE",32928:"SAMPLE_COVERAGE",32936:"SAMPLE_BUFFERS",32937:"SAMPLES",32938:"SAMPLE_COVERAGE_VALUE",32939:"SAMPLE_COVERAGE_INVERT",32968:"BLEND_DST_RGB",32969:"BLEND_SRC_RGB",32970:"BLEND_DST_ALPHA",32971:"BLEND_SRC_ALPHA",33071:"CLAMP_TO_EDGE",33170:"GENERATE_MIPMAP_HINT",33189:"DEPTH_COMPONENT16",33306:"DEPTH_STENCIL_ATTACHMENT",33635:"UNSIGNED_SHORT_5_6_5",33648:"MIRRORED_REPEAT",33901:"ALIASED_POINT_SIZE_RANGE",33902:"ALIASED_LINE_WIDTH_RANGE",33984:"TEXTURE0",33985:"TEXTURE1",33986:"TEXTURE2",33987:"TEXTURE3",33988:"TEXTURE4",33989:"TEXTURE5",33990:"TEXTURE6",33991:"TEXTURE7",33992:"TEXTURE8",33993:"TEXTURE9",33994:"TEXTURE10",33995:"TEXTURE11",33996:"TEXTURE12",33997:"TEXTURE13",33998:"TEXTURE14",33999:"TEXTURE15",34e3:"TEXTURE16",34001:"TEXTURE17",34002:"TEXTURE18",34003:"TEXTURE19",34004:"TEXTURE20",34005:"TEXTURE21",34006:"TEXTURE22",34007:"TEXTURE23",34008:"TEXTURE24",34009:"TEXTURE25",34010:"TEXTURE26",34011:"TEXTURE27",34012:"TEXTURE28",34013:"TEXTURE29",34014:"TEXTURE30",34015:"TEXTURE31",34016:"ACTIVE_TEXTURE",34024:"MAX_RENDERBUFFER_SIZE",34041:"DEPTH_STENCIL",34055:"INCR_WRAP",34056:"DECR_WRAP",34067:"TEXTURE_CUBE_MAP",34068:"TEXTURE_BINDING_CUBE_MAP",34069:"TEXTURE_CUBE_MAP_POSITIVE_X",34070:"TEXTURE_CUBE_MAP_NEGATIVE_X",34071:"TEXTURE_CUBE_MAP_POSITIVE_Y",34072:"TEXTURE_CUBE_MAP_NEGATIVE_Y",34073:"TEXTURE_CUBE_MAP_POSITIVE_Z",34074:"TEXTURE_CUBE_MAP_NEGATIVE_Z",34076:"MAX_CUBE_MAP_TEXTURE_SIZE",34338:"VERTEX_ATTRIB_ARRAY_ENABLED",34339:"VERTEX_ATTRIB_ARRAY_SIZE",34340:"VERTEX_ATTRIB_ARRAY_STRIDE",34341:"VERTEX_ATTRIB_ARRAY_TYPE",34342:"CURRENT_VERTEX_ATTRIB",34373:"VERTEX_ATTRIB_ARRAY_POINTER",34466:"NUM_COMPRESSED_TEXTURE_FORMATS",34467:"COMPRESSED_TEXTURE_FORMATS",34660:"BUFFER_SIZE",34661:"BUFFER_USAGE",34816:"STENCIL_BACK_FUNC",34817:"STENCIL_BACK_FAIL",34818:"STENCIL_BACK_PASS_DEPTH_FAIL",34819:"STENCIL_BACK_PASS_DEPTH_PASS",34877:"BLEND_EQUATION_ALPHA",34921:"MAX_VERTEX_ATTRIBS",34922:"VERTEX_ATTRIB_ARRAY_NORMALIZED",34930:"MAX_TEXTURE_IMAGE_UNITS",34962:"ARRAY_BUFFER",34963:"ELEMENT_ARRAY_BUFFER",34964:"ARRAY_BUFFER_BINDING",34965:"ELEMENT_ARRAY_BUFFER_BINDING",34975:"VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",35040:"STREAM_DRAW",35044:"STATIC_DRAW",35048:"DYNAMIC_DRAW",35632:"FRAGMENT_SHADER",35633:"VERTEX_SHADER",35660:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",35661:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",35663:"SHADER_TYPE",35664:"FLOAT_VEC2",35665:"FLOAT_VEC3",35666:"FLOAT_VEC4",35667:"INT_VEC2",35668:"INT_VEC3",35669:"INT_VEC4",35670:"BOOL",35671:"BOOL_VEC2",35672:"BOOL_VEC3",35673:"BOOL_VEC4",35674:"FLOAT_MAT2",35675:"FLOAT_MAT3",35676:"FLOAT_MAT4",35678:"SAMPLER_2D",35680:"SAMPLER_CUBE",35712:"DELETE_STATUS",35713:"COMPILE_STATUS",35714:"LINK_STATUS",35715:"VALIDATE_STATUS",35716:"INFO_LOG_LENGTH",35717:"ATTACHED_SHADERS",35718:"ACTIVE_UNIFORMS",35719:"ACTIVE_UNIFORM_MAX_LENGTH",35720:"SHADER_SOURCE_LENGTH",35721:"ACTIVE_ATTRIBUTES",35722:"ACTIVE_ATTRIBUTE_MAX_LENGTH",35724:"SHADING_LANGUAGE_VERSION",35725:"CURRENT_PROGRAM",36003:"STENCIL_BACK_REF",36004:"STENCIL_BACK_VALUE_MASK",36005:"STENCIL_BACK_WRITEMASK",36006:"FRAMEBUFFER_BINDING",36007:"RENDERBUFFER_BINDING",36048:"FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",36049:"FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",36050:"FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",36051:"FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",36053:"FRAMEBUFFER_COMPLETE",36054:"FRAMEBUFFER_INCOMPLETE_ATTACHMENT",36055:"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",36057:"FRAMEBUFFER_INCOMPLETE_DIMENSIONS",36061:"FRAMEBUFFER_UNSUPPORTED",36064:"COLOR_ATTACHMENT0",36096:"DEPTH_ATTACHMENT",36128:"STENCIL_ATTACHMENT",36160:"FRAMEBUFFER",36161:"RENDERBUFFER",36162:"RENDERBUFFER_WIDTH",36163:"RENDERBUFFER_HEIGHT",36164:"RENDERBUFFER_INTERNAL_FORMAT",36168:"STENCIL_INDEX8",36176:"RENDERBUFFER_RED_SIZE",36177:"RENDERBUFFER_GREEN_SIZE",36178:"RENDERBUFFER_BLUE_SIZE",36179:"RENDERBUFFER_ALPHA_SIZE",36180:"RENDERBUFFER_DEPTH_SIZE",36181:"RENDERBUFFER_STENCIL_SIZE",36194:"RGB565",36336:"LOW_FLOAT",36337:"MEDIUM_FLOAT",36338:"HIGH_FLOAT",36339:"LOW_INT",36340:"MEDIUM_INT",36341:"HIGH_INT",36346:"SHADER_COMPILER",36347:"MAX_VERTEX_UNIFORM_VECTORS",36348:"MAX_VARYING_VECTORS",36349:"MAX_FRAGMENT_UNIFORM_VECTORS",37440:"UNPACK_FLIP_Y_WEBGL",37441:"UNPACK_PREMULTIPLY_ALPHA_WEBGL",37442:"CONTEXT_LOST_WEBGL",37443:"UNPACK_COLORSPACE_CONVERSION_WEBGL",37444:"BROWSER_DEFAULT_WEBGL"},Qr=function(t){return kr[t]},Xr=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","uint","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"],Gr=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"],Hr=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"],qr=Xr.slice().concat(["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray"]),Yr=Hr,Wr=(Yr=Yr.slice().filter(function(t){return!/^(gl\_|texture)/.test(t)})).concat(["gl_VertexID","gl_InstanceID","gl_Position","gl_PointSize","gl_FragCoord","gl_FrontFacing","gl_FragDepth","gl_PointCoord","gl_MaxVertexAttribs","gl_MaxVertexUniformVectors","gl_MaxVertexOutputVectors","gl_MaxFragmentInputVectors","gl_MaxVertexTextureImageUnits","gl_MaxCombinedTextureImageUnits","gl_MaxTextureImageUnits","gl_MaxFragmentUniformVectors","gl_MaxDrawBuffers","gl_MinProgramTexelOffset","gl_MaxProgramTexelOffset","gl_DepthRangeParameters","gl_DepthRange","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"]),zr=cn,Kr=999,Zr=9999,$r=0,Jr=1,tn=2,en=3,rn=4,nn=5,on=6,an=7,sn=8,un=9,hn=10,fn=11,ln=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function cn(t){var e,r,n,i=0,o=0,a=Kr,s=[],u=[],h=1,f=0,l=0,c=!1,g=!1,d="",p=Hr,_=Xr;"300 es"===(t=t||{}).version&&(p=Wr,_=qr);var A={},E={};for(i=0;i<p.length;i++)A[p[i]]=!0;for(i=0;i<_.length;i++)E[_[i]]=!0;return function(t){return u=[],null!==t?function(t){var r;for(i=0,t.toString&&(t=t.toString()),d+=t.replace(/\r\n/g,"\n"),n=d.length;e=d[i],i<n;){switch(r=i,a){case $r:i=w();break;case Jr:case tn:i=I();break;case en:i=T();break;case rn:i=C();break;case fn:i=x();break;case nn:i=B();break;case Zr:i=R();break;case un:i=v();break;case Kr:i=m()}if(r!==i)switch(d[r]){case"\n":f=0,++h;break;default:++f}}return o+=i,d=d.slice(i),u}(t):(s.length&&y(s.join("")),a=hn,y("(eof)"),u)};function y(t){t.length&&u.push({type:ln[a],data:t,position:l,line:h,column:f})}function m(){return s=s.length?[]:s,"/"===r&&"*"===e?(l=o+i-1,a=$r,r=e,i+1):"/"===r&&"/"===e?(l=o+i-1,a=Jr,r=e,i+1):"#"===e?(a=tn,l=o+i,i):/\s/.test(e)?(a=un,l=o+i,i):(c=/\d/.test(e),g=/[^\w_]/.test(e),l=o+i,a=c?rn:g?en:Zr,i)}function v(){return/[^\s]/g.test(e)?(y(s.join("")),a=Kr,i):(s.push(e),r=e,i+1)}function I(){return"\r"!==e&&"\n"!==e||"\\"===r?(s.push(e),r=e,i+1):(y(s.join("")),a=Kr,i)}function w(){return"/"===e&&"*"===r?(s.push(e),y(s.join("")),a=Kr,i+1):(s.push(e),r=e,i+1)}function T(){if("."===r&&/\d/.test(e))return a=nn,i;if("/"===r&&"*"===e)return a=$r,i;if("/"===r&&"/"===e)return a=Jr,i;if("."===e&&s.length){for(;b(s););return a=nn,i}if(";"===e||")"===e||"("===e){if(s.length)for(;b(s););return y(e),a=Kr,i+1}var t=2===s.length&&"="!==e;if(/[\w_\d\s]/.test(e)||t){for(;b(s););return a=Kr,i}return s.push(e),r=e,i+1}function b(t){for(var e,r,n=0;;){if(e=Gr.indexOf(t.slice(0,t.length+n).join("")),r=Gr[e],-1===e){if(n--+t.length>0)continue;r=t.slice(0,1).join("")}return y(r),l+=r.length,(s=s.slice(r.length)).length}}function x(){return/[^a-fA-F0-9]/.test(e)?(y(s.join("")),a=Kr,i):(s.push(e),r=e,i+1)}function C(){return"."===e||/[eE]/.test(e)?(s.push(e),a=nn,r=e,i+1):"x"===e&&1===s.length&&"0"===s[0]?(a=fn,s.push(e),r=e,i+1):/[^\d]/.test(e)?(y(s.join("")),a=Kr,i):(s.push(e),r=e,i+1)}function B(){return"f"===e&&(s.push(e),r=e,i+=1),/[eE]/.test(e)?(s.push(e),r=e,i+1):("-"!==e&&"+"!==e||!/[eE]/.test(r))&&/[^\d]/.test(e)?(y(s.join("")),a=Kr,i):(s.push(e),r=e,i+1)}function R(){if(/[^\d\w_]/.test(e)){var t=s.join("");return a=E[t]?sn:A[t]?an:on,y(s.join("")),a=Kr,i}return s.push(e),r=e,i+1}}var gn=dn;function dn(t,e){var r=zr(e),n=[];return(n=n.concat(r(t))).concat(r(null))}var pn=function(t){return atob(t)},_n=An;function An(t){for(var e=Array.isArray(t)?t:gn(t),r=0;r<e.length;r++){var n=e[r];if("preprocessor"===n.type){var i=n.data.match(/\#define\s+SHADER_NAME(_B64)?\s+(.+)$/);if(i&&i[2]){var o=i[2];return(i[1]?pn(o):o).trim()}}}}var En,yn="",mn=vn;function vn(t,e){if("string"!=typeof t)throw new TypeError("expected a string");if(1===e)return t;if(2===e)return t+t;var r=t.length*e;if(En!==t||void 0===En)En=t,yn="";else if(yn.length>=r)return yn.substr(0,r);for(;r>yn.length&&e>1;)1&e&&(yn+=t),e>>=1,t+=t;return yn=(yn+=t).substr(0,r)}var In=function(t,e,r){return mn(r=void 0!==r?r+"":" ",e)+t},wn=Tn;function Tn(t,e,r){e="number"==typeof e?e:1,r=r||": ";var n=t.split(/\r?\n/),i=String(n.length+e-1).length;return n.map(function(t,n){var o=n+e,a=String(o).length;return In(o,i-a)+r+t}).join("\n")}var bn=Vr.sprintf,xn=Cn;function Cn(t,e,r){var n=_n(e)||"of unknown name (see npm glsl-shader-name)",i="unknown type";void 0!==r&&(i=r===Qr.FRAGMENT_SHADER?"fragment":"vertex");for(var o=bn("Error compiling %s shader %s:\n",i,n),a=bn("%s%s",o,t),s=t.split("\n"),u={},h=0;h<s.length;h++){var f=s[h];if(""!==f&&"\0"!==f){var l=parseInt(f.split(":")[2]);if(isNaN(l))throw new Error(bn("Could not parse error: %s",f));u[l]=f}}var c=wn(e).split("\n");for(h=0;h<c.length;h++)if((u[h+3]||u[h+2]||u[h+1])&&(o+=c[h]+"\n",u[h+1])){var g=u[h+1];g=g.substr(g.split(":",3).join(":").length+1).trim(),o+=bn("^^^ %s\n\n",g)}return{long:o.trim(),short:a.trim()}}var Bn=Rn;function Rn(t,e){var r={identity:e},n=t.valueOf;return Object.defineProperty(t,"valueOf",{value:function(t){return t!==e?n.apply(this,arguments):r},writable:!0}),r}var Sn=Mn;function Mn(){var t={};return function(e){if(("object"!=typeof e||null===e)&&"function"!=typeof e)throw new Error("Weakmap-shim: Key must be object");var r=e.valueOf(t);return r&&r.identity===t?r:Bn(e,t)}}var Un=Nn;function Nn(){var t=Sn();return{get:function(e,r){var n=t(e);return n.hasOwnProperty("value")?n.value:r},set:function(e,r){return t(e).value=r,this},has:function(e){return"value"in t(e)},delete:function(e){return delete t(e).value}}}var Ln=Hn,Dn=qn,On="undefined"==typeof WeakMap?Un:WeakMap,Pn=new On,Fn=0;function jn(t,e,r,n,i,o,a){this.id=t,this.src=e,this.type=r,this.shader=n,this.count=o,this.programs=[],this.cache=a}function Vn(t){this.gl=t,this.shaders=[{},{}],this.programs={}}jn.prototype.dispose=function(){if(0==--this.count){for(var t=this.cache,e=t.gl,r=this.programs,n=0,i=r.length;n<i;++n){var o=t.programs[r[n]];o&&(delete t.programs[n],e.deleteProgram(o))}e.deleteShader(this.shader),delete t.shaders[this.type===e.FRAGMENT_SHADER|0][this.src]}};var kn=Vn.prototype;function Qn(t,e,r){var n=t.createShader(e);if(t.shaderSource(n,r),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS)){var i=t.getShaderInfoLog(n);try{var o=xn(i,r,e)}catch(t){throw console.warn("Failed to format compiler error: "+t),new Br(i,"Error compiling shader:\n"+i)}throw new Br(i,o.short,o.long)}return n}function Xn(t,e,r,n,i){var o=t.createProgram();t.attachShader(o,e),t.attachShader(o,r);for(var a=0;a<n.length;++a)t.bindAttribLocation(o,i[a],n[a]);if(t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS)){var s=t.getProgramInfoLog(o);throw new Br(s,"Error linking program: "+s)}return o}function Gn(t){var e=Pn.get(t);return e||(e=new Vn(t),Pn.set(t,e)),e}function Hn(t,e,r){return Gn(t).getShaderReference(e,r)}function qn(t,e,r,n,i){return Gn(t).getProgram(e,r,n,i)}kn.getShaderReference=function(t,e){var r=this.gl,n=this.shaders[t===r.FRAGMENT_SHADER|0],i=n[e];if(i&&r.isShader(i.shader))i.count+=1;else{var o=Qn(r,t,e);i=n[e]=new jn(Fn++,e,t,o,[],1,this)}return i},kn.getProgram=function(t,e,r,n){var i=[t.id,e.id,r.join(":"),n.join(":")].join("@"),o=this.programs[i];return o&&this.gl.isProgram(o)||(this.programs[i]=o=Xn(this.gl,t.shader,e.shader,r,n),t.programs.push(i),e.programs.push(i)),o};var Yn={shader:Ln,program:Dn},Wn=Jn,zn=ti,Kn={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube"},Zn=null;function $n(t,e){if(!Zn){var r=Object.keys(Kn);Zn={};for(var n=0;n<r.length;++n){var i=r[n];Zn[t[i]]=Kn[i]}}return Zn[e]}function Jn(t,e){for(var r=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),n=[],i=0;i<r;++i){var o=t.getActiveUniform(e,i);if(o){var a=$n(t,o.type);if(o.size>1)for(var s=0;s<o.size;++s)n.push({name:o.name.replace("[0]","["+s+"]"),type:a});else n.push({name:o.name,type:a})}}return n}function ti(t,e){for(var r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),n=[],i=0;i<r;++i){var o=t.getActiveAttrib(e,i);o&&n.push({name:o.name,type:$n(t,o.type)})}return n}var ei={uniforms:Wn,attributes:zn};function ri(t){this.gl=t,this.gl.lastAttribCount=0,this._vref=this._fref=this._relink=this.vertShader=this.fragShader=this.program=this.attributes=this.uniforms=this.types=null}var ni=ri.prototype;function ii(t,e){return t.name<e.name?-1:1}function oi(t,e,r,n,i){var o=new ri(t);return o.update(e,r,n,i),o}ni.bind=function(){var t;this.program||this._relink();var e=this.gl.getProgramParameter(this.program,this.gl.ACTIVE_ATTRIBUTES),r=this.gl.lastAttribCount;if(e>r)for(t=r;t<e;t++)this.gl.enableVertexAttribArray(t);else if(r>e)for(t=e;t<r;t++)this.gl.disableVertexAttribArray(t);this.gl.lastAttribCount=e,this.gl.useProgram(this.program)},ni.dispose=function(){for(var t=this.gl.lastAttribCount,e=0;e<t;e++)this.gl.disableVertexAttribArray(e);this.gl.lastAttribCount=0,this._fref&&this._fref.dispose(),this._vref&&this._vref.dispose(),this.attributes=this.types=this.vertShader=this.fragShader=this.program=this._relink=this._fref=this._vref=null},ni.update=function(t,e,r,n){if(!e||1===arguments.length){var i=t;t=i.vertex,e=i.fragment,r=i.uniforms,n=i.attributes}var o=this,a=o.gl,s=o._vref;o._vref=Yn.shader(a,a.VERTEX_SHADER,t),s&&s.dispose(),o.vertShader=o._vref.shader;var u=this._fref;if(o._fref=Yn.shader(a,a.FRAGMENT_SHADER,e),u&&u.dispose(),o.fragShader=o._fref.shader,!r||!n){var h=a.createProgram();if(a.attachShader(h,o.fragShader),a.attachShader(h,o.vertShader),a.linkProgram(h),!a.getProgramParameter(h,a.LINK_STATUS)){var f=a.getProgramInfoLog(h);throw new Br(f,"Error linking program:"+f)}r=r||ei.uniforms(a,h),n=n||ei.attributes(a,h),a.deleteProgram(h)}(n=n.slice()).sort(ii);var l,c=[],g=[],d=[];for(l=0;l<n.length;++l){var p=n[l];if(p.type.indexOf("mat")>=0){for(var _=0|p.type.charAt(p.type.length-1),A=new Array(_),E=0;E<_;++E)A[E]=d.length,g.push(p.name+"["+E+"]"),"number"==typeof p.location?d.push(p.location+E):Array.isArray(p.location)&&p.location.length===_&&"number"==typeof p.location[E]?d.push(0|p.location[E]):d.push(-1);c.push({name:p.name,type:p.type,locations:A})}else c.push({name:p.name,type:p.type,locations:[d.length]}),g.push(p.name),d.push("number"==typeof p.location?0|p.location:-1)}var y=0;for(l=0;l<d.length;++l)if(d[l]<0){for(;d.indexOf(y)>=0;)y+=1;d[l]=y}var m=new Array(r.length);function v(){o.program=Yn.program(a,o._vref,o._fref,g,d);for(var t=0;t<r.length;++t)m[t]=a.getUniformLocation(o.program,r[t].name)}v(),o._relink=v,o.types={uniforms:br(r),attributes:br(n)},o.attributes=Nr(a,o,c,d),Object.defineProperty(o,"uniforms",Rr(a,o,r,m))};var ai=oi,si=g(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var r,n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},i=(r=ai)&&r.__esModule?r:{default:r},o="attribute vec2 _p;\nvarying vec2 _uv;\nvoid main() {\ngl_Position = vec4(_p,0.0,1.0);\n_uv = vec2(0.5, 0.5) * (_p+vec2(1.0, 1.0));\n}",a={cover:function(t){return".5+(uv-.5)*vec2(min(ratio/"+t+",1.),min("+t+"/ratio,1.))"},contain:function(t){return".5+(uv-.5)*vec2(max(ratio/"+t+",1.),max("+t+"/ratio,1.))"},stretch:function(){return"uv"}},s=function(t,e){var r=a[e];if(!r)throw new Error("invalid resizeMode="+e);return"precision highp float;varying vec2 _uv;uniform sampler2D from, to;uniform float progress, ratio, _fromR, _toR;vec4 getFromColor(vec2 uv){return texture2D(from,"+r("_fromR")+");}vec4 getToColor(vec2 uv){return texture2D(to,"+r("_toR")+");}\n"+t+"\nvoid main(){gl_FragColor=transition(_uv);}"};e.default=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n({resizeMode:"cover"},r),u=a.resizeMode,h=(0,i.default)(t,o,s(e.glsl,u));return h.bind(),h.attributes._p.pointer(),{draw:function(r,n,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.drawingBufferWidth,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:t.drawingBufferHeight,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};h.bind(),h.uniforms.ratio=o/a,h.uniforms.progress=r,h.uniforms.from=n.bind(0),h.uniforms.to=i.bind(1),h.uniforms._fromR=n.shape[0]/n.shape[1],h.uniforms._toR=i.shape[0]/i.shape[1];var u=2;for(var f in e.paramsTypes){var l=f in s?s[f]:e.defaultParams[f];if("sampler2D"===e.paramsTypes[f])if(l){if("function"!=typeof l.bind)throw new Error("uniform["+f+"]: A gl-texture2d API-like object was expected");h.uniforms[f]=l.bind(u++)}else console.warn("uniform["+f+"]: A texture MUST be defined for uniform sampler2D of a texture");else h.uniforms[f]=l}t.drawArrays(t.TRIANGLES,0,3)},dispose:function(){h.dispose()}}}}),ui=c(si);function hi(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}var fi=hi;function li(t){var e=1.70158;return t*t*((e+1)*t-e)}var ci=li;function gi(t){var e=1.70158;return--t*t*((e+1)*t+e)+1}var di=gi;function pi(t){var e=t*t;return t<4/11?7.5625*e:t<8/11?9.075*e-9.9*t+3.4:t<.9?4356/361*e-35442/1805*t+16061/1805:10.8*t*t-20.52*t+10.72}var _i=pi;function Ai(t){return t<.5?.5*(1-_i(1-2*t)):.5*_i(2*t-1)+.5}var Ei=Ai;function yi(t){return 1-_i(1-t)}var mi=yi;function vi(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}var Ii=vi;function wi(t){return 1-Math.sqrt(1-t*t)}var Ti=wi;function bi(t){return Math.sqrt(1- --t*t)}var xi=bi;function Ci(t){return t<.5?4*t*t*t:.5*Math.pow(2*t-2,3)+1}var Bi=Ci;function Ri(t){return t*t*t}var Si=Ri;function Mi(t){var e=t-1;return e*e*e+1}var Ui=Mi;function Ni(t){return t<.5?.5*Math.sin(13*Math.PI/2*2*t)*Math.pow(2,10*(2*t-1)):.5*Math.sin(-13*Math.PI/2*(2*t-1+1))*Math.pow(2,-10*(2*t-1))+1}var Li=Ni;function Di(t){return Math.sin(13*t*Math.PI/2)*Math.pow(2,10*(t-1))}var Oi=Di;function Pi(t){return Math.sin(-13*(t+1)*Math.PI/2)*Math.pow(2,-10*t)+1}var Fi=Pi;function ji(t){return 0===t||1===t?t:t<.5?.5*Math.pow(2,20*t-10):-.5*Math.pow(2,10-20*t)+1}var Vi=ji;function ki(t){return 0===t?t:Math.pow(2,10*(t-1))}var Qi=ki;function Xi(t){return 1===t?t:1-Math.pow(2,-10*t)}var Gi=Xi;function Hi(t){return t}var qi=Hi;function Yi(t){return(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1)}var Wi=Yi;function zi(t){return t*t}var Ki=zi;function Zi(t){return-t*(t-2)}var $i=Zi;function Ji(t){return t<.5?8*Math.pow(t,4):-8*Math.pow(t-1,4)+1}var to=Ji;function eo(t){return Math.pow(t,4)}var ro=eo;function no(t){return Math.pow(t-1,3)*(1-t)+1}var io=no;function oo(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}var ao=oo;function so(t){return t*t*t*t*t}var uo=so;function ho(t){return--t*t*t*t*t+1}var fo=ho;function lo(t){return-.5*(Math.cos(Math.PI*t)-1)}var co=lo;function go(t){var e=Math.cos(t*Math.PI*.5);return Math.abs(e)<1e-14?1:1-e}var po=go;function _o(t){return Math.sin(t*Math.PI/2)}var Ao=_o,Eo={backInOut:fi,backIn:ci,backOut:di,bounceInOut:Ei,bounceIn:mi,bounceOut:_i,circInOut:Ii,circIn:Ti,circOut:xi,cubicInOut:Bi,cubicIn:Si,cubicOut:Ui,elasticInOut:Li,elasticIn:Oi,elasticOut:Fi,expoInOut:Vi,expoIn:Qi,expoOut:Gi,linear:qi,quadInOut:Wi,quadIn:Ki,quadOut:$i,quartInOut:to,quartIn:ro,quartOut:io,quintInOut:ao,quintIn:uo,quintOut:fo,sineInOut:co,sineIn:po,sineOut:Ao},yo={none:{name:"none",paramsTypes:{},defaultParams:{},glsl:"vec4 transition(vec2 p) {\n return getToColor(p);\n }"},crossfade:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      void main() {\n        vec2 p = gl_FragCoord.xy / resolution.xy;\n        gl_FragColor = mix(texture2D(from, p), texture2D(to, p), progress);\n      }\n    ",uniforms:{}},circleInOut:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      float maxRadius = resolution.x + resolution.y;\n\n      void main() {\n        vec2 p = gl_FragCoord.xy / resolution.xy;\n\n        float distX = gl_FragCoord.x - resolution.x / 2.0;\n        float distY = gl_FragCoord.y - resolution.y / 2.0;\n        float dist = sqrt(distX * distX + distY * distY);\n\n        float step = 2.0 * abs(progress - 0.5);\n        step = step * step * step;\n\n        if (dist < step * maxRadius)\n        {\n          if (progress < 0.5)\n            gl_FragColor = texture2D(from, p);\n          else\n            gl_FragColor = texture2D(to, p);\n        }\n        else\n          gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n      }\n    ",uniforms:{}},splitVertical:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n\n      // General parameters\n      uniform sampler2D from;\n      uniform sampler2D to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      uniform float reflection;\n      uniform float perspective;\n      uniform float depth;\n\n      const vec4 black = vec4(0.0, 0.0, 0.0, 1.0);\n      const vec2 boundMin = vec2(0.0, 0.0);\n      const vec2 boundMax = vec2(1.0, 1.0);\n\n      bool inBounds (vec2 p) {\n        return all(lessThan(boundMin, p)) && all(lessThan(p, boundMax));\n      }\n\n      vec2 project (vec2 p) {\n        return p * vec2(1.0, -1.2) + vec2(0.0, -0.02);\n      }\n\n      vec4 bgColor (vec2 p, vec2 pto) {\n        vec4 c = black;\n        pto = project(pto);\n        if (inBounds(pto)) {\n          c += mix(black, texture2D(to, pto), reflection * mix(1.0, 0.0, pto.y));\n        }\n        return c;\n      }\n\n      void main() {\n        vec2 p = gl_FragCoord.xy / resolution.xy;\n\n        vec2 pfr = vec2(-1.), pto = vec2(-1.);\n\n        float middleSlit = 2.0 * abs(p.x-0.5) - progress;\n        if (middleSlit > 0.0) {\n          pfr = p + (p.x > 0.5 ? -1.0 : 1.0) * vec2(0.5*progress, 0.0);\n          float d = 1.0/(1.0+perspective*progress*(1.0-middleSlit));\n          pfr.y -= d/2.;\n          pfr.y *= d;\n          pfr.y += d/2.;\n        }\n\n        float size = mix(1.0, depth, 1.-progress);\n        pto = (p + vec2(-0.5, -0.5)) * vec2(size, size) + vec2(0.5, 0.5);\n\n        if (inBounds(pfr)) {\n          gl_FragColor = texture2D(from, pfr);\n        }\n        else if (inBounds(pto)) {\n          gl_FragColor = texture2D(to, pto);\n        }\n        else {\n          gl_FragColor = bgColor(p, pto);\n        }\n      }\n    ",uniforms:{reflection:0,perspective:0,depth:1}},slideUp:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      uniform float translateX;\n      uniform float translateY;\n\n      void main() {\n          vec2 texCoord = gl_FragCoord.xy / resolution.xy;\n          float x = progress * translateX;\n          float y = progress * translateY;\n\n          if (x >= 0.0 && y >= 0.0) {\n              if (texCoord.x >= x && texCoord.y >= y) {\n                  gl_FragColor = texture2D(from, texCoord - vec2(x, y));\n              }\n              else {\n                  vec2 uv;\n                  if (x > 0.0)\n                      uv = vec2(x - 1.0, y);\n                  else if (y > 0.0)\n                      uv = vec2(x, y - 1.0);\n                  gl_FragColor = texture2D(to, texCoord - uv);\n              }\n          }\n          else if (x <= 0.0 && y <= 0.0) {\n              if (texCoord.x <= (1.0 + x) && texCoord.y <= (1.0 + y))\n                  gl_FragColor = texture2D(from, texCoord - vec2(x, y));\n              else {\n                  vec2 uv;\n                  if (x < 0.0)\n                      uv = vec2(x + 1.0, y);\n                  else if (y < 0.0)\n                      uv = vec2(x, y + 1.0);\n                  gl_FragColor = texture2D(to, texCoord - uv);\n              }\n          }\n          else\n              gl_FragColor = vec4(0.0);\n      }\n    ",uniforms:{translateX:0,translateY:1}},slideDown:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      uniform float translateX;\n      uniform float translateY;\n\n      void main() {\n          vec2 texCoord = gl_FragCoord.xy / resolution.xy;\n          float x = progress * translateX;\n          float y = progress * translateY;\n\n          if (x >= 0.0 && y >= 0.0) {\n              if (texCoord.x >= x && texCoord.y >= y) {\n                  gl_FragColor = texture2D(from, texCoord - vec2(x, y));\n              }\n              else {\n                  vec2 uv;\n                  if (x > 0.0)\n                      uv = vec2(x - 1.0, y);\n                  else if (y > 0.0)\n                      uv = vec2(x, y - 1.0);\n                  gl_FragColor = texture2D(to, texCoord - uv);\n              }\n          }\n          else if (x <= 0.0 && y <= 0.0) {\n              if (texCoord.x <= (1.0 + x) && texCoord.y <= (1.0 + y))\n                  gl_FragColor = texture2D(from, texCoord - vec2(x, y));\n              else {\n                  vec2 uv;\n                  if (x < 0.0)\n                      uv = vec2(x + 1.0, y);\n                  else if (y < 0.0)\n                      uv = vec2(x, y + 1.0);\n                  gl_FragColor = texture2D(to, texCoord - uv);\n              }\n          }\n          else\n              gl_FragColor = vec4(0.0);\n      }\n    ",uniforms:{translateX:0,translateY:-1}},slideLeft:{name:"slideLeft",paramsTypes:{translateX:"float",translateY:"float"},defaultParams:{translateX:1,translateY:0},glsl:"\n      uniform float power; // = 5.0\n\n      vec4 transition(vec2 p) {\n        vec4 fTex = getFromColor(p);\n        vec4 tTex = getToColor(p);\n\n        float m = step(distance(fTex, tTex), progress);\n\n        return mix(\n          mix(fTex, tTex, m),\n          tTex,\n          pow(progress, power)\n        );\n      }\n    "},slideRight:{shader:"\n      #ifdef GL_ES\n      precision highp float;\n      #endif\n      uniform sampler2D from, to;\n      uniform float progress;\n      uniform vec2 resolution;\n\n      uniform float translateX;\n      uniform float translateY;\n\n      void main() {\n          vec2 texCoord = gl_FragCoord.xy / resolution.xy;\n          float x = progress * translateX;\n          float y = progress * translateY;\n\n          if (x >= 0.0 && y >= 0.0) {\n              if (texCoord.x >= x && texCoord.y >= y) {\n                  gl_FragColor = texture2D(from, texCoord - vec2(x, y));\n              }\n              else {\n                  vec2 uv;\n                  if (x > 0.0)\n                      uv = vec2(x - 1.0, y);\n                  else if (y > 0.0)\n                      uv = vec2(x, y - 1.0);\n                  gl_FragColor = texture2D(to, texCoord - uv);\n              }\n          }\n          else if (x <= 0.0 && y <= 0.0) {\n              if (texCoord.x <= (1.0 + x) && texCoord.y <= (1.0 + y))\n                  gl_FragColor = texture2D(from, texCoord - vec2(x, y));\n              else {\n                  vec2 uv;\n                  if (x < 0.0)\n                      uv = vec2(x + 1.0, y);\n                  else if (y < 0.0)\n                      uv = vec2(x, y + 1.0);\n                  gl_FragColor = texture2D(to, texCoord - uv);\n              }\n          }\n          else\n              gl_FragColor = vec4(0.0);\n      }\n    ",uniforms:{translateX:-1,translateY:0}}},mo="forwards",vo="backwards",Io="random",wo={name:"none",paramsTypes:{},defaultParams:{},glsl:"vec4 transition(vec2 p) {\n return getToColor(p);\n }"};window.HTMLMediaElement&&Object.defineProperty(HTMLMediaElement.prototype,"playing",{get:function(){return!!(this.currentTime>0&&!this.paused&&!this.ended&&this.readyState>2)}});var To=Lt(),bo=function(){function t(t){this.config=_.merge({},{container:"body",slides:[],autoplay:!1,slideDuration:3e3,transitions:yo,transition:{name:"random",duration:2e3,ease:"linear",priority:0}},t),this.container="string"==typeof this.config.container?document.querySelector(this.config.container):this.config.container,this.container.style.display="block",this.container.style.position="absolute",this.container.style.top="0",this.container.style.left="0",this.container.style.width="100%",this.container.style.height="100%",this._slides=this.config.slides,this._currentSlideIndex=0,this._transitionToIndex=0,this._currentSlideRendered=!1,this._transitionProgress=0,this._imageMap={},this._videoMap={},this._slideContentMap={},this._ready=!1,this._destroyed=!1,this._playing=this.config.autoplay,this._width=0,this._height=0,this._regExp={image:/\.(jpe?g|webp|png)$/i,video:/\.(mp4|webm|ogg)$/i},this._createCanvases(),this._resizeHandler=this.resize.bind(this),window.addEventListener("resize",this._resizeHandler),this._lastFrameTime=0,window.requestAnimationFrame(this._animate.bind(this))}var e=t.prototype;return e.goToSlide=function(t,e){this._transitionToIndex=t,this._transitionDirection=e,this._currentSlideRendered=!1,this._autoPlayTimeout&&clearTimeout(this._autoPlayTimeout)},e.nextSlide=function(){this.goToSlide(this._transitionToIndex===this._currentSlideIndex-1||this._transitionToIndex===this._slides.length-1&&0===this._currentSlideIndex?this._currentSlideIndex:this._currentSlideIndex===this._slides.length-1?0:this._currentSlideIndex+1,mo)},e.prevSlide=function(){this.goToSlide(this._transitionToIndex===this._currentSlideIndex+1||0===this._transitionToIndex&&this._currentSlideIndex===this._slides.length-1?this._currentSlideIndex:0===this._currentSlideIndex?this._slides.length-1:this._currentSlideIndex-1,vo)},e.play=function(){this._playing=!0,this.nextSlide()},e.pause=function(){this._playing=!1,this._autoPlayTimeout&&clearTimeout(this._autoPlayTimeout)},e.destroy=function(){var t=this;this._playing=!1,this._destroyed=!0,window.removeEventListener("resize",this._resizeHandler),_.forEach(this._videoMap,function(e){t.container.removeChild(e),e=null}),this._videoMap=null},t._updateCoords=function(t,e,r){var n=t.width/t.height,i=e.width/e.height;if(r&&"fill"===r){if(n<i){var o=e.height*(t.width/e.width);t.y=t.y+.5*(t.height-o),t.height=o}if(n>i){var a=e.width*(t.height/e.height);t.x=t.x+.5*(t.width-a),t.width=a}}else{if(n>i){var s=e.width*(t.height/t.width);e.y=e.y+.5*(e.height-s),e.height=s}if(n<i){var u=e.height*n;e.x=e.x+.5*(e.width-u),e.width=u}}return["x","y","width","height"].forEach(function(r){t[r]=Math.round(t[r]),e[r]=Math.round(e[r])}),{src:t,dst:e}},t._getTile=function(t,e){return{x:t.x,y:t.y,width:e[0]<=1?t.width*e[0]:e[0],height:e[1]<=1?t.height*e[1]:e[1]}},t._drawTiles=function(t,e,r,n){var i,o,a=0,s=0;r&&"fill"===r?(i=Math.ceil(t.height/e.height),o=Math.ceil(t.width/e.width),a=.5*(e.width*o-t.width),s=.5*(e.height*i-t.height)):(i=Math.floor(t.height/e.height),o=Math.floor(t.width/e.width));for(var u=0,h=0,f=i*o,l=0;l<f;l++)n({x:e.x+h*e.width-a,y:e.y+u*e.height-s}),h===o-1&&u++,h=h<o-1?h+1:0},t._getImageData=function(t,e,r,n,i){var o=document.createElement("canvas");o.width=t.naturalWidth,o.height=t.naturalHeight;var a=o.getContext("2d");return a.drawImage(t,0,0,t.naturalWidth,t.naturalHeight),a.getImageData(e,r,n,i).data},t._getVideoData=function(t){var e=document.createElement("canvas");e.width=t.videoWidth,e.height=t.videoHeight;var r=e.getContext("2d");return r.drawImage(t,0,0,t.videoWidth,t.videoHeight),r._getImageData(0,0,t.videoWidth,t.videoHeight).data},e._transitionEnded=function(){},e._videoEnded=function(t,e){var r=this._slides[this._transitionToIndex];if(this._playing&&r.duration&&_.isFunction(r.duration)){var n=r.duration();this._isType(n,"video")&&this.nextSlide()}},e._slideLoaded=function(t,e){},e._slideRendered=function(){var t=this;this._ready||(this._ready=!0,this.container.classList.add("showy--ready"));var e=this._slides[this._transitionToIndex];if(this._playing){var r=this.config.slideDuration;if(e.duration){if(_.isFunction(e.duration)){var n=e.duration();if(this._isType(n,"video"))return}_.isNumber(e.duration)&&(r=e.duration)}this._autoPlayTimeout=setTimeout(function(){t.nextSlide()},r)}},e._animate=function(t){if(!this._destroyed){this._fps=1e3/(t-this._lastFrameTime);try{this._drawSlides(),window.requestAnimationFrame(this._animate.bind(this))}catch(t){console.error(t)}this._lastFrameTime=t}},e._createCanvas=function(){var t=document.createElement("canvas");return t.style.position="absolute",t.style.width="100%",t.style.height="100%",this._resizeCanvas(t),t},e._createCanvases=function(){this._currentCanvas=this._createCanvas(),this._currentContext=this._currentCanvas.getContext("2d"),this._nextCanvas=this._createCanvas(),this._nextContext=this._nextCanvas.getContext("2d"),this._prevCanvas=this._createCanvas(),this._prevContext=this._prevCanvas.getContext("2d"),this._renderCanvas=this._createCanvas(),this._renderContext=this._renderCanvas.getContext("webgl")||this._renderCanvas.getContext("experimental-webgl"),this._renderContext.pixelStorei(this._renderContext.UNPACK_FLIP_Y_WEBGL,!0);var t=this._renderContext.createBuffer();this._renderContext.bindBuffer(this._renderContext.ARRAY_BUFFER,t),this._renderContext.bufferData(this._renderContext.ARRAY_BUFFER,new Float32Array([-1,-1,-1,4,4,-1]),this._renderContext.STATIC_DRAW),this.container.appendChild(this._renderCanvas)},e._resizeCanvas=function(t){this._scale=window.devicePixelRatio,this._width=this.container.clientWidth*this._scale,this._height=this.container.clientHeight*this._scale,t.width=this._width,t.height=this._height},e.resize=function(){this._slideContentMap={},this._resizeCanvas(this._currentCanvas),this._resizeCanvas(this._nextCanvas),this._resizeCanvas(this._prevCanvas),this._resizeCanvas(this._renderCanvas),this._drawSlides(!0)},e._clearContext=function(t){t.clearRect(0,0,this._width,this._height)},e._transitionInProgress=function(){return this._transitionProgress>0&&this._transitionProgress<1},e._getTransition=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var r=_.merge({},this.config.transition,t||{}),n=_.merge({},this.config.transition,e||{});return r.glsl=r.name===Io?_.sample(this.config.transitions):this.config.transitions[r.name],n.glsl=n.name===Io?_.sample(this.config.transitions):this.config.transitions[n.name],r.priority>=n.priority?r:n},e._drawSlides=function(t){var e,r=this._slides[this._currentSlideIndex],n=this._slides[this._currentSlideIndex===this._slides.length-1?0:this._currentSlideIndex+1],i=this._slides[0===this._currentSlideIndex?this._slides.length-1:this._currentSlideIndex-1];if(t&&(r._rendered=!1),r._hasVideo||!r._rendered||this._transitionInProgress()||this._currentSlideIndex!==this._transitionToIndex){if(this._drawSlide(this._currentContext,r),this._drawSlide(this._nextContext,n),this._drawSlide(this._prevContext,i),this._fromTexture&&this._fromTexture.dispose(),this._toTexture&&this._toTexture.dispose(),this._transitionToIndex!==this._currentSlideIndex||this._transitionInProgress()?((this._transitionToIndex!==this._currentSlideIndex&&this._transitionDirection===mo||this._transitionToIndex===this._currentSlideIndex&&this._transitionDirection===vo)&&(this._fromTexture=ur(this._renderContext,this._currentCanvas),this._toTexture=ur(this._renderContext,this._nextCanvas),e=this._getTransition(r.transitionNext,n.transitionPrev)),(this._transitionToIndex!==this._currentSlideIndex&&this._transitionDirection===vo||this._transitionToIndex===this._currentSlideIndex&&this._transitionDirection===mo)&&(this._fromTexture=ur(this._renderContext,this._prevCanvas),this._toTexture=ur(this._renderContext,this._currentCanvas),e=this._getTransition(r.transitionPrev,i.transitionNext))):(this._fromTexture=ur(this._renderContext,this._currentCanvas),this._toTexture=this._fromTexture),!e||this._transitionInProgress()||this._transitionOptions&&this._transitionOptions.name===e.name&&this._transitionOptions.name!==Io||(this._transitionOptions=e,this._transition&&(this._transition.dispose(),this._transition=null)),this._transitionOptions){if(!this._transition){if(!this._transitionOptions.glsl)throw new Error("Missing transition: "+this._transitionOptions.name);this._transition=ui(this._renderContext,this._transitionOptions.glsl)}if(this._transitionToIndex!==this._currentSlideIndex||this._transitionInProgress()){var o=60/this._transitionOptions.duration;this._transitionDirection===mo&&(this._transitionProgress=this._transitionInProgress()?this._transitionProgress+o:o),this._transitionDirection===vo&&(this._transitionProgress=this._transitionInProgress()?this._transitionProgress-o:1-o)}this._transitionProgress>1&&(this._transitionProgress=1),this._transitionProgress<0&&(this._transitionProgress=0);var a=Eo[this._transitionOptions.ease](this._transitionProgress);this._transition.draw(a,this._fromTexture,this._toTexture,this._transitionOptions.glsl.defaultParams)}else this._transition||(this._transition=ui(this._renderContext,wo)),this._transition.draw(1,this._fromTexture,this._toTexture);r._ready&&(r._rendered=!0,this._currentSlideRendered||(this._currentSlideRendered=!0,this._playSlideContent(this._transitionToIndex),this._slideRendered())),this._transitionToIndex===this._currentSlideIndex||this._transitionInProgress()||(this._currentSlideIndex=this._transitionToIndex,this._clearContext(this._currentContext),this._clearContext(this._nextContext),this._clearContext(this._prevContext),this._pauseSlideContent(),this._transitionEnded())}},e._isType=function(t,e){return t.type===e||t[e]||this._regExp[e]&&t.url&&this._regExp[e].test(t.url)||this._regExp[e]&&t.sources&&this._regExp[e].test(t.sources[0].url)},e._drawSlide=function(t,e){var r=this;e._hasVideo=e.content.filter(function(t){return r._isType(t,"video")}).length>0,e._rendered=!1,e._ready=!1,e._loaded||(e._loaded=!1),e.background&&(t.fillStyle=e.background,t.fillRect(0,0,this._width,this._height)),e.content.length&&this._drawSlideContent(t,e,0)},e._drawSlideContent=function(t,e,r){var n=e.content[r];if(!n)return e._ready=!0,void(e._loaded||(e._loaded=!0,this._slideLoaded(e,this._slides.indexOf(e))));var i=this._drawSlideContent.bind(this,t,e,r+1);if(this._isType(n,"video"))this._drawVideo(t,n,i);else if(this._isType(n,"image"))this._drawImage(t,n,i);else{if(!this._isType(n,"text"))throw new Error("Unknown content type");this._drawText(t,n,i)}},e._position2Pixels=function(t,e){var r=this;void 0===e&&(e=1);var n=[];return t.forEach(function(t,i){var o,a=[r._width,r._height,r._width,r._height][i];a/=e,o=t>=0&&t<=1?i<2?t*a:t*a-n[i-2]:i<2?t:a-n[i-2]-Math.abs(t),n.push(o)}),{x:n[0]*e,y:n[1]*e,width:n[2]*e,height:n[3]*e}},e._getImage=function(t,e){var r=this,n="function"==typeof t.url?t.url():t.url;if(this._imageMap[n])e(this._imageMap[n]);else{var i=new Image;i.crossOrigin="Anonymous",i.src=n,i.onerror=function(){throw r.destroy(),new Error("Image failed to load",n)},i.onload=function(){r._imageMap[n]=i,e(i)}}},e._resizeImage=function(e,r,n,i){var o=this,a=JSON.stringify({src:e.src,dst:n});this._slideContentMap[a]?i(this._slideContentMap[a]):To.resizeBuffer({src:t._getImageData(e,r.x,r.y,r.width,r.height),width:r.width,height:r.height,toWidth:n.width,toHeight:n.height,alpha:!1,unsharpAmount:0,unsharpRadius:.5,unsharpThreshold:0}).then(function(t){if(t.length)return o._resizedImageData=new ImageData(new Uint8ClampedArray(t),n.width,n.height),o._slideContentMap[a]=o._resizedImageData,void i(o._slideContentMap[a]);console.error(new Error("Resize failed"),e.src,r,n)},function(t){console.error(t)})},e._drawText=function(t,e,r){var n=this._position2Pixels(e.position,this._scale);t.font=e.font||"72px sans-serif",t.textAlign=e.align||"center",t.fillStyle=e.color||"rgba(0, 0, 0, 1)",t.fillText(e.text,n.x,n.y,e.maxWidth?e.maxWidth*this._width:void 0),r()},e._drawImage=function(e,r,n){var i=this;this._getImage(r,function(o){var a={x:0,y:0,width:o.naturalWidth,height:o.naturalHeight},s=i._position2Pixels(r.position,i._scale);if(r.tile){var u=t._getTile(s,r.tile.size),h=t._updateCoords(a,u,r.tile.scaleMode);i._resizeImage(o,h.src,h.dst,function(i){t._drawTiles(s,h.dst,r.scaleMode,function(t){e.putImageData(i,t.x,t.y)}),n()})}else{var f=t._updateCoords(a,s,r.scaleMode);i._resizeImage(o,a=f.src,s=f.dst,function(t){e.putImageData(t,s.x,s.y),n()})}})},e._getVideo=function(t,e){var r=this;void 0===e&&(e=function(){});var n="function"==typeof t.url?t.url():t.url,i="function"==typeof t.sources?t.sources():t.sources,o=JSON.stringify(n||i);if(this._videoMap[o])return e(this._videoMap[o]),this._videoMap[o];var a=document.createElement("video");return a.style.display="none",a.crossOrigin="anonymous",a.muted=!0,this.container.appendChild(a),i?(i.forEach(function(t){var e=document.createElement("source");e.src=t.url,t.type&&(e.type=t.type),e.crossOrigin="anonymous",a.appendChild(e)}),n&&(a.poster=n)):n&&(a.src=n),this._videoMap[o]=a,a.addEventListener("loadedmetadata",function(){e(a)}),a._playCount=0,a.addEventListener("ended",function(){a.play(),a._playCount+=1,r._videoEnded(a,t)}),a},e._drawVideo=function(e,r,n){var i=this;this._getVideo(r,function(o){if(0!==o.videoWidth&&0!==o.videoHeight){var a={x:0,y:0,width:o.videoWidth,height:o.videoHeight},s=i._position2Pixels(r.position,i._scale);if(r.tile){var u=t._getTile(s,r.tile.size),h=t._updateCoords(a,u,r.tile.scaleMode);return t._drawTiles(s,h.dst,r.scaleMode,function(t){e.drawImage(o,a.x,a.y,a.width,a.height,t.x,t.y,u.width,u.height)}),void n()}var f=t._updateCoords(a,s,r.scaleMode);e.drawImage(o,(a=f.src).x,a.y,a.width,a.height,(s=f.dst).x,s.y,s.width,s.height),n()}})},e._playSlideContent=function(t){var e=this;this._slides[t].content.forEach(function(t){e._isType(t,"video")&&e._getVideo(t,function(t){t._playCount=0,t.currentTime=0,t.play()})})},e._pauseSlideContent=function(){var t=this,e=[];this._slides[this._currentSlideIndex].content.forEach(function(r){t._isType(r,"video")&&e.push(t._getVideo(r))}),this._slides.forEach(function(r,n){n!==t._currentSlideIndex&&r.content.forEach(function(r){t._isType(r,"video")&&t._getVideo(r,function(t){-1===e.indexOf(t)&&(t._playCount=0,t.currentTime=0,t.pause())})})})},t}();return bo});
//# sourceMappingURL=showy.umd.js.map
